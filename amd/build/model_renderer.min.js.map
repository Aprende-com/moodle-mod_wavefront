{"version":3,"sources":["../src/model_renderer.js"],"names":["camera","controls","scene","renderer","stage_width","stage_height","lighting","ambient","keyLight","fillLight","backLight","windowHalfX","window","innerWidth","windowHalfY","innerHeight","animate","requestAnimationFrame","render","update","init","stage","obj_file","mtl_file","baseurl","width","height","cameraangle","camerafar","camerax","cameray","cameraz","container","document","getElementById","WebGL","isWebGLAvailable","warning","getWebGLErrorMessage","appendChild","THREE","Scene","SCREEN_WIDTH","SCREEN_HEIGHT","PerspectiveCamera","add","position","set","AmbientLight","DirectionalLight","Color","normalize","mtlLoader","MTLLoader","load","materials","preload","objLoader","OBJLoader","setMaterials","object","WebGLRenderer","setPixelRatio","devicePixelRatio","setSize","setClearColor","domElement","OrbitControls","enableDamping","dampingFactor","addEventListener","e","stopPropagation","code","intensity","remove"],"mappings":"sjBA4BA,uDACA,O,yiBAKIA,CAAAA,C,CAAQC,C,CAAUC,C,CAAOC,C,CAGzBC,C,CAAaC,C,CACbC,C,CAAUC,C,CAASC,C,CAAUC,C,CAAWC,C,CAExCC,CAAW,CAAGC,MAAM,CAACC,UAAP,CAAoB,C,CAClCC,CAAW,CAAGF,MAAM,CAACG,WAAP,CAAqB,C,CAEjCC,CAAO,CAAG,UAAM,CACpBC,qBAAqB,CAACD,CAAD,CAArB,CACGb,CAAQ,CAACe,MAAT,CAAgBhB,CAAhB,CAAuBF,CAAvB,EACHC,CAAQ,CAACkB,MAAT,EACD,C,CAEYC,CAAI,CAAG,SAACC,CAAD,CAAQC,CAAR,CAAkBC,CAAlB,CAA4BC,CAA5B,CAAqCC,CAArC,CAA4CC,CAA5C,CAAoDC,CAApD,CAAiEC,CAAjE,CAA4EC,CAA5E,CAAqFC,CAArF,CAA8FC,CAA9F,CAA0G,CAE1H,GAAIC,CAAAA,CAAS,CAAGC,QAAQ,CAACC,cAAT,CAAwBb,CAAxB,CAAhB,CAEH,GAAI,CAACc,UAAMC,gBAAN,EAAL,CAAgC,CAE5B,GAAMC,CAAAA,CAAO,CAAGF,UAAMG,oBAAN,EAAhB,CACHL,QAAQ,CAACC,cAAT,CAAyB,WAAzB,EAAuCK,WAAvC,CAAoDF,CAApD,EACG,QACH,CAGDjC,CAAW,CAAGqB,CAAd,CACApB,CAAY,CAAGqB,CAAf,CAGAxB,CAAK,CAAG,GAAIsC,CAAAA,CAAK,CAACC,KAAlB,CAhB6H,GAmBzHC,CAAAA,CAAY,CAAGtC,CAnB0G,CAmB7FuC,CAAa,CAAGtC,CAnB6E,CAqB7HL,CAAM,CAAG,GAAIwC,CAAAA,CAAK,CAACI,iBAAV,EADejB,CACf,CADsCe,CAAY,CAAGC,CACrD,CAD2E,EAC3E,EAD6Ff,CAC7F,CAAT,CACA1B,CAAK,CAAC2C,GAAN,CAAU7C,CAAV,EACAA,CAAM,CAAC8C,QAAP,CAAgBC,GAAhB,EAA2BlB,CAA3B,EAA2CC,CAA3C,EAA2DC,CAA3D,EAEAxB,CAAO,CAAG,GAAIiC,CAAAA,CAAK,CAACQ,YAAV,CAAuB,QAAvB,CAAiC,CAAjC,CAAV,CACA9C,CAAK,CAAC2C,GAAN,CAAUtC,CAAV,EAEAC,CAAQ,CAAG,GAAIgC,CAAAA,CAAK,CAACS,gBAAV,CAA2B,GAAIT,CAAAA,CAAK,CAACU,KAAV,CAAgB,oBAAhB,CAA3B,CAAkE,CAAlE,CAAX,CACA1C,CAAQ,CAACsC,QAAT,CAAkBC,GAAlB,CAAsB,CAAC,GAAvB,CAA4B,CAA5B,CAA+B,GAA/B,EAEAtC,CAAS,CAAG,GAAI+B,CAAAA,CAAK,CAACS,gBAAV,CAA2B,GAAIT,CAAAA,CAAK,CAACU,KAAV,CAAgB,qBAAhB,CAA3B,CAAmE,GAAnE,CAAZ,CACAzC,CAAS,CAACqC,QAAV,CAAmBC,GAAnB,CAAuB,GAAvB,CAA4B,CAA5B,CAA+B,GAA/B,EAEArC,CAAS,CAAG,GAAI8B,CAAAA,CAAK,CAACS,gBAAV,CAA2B,QAA3B,CAAqC,CAArC,CAAZ,CACAvC,CAAS,CAACoC,QAAV,CAAmBC,GAAnB,CAAuB,GAAvB,CAA4B,CAA5B,CAA+B,CAAC,GAAhC,EAAqCI,SAArC,GAEAjD,CAAK,CAAC2C,GAAN,CAAUrC,CAAV,EACAN,CAAK,CAAC2C,GAAN,CAAUpC,CAAV,EACAP,CAAK,CAAC2C,GAAN,CAAUnC,CAAV,EAGA,GAAI0C,CAAAA,CAAS,CAAG,GAAIC,YAApB,CACGD,CAAS,CAACE,IAAV,CAAe/B,CAAf,CAAyB,SAACgC,CAAD,CAAe,CAEpCA,CAAS,CAACC,OAAV,GAEA,GAAIC,CAAAA,CAAS,CAAG,GAAIC,YAApB,CACAD,CAAS,CAACE,YAAV,CAAuBJ,CAAvB,EACAE,CAAS,CAACH,IAAV,CAAehC,CAAf,CAAyB,SAAUsC,CAAV,CAAkB,CACvC1D,CAAK,CAAC2C,GAAN,CAAUe,CAAV,CACH,CAFD,CAGH,CATD,EAcAzD,CAAQ,CAAG,GAAIqC,CAAAA,CAAK,CAACqB,aAArB,CACA1D,CAAQ,CAAC2D,aAAT,CAAuBlD,MAAM,CAACmD,gBAA9B,EACA5D,CAAQ,CAAC6D,OAAT,CAAiB5D,CAAjB,CAA8BC,CAA9B,EACAF,CAAQ,CAAC8D,aAAT,CAAuB,GAAIzB,CAAAA,CAAK,CAACU,KAAV,CAAgB,iBAAhB,CAAvB,EAEAlB,CAAS,CAACO,WAAV,CAAsBpC,CAAQ,CAAC+D,UAA/B,EAIAjE,CAAQ,CAAG,GAAIkE,gBAAJ,CAAkBnE,CAAlB,CAA0BG,CAAQ,CAAC+D,UAAnC,CAAX,CACAjE,CAAQ,CAACmE,aAAT,IACAnE,CAAQ,CAACoE,aAAT,CAAyB,GAAzB,CAIAzD,MAAM,CAAC0D,gBAAP,CAAwB,SAAxB,CAAmC,SAAUC,CAAV,CAAa,CAC/CA,CAAC,CAACC,eAAF,GACA,GAAe,MAAX,GAAAD,CAAC,CAACE,IAAN,CAAuB,CAChBnE,CAAQ,CAAG,CAACA,CAAZ,CACA,GAAIA,CAAJ,CAAc,CACVC,CAAO,CAACmE,SAAR,CAAoB,GAApB,CACAxE,CAAK,CAAC2C,GAAN,CAAUrC,CAAV,EACAN,CAAK,CAAC2C,GAAN,CAAUpC,CAAV,EACAP,CAAK,CAAC2C,GAAN,CAAUnC,CAAV,CACH,CALD,IAKO,CACHH,CAAO,CAACmE,SAAR,CAAoB,CAApB,CACAxE,CAAK,CAACyE,MAAN,CAAanE,CAAb,EACAN,CAAK,CAACyE,MAAN,CAAalE,CAAb,EACAP,CAAK,CAACyE,MAAN,CAAajE,CAAb,CACH,CACJ,CACJ,CAhBD,KAoBAM,CAAO,EACV,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Encapsules the behavior for creating a Wavefront 3D model in Moodle.\n *\n * Manages the UI while operations are occuring, including rendering and manipulating the model.\n *\n * @module     mod_wavefront/model_renderer\n * @class      model_renderer\n * @package    mod_wavefront\n * @copyright  2022 Ian Wild\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.9\n */\n\nimport WebGL from 'mod_wavefront/WebGL';\nimport * as THREE from 'mod_wavefront/three';\nimport { MTLLoader } from 'mod_wavefront/MTLLoader';\nimport { OBJLoader } from 'mod_wavefront/OBJLoader';\nimport { OrbitControls } from 'mod_wavefront/OrbitControls';\n\nlet camera, controls, scene, renderer;\n\nvar wavefront_stage;\nvar stage_width, stage_height; \nvar lighting, ambient, keyLight, fillLight, backLight;\n\nvar windowHalfX = window.innerWidth / 2;\nvar windowHalfY = window.innerHeight / 2;\n\nconst animate = () => {\n\t requestAnimationFrame(animate);\n     renderer.render(scene, camera);\n\t controls.update();\n}\n\nexport const init = (stage, obj_file, mtl_file, baseurl, width, height, cameraangle, camerafar, camerax, cameray, cameraz) => {\n    \n    var container = document.getElementById(stage);\n        \t        \t\n\tif (!WebGL.isWebGLAvailable() ) {\n\t\t\n\t    const warning = WebGL.getWebGLErrorMessage();\n\t\tdocument.getElementById( 'container' ).appendChild( warning );\n\t    return true;\n\t}\n\t\t\t\n\twavefront_stage = stage;\n\tstage_width = width;\n\tstage_height = height;\n\t\t\n\t// Scene\n\tscene = new THREE.Scene();\n\t\n\t// Camera\n\tvar SCREEN_WIDTH = stage_width, SCREEN_HEIGHT = stage_height;\n\tvar VIEW_ANGLE = Number(cameraangle), ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1, FAR = Number(camerafar);\n\tcamera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);\n\tscene.add(camera);\n\tcamera.position.set(Number(camerax),Number(cameray),Number(cameraz));\t\n\t\n\tambient = new THREE.AmbientLight(0xffffff, 1.0);\t\n\tscene.add(ambient);\n\t// Lighting\n\tkeyLight = new THREE.DirectionalLight(new THREE.Color('hsl(30, 100%, 75%)'), 1.0);\n\tkeyLight.position.set(-100, 0, 100);\n\n\tfillLight = new THREE.DirectionalLight(new THREE.Color('hsl(240, 100%, 75%)'), 0.75);\n\tfillLight.position.set(100, 0, 100);\n\n\tbackLight = new THREE.DirectionalLight(0xffffff, 1.0);\n\tbackLight.position.set(100, 0, -100).normalize();\n\n\tscene.add(keyLight);\n\tscene.add(fillLight);\n\tscene.add(backLight);\n\t\n\t/* Load model */\n\tvar mtlLoader = new MTLLoader();\n    mtlLoader.load(mtl_file, (materials) => {\n\n        materials.preload();\n\n        var objLoader = new OBJLoader();\n        objLoader.setMaterials(materials);\n        objLoader.load(obj_file, function (object) {\n            scene.add(object);\n        });\n    });\n\n\n    /* Renderer */\n    \n    renderer = new THREE.WebGLRenderer();\n    renderer.setPixelRatio(window.devicePixelRatio);\n    renderer.setSize(stage_width, stage_height);\n    renderer.setClearColor(new THREE.Color(\"hsl(0, 0%, 10%)\"));\n\n    container.appendChild(renderer.domElement);\n\n    /* Controls */\n\n    controls = new OrbitControls(camera, renderer.domElement);\n    controls.enableDamping = true;\n    controls.dampingFactor = 0.25;\n          \n    /* Events */\n  \n    window.addEventListener('keydown', function (e) {\n    \te.stopPropagation();\n    \tif (e.code === 'KeyL') {\n            lighting = !lighting;\n            if (lighting) {\n                ambient.intensity = 0.25;\n                scene.add(keyLight);\n                scene.add(fillLight);\n                scene.add(backLight);\n            } else {\n                ambient.intensity = 1.0;\n                scene.remove(keyLight);\n                scene.remove(fillLight);\n                scene.remove(backLight);\n            }\n        }\t\n    }, false);\n\n    /* Start animation */\n            \n    animate();\n};"],"file":"model_renderer.min.js"}