function asyncGeneratorStep(e,t,a,r,i,n,o){try{var s=e[n](o),l=s.value}catch(e){a(e);return}if(s.done){t(l)}else{Promise.resolve(l).then(r,i)}}function _asyncToGenerator(e){return function(){var t=this,a=arguments;return new Promise(function(r,i){var s=e.apply(t,a);function n(e){asyncGeneratorStep(s,r,i,n,o,"next",e)}function o(e){asyncGeneratorStep(s,r,i,n,o,"throw",e)}n(void 0)})}}function _defineProperty(e,t,a){if(t in e){Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0})}else{e[t]=a}return e}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,a=function(){};return{s:a,n:function n(){if(t>=e.length)return{done:!0};return{done:!1,value:e[t++]}},e:function e(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,n=!0,s=!1,l;return{s:function s(){r=e[Symbol.iterator]()},n:function n(){var e=r.next();n=e.done;return e},e:function e(e){s=!0;l=e},f:function f(){try{if(!n&&null!=r.return)r.return()}finally{if(s)throw l}}}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if("Object"===a&&e.constructor)a=e.constructor.name;if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(e,t)}function _arrayLikeToArray(e,t){if(null==t||t>e.length)t=e.length;for(var a=0,r=Array(t);a<t;a++){r[a]=e[a]}return r}function _iterableToArrayLimit(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,i=!1,n=void 0;try{for(var o=e[Symbol.iterator](),s;!(r=(s=o.next()).done);r=!0){a.push(s.value);if(t&&a.length===t)break}}catch(e){i=!0;n=e}finally{try{if(!r&&null!=o["return"])o["return"]()}finally{if(i)throw n}}return a}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _get(e,t,a){if("undefined"!=typeof Reflect&&Reflect.get){_get=Reflect.get}else{_get=function(e,t,a){var r=_superPropBase(e,t);if(!r)return;var i=Object.getOwnPropertyDescriptor(r,t);if(i.get){return i.get.call(a)}return i.value}}return _get(e,t,a||e)}function _superPropBase(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=_getPrototypeOf(e);if(null===e)break}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});if(t)_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){_setPrototypeOf=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e};return _setPrototypeOf(e,t)}function _createSuper(e){return function(){var t=_getPrototypeOf(e),a;if(_isNativeReflectConstruct()){var r=_getPrototypeOf(this).constructor;a=Reflect.construct(t,arguments,r)}else{a=t.apply(this,arguments)}return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t)){return t}return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return!0}catch(t){return!1}}function _getPrototypeOf(e){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)};return _getPrototypeOf(e)}function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(e,t){for(var a=0,r;a<t.length;a++){r=t[a];r.enumerable=r.enumerable||!1;r.configurable=!0;if("value"in r)r.writable=!0;Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){if(t)_defineProperties(e.prototype,t);if(a)_defineProperties(e,a);return e}function _typeof(e){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}(function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define ("mod_wavefront/three",["exports"],t):(e="undefined"!=typeof globalThis?globalThis:e||self,t(e.THREE={}))})(this,function(e){'use strict';for(var Pa="137",Ia={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Da={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Na=0,Ua=1,Fa=2,Ba=3,Oa=0,za=1,Ha=2,Ga=3,Va=0,Wa=1,ja=2,Xa=1,qa=2,Ya=0,Za=1,Ja=2,Ka=3,Qa=4,$a=5,er=100,tr=101,ar=102,rr=103,ir=104,nr=200,or=201,sr=202,lr=203,dr=204,ur=205,pr=206,cr=207,mr=208,gr=209,fr=210,hr=0,yr=1,vr=2,_r=3,xr=4,br=5,Er=6,Sr=7,Tr=0,Mr=1,Ar=2,Rr=0,wr=1,Lr=2,Cr=3,kr=4,Pr=5,Ir=300,Dr=301,Nr=302,Ur=303,Fr=304,Br=306,Or=307,zr=1e3,Hr=1001,Gr=1002,Vr=1003,Wr=1004,jr=1004,Xr=1005,qr=1005,Yr=1006,Zr=1007,Jr=1007,Kr=1008,Qr=1008,$r=1009,ei=1010,ti=1011,ai=1012,ri=1013,ii=1014,ni=1015,oi=1016,si=1017,li=1018,di=1020,ui=1021,pi=1022,ci=1023,mi=1024,gi=1025,fi=1026,hi=1027,yi=1028,vi=1029,_i=1030,xi=1031,bi=1033,Ei=33776,Si=33777,Ti=33778,Mi=33779,Ai=35840,Ri=35841,wi=35842,Li=35843,Ci=36196,ki=37492,Pi=37496,Ii=37808,Di=37809,Ni=37810,Ui=37811,Fi=37812,Bi=37813,Oi=37814,zi=37815,Hi=37816,Gi=37817,Vi=37818,Wi=37819,ji=37820,Xi=37821,qi=36492,Yi=2200,Zi=2201,Ji=2202,Ki=2300,Qi=2301,$i=2302,en=2400,tn=2401,an=2402,rn=2500,nn=2501,on=0,sn=1,ln=2,dn=3e3,un=3001,pn=3200,cn=3201,mn=0,gn=1,fn=0,hn=7680,yn=7681,vn=7682,_n=7683,xn=34055,bn=34056,En=5386,Sn=512,Tn=513,Mn=514,An=515,Rn=516,wn=517,Ln=518,Cn=519,kn=35044,Pn=35048,In=35040,Dn=35045,Nn=35049,Un=35041,Fn=35046,Bn=35050,On=35042,zn="100",Hn="300 es",Gn=1035,Vn=function(){function e(){_classCallCheck(this,e)}_createClass(e,[{key:"addEventListener",value:function addEventListener(e,t){if(this._listeners===void 0)this._listeners={};var a=this._listeners;if(a[e]===void 0){a[e]=[]}if(-1===a[e].indexOf(t)){a[e].push(t)}}},{key:"hasEventListener",value:function hasEventListener(e,t){if(this._listeners===void 0)return!1;var a=this._listeners;return a[e]!==void 0&&-1!==a[e].indexOf(t)}},{key:"removeEventListener",value:function removeEventListener(e,t){if(this._listeners===void 0)return;var a=this._listeners,r=a[e];if(r!==void 0){var i=r.indexOf(t);if(-1!==i){r.splice(i,1)}}}},{key:"dispatchEvent",value:function dispatchEvent(e){if(this._listeners===void 0)return;var t=this._listeners,a=t[e.type];if(a!==void 0){e.target=this;for(var r=a.slice(0),n=0,o=r.length;n<o;n++){r[n].call(this,e)}e.target=null}}}]);return e}(),Wn=[],jn=0;256>jn;jn++){Wn[jn]=(16>jn?"0":"")+jn.toString(16)}var Xn=1234567,qn=Math.PI/180,Yn=180/Math.PI;function t(){var e=0|4294967295*Math.random(),t=0|4294967295*Math.random(),a=0|4294967295*Math.random(),r=0|4294967295*Math.random(),i=Wn[255&e]+Wn[255&e>>8]+Wn[255&e>>16]+Wn[255&e>>24]+"-"+Wn[255&t]+Wn[255&t>>8]+"-"+Wn[64|15&t>>16]+Wn[255&t>>24]+"-"+Wn[128|63&a]+Wn[255&a>>8]+"-"+Wn[255&a>>16]+Wn[255&a>>24]+Wn[255&r]+Wn[255&r>>8]+Wn[255&r>>16]+Wn[255&r>>24];return i.toUpperCase()}function a(e,t,a){return Math.max(t,Math.min(a,e))}function r(e,t){return(e%t+t)%t}function n(e,a,r){return(1-r)*e+r*a}function o(e){if(e!==void 0)Xn=e%2147483647;Xn=16807*Xn%2147483647;return(Xn-1)/2147483646}function s(e){return 0==(e&e-1)&&0!==e}function l(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function d(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Zn=Object.freeze({__proto__:null,DEG2RAD:qn,RAD2DEG:Yn,generateUUID:t,clamp:a,euclideanModulo:r,mapLinear:function(e,t,a,r,i){return r+(e-t)*(i-r)/(a-t)},inverseLerp:function(e,t,a){if(e!==t){return(a-e)/(t-e)}else{return 0}},lerp:n,damp:function(e,t,a,r){return n(e,t,1-Math.exp(-a*r))},pingpong:function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;return t-Math.abs(r(e,2*t)-t)},smoothstep:function(e,t,a){if(e<=t)return 0;if(e>=a)return 1;e=(e-t)/(a-t);return e*e*(3-2*e)},smootherstep:function(e,t,a){if(e<=t)return 0;if(e>=a)return 1;e=(e-t)/(a-t);return e*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:o,degToRad:function(e){return e*qn},radToDeg:function(e){return e*Yn},isPowerOfTwo:s,ceilPowerOfTwo:l,floorPowerOfTwo:d,setQuaternionFromProperEuler:function(e,t,a,r,i){var n=Math.cos,o=Math.sin,s=n(a/2),l=o(a/2),d=n((t+r)/2),u=o((t+r)/2),p=n((t-r)/2),c=o((t-r)/2),m=n((r-t)/2),g=o((r-t)/2);switch(i){case"XYX":e.set(s*u,l*p,l*c,s*d);break;case"YZY":e.set(l*c,s*u,l*p,s*d);break;case"ZXZ":e.set(l*p,l*c,s*u,s*d);break;case"XZX":e.set(s*u,l*g,l*m,s*d);break;case"YXY":e.set(l*m,s*u,l*g,s*d);break;case"ZYZ":e.set(l*g,l*m,s*u,s*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i);}}}),Jn=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck(this,e);this.x=t;this.y=a}_createClass(e,[{key:"set",value:function set(e,t){this.x=e;this.y=t;return this}},{key:"setScalar",value:function setScalar(e){this.x=e;this.y=e;return this}},{key:"setX",value:function setX(e){this.x=e;return this}},{key:"setY",value:function setY(e){this.y=e;return this}},{key:"setComponent",value:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e);}return this}},{key:"getComponent",value:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function copy(e){this.x=e.x;this.y=e.y;return this}},{key:"add",value:function add(e,t){if(t!==void 0){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this}},{key:"addScalar",value:function addScalar(e){this.x+=e;this.y+=e;return this}},{key:"addVectors",value:function addVectors(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this}},{key:"addScaledVector",value:function addScaledVector(e,t){this.x+=e.x*t;this.y+=e.y*t;return this}},{key:"sub",value:function sub(e,t){if(t!==void 0){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this}},{key:"subScalar",value:function subScalar(e){this.x-=e;this.y-=e;return this}},{key:"subVectors",value:function subVectors(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this}},{key:"multiply",value:function multiply(e){this.x*=e.x;this.y*=e.y;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.x*=e;this.y*=e;return this}},{key:"divide",value:function divide(e){this.x/=e.x;this.y/=e.y;return this}},{key:"divideScalar",value:function divideScalar(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function applyMatrix3(t){var a=this.x,r=this.y,i=t.elements;this.x=i[0]*a+i[3]*r+i[6];this.y=i[1]*a+i[4]*r+i[7];return this}},{key:"min",value:function min(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);return this}},{key:"max",value:function max(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);return this}},{key:"clamp",value:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));return this}},{key:"clampScalar",value:function clampScalar(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));return this}},{key:"clampLength",value:function clampLength(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}},{key:"floor",value:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this}},{key:"ceil",value:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this}},{key:"round",value:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this}},{key:"roundToZero",value:function roundToZero(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this}},{key:"negate",value:function negate(){this.x=-this.x;this.y=-this.y;return this}},{key:"dot",value:function dot(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function cross(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function distanceToSquared(e){var t=this.x-e.x,a=this.y-e.y;return t*t+a*a}},{key:"manhattanDistanceTo",value:function manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function setLength(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this}},{key:"lerpVectors",value:function lerpVectors(e,t,a){this.x=e.x+(t.x-e.x)*a;this.y=e.y+(t.y-e.y)*a;return this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.x=e[t];this.y=e[t+1];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.x;e[t+1]=this.y;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t,a){if(a!==void 0){console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);return this}},{key:"rotateAround",value:function rotateAround(e,t){var a=Math.cos(t),r=Math.sin(t),i=this.x-e.x,n=this.y-e.y;this.x=i*a-n*r+e.x;this.y=i*r+n*a+e.y;return this}},{key:"random",value:function random(){this.x=Math.random();this.y=Math.random();return this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:e.next=2;return this.x;case 2:e.next=4;return this.y;case 4:case"end":return e.stop();}}},value,this)})},{key:"width",get:function get(){return this.x},set:function set(e){this.x=e}},{key:"height",get:function get(){return this.y},set:function set(e){this.y=e}}]);return e}();Jn.prototype.isVector2=!0;var Kn=function(){function e(){_classCallCheck(this,e);this.elements=[1,0,0,0,1,0,0,0,1];if(0<arguments.length){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}}_createClass(e,[{key:"set",value:function set(e,t,a,r,i,n,o,s,l){var d=this.elements;d[0]=e;d[1]=r;d[2]=o;d[3]=t;d[4]=i;d[5]=s;d[6]=a;d[7]=n;d[8]=l;return this}},{key:"identity",value:function identity(){this.set(1,0,0,0,1,0,0,0,1);return this}},{key:"copy",value:function copy(e){var t=this.elements,a=e.elements;t[0]=a[0];t[1]=a[1];t[2]=a[2];t[3]=a[3];t[4]=a[4];t[5]=a[5];t[6]=a[6];t[7]=a[7];t[8]=a[8];return this}},{key:"extractBasis",value:function extractBasis(e,t,a){e.setFromMatrix3Column(this,0);t.setFromMatrix3Column(this,1);a.setFromMatrix3Column(this,2);return this}},{key:"setFromMatrix4",value:function setFromMatrix4(e){var t=e.elements;this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]);return this}},{key:"multiply",value:function multiply(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function premultiply(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function multiplyMatrices(e,t){var a=e.elements,r=t.elements,i=this.elements,n=a[0],o=a[3],s=a[6],l=a[1],d=a[4],u=a[7],p=a[2],c=a[5],m=a[8],g=r[0],f=r[3],h=r[6],y=r[1],v=r[4],_=r[7],x=r[2],b=r[5],E=r[8];i[0]=n*g+o*y+s*x;i[3]=n*f+o*v+s*b;i[6]=n*h+o*_+s*E;i[1]=l*g+d*y+u*x;i[4]=l*f+d*v+u*b;i[7]=l*h+d*_+u*E;i[2]=p*g+c*y+m*x;i[5]=p*f+c*v+m*b;i[8]=p*h+c*_+m*E;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this}},{key:"determinant",value:function determinant(){var t=this.elements,r=t[0],a=t[1],n=t[2],o=t[3],s=t[4],e=t[5],l=t[6],d=t[7],u=t[8];return r*s*u-r*e*d-a*o*u+a*e*l+n*o*d-n*s*l}},{key:"invert",value:function invert(){var e=this.elements,t=e[0],a=e[1],r=e[2],i=e[3],n=e[4],o=e[5],s=e[6],l=e[7],d=e[8],u=d*n-o*l,p=o*s-d*i,c=l*i-n*s,m=t*u+a*p+r*c;if(0==m)return this.set(0,0,0,0,0,0,0,0,0);var g=1/m;e[0]=u*g;e[1]=(r*l-d*a)*g;e[2]=(o*a-r*n)*g;e[3]=p*g;e[4]=(d*t-r*s)*g;e[5]=(r*i-o*t)*g;e[6]=c*g;e[7]=(a*s-l*t)*g;e[8]=(n*t-a*i)*g;return this}},{key:"transpose",value:function transpose(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this}},{key:"getNormalMatrix",value:function getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function transposeIntoArray(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this}},{key:"setUvTransform",value:function setUvTransform(e,t,a,r,i,n,o){var l=Math.cos(i),d=Math.sin(i);this.set(a*l,a*d,-a*(l*n+d*o)+n+e,-r*d,r*l,-r*(-d*n+l*o)+o+t,0,0,1);return this}},{key:"scale",value:function scale(e,t){var a=this.elements;a[0]*=e;a[3]*=e;a[6]*=e;a[1]*=t;a[4]*=t;a[7]*=t;return this}},{key:"rotate",value:function rotate(e){var t=Math.cos(e),a=Math.sin(e),r=this.elements,i=r[0],n=r[3],o=r[6],s=r[1],l=r[4],d=r[7];r[0]=t*i+a*s;r[3]=t*n+a*l;r[6]=t*o+a*d;r[1]=-a*i+t*s;r[4]=-a*n+t*l;r[7]=-a*o+t*d;return this}},{key:"translate",value:function translate(e,t){var a=this.elements;a[0]+=e*a[2];a[3]+=e*a[5];a[6]+=e*a[8];a[1]+=t*a[2];a[4]+=t*a[5];a[7]+=t*a[8];return this}},{key:"equals",value:function(e){for(var t=this.elements,a=e.elements,r=0;9>r;r++){if(t[r]!==a[r])return!1}return!0}},{key:"fromArray",value:function fromArray(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=0;9>a;a++){this.elements[a]=e[a+t]}return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.elements;e[t]=a[0];e[t+1]=a[1];e[t+2]=a[2];e[t+3]=a[3];e[t+4]=a[4];e[t+5]=a[5];e[t+6]=a[6];e[t+7]=a[7];e[t+8]=a[8];return e}},{key:"clone",value:function clone(){return new this.constructor().fromArray(this.elements)}}]);return e}();Kn.prototype.isMatrix3=!0;function u(e){for(var t=e.length-1;0<=t;--t){if(65535<e[t])return!0}return!1}var Qn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function p(e,t){return new Qn[e](t)}function c(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}var $n={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},eo={h:0,s:0,l:0},to={h:0,s:0,l:0};function m(e,a,r){if(0>r)r+=1;if(1<r)r-=1;if(r<1/6)return e+6*(a-e)*r;if(r<1/2)return a;if(r<2/3)return e+6*(a-e)*(2/3-r);return e}function g(e){return .04045>e?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function f(e){return .0031308>e?12.92*e:1.055*Math.pow(e,.41666)-.055}var ao=function(){function e(t,a,r){_classCallCheck(this,e);if(a===void 0&&r===void 0){return this.set(t)}return this.setRGB(t,a,r)}_createClass(e,[{key:"set",value:function set(e){if(e&&e.isColor){this.copy(e)}else if("number"==typeof e){this.setHex(e)}else if("string"==typeof e){this.setStyle(e)}return this}},{key:"setScalar",value:function setScalar(e){this.r=e;this.g=e;this.b=e;return this}},{key:"setHex",value:function setHex(e){e=Math.floor(e);this.r=(255&e>>16)/255;this.g=(255&e>>8)/255;this.b=(255&e)/255;return this}},{key:"setRGB",value:function setRGB(e,t,a){this.r=e;this.g=t;this.b=a;return this}},{key:"setHSL",value:function setHSL(e,t,i){e=r(e,1);t=a(t,0,1);i=a(i,0,1);if(0===t){this.r=this.g=this.b=i}else{var n=.5>=i?i*(1+t):i+t-i*t,o=2*i-n;this.r=m(o,n,e+1/3);this.g=m(o,n,e);this.b=m(o,n,e-1/3)}return this}},{key:"setStyle",value:function setStyle(e){function t(t){if(t===void 0)return;if(1>parseFloat(t)){console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}}var a;if(a=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var r,i=a[1],n=a[2];switch(i){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){this.r=Math.min(255,parseInt(r[1],10))/255;this.g=Math.min(255,parseInt(r[2],10))/255;this.b=Math.min(255,parseInt(r[3],10))/255;t(r[4]);return this}if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){this.r=Math.min(100,parseInt(r[1],10))/100;this.g=Math.min(100,parseInt(r[2],10))/100;this.b=Math.min(100,parseInt(r[3],10))/100;t(r[4]);return this}break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){var o=parseFloat(r[1])/360,d=parseInt(r[2],10)/100,s=parseInt(r[3],10)/100;t(r[4]);return this.setHSL(o,d,s)}break;}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){var l=a[1],u=l.length;if(3===u){this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255;this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255;this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255;return this}else if(6===u){this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255;this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255;this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255;return this}}if(e&&0<e.length){return this.setColorName(e)}return this}},{key:"setColorName",value:function setColorName(e){var t=$n[e.toLowerCase()];if(t!==void 0){this.setHex(t)}else{console.warn("THREE.Color: Unknown color "+e)}return this}},{key:"clone",value:function clone(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function copy(e){this.r=e.r;this.g=e.g;this.b=e.b;return this}},{key:"copySRGBToLinear",value:function copySRGBToLinear(e){this.r=g(e.r);this.g=g(e.g);this.b=g(e.b);return this}},{key:"copyLinearToSRGB",value:function copyLinearToSRGB(e){this.r=f(e.r);this.g=f(e.g);this.b=f(e.b);return this}},{key:"convertSRGBToLinear",value:function convertSRGBToLinear(){this.copySRGBToLinear(this);return this}},{key:"convertLinearToSRGB",value:function convertLinearToSRGB(){this.copyLinearToSRGB(this);return this}},{key:"getHex",value:function getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function getHSL(e){var t=this.r,a=this.g,r=this.b,i=Math.max(t,a,r),n=Math.min(t,a,r),o,s,l=(n+i)/2;if(n===i){o=0;s=0}else{var d=i-n;s=.5>=l?d/(i+n):d/(2-i-n);switch(i){case t:o=(a-r)/d+(a<r?6:0);break;case a:o=(r-t)/d+2;break;case r:o=(t-a)/d+4;break;}o/=6}e.h=o;e.s=s;e.l=l;return e}},{key:"getStyle",value:function getStyle(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"}},{key:"offsetHSL",value:function offsetHSL(e,t,a){this.getHSL(eo);eo.h+=e;eo.s+=t;eo.l+=a;this.setHSL(eo.h,eo.s,eo.l);return this}},{key:"add",value:function add(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this}},{key:"addColors",value:function addColors(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this}},{key:"addScalar",value:function addScalar(e){this.r+=e;this.g+=e;this.b+=e;return this}},{key:"sub",value:function sub(e){this.r=Math.max(0,this.r-e.r);this.g=Math.max(0,this.g-e.g);this.b=Math.max(0,this.b-e.b);return this}},{key:"multiply",value:function multiply(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.r*=e;this.g*=e;this.b*=e;return this}},{key:"lerp",value:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this}},{key:"lerpColors",value:function lerpColors(e,t,a){this.r=e.r+(t.r-e.r)*a;this.g=e.g+(t.g-e.g)*a;this.b=e.b+(t.b-e.b)*a;return this}},{key:"lerpHSL",value:function lerpHSL(e,t){this.getHSL(eo);e.getHSL(to);var a=n(eo.h,to.h,t),r=n(eo.s,to.s,t),i=n(eo.l,to.l,t);this.setHSL(a,r,i);return this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.r=e[t];this.g=e[t+1];this.b=e[t+2];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.r;e[t+1]=this.g;e[t+2]=this.b;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t){this.r=e.getX(t);this.g=e.getY(t);this.b=e.getZ(t);if(!0===e.normalized){this.r/=255;this.g/=255;this.b/=255}return this}},{key:"toJSON",value:function toJSON(){return this.getHex()}}]);return e}();ao.NAMES=$n;ao.prototype.isColor=!0;ao.prototype.r=1;ao.prototype.g=1;ao.prototype.b=1;var ro,io=function(){function e(){_classCallCheck(this,e)}_createClass(e,null,[{key:"getDataURL",value:function getDataURL(e){if(/^data:/i.test(e.src)){return e.src}if("undefined"==typeof HTMLCanvasElement){return e.src}var t;if(e instanceof HTMLCanvasElement){t=e}else{if(ro===void 0)ro=c("canvas");ro.width=e.width;ro.height=e.height;var a=ro.getContext("2d");if(e instanceof ImageData){a.putImageData(e,0,0)}else{a.drawImage(e,0,0,e.width,e.height)}t=ro}if(2048<t.width||2048<t.height){console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e);return t.toDataURL("image/jpeg",.6)}else{return t.toDataURL("image/png")}}},{key:"sRGBToLinear",value:function sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=c("canvas");o.width=e.width;o.height=e.height;var s=o.getContext("2d");s.drawImage(e,0,0,e.width,e.height);for(var t=s.getImageData(0,0,e.width,e.height),a=t.data,r=0;r<a.length;r++){a[r]=255*g(a[r]/255)}s.putImageData(t,0,0);return o}else if(e.data){for(var i=e.data.slice(0),n=0;n<i.length;n++){if(i instanceof Uint8Array||i instanceof Uint8ClampedArray){i[n]=Math.floor(255*g(i[n]/255))}else{i[n]=g(i[n])}}return{data:i,width:e.width,height:e.height}}else{console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied.");return e}}}]);return e}(),no=0,oo=function(e){_inherits(a,e);var r=_createSuper(a);function a(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:a.DEFAULT_IMAGE,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:a.DEFAULT_MAPPING,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Hr,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:Hr,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:Yr,d=5<arguments.length&&arguments[5]!==void 0?arguments[5]:Kr,u=6<arguments.length&&arguments[6]!==void 0?arguments[6]:ci,p=7<arguments.length&&arguments[7]!==void 0?arguments[7]:$r,c=8<arguments.length&&arguments[8]!==void 0?arguments[8]:1,m=9<arguments.length&&arguments[9]!==void 0?arguments[9]:dn;_classCallCheck(this,a);e=r.call(this);Object.defineProperty(_assertThisInitialized(e),"id",{value:no++});e.uuid=t();e.name="";e.image=i;e.mipmaps=[];e.mapping=n;e.wrapS=o;e.wrapT=s;e.magFilter=l;e.minFilter=d;e.anisotropy=c;e.format=u;e.internalFormat=null;e.type=p;e.offset=new Jn(0,0);e.repeat=new Jn(1,1);e.center=new Jn(0,0);e.rotation=0;e.matrixAutoUpdate=!0;e.matrix=new Kn;e.generateMipmaps=!0;e.premultiplyAlpha=!1;e.flipY=!0;e.unpackAlignment=4;e.encoding=m;e.userData={};e.version=0;e.onUpdate=null;e.isRenderTargetTexture=!1;e.needsPMREMUpdate=!1;return e}_createClass(a,[{key:"updateMatrix",value:function updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.name=e.name;this.image=e.image;this.mipmaps=e.mipmaps.slice(0);this.mapping=e.mapping;this.wrapS=e.wrapS;this.wrapT=e.wrapT;this.magFilter=e.magFilter;this.minFilter=e.minFilter;this.anisotropy=e.anisotropy;this.format=e.format;this.internalFormat=e.internalFormat;this.type=e.type;this.offset.copy(e.offset);this.repeat.copy(e.repeat);this.center.copy(e.center);this.rotation=e.rotation;this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrix.copy(e.matrix);this.generateMipmaps=e.generateMipmaps;this.premultiplyAlpha=e.premultiplyAlpha;this.flipY=e.flipY;this.unpackAlignment=e.unpackAlignment;this.encoding=e.encoding;this.userData=JSON.parse(JSON.stringify(e.userData));return this}},{key:"toJSON",value:function toJSON(e){var a=e===void 0||"string"==typeof e;if(!a&&e.textures[this.uuid]!==void 0){return e.textures[this.uuid]}var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var i=this.image;if(i.uuid===void 0){i.uuid=t()}if(!a&&e.images[i.uuid]===void 0){var n;if(Array.isArray(i)){n=[];for(var o=0,s=i.length;o<s;o++){if(i[o].isDataTexture){n.push(h(i[o].image))}else{n.push(h(i[o]))}}}else{n=h(i)}e.images[i.uuid]={uuid:i.uuid,url:n}}r.image=i.uuid}if("{}"!==JSON.stringify(this.userData))r.userData=this.userData;if(!a){e.textures[this.uuid]=r}return r}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function transformUv(e){if(this.mapping!==Ir)return e;e.applyMatrix3(this.matrix);if(0>e.x||1<e.x){switch(this.wrapS){case zr:e.x=e.x-Math.floor(e.x);break;case Hr:e.x=0>e.x?0:1;break;case Gr:if(1===Math.abs(Math.floor(e.x)%2)){e.x=Math.ceil(e.x)-e.x}else{e.x=e.x-Math.floor(e.x)}break;}}if(0>e.y||1<e.y){switch(this.wrapT){case zr:e.y=e.y-Math.floor(e.y);break;case Hr:e.y=0>e.y?0:1;break;case Gr:if(1===Math.abs(Math.floor(e.y)%2)){e.y=Math.ceil(e.y)-e.y}else{e.y=e.y-Math.floor(e.y)}break;}}if(this.flipY){e.y=1-e.y}return e}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return a}(Vn);oo.DEFAULT_IMAGE=void 0;oo.DEFAULT_MAPPING=Ir;oo.prototype.isTexture=!0;function h(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){return io.getDataURL(e)}else{if(e.data){return{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}}else{console.warn("THREE.Texture: Unable to serialize Texture.");return{}}}}var so=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck(this,e);this.x=t;this.y=a;this.z=r;this.w=i}_createClass(e,[{key:"set",value:function set(e,t,a,r){this.x=e;this.y=t;this.z=a;this.w=r;return this}},{key:"setScalar",value:function setScalar(e){this.x=e;this.y=e;this.z=e;this.w=e;return this}},{key:"setX",value:function setX(e){this.x=e;return this}},{key:"setY",value:function setY(e){this.y=e;return this}},{key:"setZ",value:function setZ(e){this.z=e;return this}},{key:"setW",value:function setW(e){this.w=e;return this}},{key:"setComponent",value:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e);}return this}},{key:"getComponent",value:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function copy(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==void 0?e.w:1;return this}},{key:"add",value:function add(e,t){if(t!==void 0){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this}},{key:"addScalar",value:function addScalar(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this}},{key:"addVectors",value:function addVectors(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this}},{key:"addScaledVector",value:function addScaledVector(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;this.w+=e.w*t;return this}},{key:"sub",value:function sub(e,t){if(t!==void 0){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this}},{key:"subScalar",value:function subScalar(e){this.x-=e;this.y-=e;this.z-=e;this.w-=e;return this}},{key:"subVectors",value:function subVectors(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this}},{key:"multiply",value:function multiply(e){this.x*=e.x;this.y*=e.y;this.z*=e.z;this.w*=e.w;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this}},{key:"applyMatrix4",value:function applyMatrix4(t){var a=this.x,r=this.y,i=this.z,n=this.w,o=t.elements;this.x=o[0]*a+o[4]*r+o[8]*i+o[12]*n;this.y=o[1]*a+o[5]*r+o[9]*i+o[13]*n;this.z=o[2]*a+o[6]*r+o[10]*i+o[14]*n;this.w=o[3]*a+o[7]*r+o[11]*i+o[15]*n;return this}},{key:"divideScalar",value:function divideScalar(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(1e-4>t){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this}},{key:"setAxisAngleFromRotationMatrix",value:function setAxisAngleFromRotationMatrix(e){var t,a,r,i,n=.01,o=.1,l=e.elements,d=l[0],u=l[4],p=l[8],c=l[1],m=l[5],g=l[9],f=l[2],h=l[6],v=l[10];if(Math.abs(u-c)<n&&Math.abs(p-f)<n&&Math.abs(g-h)<n){if(Math.abs(u+c)<o&&Math.abs(p+f)<o&&Math.abs(g+h)<o&&Math.abs(d+m+v-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var _=(d+1)/2,b=(m+1)/2,E=(v+1)/2,S=(u+c)/4,T=(p+f)/4,M=(g+h)/4;if(_>b&&_>E){if(_<n){a=0;r=.707106781;i=.707106781}else{a=Math.sqrt(_);r=S/a;i=T/a}}else if(b>E){if(b<n){a=.707106781;r=0;i=.707106781}else{r=Math.sqrt(b);a=S/r;i=M/r}}else{if(E<n){a=.707106781;r=.707106781;i=0}else{i=Math.sqrt(E);a=T/i;r=M/i}}this.set(a,r,i,t);return this}var A=Math.sqrt((h-g)*(h-g)+(p-f)*(p-f)+(c-u)*(c-u));if(.001>Math.abs(A))A=1;this.x=(h-g)/A;this.y=(p-f)/A;this.z=(c-u)/A;this.w=Math.acos((d+m+v-1)/2);return this}},{key:"min",value:function min(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);this.w=Math.min(this.w,e.w);return this}},{key:"max",value:function max(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);this.w=Math.max(this.w,e.w);return this}},{key:"clamp",value:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));this.w=Math.max(e.w,Math.min(t.w,this.w));return this}},{key:"clampScalar",value:function clampScalar(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));this.z=Math.max(e,Math.min(t,this.z));this.w=Math.max(e,Math.min(t,this.w));return this}},{key:"clampLength",value:function clampLength(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}},{key:"floor",value:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this}},{key:"ceil",value:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this}},{key:"round",value:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this}},{key:"roundToZero",value:function roundToZero(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this}},{key:"negate",value:function negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this}},{key:"dot",value:function dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function setLength(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this}},{key:"lerpVectors",value:function lerpVectors(e,t,a){this.x=e.x+(t.x-e.x)*a;this.y=e.y+(t.y-e.y)*a;this.z=e.z+(t.z-e.z)*a;this.w=e.w+(t.w-e.w)*a;return this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t,a){if(a!==void 0){console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);this.z=e.getZ(t);this.w=e.getW(t);return this}},{key:"random",value:function random(){this.x=Math.random();this.y=Math.random();this.z=Math.random();this.w=Math.random();return this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:e.next=2;return this.x;case 2:e.next=4;return this.y;case 4:e.next=6;return this.z;case 6:e.next=8;return this.w;case 8:case"end":return e.stop();}}},value,this)})},{key:"width",get:function get(){return this.z},set:function set(e){this.z=e}},{key:"height",get:function get(){return this.w},set:function set(e){this.w=e}}]);return e}();so.prototype.isVector4=!0;var lo=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};_classCallCheck(this,t);i=a.call(this);i.width=e;i.height=r;i.depth=1;i.scissor=new so(0,0,e,r);i.scissorTest=!1;i.viewport=new so(0,0,e,r);i.texture=new oo(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding);i.texture.isRenderTargetTexture=!0;i.texture.image={width:e,height:r,depth:1};i.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1;i.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null;i.texture.minFilter=n.minFilter!==void 0?n.minFilter:Yr;i.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0;i.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1;i.depthTexture=n.depthTexture!==void 0?n.depthTexture:null;return i}_createClass(t,[{key:"setTexture",value:function setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth};this.texture=e}},{key:"setSize",value:function setSize(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==a){this.width=e;this.height=t;this.depth=a;this.texture.image.width=e;this.texture.image.height=t;this.texture.image.depth=a;this.dispose()}this.viewport.set(0,0,e,t);this.scissor.set(0,0,e,t)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.width=e.width;this.height=e.height;this.depth=e.depth;this.viewport.copy(e.viewport);this.texture=e.texture.clone();this.texture.image=Object.assign({},e.texture.image);this.depthBuffer=e.depthBuffer;this.stencilBuffer=e.stencilBuffer;this.depthTexture=e.depthTexture;return this}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}}]);return t}(Vn);lo.prototype.isWebGLRenderTarget=!0;var uo=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck(this,t);n=a.call(this,e,r);var o=n.texture;n.texture=[];for(var s=0;s<i;s++){n.texture[s]=o.clone()}return n}_createClass(t,[{key:"setSize",value:function setSize(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==a){this.width=e;this.height=t;this.depth=a;for(var r=0,i=this.texture.length;r<i;r++){this.texture[r].image.width=e;this.texture[r].image.height=t;this.texture[r].image.depth=a}this.dispose()}this.viewport.set(0,0,e,t);this.scissor.set(0,0,e,t);return this}},{key:"copy",value:function copy(e){this.dispose();this.width=e.width;this.height=e.height;this.depth=e.depth;this.viewport.set(0,0,this.width,this.height);this.scissor.set(0,0,this.width,this.height);this.depthBuffer=e.depthBuffer;this.stencilBuffer=e.stencilBuffer;this.depthTexture=e.depthTexture;this.texture.length=0;for(var t=0,a=e.texture.length;t<a;t++){this.texture[t]=e.texture[t].clone()}return this}}]);return t}(lo);uo.prototype.isWebGLMultipleRenderTargets=!0;var po=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};_classCallCheck(this,t);i=a.call(this,e,r,n);i.samples=4;i.ignoreDepthForMultisampleCopy=n.ignoreDepth!==void 0?n.ignoreDepth:!0;i.useRenderToTexture=n.useRenderToTexture!==void 0?n.useRenderToTexture:!1;i.useRenderbuffer=!1===i.useRenderToTexture;return i}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.samples=e.samples;this.useRenderToTexture=e.useRenderToTexture;this.useRenderbuffer=e.useRenderbuffer;return this}}]);return t}(lo);po.prototype.isWebGLMultisampleRenderTarget=!0;var co=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck(this,e);this._x=t;this._y=a;this._z=r;this._w=i}_createClass(e,[{key:"set",value:function set(e,t,a,r){this._x=e;this._y=t;this._z=a;this._w=r;this._onChangeCallback();return this}},{key:"clone",value:function clone(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function copy(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this._onChangeCallback();return this}},{key:"setFromEuler",value:function setFromEuler(e,t){if(!(e&&e.isEuler)){throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")}var a=e._x,r=e._y,i=e._z,n=e._order,o=Math.cos,s=Math.sin,l=o(a/2),d=o(r/2),u=o(i/2),p=s(a/2),c=s(r/2),m=s(i/2);switch(n){case"XYZ":this._x=p*d*u+l*c*m;this._y=l*c*u-p*d*m;this._z=l*d*m+p*c*u;this._w=l*d*u-p*c*m;break;case"YXZ":this._x=p*d*u+l*c*m;this._y=l*c*u-p*d*m;this._z=l*d*m-p*c*u;this._w=l*d*u+p*c*m;break;case"ZXY":this._x=p*d*u-l*c*m;this._y=l*c*u+p*d*m;this._z=l*d*m+p*c*u;this._w=l*d*u-p*c*m;break;case"ZYX":this._x=p*d*u-l*c*m;this._y=l*c*u+p*d*m;this._z=l*d*m-p*c*u;this._w=l*d*u+p*c*m;break;case"YZX":this._x=p*d*u+l*c*m;this._y=l*c*u+p*d*m;this._z=l*d*m-p*c*u;this._w=l*d*u-p*c*m;break;case"XZY":this._x=p*d*u-l*c*m;this._y=l*c*u-p*d*m;this._z=l*d*m+p*c*u;this._w=l*d*u+p*c*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n);}if(!1!==t)this._onChangeCallback();return this}},{key:"setFromAxisAngle",value:function setFromAxisAngle(e,t){var a=t/2,r=Math.sin(a);this._x=e.x*r;this._y=e.y*r;this._z=e.z*r;this._w=Math.cos(a);this._onChangeCallback();return this}},{key:"setFromRotationMatrix",value:function setFromRotationMatrix(e){var t=e.elements,a=t[0],r=t[4],i=t[8],n=t[1],o=t[5],l=t[9],d=t[2],u=t[6],p=t[10],c=a+o+p;if(0<c){var m=.5/Math.sqrt(c+1);this._w=.25/m;this._x=(u-l)*m;this._y=(i-d)*m;this._z=(n-r)*m}else if(a>o&&a>p){var s=2*Math.sqrt(1+a-o-p);this._w=(u-l)/s;this._x=.25*s;this._y=(r+n)/s;this._z=(i+d)/s}else if(o>p){var g=2*Math.sqrt(1+o-a-p);this._w=(i-d)/g;this._x=(r+n)/g;this._y=.25*g;this._z=(l+u)/g}else{var f=2*Math.sqrt(1+p-a-o);this._w=(n-r)/f;this._x=(i+d)/f;this._y=(l+u)/f;this._z=.25*f}this._onChangeCallback();return this}},{key:"setFromUnitVectors",value:function setFromUnitVectors(e,t){var a=e.dot(t)+1;if(a<Number.EPSILON){a=0;if(Math.abs(e.x)>Math.abs(e.z)){this._x=-e.y;this._y=e.x;this._z=0;this._w=a}else{this._x=0;this._y=-e.z;this._z=e.y;this._w=a}}else{this._x=e.y*t.z-e.z*t.y;this._y=e.z*t.x-e.x*t.z;this._z=e.x*t.y-e.y*t.x;this._w=a}return this.normalize()}},{key:"angleTo",value:function angleTo(e){return 2*Math.acos(Math.abs(a(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function rotateTowards(e,a){var r=this.angleTo(e);if(0===r)return this;var i=Math.min(1,a/r);this.slerp(e,i);return this}},{key:"identity",value:function identity(){return this.set(0,0,0,1)}},{key:"invert",value:function invert(){return this.conjugate()}},{key:"conjugate",value:function conjugate(){this._x*=-1;this._y*=-1;this._z*=-1;this._onChangeCallback();return this}},{key:"dot",value:function dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function normalize(){var e=this.length();if(0===e){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}this._onChangeCallback();return this}},{key:"multiply",value:function multiply(e,t){if(t!==void 0){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function premultiply(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function multiplyQuaternions(e,t){var a=e._x,r=e._y,i=e._z,n=e._w,o=t._x,s=t._y,l=t._z,d=t._w;this._x=a*d+n*o+r*l-i*s;this._y=r*d+n*s+i*o-a*l;this._z=i*d+n*l+a*s-r*o;this._w=n*d-a*o-r*s-i*l;this._onChangeCallback();return this}},{key:"slerp",value:function slerp(e,a){if(0===a)return this;if(1===a)return this.copy(e);var t=this._x,r=this._y,i=this._z,n=this._w,o=n*e._w+t*e._x+r*e._y+i*e._z;if(0>o){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(1<=o){this._w=n;this._x=t;this._y=r;this._z=i;return this}var l=1-o*o;if(l<=Number.EPSILON){var m=1-a;this._w=m*n+a*this._w;this._x=m*t+a*this._x;this._y=m*r+a*this._y;this._z=m*i+a*this._z;this.normalize();this._onChangeCallback();return this}var d=Math.sqrt(l),u=Math.atan2(d,o),p=Math.sin((1-a)*u)/d,c=Math.sin(a*u)/d;this._w=n*p+this._w*c;this._x=t*p+this._x*c;this._y=r*p+this._y*c;this._z=i*p+this._z*c;this._onChangeCallback();return this}},{key:"slerpQuaternions",value:function slerpQuaternions(e,a,r){return this.copy(e).slerp(a,r)}},{key:"random",value:function random(){var e=Math.random(),t=Math.sqrt(1-e),a=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),a*Math.sin(i),a*Math.cos(i),t*Math.sin(r))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this._onChangeCallback();return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t){this._x=e.getX(t);this._y=e.getY(t);this._z=e.getZ(t);this._w=e.getW(t);return this}},{key:"_onChange",value:function _onChange(e){this._onChangeCallback=e;return this}},{key:"_onChangeCallback",value:function _onChangeCallback(){}},{key:"x",get:function get(){return this._x},set:function set(e){this._x=e;this._onChangeCallback()}},{key:"y",get:function get(){return this._y},set:function set(e){this._y=e;this._onChangeCallback()}},{key:"z",get:function get(){return this._z},set:function set(e){this._z=e;this._onChangeCallback()}},{key:"w",get:function get(){return this._w},set:function set(e){this._w=e;this._onChangeCallback()}}],[{key:"slerp",value:function slerp(e,a,r,i){console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead.");return r.slerpQuaternions(e,a,i)}},{key:"slerpFlat",value:function slerpFlat(e,a,r,i,n,o,l){var d=r[i+0],u=r[i+1],p=r[i+2],c=r[i+3],m=n[o+0],g=n[o+1],h=n[o+2],y=n[o+3];if(0===l){e[a+0]=d;e[a+1]=u;e[a+2]=p;e[a+3]=c;return}if(1===l){e[a+0]=m;e[a+1]=g;e[a+2]=h;e[a+3]=y;return}if(c!==y||d!==m||u!==g||p!==h){var v=1-l,_=d*m+u*g+p*h+c*y,x=0<=_?1:-1,b=1-_*_;if(b>Number.EPSILON){var E=Math.sqrt(b),S=Math.atan2(E,_*x);v=Math.sin(v*S)/E;l=Math.sin(l*S)/E}var T=l*x;d=d*v+m*T;u=u*v+g*T;p=p*v+h*T;c=c*v+y*T;if(v==1-l){var M=1/Math.sqrt(d*d+u*u+p*p+c*c);d*=M;u*=M;p*=M;c*=M}}e[a]=d;e[a+1]=u;e[a+2]=p;e[a+3]=c}},{key:"multiplyQuaternionsFlat",value:function multiplyQuaternionsFlat(e,t,a,r,i,n){var o=a[r],s=a[r+1],l=a[r+2],d=a[r+3],u=i[n],p=i[n+1],c=i[n+2],m=i[n+3];e[t]=o*m+d*u+s*c-l*p;e[t+1]=s*m+d*p+l*u-o*c;e[t+2]=l*m+d*c+o*p-s*u;e[t+3]=d*m-o*u-s*p-l*c;return e}}]);return e}();co.prototype.isQuaternion=!0;var mo=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;_classCallCheck(this,e);this.x=t;this.y=a;this.z=r}_createClass(e,[{key:"set",value:function set(e,t,a){if(a===void 0)a=this.z;this.x=e;this.y=t;this.z=a;return this}},{key:"setScalar",value:function setScalar(e){this.x=e;this.y=e;this.z=e;return this}},{key:"setX",value:function setX(e){this.x=e;return this}},{key:"setY",value:function setY(e){this.y=e;return this}},{key:"setZ",value:function setZ(e){this.z=e;return this}},{key:"setComponent",value:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e);}return this}},{key:"getComponent",value:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e);}}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function copy(e){this.x=e.x;this.y=e.y;this.z=e.z;return this}},{key:"add",value:function add(e,t){if(t!==void 0){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this}},{key:"addScalar",value:function addScalar(e){this.x+=e;this.y+=e;this.z+=e;return this}},{key:"addVectors",value:function addVectors(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this}},{key:"addScaledVector",value:function addScaledVector(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;return this}},{key:"sub",value:function sub(e,t){if(t!==void 0){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this}},{key:"subScalar",value:function subScalar(e){this.x-=e;this.y-=e;this.z-=e;return this}},{key:"subVectors",value:function subVectors(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this}},{key:"multiply",value:function multiply(e,t){if(t!==void 0){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){this.x*=e;this.y*=e;this.z*=e;return this}},{key:"multiplyVectors",value:function multiplyVectors(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this}},{key:"applyEuler",value:function applyEuler(e){if(!(e&&e.isEuler)){console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.")}return this.applyQuaternion(fo.setFromEuler(e))}},{key:"applyAxisAngle",value:function applyAxisAngle(e,t){return this.applyQuaternion(fo.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function applyMatrix3(t){var a=this.x,r=this.y,i=this.z,n=t.elements;this.x=n[0]*a+n[3]*r+n[6]*i;this.y=n[1]*a+n[4]*r+n[7]*i;this.z=n[2]*a+n[5]*r+n[8]*i;return this}},{key:"applyNormalMatrix",value:function applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function applyMatrix4(t){var a=this.x,r=this.y,i=this.z,n=t.elements,e=1/(n[3]*a+n[7]*r+n[11]*i+n[15]);this.x=(n[0]*a+n[4]*r+n[8]*i+n[12])*e;this.y=(n[1]*a+n[5]*r+n[9]*i+n[13])*e;this.z=(n[2]*a+n[6]*r+n[10]*i+n[14])*e;return this}},{key:"applyQuaternion",value:function applyQuaternion(e){var t=this.x,a=this.y,r=this.z,i=e.x,n=e.y,o=e.z,s=e.w,l=s*t+n*r-o*a,d=s*a+o*t-i*r,u=s*r+i*a-n*t,p=-i*t-n*a-o*r;this.x=l*s+p*-i+d*-o-u*-n;this.y=d*s+p*-n+u*-i-l*-o;this.z=u*s+p*-o+l*-n-d*-i;return this}},{key:"project",value:function project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function transformDirection(t){var a=this.x,r=this.y,i=this.z,n=t.elements;this.x=n[0]*a+n[4]*r+n[8]*i;this.y=n[1]*a+n[5]*r+n[9]*i;this.z=n[2]*a+n[6]*r+n[10]*i;return this.normalize()}},{key:"divide",value:function divide(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this}},{key:"divideScalar",value:function divideScalar(e){return this.multiplyScalar(1/e)}},{key:"min",value:function min(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);return this}},{key:"max",value:function max(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);return this}},{key:"clamp",value:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));return this}},{key:"clampScalar",value:function clampScalar(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));this.z=Math.max(e,Math.min(t,this.z));return this}},{key:"clampLength",value:function clampLength(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}},{key:"floor",value:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this}},{key:"ceil",value:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this}},{key:"round",value:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this}},{key:"roundToZero",value:function roundToZero(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this}},{key:"negate",value:function negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this}},{key:"dot",value:function dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function normalize(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function setLength(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this}},{key:"lerpVectors",value:function lerpVectors(e,t,a){this.x=e.x+(t.x-e.x)*a;this.y=e.y+(t.y-e.y)*a;this.z=e.z+(t.z-e.z)*a;return this}},{key:"cross",value:function cross(e,t){if(t!==void 0){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}return this.crossVectors(this,e)}},{key:"crossVectors",value:function crossVectors(e,t){var a=e.x,r=e.y,i=e.z,n=t.x,o=t.y,s=t.z;this.x=r*s-i*o;this.y=i*n-a*s;this.z=a*o-r*n;return this}},{key:"projectOnVector",value:function projectOnVector(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var a=e.dot(this)/t;return this.copy(e).multiplyScalar(a)}},{key:"projectOnPlane",value:function projectOnPlane(e){go.copy(this).projectOnVector(e);return this.sub(go)}},{key:"reflect",value:function reflect(e){return this.sub(go.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var r=this.dot(e)/t;return Math.acos(a(r,-1,1))}},{key:"distanceTo",value:function distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function distanceToSquared(e){var t=this.x-e.x,a=this.y-e.y,r=this.z-e.z;return t*t+a*a+r*r}},{key:"manhattanDistanceTo",value:function manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function setFromSphericalCoords(e,t,a){var r=Math.sin(t)*e;this.x=r*Math.sin(a);this.y=Math.cos(t)*e;this.z=r*Math.cos(a);return this}},{key:"setFromCylindrical",value:function setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function setFromCylindricalCoords(e,t,a){this.x=e*Math.sin(t);this.y=a;this.z=e*Math.cos(t);return this}},{key:"setFromMatrixPosition",value:function setFromMatrixPosition(t){var a=t.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this}},{key:"setFromMatrixScale",value:function setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),a=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();this.x=t;this.y=a;this.z=r;return this}},{key:"setFromMatrixColumn",value:function setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function fromArray(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e}},{key:"fromBufferAttribute",value:function fromBufferAttribute(e,t,a){if(a!==void 0){console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);this.z=e.getZ(t);return this}},{key:"random",value:function random(){this.x=Math.random();this.y=Math.random();this.z=Math.random();return this}},{key:"randomDirection",value:function randomDirection(){var e=2*(Math.random()-.5),a=2*(Math.random()*Math.PI),t=Math.sqrt(1-Math.pow(e,2));this.x=t*Math.cos(a);this.y=t*Math.sin(a);this.z=e;return this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function value(){return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:e.next=2;return this.x;case 2:e.next=4;return this.y;case 4:e.next=6;return this.z;case 6:case"end":return e.stop();}}},value,this)})}]);return e}();mo.prototype.isVector3=!0;var go=new mo,fo=new co,ho=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new mo(+Infinity,+Infinity,+Infinity),a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo(-Infinity,-Infinity,-Infinity);_classCallCheck(this,e);this.min=t;this.max=a}_createClass(e,[{key:"set",value:function set(e,t){this.min.copy(e);this.max.copy(t);return this}},{key:"setFromArray",value:function setFromArray(e){for(var t=+Infinity,a=+Infinity,r=+Infinity,i=-Infinity,n=-Infinity,o=-Infinity,s=0,d=e.length;s<d;s+=3){var l=e[s],u=e[s+1],p=e[s+2];if(l<t)t=l;if(u<a)a=u;if(p<r)r=p;if(l>i)i=l;if(u>n)n=u;if(p>o)o=p}this.min.set(t,a,r);this.max.set(i,n,o);return this}},{key:"setFromBufferAttribute",value:function setFromBufferAttribute(e){for(var t=+Infinity,a=+Infinity,r=+Infinity,i=-Infinity,n=-Infinity,o=-Infinity,s=0,d=e.count;s<d;s++){var l=e.getX(s),u=e.getY(s),p=e.getZ(s);if(l<t)t=l;if(u<a)a=u;if(p<r)r=p;if(l>i)i=l;if(u>n)n=u;if(p>o)o=p}this.min.set(t,a,r);this.max.set(i,n,o);return this}},{key:"setFromPoints",value:function setFromPoints(e){this.makeEmpty();for(var t=0,a=e.length;t<a;t++){this.expandByPoint(e[t])}return this}},{key:"setFromCenterAndSize",value:function setFromCenterAndSize(e,t){var a=vo.copy(t).multiplyScalar(.5);this.min.copy(e).sub(a);this.max.copy(e).add(a);return this}},{key:"setFromObject",value:function setFromObject(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1;this.makeEmpty();return this.expandByObject(e,t)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.min.copy(e.min);this.max.copy(e.max);return this}},{key:"makeEmpty",value:function makeEmpty(){this.min.x=this.min.y=this.min.z=+Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this}},{key:"isEmpty",value:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function expandByPoint(e){this.min.min(e);this.max.max(e);return this}},{key:"expandByVector",value:function expandByVector(e){this.min.sub(e);this.max.add(e);return this}},{key:"expandByScalar",value:function expandByScalar(e){this.min.addScalar(-e);this.max.addScalar(e);return this}},{key:"expandByObject",value:function expandByObject(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1;e.updateWorldMatrix(!1,!1);var a=e.geometry;if(a!==void 0){if(t&&a.attributes!=void 0&&a.attributes.position!==void 0){for(var r=a.attributes.position,i=0,n=r.count;i<n;i++){vo.fromBufferAttribute(r,i).applyMatrix4(e.matrixWorld);this.expandByPoint(vo)}}else{if(null===a.boundingBox){a.computeBoundingBox()}_o.copy(a.boundingBox);_o.applyMatrix4(e.matrixWorld);this.union(_o)}}for(var o=e.children,s=0,l=o.length;s<l;s++){this.expandByObject(o[s],t)}return this}},{key:"containsPoint",value:function containsPoint(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0}},{key:"containsBox",value:function containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function intersectsBox(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0}},{key:"intersectsSphere",value:function intersectsSphere(e){this.clampPoint(e.center,vo);return vo.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function intersectsPlane(e){var t,a;if(0<e.normal.x){t=e.normal.x*this.min.x;a=e.normal.x*this.max.x}else{t=e.normal.x*this.max.x;a=e.normal.x*this.min.x}if(0<e.normal.y){t+=e.normal.y*this.min.y;a+=e.normal.y*this.max.y}else{t+=e.normal.y*this.max.y;a+=e.normal.y*this.min.y}if(0<e.normal.z){t+=e.normal.z*this.min.z;a+=e.normal.z*this.max.z}else{t+=e.normal.z*this.max.z;a+=e.normal.z*this.min.z}return t<=-e.constant&&a>=-e.constant}},{key:"intersectsTriangle",value:function intersectsTriangle(e){if(this.isEmpty()){return!1}this.getCenter(Ao);Ro.subVectors(this.max,Ao);xo.subVectors(e.a,Ao);bo.subVectors(e.b,Ao);Eo.subVectors(e.c,Ao);So.subVectors(bo,xo);To.subVectors(Eo,bo);Mo.subVectors(xo,Eo);var t=[0,-So.z,So.y,0,-To.z,To.y,0,-Mo.z,Mo.y,So.z,0,-So.x,To.z,0,-To.x,Mo.z,0,-Mo.x,-So.y,So.x,0,-To.y,To.x,0,-Mo.y,Mo.x,0];if(!y(t,xo,bo,Eo,Ro)){return!1}t=[1,0,0,0,1,0,0,0,1];if(!y(t,xo,bo,Eo,Ro)){return!1}wo.crossVectors(So,To);t=[wo.x,wo.y,wo.z];return y(t,xo,bo,Eo,Ro)}},{key:"clampPoint",value:function clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function distanceToPoint(e){var t=vo.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"getBoundingSphere",value:function getBoundingSphere(e){this.getCenter(e.center);e.radius=.5*this.getSize(vo).length();return e}},{key:"intersect",value:function intersect(e){this.min.max(e.min);this.max.min(e.max);if(this.isEmpty())this.makeEmpty();return this}},{key:"union",value:function union(e){this.min.min(e.min);this.max.max(e.max);return this}},{key:"applyMatrix4",value:function applyMatrix4(e){if(this.isEmpty())return this;yo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e);yo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e);yo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e);yo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e);yo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e);yo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e);yo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e);yo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e);this.setFromPoints(yo);return this}},{key:"translate",value:function translate(e){this.min.add(e);this.max.add(e);return this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]);return e}();ho.prototype.isBox3=!0;var yo=[new mo,new mo,new mo,new mo,new mo,new mo,new mo,new mo],vo=new mo,_o=new ho,xo=new mo,bo=new mo,Eo=new mo,So=new mo,To=new mo,Mo=new mo,Ao=new mo,Ro=new mo,wo=new mo,Lo=new mo;function y(e,t,a,i,n){for(var d=0,u=e.length-3;d<=u;d+=3){Lo.fromArray(e,d);var o=n.x*Math.abs(Lo.x)+n.y*Math.abs(Lo.y)+n.z*Math.abs(Lo.z),r=t.dot(Lo),s=a.dot(Lo),l=i.dot(Lo);if(Math.max(-Math.max(r,s,l),Math.min(r,s,l))>o){return!1}}return!0}var Co=new ho,ko=new mo,Po=new mo,Io=new mo,Do=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new mo,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:-1;_classCallCheck(this,e);this.center=t;this.radius=a}_createClass(e,[{key:"set",value:function set(e,t){this.center.copy(e);this.radius=t;return this}},{key:"setFromPoints",value:function setFromPoints(e,t){var a=this.center;if(t!==void 0){a.copy(t)}else{Co.setFromPoints(e).getCenter(a)}for(var r=0,i=0,n=e.length;i<n;i++){r=Math.max(r,a.distanceToSquared(e[i]))}this.radius=Math.sqrt(r);return this}},{key:"copy",value:function copy(e){this.center.copy(e.center);this.radius=e.radius;return this}},{key:"isEmpty",value:function isEmpty(){return 0>this.radius}},{key:"makeEmpty",value:function makeEmpty(){this.center.set(0,0,0);this.radius=-1;return this}},{key:"containsPoint",value:function containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function distanceToPoint(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function intersectsBox(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function clampPoint(e,t){var a=this.center.distanceToSquared(e);t.copy(e);if(a>this.radius*this.radius){t.sub(this.center).normalize();t.multiplyScalar(this.radius).add(this.center)}return t}},{key:"getBoundingBox",value:function getBoundingBox(e){if(this.isEmpty()){e.makeEmpty();return e}e.set(this.center,this.center);e.expandByScalar(this.radius);return e}},{key:"applyMatrix4",value:function applyMatrix4(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this}},{key:"translate",value:function translate(e){this.center.add(e);return this}},{key:"expandByPoint",value:function expandByPoint(e){Io.subVectors(e,this.center);var t=Io.lengthSq();if(t>this.radius*this.radius){var a=Math.sqrt(t),r=.5*(a-this.radius);this.center.add(Io.multiplyScalar(r/a));this.radius+=r}return this}},{key:"union",value:function union(e){if(!0===this.center.equals(e.center)){Po.set(0,0,1).multiplyScalar(e.radius)}else{Po.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius)}this.expandByPoint(ko.copy(e.center).add(Po));this.expandByPoint(ko.copy(e.center).sub(Po));return this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),No=new mo,Uo=new mo,Fo=new mo,Bo=new mo,Oo=new mo,zo=new mo,Ho=new mo,Go=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new mo,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo(0,0,-1);_classCallCheck(this,e);this.origin=t;this.direction=a}_createClass(e,[{key:"set",value:function set(e,t){this.origin.copy(e);this.direction.copy(t);return this}},{key:"copy",value:function copy(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this}},{key:"at",value:function at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function lookAt(e){this.direction.copy(e).sub(this.origin).normalize();return this}},{key:"recast",value:function recast(e){this.origin.copy(this.at(e,No));return this}},{key:"closestPointToPoint",value:function closestPointToPoint(e,t){t.subVectors(e,this.origin);var a=t.dot(this.direction);if(0>a){return t.copy(this.origin)}return t.copy(this.direction).multiplyScalar(a).add(this.origin)}},{key:"distanceToPoint",value:function distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function distanceSqToPoint(e){var t=No.subVectors(e,this.origin).dot(this.direction);if(0>t){return this.origin.distanceToSquared(e)}No.copy(this.direction).multiplyScalar(t).add(this.origin);return No.distanceToSquared(e)}},{key:"distanceSqToSegment",value:function distanceSqToSegment(e,t,a,r){Uo.copy(e).add(t).multiplyScalar(.5);Fo.copy(t).sub(e).normalize();Bo.copy(this.origin).sub(Uo);var i=.5*e.distanceTo(t),n=-this.direction.dot(Fo),o=Bo.dot(this.direction),s=-Bo.dot(Fo),l=Bo.lengthSq(),d=Math.abs(1-n*n),u,p,c,m;if(0<d){u=n*s-o;p=n*o-s;m=i*d;if(0<=u){if(p>=-m){if(p<=m){var g=1/d;u*=g;p*=g;c=u*(u+n*p+2*o)+p*(n*u+p+2*s)+l}else{p=i;u=Math.max(0,-(n*p+o));c=-u*u+p*(p+2*s)+l}}else{p=-i;u=Math.max(0,-(n*p+o));c=-u*u+p*(p+2*s)+l}}else{if(p<=-m){u=Math.max(0,-(-n*i+o));p=0<u?-i:Math.min(Math.max(-i,-s),i);c=-u*u+p*(p+2*s)+l}else if(p<=m){u=0;p=Math.min(Math.max(-i,-s),i);c=p*(p+2*s)+l}else{u=Math.max(0,-(n*i+o));p=0<u?i:Math.min(Math.max(-i,-s),i);c=-u*u+p*(p+2*s)+l}}}else{p=0<n?-i:i;u=Math.max(0,-(n*p+o));c=-u*u+p*(p+2*s)+l}if(a){a.copy(this.direction).multiplyScalar(u).add(this.origin)}if(r){r.copy(Fo).multiplyScalar(p).add(Uo)}return c}},{key:"intersectSphere",value:function intersectSphere(e,t){No.subVectors(e.center,this.origin);var a=No.dot(this.direction),r=No.dot(No)-a*a,i=e.radius*e.radius;if(r>i)return null;var n=Math.sqrt(i-r),o=a-n,s=a+n;if(0>o&&0>s)return null;if(0>o)return this.at(s,t);return this.at(o,t)}},{key:"intersectsSphere",value:function intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function distanceToPlane(e){var a=e.normal.dot(this.direction);if(0===a){if(0===e.distanceToPoint(this.origin)){return 0}return null}var r=-(this.origin.dot(e.normal)+e.constant)/a;return 0<=r?r:null}},{key:"intersectPlane",value:function intersectPlane(e,a){var r=this.distanceToPlane(e);if(null===r){return null}return this.at(r,a)}},{key:"intersectsPlane",value:function intersectsPlane(e){var t=e.distanceToPoint(this.origin);if(0===t){return!0}var a=e.normal.dot(this.direction);if(0>a*t){return!0}return!1}},{key:"intersectBox",value:function intersectBox(e,t){var a,r,i,n,o,s,l=1/this.direction.x,d=1/this.direction.y,u=1/this.direction.z,p=this.origin;if(0<=l){a=(e.min.x-p.x)*l;r=(e.max.x-p.x)*l}else{a=(e.max.x-p.x)*l;r=(e.min.x-p.x)*l}if(0<=d){i=(e.min.y-p.y)*d;n=(e.max.y-p.y)*d}else{i=(e.max.y-p.y)*d;n=(e.min.y-p.y)*d}if(a>n||i>r)return null;if(i>a||a!==a)a=i;if(n<r||r!==r)r=n;if(0<=u){o=(e.min.z-p.z)*u;s=(e.max.z-p.z)*u}else{o=(e.max.z-p.z)*u;s=(e.min.z-p.z)*u}if(a>s||o>r)return null;if(o>a||a!==a)a=o;if(s<r||r!==r)r=s;if(0>r)return null;return this.at(0<=a?a:r,t)}},{key:"intersectsBox",value:function intersectsBox(e){return null!==this.intersectBox(e,No)}},{key:"intersectTriangle",value:function intersectTriangle(e,t,a,r,i){Oo.subVectors(t,e);zo.subVectors(a,e);Ho.crossVectors(Oo,zo);var n=this.direction.dot(Ho),o;if(0<n){if(r)return null;o=1}else if(0>n){o=-1;n=-n}else{return null}Bo.subVectors(this.origin,e);var s=o*this.direction.dot(zo.crossVectors(Bo,zo));if(0>s){return null}var l=o*this.direction.dot(Oo.cross(Bo));if(0>l){return null}if(s+l>n){return null}var d=-o*Bo.dot(Ho);if(0>d){return null}return this.at(d/n,i)}},{key:"applyMatrix4",value:function applyMatrix4(e){this.origin.applyMatrix4(e);this.direction.transformDirection(e);return this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),Vo=function(){function e(){_classCallCheck(this,e);this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(0<arguments.length){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}}_createClass(e,[{key:"set",value:function set(e,t,a,r,i,n,o,s,l,d,u,p,c,m,g,f){var h=this.elements;h[0]=e;h[4]=t;h[8]=a;h[12]=r;h[1]=i;h[5]=n;h[9]=o;h[13]=s;h[2]=l;h[6]=d;h[10]=u;h[14]=p;h[3]=c;h[7]=m;h[11]=g;h[15]=f;return this}},{key:"identity",value:function identity(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this}},{key:"clone",value:function clone(){return new e().fromArray(this.elements)}},{key:"copy",value:function copy(e){var t=this.elements,a=e.elements;t[0]=a[0];t[1]=a[1];t[2]=a[2];t[3]=a[3];t[4]=a[4];t[5]=a[5];t[6]=a[6];t[7]=a[7];t[8]=a[8];t[9]=a[9];t[10]=a[10];t[11]=a[11];t[12]=a[12];t[13]=a[13];t[14]=a[14];t[15]=a[15];return this}},{key:"copyPosition",value:function copyPosition(e){var t=this.elements,a=e.elements;t[12]=a[12];t[13]=a[13];t[14]=a[14];return this}},{key:"setFromMatrix3",value:function setFromMatrix3(e){var t=e.elements;this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1);return this}},{key:"extractBasis",value:function extractBasis(e,t,a){e.setFromMatrixColumn(this,0);t.setFromMatrixColumn(this,1);a.setFromMatrixColumn(this,2);return this}},{key:"makeBasis",value:function makeBasis(e,t,a){this.set(e.x,t.x,a.x,0,e.y,t.y,a.y,0,e.z,t.z,a.z,0,0,0,0,1);return this}},{key:"extractRotation",value:function extractRotation(e){var t=this.elements,a=e.elements,r=1/Wo.setFromMatrixColumn(e,0).length(),i=1/Wo.setFromMatrixColumn(e,1).length(),n=1/Wo.setFromMatrixColumn(e,2).length();t[0]=a[0]*r;t[1]=a[1]*r;t[2]=a[2]*r;t[3]=0;t[4]=a[4]*i;t[5]=a[5]*i;t[6]=a[6]*i;t[7]=0;t[8]=a[8]*n;t[9]=a[9]*n;t[10]=a[10]*n;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this}},{key:"makeRotationFromEuler",value:function makeRotationFromEuler(t){if(!(t&&t.isEuler)){console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var r=this.elements,i=t.x,n=t.y,o=t.z,s=Math.cos(i),a=Math.sin(i),l=Math.cos(n),u=Math.sin(n),d=Math.cos(o),e=Math.sin(o);if("XYZ"===t.order){var p=s*d,c=s*e,m=a*d,g=a*e;r[0]=l*d;r[4]=-l*e;r[8]=u;r[1]=c+m*u;r[5]=p-g*u;r[9]=-a*l;r[2]=g-p*u;r[6]=m+c*u;r[10]=s*l}else if("YXZ"===t.order){var f=l*d,h=l*e,y=u*d,v=u*e;r[0]=f+v*a;r[4]=y*a-h;r[8]=s*u;r[1]=s*e;r[5]=s*d;r[9]=-a;r[2]=h*a-y;r[6]=v+f*a;r[10]=s*l}else if("ZXY"===t.order){var _=l*d,x=l*e,b=u*d,E=u*e;r[0]=_-E*a;r[4]=-s*e;r[8]=b+x*a;r[1]=x+b*a;r[5]=s*d;r[9]=E-_*a;r[2]=-s*u;r[6]=a;r[10]=s*l}else if("ZYX"===t.order){var S=s*d,T=s*e,M=a*d,A=a*e;r[0]=l*d;r[4]=M*u-T;r[8]=S*u+A;r[1]=l*e;r[5]=A*u+S;r[9]=T*u-M;r[2]=-u;r[6]=a*l;r[10]=s*l}else if("YZX"===t.order){var R=s*l,w=s*u,L=a*l,C=a*u;r[0]=l*d;r[4]=C-R*e;r[8]=L*e+w;r[1]=e;r[5]=s*d;r[9]=-a*d;r[2]=-u*d;r[6]=w*e+L;r[10]=R-C*e}else if("XZY"===t.order){var k=s*l,P=s*u,I=a*l,D=a*u;r[0]=l*d;r[4]=-e;r[8]=u*d;r[1]=k*e+D;r[5]=s*d;r[9]=P*e-I;r[2]=I*e-P;r[6]=a*d;r[10]=D*e+k}r[3]=0;r[7]=0;r[11]=0;r[12]=0;r[13]=0;r[14]=0;r[15]=1;return this}},{key:"makeRotationFromQuaternion",value:function makeRotationFromQuaternion(e){return this.compose(Xo,e,qo)}},{key:"lookAt",value:function lookAt(e,t,a){var r=this.elements;Jo.subVectors(e,t);if(0===Jo.lengthSq()){Jo.z=1}Jo.normalize();Yo.crossVectors(a,Jo);if(0===Yo.lengthSq()){if(1===Math.abs(a.z)){Jo.x+=1e-4}else{Jo.z+=1e-4}Jo.normalize();Yo.crossVectors(a,Jo)}Yo.normalize();Zo.crossVectors(Jo,Yo);r[0]=Yo.x;r[4]=Zo.x;r[8]=Jo.x;r[1]=Yo.y;r[5]=Zo.y;r[9]=Jo.y;r[2]=Yo.z;r[6]=Zo.z;r[10]=Jo.z;return this}},{key:"multiply",value:function multiply(e,t){if(t!==void 0){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function premultiply(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function multiplyMatrices(e,t){var a=e.elements,r=t.elements,i=this.elements,n=a[0],o=a[4],s=a[8],l=a[12],d=a[1],u=a[5],p=a[9],c=a[13],m=a[2],g=a[6],f=a[10],h=a[14],y=a[3],v=a[7],_=a[11],x=a[15],b=r[0],E=r[4],S=r[8],T=r[12],M=r[1],A=r[5],R=r[9],w=r[13],L=r[2],C=r[6],k=r[10],P=r[14],I=r[3],D=r[7],N=r[11],U=r[15];i[0]=n*b+o*M+s*L+l*I;i[4]=n*E+o*A+s*C+l*D;i[8]=n*S+o*R+s*k+l*N;i[12]=n*T+o*w+s*P+l*U;i[1]=d*b+u*M+p*L+c*I;i[5]=d*E+u*A+p*C+c*D;i[9]=d*S+u*R+p*k+c*N;i[13]=d*T+u*w+p*P+c*U;i[2]=m*b+g*M+f*L+h*I;i[6]=m*E+g*A+f*C+h*D;i[10]=m*S+g*R+f*k+h*N;i[14]=m*T+g*w+f*P+h*U;i[3]=y*b+v*M+_*L+x*I;i[7]=y*E+v*A+_*C+x*D;i[11]=y*S+v*R+_*k+x*N;i[15]=y*T+v*w+_*P+x*U;return this}},{key:"multiplyScalar",value:function multiplyScalar(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this}},{key:"determinant",value:function determinant(){var e=this.elements,t=e[0],a=e[4],r=e[8],i=e[12],n=e[1],o=e[5],s=e[9],l=e[13],d=e[2],u=e[6],p=e[10],c=e[14],m=e[3],g=e[7],f=e[11],h=e[15];return m*(+i*s*u-r*l*u-i*o*p+a*l*p+r*o*c-a*s*c)+g*(+t*s*c-t*l*p+i*n*p-r*n*c+r*l*d-i*s*d)+f*(+t*l*u-t*o*c-i*n*u+a*n*c+i*o*d-a*l*d)+h*(-r*o*d-t*s*u+t*o*p+r*n*u-a*n*p+a*s*d)}},{key:"transpose",value:function transpose(){var e=this.elements,t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this}},{key:"setPosition",value:function setPosition(e,t,a){var r=this.elements;if(e.isVector3){r[12]=e.x;r[13]=e.y;r[14]=e.z}else{r[12]=e;r[13]=t;r[14]=a}return this}},{key:"invert",value:function invert(){var e=this.elements,t=e[0],a=e[1],r=e[2],i=e[3],n=e[4],o=e[5],s=e[6],l=e[7],d=e[8],u=e[9],p=e[10],c=e[11],m=e[12],g=e[13],f=e[14],h=e[15],y=u*f*l-g*p*l+g*s*c-o*f*c-u*s*h+o*p*h,v=m*p*l-d*f*l-m*s*c+n*f*c+d*s*h-n*p*h,_=d*g*l-m*u*l+m*o*c-n*g*c-d*o*h+n*u*h,x=m*u*s-d*g*s-m*o*p+n*g*p+d*o*f-n*u*f,b=t*y+a*v+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var E=1/b;e[0]=y*E;e[1]=(g*p*i-u*f*i-g*r*c+a*f*c+u*r*h-a*p*h)*E;e[2]=(o*f*i-g*s*i+g*r*l-a*f*l-o*r*h+a*s*h)*E;e[3]=(u*s*i-o*p*i-u*r*l+a*p*l+o*r*c-a*s*c)*E;e[4]=v*E;e[5]=(d*f*i-m*p*i+m*r*c-t*f*c-d*r*h+t*p*h)*E;e[6]=(m*s*i-n*f*i-m*r*l+t*f*l+n*r*h-t*s*h)*E;e[7]=(n*p*i-d*s*i+d*r*l-t*p*l-n*r*c+t*s*c)*E;e[8]=_*E;e[9]=(m*u*i-d*g*i-m*a*c+t*g*c+d*a*h-t*u*h)*E;e[10]=(n*g*i-m*o*i+m*a*l-t*g*l-n*a*h+t*o*h)*E;e[11]=(d*o*i-n*u*i-d*a*l+t*u*l+n*a*c-t*o*c)*E;e[12]=x*E;e[13]=(d*g*r-m*u*r+m*a*p-t*g*p-d*a*f+t*u*f)*E;e[14]=(m*o*r-n*g*r-m*a*s+t*g*s+n*a*f-t*o*f)*E;e[15]=(n*u*r-d*o*r+d*a*s-t*u*s-n*a*p+t*o*p)*E;return this}},{key:"scale",value:function scale(e){var t=this.elements,a=e.x,r=e.y,i=e.z;t[0]*=a;t[4]*=r;t[8]*=i;t[1]*=a;t[5]*=r;t[9]*=i;t[2]*=a;t[6]*=r;t[10]*=i;t[3]*=a;t[7]*=r;t[11]*=i;return this}},{key:"getMaxScaleOnAxis",value:function getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],a=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,a,r))}},{key:"makeTranslation",value:function makeTranslation(e,t,a){this.set(1,0,0,e,0,1,0,t,0,0,1,a,0,0,0,1);return this}},{key:"makeRotationX",value:function makeRotationX(e){var t=Math.cos(e),a=Math.sin(e);this.set(1,0,0,0,0,t,-a,0,0,a,t,0,0,0,0,1);return this}},{key:"makeRotationY",value:function makeRotationY(e){var t=Math.cos(e),a=Math.sin(e);this.set(t,0,a,0,0,1,0,0,-a,0,t,0,0,0,0,1);return this}},{key:"makeRotationZ",value:function makeRotationZ(e){var t=Math.cos(e),a=Math.sin(e);this.set(t,-a,0,0,a,t,0,0,0,0,1,0,0,0,0,1);return this}},{key:"makeRotationAxis",value:function makeRotationAxis(e,a){var r=Math.cos(a),i=Math.sin(a),n=1-r,t=e.x,o=e.y,s=e.z,l=n*t,d=n*o;this.set(l*t+r,l*o-i*s,l*s+i*o,0,l*o+i*s,d*o+r,d*s-i*t,0,l*s-i*o,d*s+i*t,n*s*s+r,0,0,0,0,1);return this}},{key:"makeScale",value:function makeScale(e,t,a){this.set(e,0,0,0,0,t,0,0,0,0,a,0,0,0,0,1);return this}},{key:"makeShear",value:function makeShear(e,t,a,r,i,n){this.set(1,a,i,0,e,1,n,0,t,r,1,0,0,0,0,1);return this}},{key:"compose",value:function compose(e,t,a){var r=this.elements,i=t._x,n=t._y,o=t._z,s=t._w,l=i+i,d=n+n,u=o+o,p=i*l,c=i*d,m=i*u,g=n*d,f=n*u,h=o*u,y=s*l,v=s*d,_=s*u,x=a.x,b=a.y,E=a.z;r[0]=(1-(g+h))*x;r[1]=(c+_)*x;r[2]=(m-v)*x;r[3]=0;r[4]=(c-_)*b;r[5]=(1-(p+h))*b;r[6]=(f+y)*b;r[7]=0;r[8]=(m+v)*E;r[9]=(f-y)*E;r[10]=(1-(p+g))*E;r[11]=0;r[12]=e.x;r[13]=e.y;r[14]=e.z;r[15]=1;return this}},{key:"decompose",value:function decompose(e,t,a){var r=this.elements,i=Wo.set(r[0],r[1],r[2]).length(),n=Wo.set(r[4],r[5],r[6]).length(),o=Wo.set(r[8],r[9],r[10]).length(),s=this.determinant();if(0>s)i=-i;e.x=r[12];e.y=r[13];e.z=r[14];jo.copy(this);var l=1/i,d=1/n,u=1/o;jo.elements[0]*=l;jo.elements[1]*=l;jo.elements[2]*=l;jo.elements[4]*=d;jo.elements[5]*=d;jo.elements[6]*=d;jo.elements[8]*=u;jo.elements[9]*=u;jo.elements[10]*=u;t.setFromRotationMatrix(jo);a.x=i;a.y=n;a.z=o;return this}},{key:"makePerspective",value:function makePerspective(e,t,a,r,i,n){if(n===void 0){console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.")}var o=this.elements;o[0]=2*i/(t-e);o[4]=0;o[8]=(t+e)/(t-e);o[12]=0;o[1]=0;o[5]=2*i/(a-r);o[9]=(a+r)/(a-r);o[13]=0;o[2]=0;o[6]=0;o[10]=-(n+i)/(n-i);o[14]=-2*n*i/(n-i);o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this}},{key:"makeOrthographic",value:function makeOrthographic(e,t,a,r,i,n){var o=this.elements,s=1/(t-e),l=1/(a-r),d=1/(n-i);o[0]=2*s;o[4]=0;o[8]=0;o[12]=-((t+e)*s);o[1]=0;o[5]=2*l;o[9]=0;o[13]=-((a+r)*l);o[2]=0;o[6]=0;o[10]=-2*d;o[14]=-((n+i)*d);o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this}},{key:"equals",value:function(e){for(var t=this.elements,a=e.elements,r=0;16>r;r++){if(t[r]!==a[r])return!1}return!0}},{key:"fromArray",value:function fromArray(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=0;16>a;a++){this.elements[a]=e[a+t]}return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.elements;e[t]=a[0];e[t+1]=a[1];e[t+2]=a[2];e[t+3]=a[3];e[t+4]=a[4];e[t+5]=a[5];e[t+6]=a[6];e[t+7]=a[7];e[t+8]=a[8];e[t+9]=a[9];e[t+10]=a[10];e[t+11]=a[11];e[t+12]=a[12];e[t+13]=a[13];e[t+14]=a[14];e[t+15]=a[15];return e}}]);return e}();Vo.prototype.isMatrix4=!0;var Wo=new mo,jo=new Vo,Xo=new mo(0,0,0),qo=new mo(1,1,1),Yo=new mo,Zo=new mo,Jo=new mo,Ko=new Vo,Qo=new co,$o=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:e.DefaultOrder;_classCallCheck(this,e);this._x=t;this._y=a;this._z=r;this._order=i}_createClass(e,[{key:"set",value:function set(e,t,a){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:this._order;this._x=e;this._y=t;this._z=a;this._order=r;this._onChangeCallback();return this}},{key:"clone",value:function clone(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function copy(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this._onChangeCallback();return this}},{key:"setFromRotationMatrix",value:function setFromRotationMatrix(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this._order,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!0,i=e.elements,n=i[0],o=i[4],s=i[8],l=i[1],d=i[5],u=i[9],p=i[2],c=i[6],m=i[10];switch(t){case"XYZ":this._y=Math.asin(a(s,-1,1));if(.9999999>Math.abs(s)){this._x=Math.atan2(-u,m);this._z=Math.atan2(-o,n)}else{this._x=Math.atan2(c,d);this._z=0}break;case"YXZ":this._x=Math.asin(-a(u,-1,1));if(.9999999>Math.abs(u)){this._y=Math.atan2(s,m);this._z=Math.atan2(l,d)}else{this._y=Math.atan2(-p,n);this._z=0}break;case"ZXY":this._x=Math.asin(a(c,-1,1));if(.9999999>Math.abs(c)){this._y=Math.atan2(-p,m);this._z=Math.atan2(-o,d)}else{this._y=0;this._z=Math.atan2(l,n)}break;case"ZYX":this._y=Math.asin(-a(p,-1,1));if(.9999999>Math.abs(p)){this._x=Math.atan2(c,m);this._z=Math.atan2(l,n)}else{this._x=0;this._z=Math.atan2(-o,d)}break;case"YZX":this._z=Math.asin(a(l,-1,1));if(.9999999>Math.abs(l)){this._x=Math.atan2(-u,d);this._y=Math.atan2(-p,n)}else{this._x=0;this._y=Math.atan2(s,m)}break;case"XZY":this._z=Math.asin(-a(o,-1,1));if(.9999999>Math.abs(o)){this._x=Math.atan2(c,d);this._y=Math.atan2(s,n)}else{this._x=Math.atan2(-u,m);this._y=0}break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t);}this._order=t;if(!0===r)this._onChangeCallback();return this}},{key:"setFromQuaternion",value:function setFromQuaternion(e,t,a){Ko.makeRotationFromQuaternion(e);return this.setFromRotationMatrix(Ko,t,a)}},{key:"setFromVector3",value:function setFromVector3(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function reorder(e){Qo.setFromEuler(this);return this.setFromQuaternion(Qo,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function fromArray(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==void 0)this._order=e[3];this._onChangeCallback();return this}},{key:"toArray",value:function toArray(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._order;return e}},{key:"toVector3",value:function toVector3(e){if(e){return e.set(this._x,this._y,this._z)}else{return new mo(this._x,this._y,this._z)}}},{key:"_onChange",value:function _onChange(e){this._onChangeCallback=e;return this}},{key:"_onChangeCallback",value:function _onChangeCallback(){}},{key:"x",get:function get(){return this._x},set:function set(e){this._x=e;this._onChangeCallback()}},{key:"y",get:function get(){return this._y},set:function set(e){this._y=e;this._onChangeCallback()}},{key:"z",get:function get(){return this._z},set:function set(e){this._z=e;this._onChangeCallback()}},{key:"order",get:function get(){return this._order},set:function set(e){this._order=e;this._onChangeCallback()}}]);return e}();$o.prototype.isEuler=!0;$o.DefaultOrder="XYZ";$o.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var es=function(){function e(){_classCallCheck(this,e);this.mask=1}_createClass(e,[{key:"set",value:function set(e){this.mask=(0|1<<e)>>>0}},{key:"enable",value:function enable(e){this.mask|=0|1<<e}},{key:"enableAll",value:function enableAll(){this.mask=-1}},{key:"toggle",value:function toggle(e){this.mask^=0|1<<e}},{key:"disable",value:function disable(e){this.mask&=~(0|1<<e)}},{key:"disableAll",value:function disableAll(){this.mask=0}},{key:"test",value:function test(e){return 0!=(this.mask&e.mask)}},{key:"isEnabled",value:function isEnabled(e){return 0!=(this.mask&(0|1<<e))}}]);return e}(),ts=0,as=new mo,rs=new co,is=new Vo,ns=new mo,os=new mo,ss=new mo,ls=new co,ds=new mo(1,0,0),us=new mo(0,1,0),ps=new mo(0,0,1),cs={type:"added"},ms={type:"removed"},gs=function(e){_inherits(a,e);var r=_createSuper(a);function a(){var e;_classCallCheck(this,a);e=r.call(this);Object.defineProperty(_assertThisInitialized(e),"id",{value:ts++});e.uuid=t();e.name="";e.type="Object3D";e.parent=null;e.children=[];e.up=a.DefaultUp.clone();var i=new mo,n=new $o,o=new co,s=new mo(1,1,1);n._onChange(function(){o.setFromEuler(n,!1)});o._onChange(function(){n.setFromQuaternion(o,void 0,!1)});Object.defineProperties(_assertThisInitialized(e),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:o},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Vo},normalMatrix:{value:new Kn}});e.matrix=new Vo;e.matrixWorld=new Vo;e.matrixAutoUpdate=a.DefaultMatrixAutoUpdate;e.matrixWorldNeedsUpdate=!1;e.layers=new es;e.visible=!0;e.castShadow=!1;e.receiveShadow=!1;e.frustumCulled=!0;e.renderOrder=0;e.animations=[];e.userData={};return e}_createClass(a,[{key:"onBeforeRender",value:function onBeforeRender(){}},{key:"onAfterRender",value:function onAfterRender(){}},{key:"applyMatrix4",value:function applyMatrix4(e){if(this.matrixAutoUpdate)this.updateMatrix();this.matrix.premultiply(e);this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function applyQuaternion(e){this.quaternion.premultiply(e);return this}},{key:"setRotationFromAxisAngle",value:function setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function setRotationFromQuaternion(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function rotateOnAxis(e,t){rs.setFromAxisAngle(e,t);this.quaternion.multiply(rs);return this}},{key:"rotateOnWorldAxis",value:function rotateOnWorldAxis(e,t){rs.setFromAxisAngle(e,t);this.quaternion.premultiply(rs);return this}},{key:"rotateX",value:function rotateX(e){return this.rotateOnAxis(ds,e)}},{key:"rotateY",value:function rotateY(e){return this.rotateOnAxis(us,e)}},{key:"rotateZ",value:function rotateZ(e){return this.rotateOnAxis(ps,e)}},{key:"translateOnAxis",value:function translateOnAxis(e,t){as.copy(e).applyQuaternion(this.quaternion);this.position.add(as.multiplyScalar(t));return this}},{key:"translateX",value:function translateX(e){return this.translateOnAxis(ds,e)}},{key:"translateY",value:function translateY(e){return this.translateOnAxis(us,e)}},{key:"translateZ",value:function translateZ(e){return this.translateOnAxis(ps,e)}},{key:"localToWorld",value:function localToWorld(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function worldToLocal(e){return e.applyMatrix4(is.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function lookAt(e,t,a){if(e.isVector3){ns.copy(e)}else{ns.set(e,t,a)}var r=this.parent;this.updateWorldMatrix(!0,!1);os.setFromMatrixPosition(this.matrixWorld);if(this.isCamera||this.isLight){is.lookAt(os,ns,this.up)}else{is.lookAt(ns,os,this.up)}this.quaternion.setFromRotationMatrix(is);if(r){is.extractRotation(r.matrixWorld);rs.setFromRotationMatrix(is);this.quaternion.premultiply(rs.invert())}}},{key:"add",value:function add(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return this}if(e===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",e);return this}if(e&&e.isObject3D){if(null!==e.parent){e.parent.remove(e)}e.parent=this;this.children.push(e);e.dispatchEvent(cs)}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e)}return this}},{key:"remove",value:function remove(e){if(1<arguments.length){for(var a=0;a<arguments.length;a++){this.remove(arguments[a])}return this}var t=this.children.indexOf(e);if(-1!==t){e.parent=null;this.children.splice(t,1);e.dispatchEvent(ms)}return this}},{key:"removeFromParent",value:function removeFromParent(){var e=this.parent;if(null!==e){e.remove(this)}return this}},{key:"clear",value:function clear(){for(var e=0,t;e<this.children.length;e++){t=this.children[e];t.parent=null;t.dispatchEvent(ms)}this.children.length=0;return this}},{key:"attach",value:function attach(e){this.updateWorldMatrix(!0,!1);is.copy(this.matrixWorld).invert();if(null!==e.parent){e.parent.updateWorldMatrix(!0,!1);is.multiply(e.parent.matrixWorld)}e.applyMatrix4(is);this.add(e);e.updateWorldMatrix(!1,!0);return this}},{key:"getObjectById",value:function getObjectById(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function getObjectByName(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function getObjectByProperty(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var a=this.children[i],r=a.getObjectByProperty(e,t);if(r!==void 0){return r}}}},{key:"getWorldPosition",value:function getWorldPosition(e){this.updateWorldMatrix(!0,!1);return e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function getWorldQuaternion(e){this.updateWorldMatrix(!0,!1);this.matrixWorld.decompose(os,e,ss);return e}},{key:"getWorldScale",value:function getWorldScale(e){this.updateWorldMatrix(!0,!1);this.matrixWorld.decompose(os,ls,e);return e}},{key:"getWorldDirection",value:function getWorldDirection(t){this.updateWorldMatrix(!0,!1);var a=this.matrixWorld.elements;return t.set(a[8],a[9],a[10]).normalize()}},{key:"raycast",value:function raycast(){}},{key:"traverse",value:function traverse(e){e(this);for(var t=this.children,a=0,r=t.length;a<r;a++){t[a].traverse(e)}}},{key:"traverseVisible",value:function traverseVisible(e){if(!1===this.visible)return;e(this);for(var t=this.children,a=0,r=t.length;a<r;a++){t[a].traverseVisible(e)}}},{key:"traverseAncestors",value:function traverseAncestors(e){var t=this.parent;if(null!==t){e(t);t.traverseAncestors(e)}}},{key:"updateMatrix",value:function updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){if(this.matrixAutoUpdate)this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){if(null===this.parent){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=!1;e=!0}for(var t=this.children,a=0,r=t.length;a<r;a++){t[a].updateMatrixWorld(e)}}},{key:"updateWorldMatrix",value:function updateWorldMatrix(e,t){var a=this.parent;if(!0===e&&null!==a){a.updateWorldMatrix(!0,!1)}if(this.matrixAutoUpdate)this.updateMatrix();if(null===this.parent){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}if(!0===t){for(var r=this.children,i=0,n=r.length;i<n;i++){r[i].updateWorldMatrix(!1,!0)}}}},{key:"toJSON",value:function toJSON(e){var r=e===void 0||"string"==typeof e,i={};if(r){e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}};i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"}}var n={uuid:this.uuid,type:this.type};if(""!==this.name)n.name=this.name;if(!0===this.castShadow)n.castShadow=!0;if(!0===this.receiveShadow)n.receiveShadow=!0;if(!1===this.visible)n.visible=!1;if(!1===this.frustumCulled)n.frustumCulled=!1;if(0!==this.renderOrder)n.renderOrder=this.renderOrder;if("{}"!==JSON.stringify(this.userData))n.userData=this.userData;n.layers=this.layers.mask;n.matrix=this.matrix.toArray();if(!1===this.matrixAutoUpdate)n.matrixAutoUpdate=!1;if(this.isInstancedMesh){n.type="InstancedMesh";n.count=this.count;n.instanceMatrix=this.instanceMatrix.toJSON();if(null!==this.instanceColor)n.instanceColor=this.instanceColor.toJSON()}function t(t,a){if(t[a.uuid]===void 0){t[a.uuid]=a.toJSON(e)}return a.uuid}if(this.isScene){if(this.background){if(this.background.isColor){n.background=this.background.toJSON()}else if(this.background.isTexture){n.background=this.background.toJSON(e).uuid}}if(this.environment&&this.environment.isTexture){n.environment=this.environment.toJSON(e).uuid}}else if(this.isMesh||this.isLine||this.isPoints){n.geometry=t(e.geometries,this.geometry);var y=this.geometry.parameters;if(y!==void 0&&y.shapes!==void 0){var v=y.shapes;if(Array.isArray(v)){for(var _=0,x=v.length,l;_<x;_++){l=v[_];t(e.shapes,l)}}else{t(e.shapes,v)}}}if(this.isSkinnedMesh){n.bindMode=this.bindMode;n.bindMatrix=this.bindMatrix.toArray();if(this.skeleton!==void 0){t(e.skeletons,this.skeleton);n.skeleton=this.skeleton.uuid}}if(this.material!==void 0){if(Array.isArray(this.material)){for(var o=[],s=0,d=this.material.length;s<d;s++){o.push(t(e.materials,this.material[s]))}n.material=o}else{n.material=t(e.materials,this.material)}}if(0<this.children.length){n.children=[];for(var b=0;b<this.children.length;b++){n.children.push(this.children[b].toJSON(e).object)}}if(0<this.animations.length){n.animations=[];for(var E=0,S;E<this.animations.length;E++){S=this.animations[E];n.animations.push(t(e.animations,S))}}if(r){var u=a(e.geometries),p=a(e.materials),c=a(e.textures),m=a(e.images),g=a(e.shapes),f=a(e.skeletons),h=a(e.animations);if(0<u.length)i.geometries=u;if(0<p.length)i.materials=p;if(0<c.length)i.textures=c;if(0<m.length)i.images=m;if(0<g.length)i.shapes=g;if(0<f.length)i.skeletons=f;if(0<h.length)i.animations=h}i.object=n;return i;function a(e){var t=[];for(var a in e){var r=e[a];delete r.metadata;t.push(r)}return t}}},{key:"clone",value:function clone(e){return new this.constructor().copy(this,e)}},{key:"copy",value:function copy(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;this.name=e.name;this.up.copy(e.up);this.position.copy(e.position);this.rotation.order=e.rotation.order;this.quaternion.copy(e.quaternion);this.scale.copy(e.scale);this.matrix.copy(e.matrix);this.matrixWorld.copy(e.matrixWorld);this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate;this.layers.mask=e.layers.mask;this.visible=e.visible;this.castShadow=e.castShadow;this.receiveShadow=e.receiveShadow;this.frustumCulled=e.frustumCulled;this.renderOrder=e.renderOrder;this.userData=JSON.parse(JSON.stringify(e.userData));if(!0===t){for(var a=0,r;a<e.children.length;a++){r=e.children[a];this.add(r.clone())}}return this}}]);return a}(Vn);gs.DefaultUp=new mo(0,1,0);gs.DefaultMatrixAutoUpdate=!0;gs.prototype.isObject3D=!0;var fs=new mo,hs=new mo,ys=new mo,vs=new mo,_s=new mo,xs=new mo,bs=new mo,Es=new mo,Ss=new mo,Ts=new mo,Ms=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new mo,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new mo;_classCallCheck(this,e);this.a=t;this.b=a;this.c=r}_createClass(e,[{key:"set",value:function set(e,t,a){this.a.copy(e);this.b.copy(t);this.c.copy(a);return this}},{key:"setFromPointsAndIndices",value:function setFromPointsAndIndices(e,t,a,r){this.a.copy(e[t]);this.b.copy(e[a]);this.c.copy(e[r]);return this}},{key:"setFromAttributeAndIndices",value:function setFromAttributeAndIndices(e,t,a,r){this.a.fromBufferAttribute(e,t);this.b.fromBufferAttribute(e,a);this.c.fromBufferAttribute(e,r);return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this}},{key:"getArea",value:function getArea(){fs.subVectors(this.c,this.b);hs.subVectors(this.a,this.b);return .5*fs.cross(hs).length()}},{key:"getMidpoint",value:function getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function getNormal(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function getBarycoord(t,a){return e.getBarycoord(t,this.a,this.b,this.c,a)}},{key:"getUV",value:function getUV(t,a,r,i,n){return e.getUV(t,this.a,this.b,this.c,a,r,i,n)}},{key:"containsPoint",value:function containsPoint(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function isFrontFacing(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function intersectsBox(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function closestPointToPoint(e,t){var r=this.a,a=this.b,i=this.c,n,o;_s.subVectors(a,r);xs.subVectors(i,r);Es.subVectors(e,r);var s=_s.dot(Es),l=xs.dot(Es);if(0>=s&&0>=l){return t.copy(r)}Ss.subVectors(e,a);var d=_s.dot(Ss),u=xs.dot(Ss);if(0<=d&&u<=d){return t.copy(a)}var p=s*u-d*l;if(0>=p&&0<=s&&0>=d){n=s/(s-d);return t.copy(r).addScaledVector(_s,n)}Ts.subVectors(e,i);var c=_s.dot(Ts),m=xs.dot(Ts);if(0<=m&&c<=m){return t.copy(i)}var g=c*l-s*m;if(0>=g&&0<=l&&0>=m){o=l/(l-m);return t.copy(r).addScaledVector(xs,o)}var f=d*m-c*u;if(0>=f&&0<=u-d&&0<=c-m){bs.subVectors(i,a);o=(u-d)/(u-d+(c-m));return t.copy(a).addScaledVector(bs,o)}var h=1/(f+g+p);n=g*h;o=p*h;return t.copy(r).addScaledVector(_s,n).addScaledVector(xs,o)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function getNormal(e,t,a,r){r.subVectors(a,t);fs.subVectors(e,t);r.cross(fs);var i=r.lengthSq();if(0<i){return r.multiplyScalar(1/Math.sqrt(i))}return r.set(0,0,0)}},{key:"getBarycoord",value:function getBarycoord(e,t,a,r,i){fs.subVectors(r,t);hs.subVectors(a,t);ys.subVectors(e,t);var n=fs.dot(fs),o=fs.dot(hs),s=fs.dot(ys),l=hs.dot(hs),d=hs.dot(ys),p=n*l-o*o;if(0===p){return i.set(-2,-1,-1)}var c=1/p,m=(l*s-o*d)*c,u=(n*d-o*s)*c;return i.set(1-m-u,u,m)}},{key:"containsPoint",value:function containsPoint(e,t,a,r){this.getBarycoord(e,t,a,r,vs);return 0<=vs.x&&0<=vs.y&&1>=vs.x+vs.y}},{key:"getUV",value:function getUV(e,t,a,r,i,n,o,s){this.getBarycoord(e,t,a,r,vs);s.set(0,0);s.addScaledVector(i,vs.x);s.addScaledVector(n,vs.y);s.addScaledVector(o,vs.z);return s}},{key:"isFrontFacing",value:function isFrontFacing(e,t,a,r){fs.subVectors(a,t);hs.subVectors(e,t);return 0>fs.cross(hs).dot(r)?!0:!1}}]);return e}(),As=0,Rs=function(e){_inherits(a,e);var r=_createSuper(a);function a(){var e;_classCallCheck(this,a);e=r.call(this);Object.defineProperty(_assertThisInitialized(e),"id",{value:As++});e.uuid=t();e.name="";e.type="Material";e.fog=!0;e.blending=Za;e.side=Va;e.vertexColors=!1;e.opacity=1;e.transparent=!1;e.blendSrc=dr;e.blendDst=ur;e.blendEquation=er;e.blendSrcAlpha=null;e.blendDstAlpha=null;e.blendEquationAlpha=null;e.depthFunc=_r;e.depthTest=!0;e.depthWrite=!0;e.stencilWriteMask=255;e.stencilFunc=Cn;e.stencilRef=0;e.stencilFuncMask=255;e.stencilFail=hn;e.stencilZFail=hn;e.stencilZPass=hn;e.stencilWrite=!1;e.clippingPlanes=null;e.clipIntersection=!1;e.clipShadows=!1;e.shadowSide=null;e.colorWrite=!0;e.precision=null;e.polygonOffset=!1;e.polygonOffsetFactor=0;e.polygonOffsetUnits=0;e.dithering=!1;e.alphaToCoverage=!1;e.premultipliedAlpha=!1;e.visible=!0;e.toneMapped=!0;e.userData={};e.version=0;e._alphaTest=0;return e}_createClass(a,[{key:"onBuild",value:function onBuild(){}},{key:"onBeforeRender",value:function onBeforeRender(){}},{key:"onBeforeCompile",value:function onBeforeCompile(){}},{key:"customProgramCacheKey",value:function customProgramCacheKey(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function setValues(e){if(e===void 0)return;for(var t in e){var a=e[t];if(a===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"==t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=a===Xa?!0:!1;continue}var r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}if(r&&r.isColor){r.set(a)}else if(r&&r.isVector3&&a&&a.isVector3){r.copy(a)}else{this[t]=a}}}},{key:"toJSON",value:function toJSON(e){var a=e===void 0||"string"==typeof e;if(a){e={textures:{},images:{}}}var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"},uuid:this.uuid,type:this.type};if(""!==this.name)r.name=this.name;if(this.color&&this.color.isColor)r.color=this.color.getHex();if(this.roughness!==void 0)r.roughness=this.roughness;if(this.metalness!==void 0)r.metalness=this.metalness;if(this.sheen!==void 0)r.sheen=this.sheen;if(this.sheenColor&&this.sheenColor.isColor)r.sheenColor=this.sheenColor.getHex();if(this.sheenRoughness!==void 0)r.sheenRoughness=this.sheenRoughness;if(this.emissive&&this.emissive.isColor)r.emissive=this.emissive.getHex();if(this.emissiveIntensity&&1!==this.emissiveIntensity)r.emissiveIntensity=this.emissiveIntensity;if(this.specular&&this.specular.isColor)r.specular=this.specular.getHex();if(this.specularIntensity!==void 0)r.specularIntensity=this.specularIntensity;if(this.specularColor&&this.specularColor.isColor)r.specularColor=this.specularColor.getHex();if(this.shininess!==void 0)r.shininess=this.shininess;if(this.clearcoat!==void 0)r.clearcoat=this.clearcoat;if(this.clearcoatRoughness!==void 0)r.clearcoatRoughness=this.clearcoatRoughness;if(this.clearcoatMap&&this.clearcoatMap.isTexture){r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid}if(this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture){r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid}if(this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture){r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid;r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()}if(this.map&&this.map.isTexture)r.map=this.map.toJSON(e).uuid;if(this.matcap&&this.matcap.isTexture)r.matcap=this.matcap.toJSON(e).uuid;if(this.alphaMap&&this.alphaMap.isTexture)r.alphaMap=this.alphaMap.toJSON(e).uuid;if(this.lightMap&&this.lightMap.isTexture){r.lightMap=this.lightMap.toJSON(e).uuid;r.lightMapIntensity=this.lightMapIntensity}if(this.aoMap&&this.aoMap.isTexture){r.aoMap=this.aoMap.toJSON(e).uuid;r.aoMapIntensity=this.aoMapIntensity}if(this.bumpMap&&this.bumpMap.isTexture){r.bumpMap=this.bumpMap.toJSON(e).uuid;r.bumpScale=this.bumpScale}if(this.normalMap&&this.normalMap.isTexture){r.normalMap=this.normalMap.toJSON(e).uuid;r.normalMapType=this.normalMapType;r.normalScale=this.normalScale.toArray()}if(this.displacementMap&&this.displacementMap.isTexture){r.displacementMap=this.displacementMap.toJSON(e).uuid;r.displacementScale=this.displacementScale;r.displacementBias=this.displacementBias}if(this.roughnessMap&&this.roughnessMap.isTexture)r.roughnessMap=this.roughnessMap.toJSON(e).uuid;if(this.metalnessMap&&this.metalnessMap.isTexture)r.metalnessMap=this.metalnessMap.toJSON(e).uuid;if(this.emissiveMap&&this.emissiveMap.isTexture)r.emissiveMap=this.emissiveMap.toJSON(e).uuid;if(this.specularMap&&this.specularMap.isTexture)r.specularMap=this.specularMap.toJSON(e).uuid;if(this.specularIntensityMap&&this.specularIntensityMap.isTexture)r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid;if(this.specularColorMap&&this.specularColorMap.isTexture)r.specularColorMap=this.specularColorMap.toJSON(e).uuid;if(this.envMap&&this.envMap.isTexture){r.envMap=this.envMap.toJSON(e).uuid;if(this.combine!==void 0)r.combine=this.combine}if(this.envMapIntensity!==void 0)r.envMapIntensity=this.envMapIntensity;if(this.reflectivity!==void 0)r.reflectivity=this.reflectivity;if(this.refractionRatio!==void 0)r.refractionRatio=this.refractionRatio;if(this.gradientMap&&this.gradientMap.isTexture){r.gradientMap=this.gradientMap.toJSON(e).uuid}if(this.transmission!==void 0)r.transmission=this.transmission;if(this.transmissionMap&&this.transmissionMap.isTexture)r.transmissionMap=this.transmissionMap.toJSON(e).uuid;if(this.thickness!==void 0)r.thickness=this.thickness;if(this.thicknessMap&&this.thicknessMap.isTexture)r.thicknessMap=this.thicknessMap.toJSON(e).uuid;if(this.attenuationDistance!==void 0)r.attenuationDistance=this.attenuationDistance;if(this.attenuationColor!==void 0)r.attenuationColor=this.attenuationColor.getHex();if(this.size!==void 0)r.size=this.size;if(null!==this.shadowSide)r.shadowSide=this.shadowSide;if(this.sizeAttenuation!==void 0)r.sizeAttenuation=this.sizeAttenuation;if(this.blending!==Za)r.blending=this.blending;if(this.side!==Va)r.side=this.side;if(this.vertexColors)r.vertexColors=!0;if(1>this.opacity)r.opacity=this.opacity;if(!0===this.transparent)r.transparent=this.transparent;r.depthFunc=this.depthFunc;r.depthTest=this.depthTest;r.depthWrite=this.depthWrite;r.colorWrite=this.colorWrite;r.stencilWrite=this.stencilWrite;r.stencilWriteMask=this.stencilWriteMask;r.stencilFunc=this.stencilFunc;r.stencilRef=this.stencilRef;r.stencilFuncMask=this.stencilFuncMask;r.stencilFail=this.stencilFail;r.stencilZFail=this.stencilZFail;r.stencilZPass=this.stencilZPass;if(this.rotation&&0!==this.rotation)r.rotation=this.rotation;if(!0===this.polygonOffset)r.polygonOffset=!0;if(0!==this.polygonOffsetFactor)r.polygonOffsetFactor=this.polygonOffsetFactor;if(0!==this.polygonOffsetUnits)r.polygonOffsetUnits=this.polygonOffsetUnits;if(this.linewidth&&1!==this.linewidth)r.linewidth=this.linewidth;if(this.dashSize!==void 0)r.dashSize=this.dashSize;if(this.gapSize!==void 0)r.gapSize=this.gapSize;if(this.scale!==void 0)r.scale=this.scale;if(!0===this.dithering)r.dithering=!0;if(0<this.alphaTest)r.alphaTest=this.alphaTest;if(!0===this.alphaToCoverage)r.alphaToCoverage=this.alphaToCoverage;if(!0===this.premultipliedAlpha)r.premultipliedAlpha=this.premultipliedAlpha;if(!0===this.wireframe)r.wireframe=this.wireframe;if(1<this.wireframeLinewidth)r.wireframeLinewidth=this.wireframeLinewidth;if("round"!==this.wireframeLinecap)r.wireframeLinecap=this.wireframeLinecap;if("round"!==this.wireframeLinejoin)r.wireframeLinejoin=this.wireframeLinejoin;if(!0===this.flatShading)r.flatShading=this.flatShading;if(!1===this.visible)r.visible=!1;if(!1===this.toneMapped)r.toneMapped=!1;if("{}"!==JSON.stringify(this.userData))r.userData=this.userData;function t(e){var t=[];for(var a in e){var r=e[a];delete r.metadata;t.push(r)}return t}if(a){var i=t(e.textures),n=t(e.images);if(0<i.length)r.textures=i;if(0<n.length)r.images=n}return r}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.name=e.name;this.fog=e.fog;this.blending=e.blending;this.side=e.side;this.vertexColors=e.vertexColors;this.opacity=e.opacity;this.transparent=e.transparent;this.blendSrc=e.blendSrc;this.blendDst=e.blendDst;this.blendEquation=e.blendEquation;this.blendSrcAlpha=e.blendSrcAlpha;this.blendDstAlpha=e.blendDstAlpha;this.blendEquationAlpha=e.blendEquationAlpha;this.depthFunc=e.depthFunc;this.depthTest=e.depthTest;this.depthWrite=e.depthWrite;this.stencilWriteMask=e.stencilWriteMask;this.stencilFunc=e.stencilFunc;this.stencilRef=e.stencilRef;this.stencilFuncMask=e.stencilFuncMask;this.stencilFail=e.stencilFail;this.stencilZFail=e.stencilZFail;this.stencilZPass=e.stencilZPass;this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,a=null;if(null!==t){var r=t.length;a=Array(r);for(var i=0;i!==r;++i){a[i]=t[i].clone()}}this.clippingPlanes=a;this.clipIntersection=e.clipIntersection;this.clipShadows=e.clipShadows;this.shadowSide=e.shadowSide;this.colorWrite=e.colorWrite;this.precision=e.precision;this.polygonOffset=e.polygonOffset;this.polygonOffsetFactor=e.polygonOffsetFactor;this.polygonOffsetUnits=e.polygonOffsetUnits;this.dithering=e.dithering;this.alphaTest=e.alphaTest;this.alphaToCoverage=e.alphaToCoverage;this.premultipliedAlpha=e.premultipliedAlpha;this.visible=e.visible;this.toneMapped=e.toneMapped;this.userData=JSON.parse(JSON.stringify(e.userData));return this}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}},{key:"alphaTest",get:function get(){return this._alphaTest},set:function set(e){if(0<this._alphaTest!=0<e){this.version++}this._alphaTest=e}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return a}(Vn);Rs.prototype.isMaterial=!0;var ws=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="MeshBasicMaterial";r.color=new ao(16777215);r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.specularMap=null;r.alphaMap=null;r.envMap=null;r.combine=Tr;r.reflectivity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;return this}}]);return t}(Rs);ws.prototype.isMeshBasicMaterial=!0;var Ls=new mo,Cs=new Jn,ks=function(){function e(t,a,r){_classCallCheck(this,e);if(Array.isArray(t)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.name="";this.array=t;this.itemSize=a;this.count=t!==void 0?t.length/a:0;this.normalized=!0===r;this.usage=kn;this.updateRange={offset:0,count:-1};this.version=0}_createClass(e,[{key:"onUploadCallback",value:function onUploadCallback(){}},{key:"setUsage",value:function setUsage(e){this.usage=e;return this}},{key:"copy",value:function copy(e){this.name=e.name;this.array=new e.array.constructor(e.array);this.itemSize=e.itemSize;this.count=e.count;this.normalized=e.normalized;this.usage=e.usage;return this}},{key:"copyAt",value:function copyAt(e,t,a){e*=this.itemSize;a*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++){this.array[e+r]=t.array[a+r]}return this}},{key:"copyArray",value:function(e){this.array.set(e);return this}},{key:"copyColorsArray",value:function copyColorsArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r);n=new ao}t[a++]=n.r;t[a++]=n.g;t[a++]=n.b}return this}},{key:"copyVector2sArray",value:function copyVector2sArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r);n=new Jn}t[a++]=n.x;t[a++]=n.y}return this}},{key:"copyVector3sArray",value:function copyVector3sArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r);n=new mo}t[a++]=n.x;t[a++]=n.y;t[a++]=n.z}return this}},{key:"copyVector4sArray",value:function copyVector4sArray(e){for(var t=this.array,a=0,r=0,i=e.length,n;r<i;r++){n=e[r];if(n===void 0){console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r);n=new so}t[a++]=n.x;t[a++]=n.y;t[a++]=n.z;t[a++]=n.w}return this}},{key:"applyMatrix3",value:function applyMatrix3(e){if(2===this.itemSize){for(var t=0,a=this.count;t<a;t++){Cs.fromBufferAttribute(this,t);Cs.applyMatrix3(e);this.setXY(t,Cs.x,Cs.y)}}else if(3===this.itemSize){for(var r=0,i=this.count;r<i;r++){Ls.fromBufferAttribute(this,r);Ls.applyMatrix3(e);this.setXYZ(r,Ls.x,Ls.y,Ls.z)}}return this}},{key:"applyMatrix4",value:function applyMatrix4(e){for(var t=0,a=this.count;t<a;t++){Ls.x=this.getX(t);Ls.y=this.getY(t);Ls.z=this.getZ(t);Ls.applyMatrix4(e);this.setXYZ(t,Ls.x,Ls.y,Ls.z)}return this}},{key:"applyNormalMatrix",value:function applyNormalMatrix(e){for(var t=0,a=this.count;t<a;t++){Ls.x=this.getX(t);Ls.y=this.getY(t);Ls.z=this.getZ(t);Ls.applyNormalMatrix(e);this.setXYZ(t,Ls.x,Ls.y,Ls.z)}return this}},{key:"transformDirection",value:function transformDirection(e){for(var t=0,a=this.count;t<a;t++){Ls.x=this.getX(t);Ls.y=this.getY(t);Ls.z=this.getZ(t);Ls.transformDirection(e);this.setXYZ(t,Ls.x,Ls.y,Ls.z)}return this}},{key:"set",value:function set(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.array.set(e,t);return this}},{key:"getX",value:function getX(e){return this.array[e*this.itemSize]}},{key:"setX",value:function setX(e,t){this.array[e*this.itemSize]=t;return this}},{key:"getY",value:function getY(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function setY(e,t){this.array[e*this.itemSize+1]=t;return this}},{key:"getZ",value:function getZ(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function setZ(e,t){this.array[e*this.itemSize+2]=t;return this}},{key:"getW",value:function getW(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function setW(e,t){this.array[e*this.itemSize+3]=t;return this}},{key:"setXY",value:function setXY(e,t,a){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=a;return this}},{key:"setXYZ",value:function setXYZ(e,t,a,r){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=a;this.array[e+2]=r;return this}},{key:"setXYZW",value:function setXYZW(e,t,a,r,i){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=a;this.array[e+2]=r;this.array[e+3]=i;return this}},{key:"onUpload",value:function onUpload(e){this.onUploadCallback=e;return this}},{key:"clone",value:function clone(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function toJSON(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};if(""!==this.name)e.name=this.name;if(this.usage!==kn)e.usage=this.usage;if(0!==this.updateRange.offset||-1!==this.updateRange.count)e.updateRange=this.updateRange;return e}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return e}();ks.prototype.isBufferAttribute=!0;var Ps=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck(this,t);return a.call(this,new Int8Array(e),r,i)}return t}(ks),Is=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck(this,t);return a.call(this,new Uint8Array(e),r,i)}return t}(ks),Ds=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck(this,t);return a.call(this,new Uint8ClampedArray(e),r,i)}return t}(ks),Ns=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck(this,t);return a.call(this,new Int16Array(e),r,i)}return t}(ks),Us=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck(this,t);return a.call(this,new Uint16Array(e),r,i)}return t}(ks),Fs=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck(this,t);return a.call(this,new Int32Array(e),r,i)}return t}(ks),Bs=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck(this,t);return a.call(this,new Uint32Array(e),r,i)}return t}(ks),Os=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck(this,t);return a.call(this,new Uint16Array(e),r,i)}return t}(ks);Os.prototype.isFloat16BufferAttribute=!0;var zs=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck(this,t);return a.call(this,new Float32Array(e),r,i)}return t}(ks),Hs=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){_classCallCheck(this,t);return a.call(this,new Float64Array(e),r,i)}return t}(ks),Gs=0,Vs=new Vo,Ws=new gs,js=new mo,Xs=new ho,qs=new ho,Ys=new mo,Zs=function(e){_inherits(a,e);var r=_createSuper(a);function a(){var e;_classCallCheck(this,a);e=r.call(this);Object.defineProperty(_assertThisInitialized(e),"id",{value:Gs++});e.uuid=t();e.name="";e.type="BufferGeometry";e.index=null;e.attributes={};e.morphAttributes={};e.morphTargetsRelative=!1;e.groups=[];e.boundingBox=null;e.boundingSphere=null;e.drawRange={start:0,count:1/0};e.userData={};return e}_createClass(a,[{key:"getIndex",value:function getIndex(){return this.index}},{key:"setIndex",value:function setIndex(e){if(Array.isArray(e)){this.index=new(u(e)?Bs:Us)(e,1)}else{this.index=e}return this}},{key:"getAttribute",value:function getAttribute(e){return this.attributes[e]}},{key:"setAttribute",value:function setAttribute(e,t){this.attributes[e]=t;return this}},{key:"deleteAttribute",value:function deleteAttribute(e){delete this.attributes[e];return this}},{key:"hasAttribute",value:function hasAttribute(e){return this.attributes[e]!==void 0}},{key:"addGroup",value:function addGroup(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:a})}},{key:"clearGroups",value:function clearGroups(){this.groups=[]}},{key:"setDrawRange",value:function setDrawRange(e,t){this.drawRange.start=e;this.drawRange.count=t}},{key:"applyMatrix4",value:function applyMatrix4(e){var t=this.attributes.position;if(t!==void 0){t.applyMatrix4(e);t.needsUpdate=!0}var a=this.attributes.normal;if(a!==void 0){var i=new Kn().getNormalMatrix(e);a.applyNormalMatrix(i);a.needsUpdate=!0}var r=this.attributes.tangent;if(r!==void 0){r.transformDirection(e);r.needsUpdate=!0}if(null!==this.boundingBox){this.computeBoundingBox()}if(null!==this.boundingSphere){this.computeBoundingSphere()}return this}},{key:"applyQuaternion",value:function applyQuaternion(e){Vs.makeRotationFromQuaternion(e);this.applyMatrix4(Vs);return this}},{key:"rotateX",value:function rotateX(e){Vs.makeRotationX(e);this.applyMatrix4(Vs);return this}},{key:"rotateY",value:function rotateY(e){Vs.makeRotationY(e);this.applyMatrix4(Vs);return this}},{key:"rotateZ",value:function rotateZ(e){Vs.makeRotationZ(e);this.applyMatrix4(Vs);return this}},{key:"translate",value:function translate(e,t,a){Vs.makeTranslation(e,t,a);this.applyMatrix4(Vs);return this}},{key:"scale",value:function scale(e,t,a){Vs.makeScale(e,t,a);this.applyMatrix4(Vs);return this}},{key:"lookAt",value:function lookAt(e){Ws.lookAt(e);Ws.updateMatrix();this.applyMatrix4(Ws.matrix);return this}},{key:"center",value:function center(){this.computeBoundingBox();this.boundingBox.getCenter(js).negate();this.translate(js.x,js.y,js.z);return this}},{key:"setFromPoints",value:function setFromPoints(e){for(var t=[],a=0,r=e.length,i;a<r;a++){i=e[a];t.push(i.x,i.y,i.z||0)}this.setAttribute("position",new zs(t,3));return this}},{key:"computeBoundingBox",value:function computeBoundingBox(){if(null===this.boundingBox){this.boundingBox=new ho}var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set \"mesh.frustumCulled\" to \"false\".",this);this.boundingBox.set(new mo(-Infinity,-Infinity,-Infinity),new mo(+Infinity,+Infinity,+Infinity));return}if(e!==void 0){this.boundingBox.setFromBufferAttribute(e);if(t){for(var a=0,r=t.length,i;a<r;a++){i=t[a];Xs.setFromBufferAttribute(i);if(this.morphTargetsRelative){Ys.addVectors(this.boundingBox.min,Xs.min);this.boundingBox.expandByPoint(Ys);Ys.addVectors(this.boundingBox.max,Xs.max);this.boundingBox.expandByPoint(Ys)}else{this.boundingBox.expandByPoint(Xs.min);this.boundingBox.expandByPoint(Xs.max)}}}}else{this.boundingBox.makeEmpty()}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error("THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)}}},{key:"computeBoundingSphere",value:function computeBoundingSphere(){if(null===this.boundingSphere){this.boundingSphere=new Do}var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set \"mesh.frustumCulled\" to \"false\".",this);this.boundingSphere.set(new mo,1/0);return}if(e){var d=this.boundingSphere.center;Xs.setFromBufferAttribute(e);if(t){for(var u=0,p=t.length,c;u<p;u++){c=t[u];qs.setFromBufferAttribute(c);if(this.morphTargetsRelative){Ys.addVectors(Xs.min,qs.min);Xs.expandByPoint(Ys);Ys.addVectors(Xs.max,qs.max);Xs.expandByPoint(Ys)}else{Xs.expandByPoint(qs.min);Xs.expandByPoint(qs.max)}}}Xs.getCenter(d);for(var a=0,r=0,i=e.count;r<i;r++){Ys.fromBufferAttribute(e,r);a=Math.max(a,d.distanceToSquared(Ys))}if(t){for(var m=0,g=t.length;m<g;m++){for(var n=t[m],o=this.morphTargetsRelative,s=0,l=n.count;s<l;s++){Ys.fromBufferAttribute(n,s);if(o){js.fromBufferAttribute(e,s);Ys.add(js)}a=Math.max(a,d.distanceToSquared(Ys))}}}this.boundingSphere.radius=Math.sqrt(a);if(isNaN(this.boundingSphere.radius)){console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}}}},{key:"computeTangents",value:function computeTangents(){var a=this.index,r=this.attributes;if(null===a||r.position===void 0||r.normal===void 0||r.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}var i=a.array,o=r.position.array,s=r.normal.array,l=r.uv.array,d=o.length/3;if(r.tangent===void 0){this.setAttribute("tangent",new ks(new Float32Array(4*d),4))}for(var u=r.tangent.array,p=[],m=[],g=0;g<d;g++){p[g]=new mo;m[g]=new mo}var f=new mo,h=new mo,y=new mo,v=new Jn,_=new Jn,x=new Jn,E=new mo,S=new mo;function e(e,t,a){f.fromArray(o,3*e);h.fromArray(o,3*t);y.fromArray(o,3*a);v.fromArray(l,2*e);_.fromArray(l,2*t);x.fromArray(l,2*a);h.sub(f);y.sub(f);_.sub(v);x.sub(v);var i=1/(_.x*x.y-x.x*_.y);if(!isFinite(i))return;E.copy(h).multiplyScalar(x.y).addScaledVector(y,-_.y).multiplyScalar(i);S.copy(y).multiplyScalar(_.x).addScaledVector(h,-x.x).multiplyScalar(i);p[e].add(E);p[t].add(E);p[a].add(E);m[e].add(S);m[t].add(S);m[a].add(S)}var T=this.groups;if(0===T.length){T=[{start:0,count:i.length}]}for(var D=0,N=T.length;D<N;++D){for(var M=T[D],A=M.start,R=M.count,w=A;w<A+R;w+=3){e(i[w+0],i[w+1],i[w+2])}}var c=new mo,b=new mo,L=new mo,n=new mo;function t(e){L.fromArray(s,3*e);n.copy(L);var a=p[e];c.copy(a);c.sub(L.multiplyScalar(L.dot(a))).normalize();b.crossVectors(n,a);var t=b.dot(m[e]),r=0>t?-1:1;u[4*e]=c.x;u[4*e+1]=c.y;u[4*e+2]=c.z;u[4*e+3]=r}for(var U=0,F=T.length;U<F;++U){for(var C=T[U],k=C.start,P=C.count,I=k;I<k+P;I+=3){t(i[I+0]);t(i[I+1]);t(i[I+2])}}}},{key:"computeVertexNormals",value:function computeVertexNormals(){var e=this.index,t=this.getAttribute("position");if(t!==void 0){var m=this.getAttribute("normal");if(m===void 0){m=new ks(new Float32Array(3*t.count),3);this.setAttribute("normal",m)}else{for(var g=0,f=m.count;g<f;g++){m.setXYZ(g,0,0,0)}}var a=new mo,r=new mo,i=new mo,n=new mo,o=new mo,s=new mo,l=new mo,d=new mo;if(e){for(var h=0,y=e.count;h<y;h+=3){var u=e.getX(h+0),p=e.getX(h+1),c=e.getX(h+2);a.fromBufferAttribute(t,u);r.fromBufferAttribute(t,p);i.fromBufferAttribute(t,c);l.subVectors(i,r);d.subVectors(a,r);l.cross(d);n.fromBufferAttribute(m,u);o.fromBufferAttribute(m,p);s.fromBufferAttribute(m,c);n.add(l);o.add(l);s.add(l);m.setXYZ(u,n.x,n.y,n.z);m.setXYZ(p,o.x,o.y,o.z);m.setXYZ(c,s.x,s.y,s.z)}}else{for(var v=0,_=t.count;v<_;v+=3){a.fromBufferAttribute(t,v+0);r.fromBufferAttribute(t,v+1);i.fromBufferAttribute(t,v+2);l.subVectors(i,r);d.subVectors(a,r);l.cross(d);m.setXYZ(v+0,l.x,l.y,l.z);m.setXYZ(v+1,l.x,l.y,l.z);m.setXYZ(v+2,l.x,l.y,l.z)}}this.normalizeNormals();m.needsUpdate=!0}}},{key:"merge",value:function merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}if(t===void 0){t=0;console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.")}var a=this.attributes;for(var p in a){if(e.attributes[p]===void 0)continue;for(var r=a[p],i=r.array,n=e.attributes[p],o=n.array,s=n.itemSize*t,l=Math.min(o.length,i.length-s),d=0,u=s;d<l;d++,u++){i[u]=o[d]}}return this}},{key:"normalizeNormals",value:function normalizeNormals(){for(var e=this.attributes.normal,t=0,a=e.count;t<a;t++){Ys.fromBufferAttribute(e,t);Ys.normalize();e.setXYZ(t,Ys.x,Ys.y,Ys.z)}}},{key:"toNonIndexed",value:function toNonIndexed(){function e(e,t){for(var a=e.array,r=e.itemSize,i=e.normalized,n=new a.constructor(t.length*r),o=0,s=0,d=0,u=t.length;d<u;d++){if(e.isInterleavedBufferAttribute){o=t[d]*e.data.stride+e.offset}else{o=t[d]*r}for(var l=0;l<r;l++){n[s++]=a[o++]}}return new ks(n,r,i)}if(null===this.index){console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed.");return this}var t=new a,r=this.index.array,i=this.attributes;for(var v in i){var n=i[v],o=e(n,r);t.setAttribute(v,o)}var s=this.morphAttributes;for(var _ in s){for(var d=[],u=s[_],p=0,c=u.length;p<c;p++){var m=u[p],g=e(m,r);d.push(g)}t.morphAttributes[_]=d}t.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,h=0,y=f.length,l;h<y;h++){l=f[h];t.addGroup(l.start,l.count,l.materialIndex)}return t}},{key:"toJSON",value:function toJSON(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"},uuid:this.uuid,type:this.type};if(""!==this.name)e.name=this.name;if(0<Object.keys(this.userData).length)e.userData=this.userData;if(this.parameters!==void 0){var c=this.parameters;for(var m in c){if(c[m]!==void 0)e[m]=c[m]}return e}e.data={attributes:{}};var t=this.index;if(null!==t){e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)}}var a=this.attributes;for(var g in a){var f=a[g];e.data.attributes[g]=f.toJSON(e.data)}var r={},i=!1;for(var h in this.morphAttributes){for(var n=this.morphAttributes[h],o=[],s=0,l=n.length,d;s<l;s++){d=n[s];o.push(d.toJSON(e.data))}if(0<o.length){r[h]=o;i=!0}}if(i){e.data.morphAttributes=r;e.data.morphTargetsRelative=this.morphTargetsRelative}var u=this.groups;if(0<u.length){e.data.groups=JSON.parse(JSON.stringify(u))}var p=this.boundingSphere;if(null!==p){e.data.boundingSphere={center:p.center.toArray(),radius:p.radius}}return e}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;var t={};this.name=e.name;var a=e.index;if(null!==a){this.setIndex(a.clone(t))}var r=e.attributes;for(var f in r){var h=r[f];this.setAttribute(f,h.clone(t))}var i=e.morphAttributes;for(var y in i){for(var n=[],o=i[y],s=0,d=o.length;s<d;s++){n.push(o[s].clone(t))}this.morphAttributes[y]=n}this.morphTargetsRelative=e.morphTargetsRelative;for(var l=e.groups,u=0,p=l.length,c;u<p;u++){c=l[u];this.addGroup(c.start,c.count,c.materialIndex)}var m=e.boundingBox;if(null!==m){this.boundingBox=m.clone()}var g=e.boundingSphere;if(null!==g){this.boundingSphere=g.clone()}this.drawRange.start=e.drawRange.start;this.drawRange.count=e.drawRange.count;this.userData=e.userData;if(e.parameters!==void 0)this.parameters=Object.assign({},e.parameters);return this}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}}]);return a}(Vn);Zs.prototype.isBufferGeometry=!0;var Js=new Vo,Ks=new Go,Qs=new Do,$s=new mo,el=new mo,tl=new mo,al=new mo,rl=new mo,il=new mo,nl=new mo,ol=new mo,sl=new mo,ll=new Jn,dl=new Jn,ul=new Jn,pl=new mo,cl=new mo,ml=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Zs,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new ws;_classCallCheck(this,t);e=a.call(this);e.type="Mesh";e.geometry=r;e.material=i;e.updateMorphTargets();return e}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);if(e.morphTargetInfluences!==void 0){this.morphTargetInfluences=e.morphTargetInfluences.slice()}if(e.morphTargetDictionary!==void 0){this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)}this.material=e.material;this.geometry=e.geometry;return this}},{key:"updateMorphTargets",value:function updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,a=Object.keys(t);if(0<a.length){var r=t[a[0]];if(r!==void 0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0,n=r.length,o;i<n;i++){o=r[i].name||i+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length){console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}},{key:"raycast",value:function raycast(e,t){var r=this.geometry,i=this.material,n=this.matrixWorld;if(i===void 0)return;if(null===r.boundingSphere)r.computeBoundingSphere();Qs.copy(r.boundingSphere);Qs.applyMatrix4(n);if(!1===e.ray.intersectsSphere(Qs))return;Js.copy(n).invert();Ks.copy(e.ray).applyMatrix4(Js);if(null!==r.boundingBox){if(!1===Ks.intersectsBox(r.boundingBox))return}var o;if(r.isBufferGeometry){var s=r.index,l=r.attributes.position,d=r.morphAttributes.position,u=r.morphTargetsRelative,p=r.attributes.uv,m=r.attributes.uv2,g=r.groups,f=r.drawRange;if(null!==s){if(Array.isArray(i)){for(var V=0,W=g.length;V<W;V++){for(var h=g[V],y=i[h.materialIndex],v=Math.max(h.start,f.start),x=Math.min(s.count,Math.min(h.start+h.count,f.start+f.count)),E=v;E<x;E+=3){var S=s.getX(E),a=s.getX(E+1),b=s.getX(E+2);o=_(this,y,e,Ks,l,d,u,p,m,S,a,b);if(o){o.faceIndex=Math.floor(E/3);o.face.materialIndex=h.materialIndex;t.push(o)}}}}else{for(var c=Math.max(0,f.start),T=Math.min(s.count,f.start+f.count),M=c;M<T;M+=3){var A=s.getX(M),R=s.getX(M+1),w=s.getX(M+2);o=_(this,i,e,Ks,l,d,u,p,m,A,R,w);if(o){o.faceIndex=Math.floor(M/3);t.push(o)}}}}else if(l!==void 0){if(Array.isArray(i)){for(var X=0,q=g.length;X<q;X++){for(var L=g[X],C=i[L.materialIndex],k=Math.max(L.start,f.start),P=Math.min(l.count,Math.min(L.start+L.count,f.start+f.count)),I=k;I<P;I+=3){var D=I,N=I+1,U=I+2;o=_(this,C,e,Ks,l,d,u,p,m,D,N,U);if(o){o.faceIndex=Math.floor(I/3);o.face.materialIndex=L.materialIndex;t.push(o)}}}}else{for(var F=Math.max(0,f.start),B=Math.min(l.count,f.start+f.count),O=F;O<B;O+=3){var z=O,H=O+1,G=O+2;o=_(this,i,e,Ks,l,d,u,p,m,z,H,G);if(o){o.faceIndex=Math.floor(O/3);t.push(o)}}}}}else if(r.isGeometry){console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]);return t}(gs);ml.prototype.isMesh=!0;function v(e,t,a,r,i,n,o,s){var l;if(t.side===Wa){l=r.intersectTriangle(o,n,i,!0,s)}else{l=r.intersectTriangle(i,n,o,t.side!==ja,s)}if(null===l)return null;cl.copy(s);cl.applyMatrix4(e.matrixWorld);var d=a.ray.origin.distanceTo(cl);if(d<a.near||d>a.far)return null;return{distance:d,point:cl.clone(),object:e}}function _(e,t,r,i,n,o,s,l,d,u,a,p){$s.fromBufferAttribute(n,u);el.fromBufferAttribute(n,a);tl.fromBufferAttribute(n,p);var c=e.morphTargetInfluences;if(o&&c){nl.set(0,0,0);ol.set(0,0,0);sl.set(0,0,0);for(var h=0,y=o.length;h<y;h++){var m=c[h],g=o[h];if(0===m)continue;al.fromBufferAttribute(g,u);rl.fromBufferAttribute(g,a);il.fromBufferAttribute(g,p);if(s){nl.addScaledVector(al,m);ol.addScaledVector(rl,m);sl.addScaledVector(il,m)}else{nl.addScaledVector(al.sub($s),m);ol.addScaledVector(rl.sub(el),m);sl.addScaledVector(il.sub(tl),m)}}$s.add(nl);el.add(ol);tl.add(sl)}if(e.isSkinnedMesh){e.boneTransform(u,$s);e.boneTransform(a,el);e.boneTransform(p,tl)}var f=v(e,t,r,i,$s,el,tl,pl);if(f){if(l){ll.fromBufferAttribute(l,u);dl.fromBufferAttribute(l,a);ul.fromBufferAttribute(l,p);f.uv=Ms.getUV(pl,$s,el,tl,ll,dl,ul,new Jn)}if(d){ll.fromBufferAttribute(d,u);dl.fromBufferAttribute(d,a);ul.fromBufferAttribute(d,p);f.uv2=Ms.getUV(pl,$s,el,tl,ll,dl,ul,new Jn)}var _={a:u,b:a,c:p,normal:new mo,materialIndex:0};Ms.getNormal($s,el,tl,_.normal);f.face=_}return f}var gl=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var r,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:1,d=5<arguments.length&&arguments[5]!==void 0?arguments[5]:1;_classCallCheck(this,t);r=a.call(this);r.type="BoxGeometry";r.parameters={width:i,height:n,depth:o,widthSegments:s,heightSegments:l,depthSegments:d};var p=_assertThisInitialized(r);s=Math.floor(s);l=Math.floor(l);d=Math.floor(d);var m=[],g=[],f=[],h=[],_=0,E=0;e("z","y","x",-1,-1,o,n,i,d,l,0);e("z","y","x",1,-1,o,n,-i,d,l,1);e("x","z","y",1,1,i,o,n,s,d,2);e("x","z","y",1,-1,i,o,-n,s,d,3);e("x","y","z",1,-1,i,n,o,s,l,4);e("x","y","z",-1,-1,i,n,-o,s,l,5);r.setIndex(m);r.setAttribute("position",new zs(g,3));r.setAttribute("normal",new zs(f,3));r.setAttribute("uv",new zs(h,2));function e(e,t,r,i,n,o,s,l,u,v,S){for(var T=u+1,M=0,A=0,R=new mo,w=0,L;w<v+1;w++){L=w*(s/v)-s/2;for(var d=0,k;d<T;d++){k=d*(o/u)-o/2;R[e]=k*i;R[t]=L*n;R[r]=l/2;g.push(R.x,R.y,R.z);R[e]=0;R[t]=0;R[r]=0<l?1:-1;f.push(R.x,R.y,R.z);h.push(d/u);h.push(1-w/v);M+=1}}for(var x=0;x<v;x++){for(var P=0;P<u;P++){var C=_+P+T*x,a=_+P+T*(x+1),b=_+(P+1)+T*(x+1),c=_+(P+1)+T*x;m.push(C,a,c);m.push(a,b,c);A+=6}}p.addGroup(E,A,S);E+=A;_+=M}return r}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]);return t}(Zs);function x(e){var t={};for(var a in e){t[a]={};for(var r in e[a]){var i=e[a][r];if(i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)){t[a][r]=i.clone()}else if(Array.isArray(i)){t[a][r]=i.slice()}else{t[a][r]=i}}}return t}function b(e){for(var t={},a=0,r;a<e.length;a++){r=x(e[a]);for(var i in r){t[i]=r[i]}}return t}var fl={clone:x,merge:b},hl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="ShaderMaterial";r.defines={};r.uniforms={};r.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";r.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";r.linewidth=1;r.wireframe=!1;r.wireframeLinewidth=1;r.fog=!1;r.lights=!1;r.clipping=!1;r.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};r.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};r.index0AttributeName=void 0;r.uniformsNeedUpdate=!1;r.glslVersion=null;if(e!==void 0){if(e.attributes!==void 0){console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.")}r.setValues(e)}return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.fragmentShader=e.fragmentShader;this.vertexShader=e.vertexShader;this.uniforms=x(e.uniforms);this.defines=Object.assign({},e.defines);this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.lights=e.lights;this.clipping=e.clipping;this.extensions=Object.assign({},e.extensions);this.glslVersion=e.glslVersion;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.glslVersion=this.glslVersion;a.uniforms={};for(var o in this.uniforms){var r=this.uniforms[o],i=r.value;if(i&&i.isTexture){a.uniforms[o]={type:"t",value:i.toJSON(e).uuid}}else if(i&&i.isColor){a.uniforms[o]={type:"c",value:i.getHex()}}else if(i&&i.isVector2){a.uniforms[o]={type:"v2",value:i.toArray()}}else if(i&&i.isVector3){a.uniforms[o]={type:"v3",value:i.toArray()}}else if(i&&i.isVector4){a.uniforms[o]={type:"v4",value:i.toArray()}}else if(i&&i.isMatrix3){a.uniforms[o]={type:"m3",value:i.toArray()}}else if(i&&i.isMatrix4){a.uniforms[o]={type:"m4",value:i.toArray()}}else{a.uniforms[o]={value:i}}}if(0<Object.keys(this.defines).length)a.defines=this.defines;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;var n={};for(var s in this.extensions){if(!0===this.extensions[s])n[s]=!0}if(0<Object.keys(n).length)a.extensions=n;return a}}]);return t}(Rs);hl.prototype.isShaderMaterial=!0;var yl=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck(this,t);e=a.call(this);e.type="Camera";e.matrixWorldInverse=new Vo;e.projectionMatrix=new Vo;e.projectionMatrixInverse=new Vo;return e}_createClass(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.matrixWorldInverse.copy(e.matrixWorldInverse);this.projectionMatrix.copy(e.projectionMatrix);this.projectionMatrixInverse.copy(e.projectionMatrixInverse);return this}},{key:"getWorldDirection",value:function getWorldDirection(t){this.updateWorldMatrix(!0,!1);var a=this.matrixWorld.elements;return t.set(-a[8],-a[9],-a[10]).normalize()}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e);this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function updateWorldMatrix(e,a){_get(_getPrototypeOf(t.prototype),"updateWorldMatrix",this).call(this,e,a);this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return t}(gs);yl.prototype.isCamera=!0;var vl=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:50,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:.1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:2e3;_classCallCheck(this,t);e=a.call(this);e.type="PerspectiveCamera";e.fov=r;e.zoom=1;e.near=n;e.far=o;e.focus=10;e.aspect=i;e.view=null;e.filmGauge=35;e.filmOffset=0;e.updateProjectionMatrix();return e}_createClass(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.fov=e.fov;this.zoom=e.zoom;this.near=e.near;this.far=e.far;this.focus=e.focus;this.aspect=e.aspect;this.view=null===e.view?null:Object.assign({},e.view);this.filmGauge=e.filmGauge;this.filmOffset=e.filmOffset;return this}},{key:"setFocalLength",value:function setFocalLength(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Yn*Math.atan(t);this.updateProjectionMatrix()}},{key:"getFocalLength",value:function getFocalLength(){var e=Math.tan(.5*qn*this.fov);return .5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function getEffectiveFOV(){return 2*Yn*Math.atan(Math.tan(.5*qn*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function setViewOffset(e,t,a,r,i,n){this.aspect=e/t;if(null===this.view){this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=!0;this.view.fullWidth=e;this.view.fullHeight=t;this.view.offsetX=a;this.view.offsetY=r;this.view.width=i;this.view.height=n;this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function clearViewOffset(){if(null!==this.view){this.view.enabled=!1}this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function updateProjectionMatrix(){var e=this.near,t=e*Math.tan(.5*qn*this.fov)/this.zoom,a=2*t,r=this.aspect*a,i=-.5*r,n=this.view;if(null!==this.view&&this.view.enabled){var s=n.fullWidth,l=n.fullHeight;i+=n.offsetX*r/s;t-=n.offsetY*a/l;r*=n.width/s;a*=n.height/l}var o=this.filmOffset;if(0!==o)i+=e*o/this.getFilmWidth();this.projectionMatrix.makePerspective(i,i+r,t,t-a,e,this.far);this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;if(null!==this.view)a.object.view=Object.assign({},this.view);a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}}]);return t}(yl);vl.prototype.isPerspectiveCamera=!0;var _l=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck(this,t);n=a.call(this);n.type="CubeCamera";if(!0!==i.isWebGLCubeRenderTarget){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return _possibleConstructorReturn(n)}n.renderTarget=i;var o=new vl(90,1,e,r);o.layers=n.layers;o.up.set(0,-1,0);o.lookAt(new mo(1,0,0));n.add(o);var s=new vl(90,1,e,r);s.layers=n.layers;s.up.set(0,-1,0);s.lookAt(new mo(-1,0,0));n.add(s);var l=new vl(90,1,e,r);l.layers=n.layers;l.up.set(0,0,1);l.lookAt(new mo(0,1,0));n.add(l);var d=new vl(90,1,e,r);d.layers=n.layers;d.up.set(0,0,-1);d.lookAt(new mo(0,-1,0));n.add(d);var u=new vl(90,1,e,r);u.layers=n.layers;u.up.set(0,-1,0);u.lookAt(new mo(0,0,1));n.add(u);var p=new vl(90,1,e,r);p.layers=n.layers;p.up.set(0,-1,0);p.lookAt(new mo(0,0,-1));n.add(p);return n}_createClass(t,[{key:"update",value:function update(e,t){if(null===this.parent)this.updateMatrixWorld();var a=this.renderTarget,r=_slicedToArray(this.children,6),i=r[0],n=r[1],o=r[2],s=r[3],l=r[4],d=r[5],u=e.xr.enabled,p=e.getRenderTarget();e.xr.enabled=!1;var c=a.texture.generateMipmaps;a.texture.generateMipmaps=!1;e.setRenderTarget(a,0);e.render(t,i);e.setRenderTarget(a,1);e.render(t,n);e.setRenderTarget(a,2);e.render(t,o);e.setRenderTarget(a,3);e.render(t,s);e.setRenderTarget(a,4);e.render(t,l);a.texture.generateMipmaps=c;e.setRenderTarget(a,5);e.render(t,d);e.setRenderTarget(p);e.xr.enabled=u;a.texture.needsPMREMUpdate=!0}}]);return t}(gs),xl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,u,p){var c;_classCallCheck(this,t);e=e!==void 0?e:[];r=r!==void 0?r:Dr;c=a.call(this,e,r,i,n,o,s,l,d,u,p);c.flipY=!1;return c}_createClass(t,[{key:"images",get:function get(){return this.image},set:function set(e){this.image=e}}]);return t}(oo);xl.prototype.isCubeTexture=!0;var bl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck(this,t);if(Number.isInteger(r)){console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )");r=i}n=a.call(this,e,e,r);r=r||{};n.texture=new xl(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding);n.texture.isRenderTargetTexture=!0;n.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1;n.texture.minFilter=r.minFilter!==void 0?r.minFilter:Yr;return n}_createClass(t,[{key:"fromEquirectangularTexture",value:function fromEquirectangularTexture(e,t){this.texture.type=t.type;this.texture.format=ci;this.texture.encoding=t.encoding;this.texture.generateMipmaps=t.generateMipmaps;this.texture.minFilter=t.minFilter;this.texture.magFilter=t.magFilter;var a={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new gl(5,5,5),i=new hl({name:"CubemapFromEquirect",uniforms:x(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:Wa,blending:Ya});i.uniforms.tEquirect.value=t;var n=new ml(r,i),o=t.minFilter;if(t.minFilter===Kr)t.minFilter=Yr;var s=new _l(1,10,this);s.update(e,n);t.minFilter=o;n.geometry.dispose();n.material.dispose();return this}},{key:"clear",value:function clear(e,t,a,r){for(var i=e.getRenderTarget(),n=0;6>n;n++){e.setRenderTarget(this,n);e.clear(t,a,r)}e.setRenderTarget(i)}}]);return t}(lo);bl.prototype.isWebGLCubeRenderTarget=!0;var El=new mo,Sl=new mo,Tl=new Kn,Ml=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new mo(1,0,0),a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck(this,e);this.normal=t;this.constant=a}_createClass(e,[{key:"set",value:function set(e,t){this.normal.copy(e);this.constant=t;return this}},{key:"setComponents",value:function setComponents(e,t,a,r){this.normal.set(e,t,a);this.constant=r;return this}},{key:"setFromNormalAndCoplanarPoint",value:function setFromNormalAndCoplanarPoint(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this}},{key:"setFromCoplanarPoints",value:function setFromCoplanarPoints(e,t,a){var r=El.subVectors(a,t).cross(Sl.subVectors(e,t)).normalize();this.setFromNormalAndCoplanarPoint(r,e);return this}},{key:"copy",value:function copy(e){this.normal.copy(e.normal);this.constant=e.constant;return this}},{key:"normalize",value:function normalize(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this}},{key:"negate",value:function negate(){this.constant*=-1;this.normal.negate();return this}},{key:"distanceToPoint",value:function distanceToPoint(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function intersectLine(e,a){var r=e.delta(El),i=this.normal.dot(r);if(0===i){if(0===this.distanceToPoint(e.start)){return a.copy(e.start)}return null}var n=-(e.start.dot(this.normal)+this.constant)/i;if(0>n||1<n){return null}return a.copy(r).multiplyScalar(n).add(e.start)}},{key:"intersectsLine",value:function intersectsLine(e){var t=this.distanceToPoint(e.start),a=this.distanceToPoint(e.end);return 0>t&&0<a||0>a&&0<t}},{key:"intersectsBox",value:function intersectsBox(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function intersectsSphere(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function applyMatrix4(e,t){var a=t||Tl.getNormalMatrix(e),r=this.coplanarPoint(El).applyMatrix4(e),i=this.normal.applyMatrix3(a).normalize();this.constant=-r.dot(i);return this}},{key:"translate",value:function translate(e){this.constant-=e.dot(this.normal);return this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}();Ml.prototype.isPlane=!0;var Al=new Do,Rl=new mo,wl=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Ml,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Ml,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new Ml,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:new Ml,n=4<arguments.length&&arguments[4]!==void 0?arguments[4]:new Ml,o=5<arguments.length&&arguments[5]!==void 0?arguments[5]:new Ml;_classCallCheck(this,e);this.planes=[t,a,r,i,n,o]}_createClass(e,[{key:"set",value:function set(e,t,a,r,i,n){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(a);o[3].copy(r);o[4].copy(i);o[5].copy(n);return this}},{key:"copy",value:function copy(e){for(var t=this.planes,a=0;6>a;a++){t[a].copy(e.planes[a])}return this}},{key:"setFromProjectionMatrix",value:function setFromProjectionMatrix(e){var t=this.planes,a=e.elements,r=a[0],i=a[1],n=a[2],o=a[3],s=a[4],l=a[5],d=a[6],u=a[7],p=a[8],c=a[9],m=a[10],g=a[11],f=a[12],h=a[13],y=a[14],v=a[15];t[0].setComponents(o-r,u-s,g-p,v-f).normalize();t[1].setComponents(o+r,u+s,g+p,v+f).normalize();t[2].setComponents(o+i,u+l,g+c,v+h).normalize();t[3].setComponents(o-i,u-l,g-c,v-h).normalize();t[4].setComponents(o-n,u-d,g-m,v-y).normalize();t[5].setComponents(o+n,u+d,g+m,v+y).normalize();return this}},{key:"intersectsObject",value:function intersectsObject(e){var t=e.geometry;if(null===t.boundingSphere)t.computeBoundingSphere();Al.copy(t.boundingSphere).applyMatrix4(e.matrixWorld);return this.intersectsSphere(Al)}},{key:"intersectsSprite",value:function intersectsSprite(e){Al.center.set(0,0,0);Al.radius=.7071067811865476;Al.applyMatrix4(e.matrixWorld);return this.intersectsSphere(Al)}},{key:"intersectsSphere",value:function intersectsSphere(e){for(var t=this.planes,a=e.center,r=-e.radius,i=0,n;6>i;i++){n=t[i].distanceToPoint(a);if(n<r){return!1}}return!0}},{key:"intersectsBox",value:function intersectsBox(e){for(var t=this.planes,a=0,r;6>a;a++){r=t[a];Rl.x=0<r.normal.x?e.max.x:e.min.x;Rl.y=0<r.normal.y?e.max.y:e.min.y;Rl.z=0<r.normal.z?e.max.z:e.min.z;if(0>r.distanceToPoint(Rl)){return!1}}return!0}},{key:"containsPoint",value:function containsPoint(e){for(var t=this.planes,a=0;6>a;a++){if(0>t[a].distanceToPoint(e)){return!1}}return!0}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}();function E(){var t=null,a=!1,r=null,i=null;function e(a,n){r(a,n);i=t.requestAnimationFrame(e)}return{start:function start(){if(!0===a)return;if(null===r)return;i=t.requestAnimationFrame(e);a=!0},stop:function stop(){t.cancelAnimationFrame(i);a=!1},setAnimationLoop:function setAnimationLoop(e){r=e},setContext:function setContext(e){t=e}}}function S(e,t){var i=t.isWebGL2,n=new WeakMap;function a(t,a){var r=t.array,n=t.usage,o=e.createBuffer();e.bindBuffer(a,o);e.bufferData(a,r,n);t.onUploadCallback();var s=e.FLOAT;if(r instanceof Float32Array){s=e.FLOAT}else if(r instanceof Float64Array){console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.")}else if(r instanceof Uint16Array){if(t.isFloat16BufferAttribute){if(i){s=e.HALF_FLOAT}else{console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.")}}else{s=e.UNSIGNED_SHORT}}else if(r instanceof Int16Array){s=e.SHORT}else if(r instanceof Uint32Array){s=e.UNSIGNED_INT}else if(r instanceof Int32Array){s=e.INT}else if(r instanceof Int8Array){s=e.BYTE}else if(r instanceof Uint8Array){s=e.UNSIGNED_BYTE}else if(r instanceof Uint8ClampedArray){s=e.UNSIGNED_BYTE}return{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}function r(t,a,r){var n=a.array,o=a.updateRange;e.bindBuffer(r,t);if(-1===o.count){e.bufferSubData(r,0,n)}else{if(i){e.bufferSubData(r,o.offset*n.BYTES_PER_ELEMENT,n,o.offset,o.count)}else{e.bufferSubData(r,o.offset*n.BYTES_PER_ELEMENT,n.subarray(o.offset,o.offset+o.count))}o.count=-1}}return{get:function(e){if(e.isInterleavedBufferAttribute)e=e.data;return n.get(e)},remove:function(t){if(t.isInterleavedBufferAttribute)t=t.data;var a=n.get(t);if(a){e.deleteBuffer(a.buffer);n.delete(t)}},update:function(e,t){if(e.isGLBufferAttribute){var o=n.get(e);if(!o||o.version<e.version){n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}return}if(e.isInterleavedBufferAttribute)e=e.data;var i=n.get(e);if(i===void 0){n.set(e,a(e,t))}else if(i.version<e.version){r(i.buffer,e,t);i.version=e.version}}}}var Ll=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck(this,t);e=r.call(this);e.type="PlaneGeometry";e.parameters={width:i,height:n,widthSegments:o,heightSegments:s};for(var l=Math.floor(o),u=Math.floor(s),p=l+1,m=[],g=[],f=[],h=[],v=0,_;v<u+1;v++){_=v*(n/u)-n/2;for(var d=0,S;d<p;d++){S=d*(i/l)-i/2;g.push(S,-_,0);f.push(0,0,1);h.push(d/l);h.push(1-v/u)}}for(var x=0;x<u;x++){for(var T=0;T<l;T++){var E=T+p*x,a=T+p*(x+1),b=T+1+p*(x+1),c=T+1+p*x;m.push(E,a,c);m.push(a,b,c)}}e.setIndex(m);e.setAttribute("position",new zs(g,3));e.setAttribute("normal",new zs(f,3));e.setAttribute("uv",new zs(h,2));return e}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.width,e.height,e.widthSegments,e.heightSegments)}}]);return t}(Zs),Cl={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\treturn texture2D( envMap, uv ).rgb;\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},kl={common:{diffuse:{value:new ao(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Kn},uv2Transform:{value:new Kn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Jn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ao(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ao(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Kn}},sprite:{diffuse:{value:new ao(16777215)},opacity:{value:1},center:{value:new Jn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Kn}}},Pl={basic:{uniforms:b([kl.common,kl.specularmap,kl.envmap,kl.aomap,kl.lightmap,kl.fog]),vertexShader:Cl.meshbasic_vert,fragmentShader:Cl.meshbasic_frag},lambert:{uniforms:b([kl.common,kl.specularmap,kl.envmap,kl.aomap,kl.lightmap,kl.emissivemap,kl.fog,kl.lights,{emissive:{value:new ao(0)}}]),vertexShader:Cl.meshlambert_vert,fragmentShader:Cl.meshlambert_frag},phong:{uniforms:b([kl.common,kl.specularmap,kl.envmap,kl.aomap,kl.lightmap,kl.emissivemap,kl.bumpmap,kl.normalmap,kl.displacementmap,kl.fog,kl.lights,{emissive:{value:new ao(0)},specular:{value:new ao(1118481)},shininess:{value:30}}]),vertexShader:Cl.meshphong_vert,fragmentShader:Cl.meshphong_frag},standard:{uniforms:b([kl.common,kl.envmap,kl.aomap,kl.lightmap,kl.emissivemap,kl.bumpmap,kl.normalmap,kl.displacementmap,kl.roughnessmap,kl.metalnessmap,kl.fog,kl.lights,{emissive:{value:new ao(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Cl.meshphysical_vert,fragmentShader:Cl.meshphysical_frag},toon:{uniforms:b([kl.common,kl.aomap,kl.lightmap,kl.emissivemap,kl.bumpmap,kl.normalmap,kl.displacementmap,kl.gradientmap,kl.fog,kl.lights,{emissive:{value:new ao(0)}}]),vertexShader:Cl.meshtoon_vert,fragmentShader:Cl.meshtoon_frag},matcap:{uniforms:b([kl.common,kl.bumpmap,kl.normalmap,kl.displacementmap,kl.fog,{matcap:{value:null}}]),vertexShader:Cl.meshmatcap_vert,fragmentShader:Cl.meshmatcap_frag},points:{uniforms:b([kl.points,kl.fog]),vertexShader:Cl.points_vert,fragmentShader:Cl.points_frag},dashed:{uniforms:b([kl.common,kl.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Cl.linedashed_vert,fragmentShader:Cl.linedashed_frag},depth:{uniforms:b([kl.common,kl.displacementmap]),vertexShader:Cl.depth_vert,fragmentShader:Cl.depth_frag},normal:{uniforms:b([kl.common,kl.bumpmap,kl.normalmap,kl.displacementmap,{opacity:{value:1}}]),vertexShader:Cl.meshnormal_vert,fragmentShader:Cl.meshnormal_frag},sprite:{uniforms:b([kl.sprite,kl.fog]),vertexShader:Cl.sprite_vert,fragmentShader:Cl.sprite_frag},background:{uniforms:{uvTransform:{value:new Kn},t2D:{value:null}},vertexShader:Cl.background_vert,fragmentShader:Cl.background_frag},cube:{uniforms:b([kl.envmap,{opacity:{value:1}}]),vertexShader:Cl.cube_vert,fragmentShader:Cl.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Cl.equirect_vert,fragmentShader:Cl.equirect_frag},distanceRGBA:{uniforms:b([kl.common,kl.displacementmap,{referencePosition:{value:new mo},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Cl.distanceRGBA_vert,fragmentShader:Cl.distanceRGBA_frag},shadow:{uniforms:b([kl.lights,kl.fog,{color:{value:new ao(0)},opacity:{value:1}}]),vertexShader:Cl.shadow_vert,fragmentShader:Cl.shadow_frag}};Pl.physical={uniforms:b([Pl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Jn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new ao(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Jn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ao(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new ao(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Cl.meshphysical_vert,fragmentShader:Cl.meshphysical_frag};function T(e,t,a,r,i,n){var l=new ao(0),d=!0===i?0:1,u,p,c=null,m=0,g=null;function o(a,i){var n=!1,o=!0===i.isScene?i.background:null;if(o&&o.isTexture){o=t.get(o)}var f=e.xr,h=f.getSession&&f.getSession();if(h&&"additive"===h.environmentBlendMode){o=null}if(null===o){s(l,d)}else if(o&&o.isColor){s(o,1);n=!0}if(e.autoClear||n){e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)}if(o&&(o.isCubeTexture||o.mapping===Br)){if(p===void 0){p=new ml(new gl(1,1,1),new hl({name:"BackgroundCubeMaterial",uniforms:x(Pl.cube.uniforms),vertexShader:Pl.cube.vertexShader,fragmentShader:Pl.cube.fragmentShader,side:Wa,depthTest:!1,depthWrite:!1,fog:!1}));p.geometry.deleteAttribute("normal");p.geometry.deleteAttribute("uv");p.onBeforeRender=function(e,t,a){this.matrixWorld.copyPosition(a.matrixWorld)};Object.defineProperty(p.material,"envMap",{get:function get(){return this.uniforms.envMap.value}});r.update(p)}p.material.uniforms.envMap.value=o;p.material.uniforms.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1;if(c!==o||m!==o.version||g!==e.toneMapping){p.material.needsUpdate=!0;c=o;m=o.version;g=e.toneMapping}a.unshift(p,p.geometry,p.material,0,0,null)}else if(o&&o.isTexture){if(u===void 0){u=new ml(new Ll(2,2),new hl({name:"BackgroundMaterial",uniforms:x(Pl.background.uniforms),vertexShader:Pl.background.vertexShader,fragmentShader:Pl.background.fragmentShader,side:Va,depthTest:!1,depthWrite:!1,fog:!1}));u.geometry.deleteAttribute("normal");Object.defineProperty(u.material,"map",{get:function get(){return this.uniforms.t2D.value}});r.update(u)}u.material.uniforms.t2D.value=o;if(!0===o.matrixAutoUpdate){o.updateMatrix()}u.material.uniforms.uvTransform.value.copy(o.matrix);if(c!==o||m!==o.version||g!==e.toneMapping){u.material.needsUpdate=!0;c=o;m=o.version;g=e.toneMapping}a.unshift(u,u.geometry,u.material,0,0,null)}}function s(e,t){a.buffers.color.setClear(e.r,e.g,e.b,t,n)}return{getClearColor:function getClearColor(){return l},setClearColor:function setClearColor(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;l.set(e);d=t;s(l,d)},getClearAlpha:function getClearAlpha(){return d},setClearAlpha:function setClearAlpha(e){d=e;s(l,d)},render:o}}function M(e,t,a,r){var x=e.getParameter(e.MAX_VERTEX_ATTRIBS),b=r.isWebGL2?null:t.get("OES_vertex_array_object"),E=r.isWebGL2||null!==b,S={},T=d(null),M=T;function i(t,r,i,n,s){var d=!1;if(E){var c=l(n,i,r);if(M!==c){M=c;o(M.object)}d=u(n,s);if(d)p(n,s)}else{var m=!0===r.wireframe;if(M.geometry!==n.id||M.program!==i.id||M.wireframe!==m){M.geometry=n.id;M.program=i.id;M.wireframe=m;d=!0}}if(!0===t.isInstancedMesh){d=!0}if(null!==s){a.update(s,e.ELEMENT_ARRAY_BUFFER)}if(d){y(t,r,i,n);if(null!==s){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.get(s).buffer)}}}function n(){if(r.isWebGL2)return e.createVertexArray();return b.createVertexArrayOES()}function o(t){if(r.isWebGL2)return e.bindVertexArray(t);return b.bindVertexArrayOES(t)}function s(t){if(r.isWebGL2)return e.deleteVertexArray(t);return b.deleteVertexArrayOES(t)}function l(e,t,a){var r=!0===a.wireframe,i=S[e.id];if(i===void 0){i={};S[e.id]=i}var o=i[t.id];if(o===void 0){o={};i[t.id]=o}var s=o[r];if(s===void 0){s=d(n());o[r]=s}return s}function d(e){for(var t=[],a=[],r=[],i=0;i<x;i++){t[i]=0;a[i]=0;r[i]=0}return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:a,attributeDivisors:r,object:e,attributes:{},index:null}}function u(e,t){var a=M.attributes,r=e.attributes,i=0;for(var s in r){var n=a[s],o=r[s];if(n===void 0)return!0;if(n.attribute!==o)return!0;if(n.data!==o.data)return!0;i++}if(M.attributesNum!==i)return!0;if(M.index!==t)return!0;return!1}function p(e,t){var a={},r=e.attributes,i=0;for(var s in r){var n=r[s],o={};o.attribute=n;if(n.data){o.data=n.data}a[s]=o;i++}M.attributes=a;M.attributesNum=i;M.index=t}function c(){for(var e=M.newAttributes,t=0,a=e.length;t<a;t++){e[t]=0}}function m(e){g(e,0)}function g(a,i){var n=M.newAttributes,o=M.enabledAttributes,s=M.attributeDivisors;n[a]=1;if(0===o[a]){e.enableVertexAttribArray(a);o[a]=1}if(s[a]!==i){var l=r.isWebGL2?e:t.get("ANGLE_instanced_arrays");l[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](a,i);s[a]=i}}function f(){for(var t=M.newAttributes,a=M.enabledAttributes,r=0,i=a.length;r<i;r++){if(a[r]!==t[r]){e.disableVertexAttribArray(r);a[r]=0}}}function h(t,a,i,n,o,s){if(!0===r.isWebGL2&&(i===e.INT||i===e.UNSIGNED_INT)){e.vertexAttribIPointer(t,a,i,o,s)}else{e.vertexAttribPointer(t,a,i,n,o,s)}}function y(i,n,o,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)){if(null===t.get("ANGLE_instanced_arrays"))return}c();var l=s.attributes,d=o.getAttributes(),u=n.defaultAttributeValues;for(var M in d){var A=d[M];if(0<=A.location){var R=l[M];if(R===void 0){if("instanceMatrix"===M&&i.instanceMatrix)R=i.instanceMatrix;if("instanceColor"===M&&i.instanceColor)R=i.instanceColor}if(R!==void 0){var p=R.normalized,y=R.itemSize,v=a.get(R);if(v===void 0)continue;var _=v.buffer,x=v.type,b=v.bytesPerElement;if(R.isInterleavedBufferAttribute){var E=R.data,S=E.stride,T=R.offset;if(E&&E.isInstancedInterleavedBuffer){for(var w=0;w<A.locationSize;w++){g(A.location+w,E.meshPerAttribute)}if(!0!==i.isInstancedMesh&&s._maxInstanceCount===void 0){s._maxInstanceCount=E.meshPerAttribute*E.count}}else{for(var L=0;L<A.locationSize;L++){m(A.location+L)}}e.bindBuffer(e.ARRAY_BUFFER,_);for(var C=0;C<A.locationSize;C++){h(A.location+C,y/A.locationSize,x,p,S*b,(T+y/A.locationSize*C)*b)}}else{if(R.isInstancedBufferAttribute){for(var k=0;k<A.locationSize;k++){g(A.location+k,R.meshPerAttribute)}if(!0!==i.isInstancedMesh&&s._maxInstanceCount===void 0){s._maxInstanceCount=R.meshPerAttribute*R.count}}else{for(var P=0;P<A.locationSize;P++){m(A.location+P)}}e.bindBuffer(e.ARRAY_BUFFER,_);for(var I=0;I<A.locationSize;I++){h(A.location+I,y/A.locationSize,x,p,y*b,y/A.locationSize*I*b)}}}else if(u!==void 0){var D=u[M];if(D!==void 0){switch(D.length){case 2:e.vertexAttrib2fv(A.location,D);break;case 3:e.vertexAttrib3fv(A.location,D);break;case 4:e.vertexAttrib4fv(A.location,D);break;default:e.vertexAttrib1fv(A.location,D);}}}}}f()}function v(){_();if(M===T)return;M=T;o(M.object)}function _(){T.geometry=null;T.program=null;T.wireframe=!1}return{setup:i,reset:v,resetDefaultState:_,dispose:function(){v();for(var e in S){var t=S[e];for(var a in t){var r=t[a];for(var i in r){s(r[i].object);delete r[i]}delete t[a]}delete S[e]}},releaseStatesOfGeometry:function(e){if(S[e.id]===void 0)return;var t=S[e.id];for(var a in t){var r=t[a];for(var i in r){s(r[i].object);delete r[i]}delete t[a]}delete S[e.id]},releaseStatesOfProgram:function(e){for(var t in S){var a=S[t];if(a[e.id]===void 0)continue;var r=a[e.id];for(var i in r){s(r[i].object);delete r[i]}delete a[e.id]}},initAttributes:c,enableAttribute:m,disableUnusedAttributes:f}}function A(e,t,a,r){var o=r.isWebGL2,s;function i(t,r){e.drawArrays(s,t,r);a.update(r,s,1)}function n(r,i,n){if(0===n)return;var l,d;if(o){l=e;d="drawArraysInstanced"}else{l=t.get("ANGLE_instanced_arrays");d="drawArraysInstancedANGLE";if(null===l){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}l[d](s,r,i,n);a.update(i,s,n)}this.setMode=function(e){s=e};this.render=i;this.renderInstances=n}function R(e,t,a){var n;function r(){if(n!==void 0)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){var a=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else{n=0}return n}function i(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision){return"highp"}t="mediump"}if("mediump"===t){if(0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision){return"mediump"}}return"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,s=a.precision!==void 0?a.precision:"highp",l=i(s);if(l!==s){console.warn("THREE.WebGLRenderer:",s,"not supported, using",l,"instead.");s=l}var d=o||t.has("WEBGL_draw_buffers"),u=!0===a.logarithmicDepthBuffer,p=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=e.getParameter(e.MAX_TEXTURE_SIZE),g=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),h=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),y=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),_=0<c,x=o||t.has("OES_texture_float"),b=o?e.getParameter(e.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:d,getMaxAnisotropy:r,getMaxPrecision:i,precision:s,logarithmicDepthBuffer:u,maxTextures:p,maxVertexTextures:c,maxTextureSize:m,maxCubemapSize:g,maxAttributes:f,maxVertexUniforms:h,maxVaryings:y,maxFragmentUniforms:v,vertexTextures:_,floatFragmentTextures:x,floatVertexTextures:_&&x,maxSamples:b}}function w(e){var r=this,i=null,n=0,o=!1,s=!1,l=new Ml,d=new Kn,u={value:null,needsUpdate:!1};this.uniform=u;this.numPlanes=0;this.numIntersection=0;this.init=function(e,t,r){var s=0!==e.length||t||0!==n||o;o=t;i=a(e,r,0);n=e.length;return s};this.beginShadows=function(){s=!0;a(null)};this.endShadows=function(){s=!1;t()};this.setState=function(r,l,d){var p=r.clippingPlanes,c=r.clipIntersection,m=r.clipShadows,g=e.get(r);if(!o||null===p||0===p.length||s&&!m){if(s){a(null)}else{t()}}else{var f=s?0:n,h=4*f,y=g.clippingState||null;u.value=y;y=a(p,l,h,d);for(var v=0;v!=h;++v){y[v]=i[v]}g.clippingState=y;this.numIntersection=c?this.numPlanes:0;this.numPlanes+=f}};function t(){if(u.value!==i){u.value=i;u.needsUpdate=0<n}r.numPlanes=n;r.numIntersection=0}function a(e,t,a,i){var n=null!==e?e.length:0,o=null;if(0!==n){o=u.value;if(!0!==i||null===o){var s=a+4*n,p=t.matrixWorldInverse;d.getNormalMatrix(p);if(null===o||o.length<s){o=new Float32Array(s)}for(var c=0,m=a;c!==n;++c,m+=4){l.copy(e[c]).applyMatrix4(p,d);l.normal.toArray(o,m);o[m+3]=l.constant}}u.value=o;u.needsUpdate=!0}r.numPlanes=n;r.numIntersection=0;return o}}function L(e){var i=new WeakMap;function t(e,t){if(t===Ur){e.mapping=Dr}else if(t===Fr){e.mapping=Nr}return e}function a(a){if(a&&a.isTexture&&!1===a.isRenderTargetTexture){var n=a.mapping;if(n===Ur||n===Fr){if(i.has(a)){var o=i.get(a).texture;return t(o,a.mapping)}else{var s=a.image;if(s&&0<s.height){var l=new bl(s.height/2);l.fromEquirectangularTexture(e,a);i.set(a,l);a.addEventListener("dispose",r);return t(l.texture,a.mapping)}else{return null}}}}return a}function r(e){var t=e.target;t.removeEventListener("dispose",r);var a=i.get(t);if(a!==void 0){i.delete(t);a.dispose()}}return{get:a,dispose:function(){i=new WeakMap}}}var Il=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:-1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:-1,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:.1,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:2e3;_classCallCheck(this,t);e=a.call(this);e.type="OrthographicCamera";e.zoom=1;e.view=null;e.left=r;e.right=i;e.top=n;e.bottom=o;e.near=s;e.far=l;e.updateProjectionMatrix();return e}_createClass(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);this.left=e.left;this.right=e.right;this.top=e.top;this.bottom=e.bottom;this.near=e.near;this.far=e.far;this.zoom=e.zoom;this.view=null===e.view?null:Object.assign({},e.view);return this}},{key:"setViewOffset",value:function setViewOffset(e,t,a,r,i,n){if(null===this.view){this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=!0;this.view.fullWidth=e;this.view.fullHeight=t;this.view.offsetX=a;this.view.offsetY=r;this.view.width=i;this.view.height=n;this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function clearViewOffset(){if(null!==this.view){this.view.enabled=!1}this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function updateProjectionMatrix(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),a=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=a-e,n=a+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=l*this.view.offsetX;n=i+l*this.view.width;o-=d*this.view.offsetY;s=o-d*this.view.height}this.projectionMatrix.makeOrthographic(i,n,o,s,this.near,this.far);this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;if(null!==this.view)a.object.view=Object.assign({},this.view);return a}}]);return t}(yl);Il.prototype.isOrthographicCamera=!0;var Dl=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this,e);r.type="RawShaderMaterial";return r}return t}(hl);Dl.prototype.isRawShaderMaterial=!0;var Nl=8,Ul=Math.pow(2,Nl),Fl=[.125,.215,.35,.446,.526,.582],Bl=Nl-4+1+Fl.length,Ol=20,zl=new Il,Hl=function(){for(var e=[],t=[],a=[],r=Nl,i=0,n;i<Bl;i++){n=Math.pow(2,r);t.push(n);var y=1/n;if(i>Nl-4){y=Fl[i-Nl+4-1]}else if(0===i){y=0}a.push(y);for(var o=1/(n-1),s=-o/2,l=1+o/2,d=[s,s,l,s,l,l,s,s,l,l,s,l],u=6,p=6,c=3,m=2,g=1,f=new Float32Array(c*p*u),h=new Float32Array(m*p*u),v=new Float32Array(g*p*u),_=0;_<u;_++){var b=2*(_%3)/3-1,x=2<_?0:-1;f.set([b,x,0,b+2/3,x,0,b+2/3,x+1,0,b,x,0,b+2/3,x+1,0,b,x+1,0],c*p*_);h.set(d,m*p*_);var E=[_,_,_,_,_,_];v.set(E,g*p*_)}var S=new Zs;S.setAttribute("position",new ks(f,c));S.setAttribute("uv",new ks(h,m));S.setAttribute("faceIndex",new ks(v,g));e.push(S);if(r>4){r--}}return{_lodPlanes:e,_sizeLods:t,_sigmas:a}}(),Gl=Hl._lodPlanes,Vl=Hl._sizeLods,Wl=Hl._sigmas,jl=new ao,Xl=null,ql=(1+Math.sqrt(5))/2,Yl=1/ql,Zl=[new mo(1,1,1),new mo(-1,1,1),new mo(1,1,-1),new mo(-1,1,-1),new mo(0,ql,Yl),new mo(0,ql,-Yl),new mo(Yl,0,ql),new mo(-Yl,0,ql),new mo(ql,Yl,0),new mo(-ql,Yl,0)],Jl=function(){function e(t){_classCallCheck(this,e);this._renderer=t;this._pingPongRenderTarget=null;this._blurMaterial=P(Ol);this._equirectShader=null;this._cubemapShader=null;this._compileMaterial(this._blurMaterial)}_createClass(e,[{key:"fromScene",value:function fromScene(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:.1,r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:100;Xl=this._renderer.getRenderTarget();var i=this._allocateTargets();this._sceneToCubeUV(e,a,r,i);if(0<t){this._blur(i,0,0,t)}this._applyPMREM(i);this._cleanup(i);return i}},{key:"fromEquirectangular",value:function fromEquirectangular(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function fromCubemap(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function compileCubemapShader(){if(null===this._cubemapShader){this._cubemapShader=D();this._compileMaterial(this._cubemapShader)}}},{key:"compileEquirectangularShader",value:function compileEquirectangularShader(){if(null===this._equirectShader){this._equirectShader=I();this._compileMaterial(this._equirectShader)}}},{key:"dispose",value:function dispose(){this._blurMaterial.dispose();if(null!==this._pingPongRenderTarget)this._pingPongRenderTarget.dispose();if(null!==this._cubemapShader)this._cubemapShader.dispose();if(null!==this._equirectShader)this._equirectShader.dispose();for(var e=0;e<Gl.length;e++){Gl[e].dispose()}}},{key:"_cleanup",value:function _cleanup(e){this._renderer.setRenderTarget(Xl);e.scissorTest=!1;k(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function _fromTexture(e,t){Xl=this._renderer.getRenderTarget();var a=t||this._allocateTargets(e);this._textureToCubeUV(e,a);this._applyPMREM(a);this._cleanup(a);return a}},{key:"_allocateTargets",value:function _allocateTargets(e){var t={magFilter:Yr,minFilter:Yr,generateMipmaps:!1,type:oi,format:ci,encoding:dn,depthBuffer:!1},a=C(t);a.depthBuffer=e?!1:!0;if(null===this._pingPongRenderTarget){this._pingPongRenderTarget=C(t)}return a}},{key:"_compileMaterial",value:function _compileMaterial(e){var t=new ml(Gl[0],e);this._renderer.compile(t,zl)}},{key:"_sceneToCubeUV",value:function _sceneToCubeUV(e,t,a,r){var i=new vl(90,1,t,a),n=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,d=s.toneMapping;s.getClearColor(jl);s.toneMapping=Rr;s.autoClear=!1;var u=new ws({name:"PMREM.Background",side:Wa,depthWrite:!1,depthTest:!1}),p=new ml(new gl(),u),c=!1,m=e.background;if(m){if(m.isColor){u.color.copy(m);e.background=null;c=!0}}else{u.color.copy(jl);c=!0}for(var g=0,f;6>g;g++){f=g%3;if(0==f){i.up.set(0,n[g],0);i.lookAt(o[g],0,0)}else if(1===f){i.up.set(0,0,n[g]);i.lookAt(0,o[g],0)}else{i.up.set(0,n[g],0);i.lookAt(0,0,o[g])}k(r,f*Ul,2<g?Ul:0,Ul,Ul);s.setRenderTarget(r);if(c){s.render(p,i)}s.render(e,i)}p.geometry.dispose();p.material.dispose();s.toneMapping=d;s.autoClear=l;e.background=m}},{key:"_textureToCubeUV",value:function _textureToCubeUV(e,t){var a=this._renderer,r=e.mapping===Dr||e.mapping===Nr;if(r){if(null===this._cubemapShader){this._cubemapShader=D()}this._cubemapShader.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1}else{if(null===this._equirectShader){this._equirectShader=I()}}var i=r?this._cubemapShader:this._equirectShader,n=new ml(Gl[0],i),o=i.uniforms;o.envMap.value=e;if(!r){o.texelSize.value.set(1/e.image.width,1/e.image.height)}k(t,0,0,3*Ul,2*Ul);a.setRenderTarget(t);a.render(n,zl)}},{key:"_applyPMREM",value:function _applyPMREM(e){var t=this._renderer,a=t.autoClear;t.autoClear=!1;for(var n=1;n<Bl;n++){var r=Math.sqrt(Wl[n]*Wl[n]-Wl[n-1]*Wl[n-1]),i=Zl[(n-1)%Zl.length];this._blur(e,n-1,n,r,i)}t.autoClear=a}},{key:"_blur",value:function _blur(e,t,a,r,i){var n=this._pingPongRenderTarget;this._halfBlur(e,n,t,a,r,"latitudinal",i);this._halfBlur(n,e,a,a,r,"longitudinal",i)}},{key:"_halfBlur",value:function _halfBlur(e,t,a,r,i,n,o){var s=this._renderer,l=this._blurMaterial;if("latitudinal"!==n&&"longitudinal"!==n){console.error("blur direction must be either latitudinal or longitudinal!")}var d=new ml(Gl[r],l),u=l.uniforms,p=Vl[a]-1,c=isFinite(i)?Math.PI/(2*p):2*Math.PI/(2*Ol-1),m=i/c,g=isFinite(i)?1+Math.floor(3*m):Ol;if(g>Ol){console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(g," samples when the maximum is set to ").concat(Ol))}for(var f=[],h=0,v=0;v<Ol;++v){var _=v/m,b=Math.exp(-_*_/2);f.push(b);if(0==v){h+=b}else if(v<g){h+=2*b}}for(var y=0;y<f.length;y++){f[y]=f[y]/h}u.envMap.value=e.texture;u.samples.value=g;u.weights.value=f;u.latitudinal.value="latitudinal"===n;if(o){u.poleAxis.value=o}u.dTheta.value=c;u.mipInt.value=Nl-a;var E=Vl[r],S=3*Math.max(0,Ul-2*E),x=(0===r?0:2*Ul)+2*E*(r>Nl-4?r-Nl+4:0);k(t,S,x,3*E,2*E);s.setRenderTarget(t);s.render(d,zl)}}]);return e}();function C(e){var t=new lo(3*Ul,3*Ul,e);t.texture.mapping=Br;t.texture.name="PMREM.cubeUv";t.scissorTest=!0;return t}function k(e,t,a,r,i){e.viewport.set(t,a,r,i);e.scissor.set(t,a,r,i)}function P(e){var t=new Float32Array(e),a=new mo(0,1,0),r=new Dl({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:N(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:Ya,depthTest:!1,depthWrite:!1});return r}function I(){var e=new Jn(1,1),t=new Dl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e}},vertexShader:N(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = texture2D ( envMap, uv ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t}\n\t\t",blending:Ya,depthTest:!1,depthWrite:!1});return t}function D(){var e=new Dl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:N(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:Ya,depthTest:!1,depthWrite:!1});return e}function N(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function U(e){var n=new WeakMap,o=null;function t(t){if(t&&t.isTexture){var i=t.mapping,s=i===Ur||i===Fr,l=i===Dr||i===Nr;if(s||l){if(t.isRenderTargetTexture&&!0===t.needsPMREMUpdate){t.needsPMREMUpdate=!1;var d=n.get(t);if(null===o)o=new Jl(e);d=s?o.fromEquirectangular(t,d):o.fromCubemap(t,d);n.set(t,d);return d.texture}else{if(n.has(t)){return n.get(t).texture}else{var u=t.image;if(s&&u&&0<u.height||l&&u&&a(u)){if(null===o)o=new Jl(e);var p=s?o.fromEquirectangular(t):o.fromCubemap(t);n.set(t,p);t.addEventListener("dispose",r);return p.texture}else{return null}}}}}return t}function a(e){for(var t=0,a=6,r=0;r<a;r++){if(e[r]!==void 0)t++}return t===a}function r(e){var t=e.target;t.removeEventListener("dispose",r);var a=n.get(t);if(a!==void 0){n.delete(t);a.dispose()}}function i(){n=new WeakMap;if(null!==o){o.dispose();o=null}}return{get:t,dispose:i}}function F(e){var a={};function t(t){if(a[t]!==void 0){return a[t]}var r;switch(t){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(t);}a[t]=r;return r}return{has:function has(e){return null!==t(e)},init:function init(e){if(e.isWebGL2){t("EXT_color_buffer_float")}else{t("WEBGL_depth_texture");t("OES_texture_float");t("OES_texture_half_float");t("OES_texture_half_float_linear");t("OES_standard_derivatives");t("OES_element_index_uint");t("OES_vertex_array_object");t("ANGLE_instanced_arrays")}t("OES_texture_float_linear");t("EXT_color_buffer_half_float");t("WEBGL_multisampled_render_to_texture")},get:function get(e){var a=t(e);if(null===a){console.warn("THREE.WebGLRenderer: "+e+" extension not supported.")}return a}}}function B(e,t,a,r){var o={},s=new WeakMap;function i(e){var n=e.target;if(null!==n.index){t.remove(n.index)}for(var d in n.attributes){t.remove(n.attributes[d])}n.removeEventListener("dispose",i);delete o[n.id];var l=s.get(n);if(l){t.remove(l);s.delete(n)}r.releaseStatesOfGeometry(n);if(!0===n.isInstancedBufferGeometry){delete n._maxInstanceCount}a.memory.geometries--}function n(e){var r=[],i=e.index,n=e.attributes.position,o=0;if(null!==i){var y=i.array;o=i.version;for(var v=0,_=y.length;v<_;v+=3){var d=y[v+0],a=y[v+1],p=y[v+2];r.push(d,a,a,p,p,d)}}else{var l=n.array;o=n.version;for(var x=0,b=l.length/3-1;x<b;x+=3){var c=x+0,m=x+1,g=x+2;r.push(c,m,m,g,g,c)}}var f=new(u(r)?Bs:Us)(r,1);f.version=o;var h=s.get(e);if(h)t.remove(h);s.set(e,f)}return{get:function(e,t){if(!0===o[t.id])return t;t.addEventListener("dispose",i);o[t.id]=!0;a.memory.geometries++;return t},update:function(a){var r=a.attributes;for(var l in r){t.update(r[l],e.ARRAY_BUFFER)}var i=a.morphAttributes;for(var d in i){for(var n=i[d],o=0,s=n.length;o<s;o++){t.update(n[o],e.ARRAY_BUFFER)}}},getWireframeAttribute:function(e){var t=s.get(e);if(t){var a=e.index;if(null!==a){if(t.version<a.version){n(e)}}}else{n(e)}return s.get(e)}}}function O(e,t,a,r){var o=r.isWebGL2,s;var l,d;function i(t,r){e.drawElements(s,r,l,t*d);a.update(r,s,1)}function n(r,i,n){if(0===n)return;var u,p;if(o){u=e;p="drawElementsInstanced"}else{u=t.get("ANGLE_instanced_arrays");p="drawElementsInstancedANGLE";if(null===u){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}u[p](s,i,l,r*d,n);a.update(i,s,n)}this.setMode=function(e){s=e};this.setIndex=function(e){l=e.type;d=e.bytesPerElement};this.render=i;this.renderInstances=n}function z(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++;t.calls=0;t.triangles=0;t.points=0;t.lines=0},update:function(a,r,i){t.calls++;switch(r){case e.TRIANGLES:t.triangles+=i*(a/3);break;case e.LINES:t.lines+=i*(a/2);break;case e.LINE_STRIP:t.lines+=i*(a-1);break;case e.LINE_LOOP:t.lines+=i*a;break;case e.POINTS:t.points+=i*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r);break;}}}}var Kl=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck(this,t);e=a.call(this,null);e.image={data:r,width:i,height:n,depth:o};e.magFilter=Vr;e.minFilter=Vr;e.wrapR=Hr;e.generateMipmaps=!1;e.flipY=!1;e.unpackAlignment=1;return e}return t}(oo);Kl.prototype.isDataTexture2DArray=!0;function H(e,t){return e[0]-t[0]}function G(e,t){return Math.abs(t[1])-Math.abs(e[1])}function V(e,t){var a=1,r=t.isInterleavedBufferAttribute?t.data.array:t.array;if(r instanceof Int8Array)a=127;else if(r instanceof Int16Array)a=32767;else if(r instanceof Int32Array)a=2147483647;else console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r);e.divideScalar(a)}function W(e,t,a){for(var r={},i=new Float32Array(8),n=new WeakMap,o=new mo,s=[],l=0;8>l;l++){s[l]=[l,0]}return{update:function(l,d,u,p){var c=l.morphTargetInfluences;if(!0===t.isWebGL2){var m=d.morphAttributes.position.length,g=n.get(d);if(g===void 0||g.count!==m){var z=function(){S.dispose();n.delete(d);d.removeEventListener("dispose",z)};if(g!==void 0)g.texture.dispose();var f=d.morphAttributes.normal!==void 0,h=d.morphAttributes.position,y=d.morphAttributes.normal||[],v=d.attributes.position.count,_=!0===f?2:1,x=v*_,b=1;if(x>t.maxTextureSize){b=Math.ceil(x/t.maxTextureSize);x=t.maxTextureSize}var E=new Float32Array(4*(x*b)*m),S=new Kl(E,x,b,m);S.format=ci;S.type=ni;S.needsUpdate=!0;for(var T=0;T<m;T++){for(var M=h[T],A=y[T],R=4*(x*b)*T,w=0;w<M.count;w++){o.fromBufferAttribute(M,w);if(!0===M.normalized)V(o,M);var W=w*(4*_);E[R+W+0]=o.x;E[R+W+1]=o.y;E[R+W+2]=o.z;E[R+W+3]=0;if(!0===f){o.fromBufferAttribute(A,w);if(!0===A.normalized)V(o,A);E[R+W+4]=o.x;E[R+W+5]=o.y;E[R+W+6]=o.z;E[R+W+7]=0}}}g={count:m,texture:S,size:new Jn(x,b)};n.set(d,g);d.addEventListener("dispose",z)}for(var L=0,C=0;C<c.length;C++){L+=c[C]}var X=d.morphTargetsRelative?1:1-L;p.getUniforms().setValue(e,"morphTargetBaseInfluence",X);p.getUniforms().setValue(e,"morphTargetInfluences",c);p.getUniforms().setValue(e,"morphTargetsTexture",g.texture,a);p.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{var k=c===void 0?0:c.length,P=r[d.id];if(P===void 0||P.length!==k){P=[];for(var q=0;q<k;q++){P[q]=[q,0]}r[d.id]=P}for(var Y=0,Z;Y<k;Y++){Z=P[Y];Z[0]=Y;Z[1]=c[Y]}P.sort(G);for(var J=0;8>J;J++){if(J<k&&P[J][1]){s[J][0]=P[J][0];s[J][1]=P[J][1]}else{s[J][0]=Number.MAX_SAFE_INTEGER;s[J][1]=0}}s.sort(H);for(var I=d.morphAttributes.position,D=d.morphAttributes.normal,N=0,U=0;8>U;U++){var F=s[U],B=F[0],O=F[1];if(B!==Number.MAX_SAFE_INTEGER&&O){if(I&&d.getAttribute("morphTarget"+U)!==I[B]){d.setAttribute("morphTarget"+U,I[B])}if(D&&d.getAttribute("morphNormal"+U)!==D[B]){d.setAttribute("morphNormal"+U,D[B])}i[U]=O;N+=O}else{if(I&&!0===d.hasAttribute("morphTarget"+U)){d.deleteAttribute("morphTarget"+U)}if(D&&!0===d.hasAttribute("morphNormal"+U)){d.deleteAttribute("morphNormal"+U)}i[U]=0}}var K=d.morphTargetsRelative?1:1-N;p.getUniforms().setValue(e,"morphTargetBaseInfluence",K);p.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function j(e,t,a,r){var o=new WeakMap;function i(i){var s=r.render.frame,l=i.geometry,d=t.get(i,l);if(o.get(d)!==s){t.update(d);o.set(d,s)}if(i.isInstancedMesh){if(!1===i.hasEventListener("dispose",n)){i.addEventListener("dispose",n)}a.update(i.instanceMatrix,e.ARRAY_BUFFER);if(null!==i.instanceColor){a.update(i.instanceColor,e.ARRAY_BUFFER)}}return d}function n(e){var t=e.target;t.removeEventListener("dispose",n);a.remove(t.instanceMatrix);if(null!==t.instanceColor)a.remove(t.instanceColor)}return{update:i,dispose:function(){o=new WeakMap}}}var Ql=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck(this,t);e=a.call(this,null);e.image={data:r,width:i,height:n,depth:o};e.magFilter=Vr;e.minFilter=Vr;e.wrapR=Hr;e.generateMipmaps=!1;e.flipY=!1;e.unpackAlignment=1;return e}return t}(oo);Ql.prototype.isDataTexture3D=!0;var $l=new oo,ed=new Kl,td=new Ql,ad=new xl,rd=[],id=[],nd=new Float32Array(16),od=new Float32Array(9),sd=new Float32Array(4);function X(e,t,a){var i=e[0];if(0>=i||0<i)return e;var o=t*a,n=rd[o];if(n===void 0){n=new Float32Array(o);rd[o]=n}if(0!==t){i.toArray(n,0);for(var s=1,l=0;s!==t;++s){l+=a;e[s].toArray(n,l)}}return n}function q(e,t){if(e.length!==t.length)return!1;for(var a=0,r=e.length;a<r;a++){if(e[a]!==t[a])return!1}return!0}function Y(e,t){for(var a=0,r=t.length;a<r;a++){e[a]=t[a]}}function Z(e,t){var a=id[t];if(a===void 0){a=new Int32Array(t);id[t]=a}for(var i=0;i!==t;++i){a[i]=e.allocateTextureUnit()}return a}function J(e,t){var a=this.cache;if(a[0]===t)return;e.uniform1f(this.addr,t);a[0]=t}function K(e,t){var a=this.cache;if(t.x!==void 0){if(a[0]!==t.x||a[1]!==t.y){e.uniform2f(this.addr,t.x,t.y);a[0]=t.x;a[1]=t.y}}else{if(q(a,t))return;e.uniform2fv(this.addr,t);Y(a,t)}}function Q(e,t){var a=this.cache;if(t.x!==void 0){if(a[0]!==t.x||a[1]!==t.y||a[2]!==t.z){e.uniform3f(this.addr,t.x,t.y,t.z);a[0]=t.x;a[1]=t.y;a[2]=t.z}}else if(t.r!==void 0){if(a[0]!==t.r||a[1]!==t.g||a[2]!==t.b){e.uniform3f(this.addr,t.r,t.g,t.b);a[0]=t.r;a[1]=t.g;a[2]=t.b}}else{if(q(a,t))return;e.uniform3fv(this.addr,t);Y(a,t)}}function $(e,t){var a=this.cache;if(t.x!==void 0){if(a[0]!==t.x||a[1]!==t.y||a[2]!==t.z||a[3]!==t.w){e.uniform4f(this.addr,t.x,t.y,t.z,t.w);a[0]=t.x;a[1]=t.y;a[2]=t.z;a[3]=t.w}}else{if(q(a,t))return;e.uniform4fv(this.addr,t);Y(a,t)}}function ee(e,t){var a=this.cache,r=t.elements;if(r===void 0){if(q(a,t))return;e.uniformMatrix2fv(this.addr,!1,t);Y(a,t)}else{if(q(a,r))return;sd.set(r);e.uniformMatrix2fv(this.addr,!1,sd);Y(a,r)}}function te(e,t){var a=this.cache,r=t.elements;if(r===void 0){if(q(a,t))return;e.uniformMatrix3fv(this.addr,!1,t);Y(a,t)}else{if(q(a,r))return;od.set(r);e.uniformMatrix3fv(this.addr,!1,od);Y(a,r)}}function ae(e,t){var a=this.cache,r=t.elements;if(r===void 0){if(q(a,t))return;e.uniformMatrix4fv(this.addr,!1,t);Y(a,t)}else{if(q(a,r))return;nd.set(r);e.uniformMatrix4fv(this.addr,!1,nd);Y(a,r)}}function re(e,t){var a=this.cache;if(a[0]===t)return;e.uniform1i(this.addr,t);a[0]=t}function ie(e,t){var a=this.cache;if(q(a,t))return;e.uniform2iv(this.addr,t);Y(a,t)}function ne(e,t){var a=this.cache;if(q(a,t))return;e.uniform3iv(this.addr,t);Y(a,t)}function oe(e,t){var a=this.cache;if(q(a,t))return;e.uniform4iv(this.addr,t);Y(a,t)}function se(e,t){var a=this.cache;if(a[0]===t)return;e.uniform1ui(this.addr,t);a[0]=t}function le(e,t){var a=this.cache;if(q(a,t))return;e.uniform2uiv(this.addr,t);Y(a,t)}function de(e,t){var a=this.cache;if(q(a,t))return;e.uniform3uiv(this.addr,t);Y(a,t)}function ue(e,t){var a=this.cache;if(q(a,t))return;e.uniform4uiv(this.addr,t);Y(a,t)}function pe(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.safeSetTexture2D(t||$l,i)}function ce(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.setTexture3D(t||td,i)}function me(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.safeSetTextureCube(t||ad,i)}function ge(e,t,a){var r=this.cache,i=a.allocateTextureUnit();if(r[0]!==i){e.uniform1i(this.addr,i);r[0]=i}a.setTexture2DArray(t||ed,i)}function fe(e){switch(e){case 5126:return J;case 35664:return K;case 35665:return Q;case 35666:return $;case 35674:return ee;case 35675:return te;case 35676:return ae;case 5124:case 35670:return re;case 35667:case 35671:return ie;case 35668:case 35672:return ne;case 35669:case 35673:return oe;case 5125:return se;case 36294:return le;case 36295:return de;case 36296:return ue;case 35678:case 36198:case 36298:case 36306:case 35682:return pe;case 35679:case 36299:case 36307:return ce;case 35680:case 36300:case 36308:case 36293:return me;case 36289:case 36303:case 36311:case 36292:return ge;}}function he(e,t){e.uniform1fv(this.addr,t)}function ye(e,t){var a=X(t,this.size,2);e.uniform2fv(this.addr,a)}function ve(e,t){var a=X(t,this.size,3);e.uniform3fv(this.addr,a)}function _e(e,t){var a=X(t,this.size,4);e.uniform4fv(this.addr,a)}function xe(e,t){var a=X(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,a)}function be(e,t){var a=X(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,a)}function Ee(e,t){var a=X(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,a)}function Se(e,t){e.uniform1iv(this.addr,t)}function Te(e,t){e.uniform2iv(this.addr,t)}function Me(e,t){e.uniform3iv(this.addr,t)}function Ae(e,t){e.uniform4iv(this.addr,t)}function Re(e,t){e.uniform1uiv(this.addr,t)}function we(e,t){e.uniform2uiv(this.addr,t)}function Le(e,t){e.uniform3uiv(this.addr,t)}function Ce(e,t){e.uniform4uiv(this.addr,t)}function ke(e,t,a){var r=t.length,i=Z(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.safeSetTexture2D(t[n]||$l,i[n])}}function Pe(e,t,a){var r=t.length,i=Z(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.setTexture3D(t[n]||td,i[n])}}function Ie(e,t,a){var r=t.length,i=Z(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.safeSetTextureCube(t[n]||ad,i[n])}}function De(e,t,a){var r=t.length,i=Z(a,r);e.uniform1iv(this.addr,i);for(var n=0;n!==r;++n){a.setTexture2DArray(t[n]||ed,i[n])}}function Ne(e){switch(e){case 5126:return he;case 35664:return ye;case 35665:return ve;case 35666:return _e;case 35674:return xe;case 35675:return be;case 35676:return Ee;case 5124:case 35670:return Se;case 35667:case 35671:return Te;case 35668:case 35672:return Me;case 35669:case 35673:return Ae;case 5125:return Re;case 36294:return we;case 36295:return Le;case 36296:return Ce;case 35678:case 36198:case 36298:case 36306:case 35682:return ke;case 35679:case 36299:case 36307:return Pe;case 35680:case 36300:case 36308:case 36293:return Ie;case 36289:case 36303:case 36311:case 36292:return De;}}function Ue(e,t,a){this.id=e;this.addr=a;this.cache=[];this.setValue=fe(t.type)}function Fe(e,t,a){this.id=e;this.addr=a;this.cache=[];this.size=t.size;this.setValue=Ne(t.type)}Fe.prototype.updateCache=function(e){var t=this.cache;if(e instanceof Float32Array&&t.length!==e.length){this.cache=new Float32Array(e.length)}Y(t,e)};function Be(e){this.id=e;this.seq=[];this.map={}}Be.prototype.setValue=function(e,t,a){for(var r=this.seq,i=0,o=r.length,n;i!==o;++i){n=r[i];n.setValue(e,t[n.id],a)}};var ld=/(\w+)(\])?(\[|\.)?/g;function Oe(e,t){e.seq.push(t);e.map[t.id]=t}function ze(e,t,a){var r=e.name,i=r.length;ld.lastIndex=0;while(!0){var n=ld.exec(r),o=ld.lastIndex,s=n[1],l="]"===n[2],d=n[3];if(l)s=0|s;if(d===void 0||"["===d&&o+2===i){Oe(a,d===void 0?new Ue(s,e,t):new Fe(s,e,t));break}else{var u=a.map,p=u[s];if(p===void 0){p=new Be(s);Oe(a,p)}a=p}}}function He(e,t){this.seq=[];this.map={};for(var a=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0;r<a;++r){var i=e.getActiveUniform(t,r),n=e.getUniformLocation(t,i.name);ze(i,n,this)}}He.prototype.setValue=function(e,t,a,r){var i=this.map[t];if(i!==void 0)i.setValue(e,a,r)};He.prototype.setOptional=function(e,t,a){var r=t[a];if(r!==void 0)this.setValue(e,a,r)};He.upload=function(e,t,a,r){for(var i=0,o=t.length;i!==o;++i){var n=t[i],s=a[n.id];if(!1!==s.needsUpdate){n.setValue(e,s.value,r)}}};He.seqWithValue=function(e,t){for(var a=[],r=0,i=e.length,n;r!==i;++r){n=e[r];if(n.id in t)a.push(n)}return a};function Ge(e,t,a){var r=e.createShader(t);e.shaderSource(r,a);e.compileShader(r);return r}var dd=0;function Ve(e){for(var t=e.split("\n"),a=0;a<t.length;a++){t[a]=a+1+": "+t[a]}return t.join("\n")}function We(e){switch(e){case dn:return["Linear","( value )"];case un:return["sRGB","( value )"];default:console.warn("THREE.WebGLProgram: Unsupported encoding:",e);return["Linear","( value )"];}}function je(e,t,a){var r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";return a.toUpperCase()+"\n\n"+i+"\n\n"+Ve(e.getShaderSource(t))}function Xe(e,t){var a=We(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"}function qe(e,t){var a;switch(t){case wr:a="Linear";break;case Lr:a="Reinhard";break;case Cr:a="OptimizedCineon";break;case kr:a="ACESFilmic";break;case Pr:a="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t);a="Linear";}return"vec3 "+e+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}function Ye(e){var t=[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(Ke).join("\n")}function Ze(e){var t=[];for(var a in e){var r=e[a];if(!1===r)continue;t.push("#define "+a+" "+r)}return t.join("\n")}function Je(e,t){for(var a={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var n=e.getActiveAttrib(t,i),o=n.name,s=1;if(n.type===e.FLOAT_MAT2)s=2;if(n.type===e.FLOAT_MAT3)s=3;if(n.type===e.FLOAT_MAT4)s=4;a[o]={type:n.type,location:e.getAttribLocation(t,o),locationSize:s}}return a}function Ke(e){return""!==e}function Qe(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function $e(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function et(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,tt)}function tt(e,t){var a=Cl[t];if(a===void 0){throw new Error("Can not resolve #include <"+t+">")}return et(a)}function at(e){return e.replace(/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,it).replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,rt)}function rt(e,t,a,r){console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.");return it(e,t,a,r)}function it(e,t,a,r){for(var i="",n=parseInt(t);n<parseInt(a);n++){i+=r.replace(/\[\s*i\s*\]/g,"[ "+n+" ]").replace(/UNROLLED_LOOP_INDEX/g,n)}return i}function nt(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";if("highp"===e.precision){t+="\n#define HIGH_PRECISION"}else if("mediump"===e.precision){t+="\n#define MEDIUM_PRECISION"}else if("lowp"===e.precision){t+="\n#define LOW_PRECISION"}return t}function ot(e){var t="SHADOWMAP_TYPE_BASIC";if(e.shadowMapType===za){t="SHADOWMAP_TYPE_PCF"}else if(e.shadowMapType===Ha){t="SHADOWMAP_TYPE_PCF_SOFT"}else if(e.shadowMapType===Ga){t="SHADOWMAP_TYPE_VSM"}return t}function st(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap){switch(e.envMapMode){case Dr:case Nr:t="ENVMAP_TYPE_CUBE";break;case Br:case Or:t="ENVMAP_TYPE_CUBE_UV";break;}}return t}function lt(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap){switch(e.envMapMode){case Nr:case Or:t="ENVMAP_MODE_REFRACTION";break;}}return t}function dt(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap){switch(e.combine){case Tr:t="ENVMAP_BLENDING_MULTIPLY";break;case Mr:t="ENVMAP_BLENDING_MIX";break;case Ar:t="ENVMAP_BLENDING_ADD";break;}}return t}function ut(e,t,a,r){var i=e.getContext(),n=a.defines,o=a.vertexShader,s=a.fragmentShader,l=ot(a),d=st(a),u=lt(a),p=dt(a),c=a.isWebGL2?"":Ye(a),m=Ze(n),g=i.createProgram(),f,h,y=a.glslVersion?"#version "+a.glslVersion+"\n":"";if(a.isRawShaderMaterial){f=[m].filter(Ke).join("\n");if(0<f.length){f+="\n"}h=[c,m].filter(Ke).join("\n");if(0<h.length){h+="\n"}}else{f=[nt(a),"#define SHADER_NAME "+a.shaderName,m,a.instancing?"#define USE_INSTANCING":"",a.instancingColor?"#define USE_INSTANCING_COLOR":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+u:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.morphTargets&&a.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",a.morphTargets&&a.isWebGL2?"#define MORPHTARGETS_COUNT "+a.morphTargetsCount:"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+l:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ke).join("\n");h=[c,nt(a),"#define SHADER_NAME "+a.shaderName,m,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+d:"",a.envMap?"#define "+u:"",a.envMap?"#define "+p:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoat?"#define USE_CLEARCOAT":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.alphaTest?"#define USE_ALPHATEST":"",a.sheen?"#define USE_SHEEN":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors||a.instancingColor?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+l:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(a.extensionShaderTextureLOD||a.envMap)&&a.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",a.toneMapping!==Rr?"#define TONE_MAPPING":"",a.toneMapping!==Rr?Cl.tonemapping_pars_fragment:"",a.toneMapping!==Rr?qe("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.transparent?"":"#define OPAQUE",Cl.encodings_pars_fragment,Xe("linearToOutputTexel",a.outputEncoding),a.depthPacking?"#define DEPTH_PACKING "+a.depthPacking:"","\n"].filter(Ke).join("\n")}o=et(o);o=Qe(o,a);o=$e(o,a);s=et(s);s=Qe(s,a);s=$e(s,a);o=at(o);s=at(s);if(a.isWebGL2&&!0!==a.isRawShaderMaterial){y="#version 300 es\n";f="precision mediump sampler2DArray;\n#define attribute in\n#define varying out\n#define texture2D texture"+"\n"+f;h=["#define varying in",a.glslVersion===Hn?"":"layout(location = 0) out highp vec4 pc_fragColor;",a.glslVersion===Hn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+h}var v=y+f+o,_=y+h+s,x=Ge(i,i.VERTEX_SHADER,v),b=Ge(i,i.FRAGMENT_SHADER,_);i.attachShader(g,x);i.attachShader(g,b);if(a.index0AttributeName!==void 0){i.bindAttribLocation(g,0,a.index0AttributeName)}else if(!0===a.morphTargets){i.bindAttribLocation(g,0,"position")}i.linkProgram(g);if(e.debug.checkShaderErrors){var E=i.getProgramInfoLog(g).trim(),S=i.getShaderInfoLog(x).trim(),T=i.getShaderInfoLog(b).trim(),M=!0,A=!0;if(!1===i.getProgramParameter(g,i.LINK_STATUS)){M=!1;var R=je(i,x,"vertex"),w=je(i,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,i.VALIDATE_STATUS)+"\n\nProgram Info Log: "+E+"\n"+R+"\n"+w)}else if(""!==E){console.warn("THREE.WebGLProgram: Program Info Log:",E)}else if(""===S||""===T){A=!1}if(A){this.diagnostics={runnable:M,programLog:E,vertexShader:{log:S,prefix:f},fragmentShader:{log:T,prefix:h}}}}i.deleteShader(x);i.deleteShader(b);var L;this.getUniforms=function(){if(L===void 0){L=new He(i,g)}return L};var C;this.getAttributes=function(){if(C===void 0){C=Je(i,g)}return C};this.destroy=function(){r.releaseStatesOfProgram(this);i.deleteProgram(g);this.program=void 0};this.name=a.shaderName;this.id=dd++;this.cacheKey=t;this.usedTimes=1;this.program=g;this.vertexShader=x;this.fragmentShader=b;return this}var ud=0,pd=function(){function e(){_classCallCheck(this,e);this.shaderCache=new Map;this.materialCache=new Map}_createClass(e,[{key:"update",value:function update(e){var t=e.vertexShader,a=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(a),n=this._getShaderCacheForMaterial(e);if(!1===n.has(r)){n.add(r);r.usedTimes++}if(!1===n.has(i)){n.add(i);i.usedTimes++}return this}},{key:"remove",value:function remove(e){var t=this.materialCache.get(e),a=_createForOfIteratorHelper(t),r;try{for(a.s();!(r=a.n()).done;){var i=r.value;i.usedTimes--;if(0===i.usedTimes)this.shaderCache.delete(i)}}catch(e){a.e(e)}finally{a.f()}this.materialCache.delete(e);return this}},{key:"getVertexShaderID",value:function getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function dispose(){this.shaderCache.clear();this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function _getShaderCacheForMaterial(e){var t=this.materialCache;if(!1===t.has(e)){t.set(e,new Set)}return t.get(e)}},{key:"_getShaderStage",value:function _getShaderStage(e){var t=this.shaderCache;if(!1===t.has(e)){var a=new cd;t.set(e,a)}return t.get(e)}}]);return e}(),cd=function e(){_classCallCheck(this,e);this.id=ud++;this.usedTimes=0};function pt(e,t,a,r,i,n,o){var p=new es,c=new pd,m=[],g=i.isWebGL2,f=i.logarithmicDepthBuffer,h=i.floatVertexTextures,y=i.maxVertexUniforms,v=i.vertexTextures,_=i.precision,x={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function s(e){var t=e.skeleton,a=t.bones;if(h){return 1024}else{var r=Math.floor((y-20)/4),i=Math.min(r,a.length);if(i<a.length){console.warn("THREE.WebGLRenderer: Skeleton has "+a.length+" bones. This GPU supports "+i+".");return 0}return i}}function l(n,l,d,u,p){var m=u.fog,y=n.isMeshStandardMaterial?u.environment:null,b=(n.isMeshStandardMaterial?a:t).get(n.envMap||y),E=x[n.type],S=p.isSkinnedMesh?s(p):0;if(null!==n.precision){_=i.getMaxPrecision(n.precision);if(_!==n.precision){console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",_,"instead.")}}var T,M,A,R;if(E){var P=Pl[E];T=P.vertexShader;M=P.fragmentShader}else{T=n.vertexShader;M=n.fragmentShader;c.update(n);A=c.getVertexShaderID(n);R=c.getFragmentShaderID(n)}var w=e.getRenderTarget(),L=0<n.alphaTest,C=0<n.clearcoat,k={isWebGL2:g,shaderID:E,shaderName:n.type,vertexShader:T,fragmentShader:M,defines:n.defines,customVertexShaderID:A,customFragmentShaderID:R,isRawShaderMaterial:!0===n.isRawShaderMaterial,glslVersion:n.glslVersion,precision:_,instancing:!0===p.isInstancedMesh,instancingColor:!0===p.isInstancedMesh&&null!==p.instanceColor,supportsVertexTextures:v,outputEncoding:null===w?e.outputEncoding:!0===w.isXRRenderTarget?w.texture.encoding:dn,map:!!n.map,matcap:!!n.matcap,envMap:!!b,envMapMode:b&&b.mapping,envMapCubeUV:!!b&&(b.mapping===Br||b.mapping===Or),lightMap:!!n.lightMap,aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,objectSpaceNormalMap:n.normalMapType===gn,tangentSpaceNormalMap:n.normalMapType===mn,decodeVideoTexture:!!n.map&&!0===n.map.isVideoTexture&&n.map.encoding===un,clearcoat:C,clearcoatMap:C&&!!n.clearcoatMap,clearcoatRoughnessMap:C&&!!n.clearcoatRoughnessMap,clearcoatNormalMap:C&&!!n.clearcoatNormalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,specularIntensityMap:!!n.specularIntensityMap,specularColorMap:!!n.specularColorMap,transparent:n.transparent,alphaMap:!!n.alphaMap,alphaTest:L,gradientMap:!!n.gradientMap,sheen:0<n.sheen,sheenColorMap:!!n.sheenColorMap,sheenRoughnessMap:!!n.sheenRoughnessMap,transmission:0<n.transmission,transmissionMap:!!n.transmissionMap,thicknessMap:!!n.thicknessMap,combine:n.combine,vertexTangents:!!n.normalMap&&!!p.geometry&&!!p.geometry.attributes.tangent,vertexColors:n.vertexColors,vertexAlphas:!0===n.vertexColors&&!!p.geometry&&!!p.geometry.attributes.color&&4===p.geometry.attributes.color.itemSize,vertexUvs:!!n.map||!!n.bumpMap||!!n.normalMap||!!n.specularMap||!!n.alphaMap||!!n.emissiveMap||!!n.roughnessMap||!!n.metalnessMap||!!n.clearcoatMap||!!n.clearcoatRoughnessMap||!!n.clearcoatNormalMap||!!n.displacementMap||!!n.transmissionMap||!!n.thicknessMap||!!n.specularIntensityMap||!!n.specularColorMap||!!n.sheenColorMap||!!n.sheenRoughnessMap,uvsVertexOnly:!(!!n.map||!!n.bumpMap||!!n.normalMap||!!n.specularMap||!!n.alphaMap||!!n.emissiveMap||!!n.roughnessMap||!!n.metalnessMap||!!n.clearcoatNormalMap||0<n.transmission||!!n.transmissionMap||!!n.thicknessMap||!!n.specularIntensityMap||!!n.specularColorMap||0<n.sheen||!!n.sheenColorMap||!!n.sheenRoughnessMap)&&!!n.displacementMap,fog:!!m,useFog:n.fog,fogExp2:m&&m.isFogExp2,flatShading:!!n.flatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:f,skinning:!0===p.isSkinnedMesh&&0<S,maxBones:S,useVertexTexture:h,morphTargets:!!p.geometry&&!!p.geometry.morphAttributes.position,morphNormals:!!p.geometry&&!!p.geometry.morphAttributes.normal,morphTargetsCount:!!p.geometry&&!!p.geometry.morphAttributes.position?p.geometry.morphAttributes.position.length:0,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:n.dithering,shadowMapEnabled:e.shadowMap.enabled&&0<d.length,shadowMapType:e.shadowMap.type,toneMapping:n.toneMapped?e.toneMapping:Rr,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,doubleSided:n.side===ja,flipSided:n.side===Wa,depthPacking:n.depthPacking!==void 0?n.depthPacking:!1,index0AttributeName:n.index0AttributeName,extensionDerivatives:n.extensions&&n.extensions.derivatives,extensionFragDepth:n.extensions&&n.extensions.fragDepth,extensionDrawBuffers:n.extensions&&n.extensions.drawBuffers,extensionShaderTextureLOD:n.extensions&&n.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:g||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||r.has("EXT_shader_texture_lod"),customProgramCacheKey:n.customProgramCacheKey()};return k}function d(e,t){e.push(t.precision);e.push(t.outputEncoding);e.push(t.envMapMode);e.push(t.combine);e.push(t.vertexUvs);e.push(t.fogExp2);e.push(t.sizeAttenuation);e.push(t.maxBones);e.push(t.morphTargetsCount);e.push(t.numDirLights);e.push(t.numPointLights);e.push(t.numSpotLights);e.push(t.numHemiLights);e.push(t.numRectAreaLights);e.push(t.numDirLightShadows);e.push(t.numPointLightShadows);e.push(t.numSpotLightShadows);e.push(t.shadowMapType);e.push(t.toneMapping);e.push(t.numClippingPlanes);e.push(t.numClipIntersection)}function u(e,t){p.disableAll();if(t.isWebGL2)p.enable(0);if(t.supportsVertexTextures)p.enable(1);if(t.instancing)p.enable(2);if(t.instancingColor)p.enable(3);if(t.map)p.enable(4);if(t.matcap)p.enable(5);if(t.envMap)p.enable(6);if(t.envMapCubeUV)p.enable(7);if(t.lightMap)p.enable(8);if(t.aoMap)p.enable(9);if(t.emissiveMap)p.enable(10);if(t.bumpMap)p.enable(11);if(t.normalMap)p.enable(12);if(t.objectSpaceNormalMap)p.enable(13);if(t.tangentSpaceNormalMap)p.enable(14);if(t.clearcoat)p.enable(15);if(t.clearcoatMap)p.enable(16);if(t.clearcoatRoughnessMap)p.enable(17);if(t.clearcoatNormalMap)p.enable(18);if(t.displacementMap)p.enable(19);if(t.specularMap)p.enable(20);if(t.roughnessMap)p.enable(21);if(t.metalnessMap)p.enable(22);if(t.gradientMap)p.enable(23);if(t.alphaMap)p.enable(24);if(t.alphaTest)p.enable(25);if(t.vertexColors)p.enable(26);if(t.vertexAlphas)p.enable(27);if(t.vertexUvs)p.enable(28);if(t.vertexTangents)p.enable(29);if(t.uvsVertexOnly)p.enable(30);if(t.fog)p.enable(31);e.push(p.mask);p.disableAll();if(t.useFog)p.enable(0);if(t.flatShading)p.enable(1);if(t.logarithmicDepthBuffer)p.enable(2);if(t.skinning)p.enable(3);if(t.useVertexTexture)p.enable(4);if(t.morphTargets)p.enable(5);if(t.morphNormals)p.enable(6);if(t.premultipliedAlpha)p.enable(7);if(t.shadowMapEnabled)p.enable(8);if(t.physicallyCorrectLights)p.enable(9);if(t.doubleSided)p.enable(10);if(t.flipSided)p.enable(11);if(t.depthPacking)p.enable(12);if(t.dithering)p.enable(13);if(t.specularIntensityMap)p.enable(14);if(t.specularColorMap)p.enable(15);if(t.transmission)p.enable(16);if(t.transmissionMap)p.enable(17);if(t.thicknessMap)p.enable(18);if(t.sheen)p.enable(19);if(t.sheenColorMap)p.enable(20);if(t.sheenRoughnessMap)p.enable(21);if(t.decodeVideoTexture)p.enable(22);if(t.transparent)p.enable(23);e.push(p.mask)}return{getParameters:l,getProgramCacheKey:function(t){var a=[];if(t.shaderID){a.push(t.shaderID)}else{a.push(t.customVertexShaderID);a.push(t.customFragmentShaderID)}if(t.defines!==void 0){for(var r in t.defines){a.push(r);a.push(t.defines[r])}}if(!1===t.isRawShaderMaterial){d(a,t);u(a,t);a.push(e.outputEncoding)}a.push(t.customProgramCacheKey);return a.join()},getUniforms:function(e){var t=x[e.type],a;if(t){var r=Pl[t];a=fl.clone(r.uniforms)}else{a=e.uniforms}return a},acquireProgram:function(t,a){for(var r,i=0,o=m.length,s;i<o;i++){s=m[i];if(s.cacheKey===a){r=s;++r.usedTimes;break}}if(r===void 0){r=new ut(e,a,t,n);m.push(r)}return r},releaseProgram:function(e){if(0==--e.usedTimes){var t=m.indexOf(e);m[t]=m[m.length-1];m.pop();e.destroy()}},releaseShaderCache:function(e){c.remove(e)},programs:m,dispose:function(){c.dispose()}}}function ct(){var r=new WeakMap;function e(e){var t=r.get(e);if(t===void 0){t={};r.set(e,t)}return t}function t(e){r.delete(e)}function a(e,t,a){r.get(e)[t]=a}return{get:e,remove:t,update:a,dispose:function(){r=new WeakMap}}}function mt(e,t){if(e.groupOrder!==t.groupOrder){return e.groupOrder-t.groupOrder}else if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}else if(e.material.id!==t.material.id){return e.material.id-t.material.id}else if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function gt(e,t){if(e.groupOrder!==t.groupOrder){return e.groupOrder-t.groupOrder}else if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}else if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function ft(){var a=[],r=0,i=[],n=[],o=[];function e(e,t,i,n,o,s){var l=a[r];if(l===void 0){l={id:e.id,object:e,geometry:t,material:i,groupOrder:n,renderOrder:e.renderOrder,z:o,group:s};a[r]=l}else{l.id=e.id;l.object=e;l.geometry=t;l.material=i;l.groupOrder=n;l.renderOrder=e.renderOrder;l.z=o;l.group=s}r++;return l}function t(){for(var e=r,t=a.length,i;e<t;e++){i=a[e];if(null===i.id)break;i.id=null;i.object=null;i.geometry=null;i.material=null;i.group=null}}return{opaque:i,transmissive:n,transparent:o,init:function(){r=0;i.length=0;n.length=0;o.length=0},push:function(t,a,r,s,l,d){var u=e(t,a,r,s,l,d);if(0<r.transmission){n.push(u)}else if(!0===r.transparent){o.push(u)}else{i.push(u)}},unshift:function(t,a,r,s,l,d){var u=e(t,a,r,s,l,d);if(0<r.transmission){n.unshift(u)}else if(!0===r.transparent){o.unshift(u)}else{i.unshift(u)}},finish:t,sort:function(e,t){if(1<i.length)i.sort(e||mt);if(1<n.length)n.sort(t||gt);if(1<o.length)o.sort(t||gt)}}}function ht(){var t=new WeakMap;function e(e,a){var r;if(!1===t.has(e)){r=new ft;t.set(e,[r])}else{if(a>=t.get(e).length){r=new ft;t.get(e).push(r)}else{r=t.get(e)[a]}}return r}return{get:e,dispose:function(){t=new WeakMap}}}function yt(){var e={};return{get:function get(t){if(e[t.id]!==void 0){return e[t.id]}var a;switch(t.type){case"DirectionalLight":a={direction:new mo,color:new ao};break;case"SpotLight":a={position:new mo,direction:new mo,color:new ao,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":a={position:new mo,color:new ao,distance:0,decay:0};break;case"HemisphereLight":a={direction:new mo,skyColor:new ao,groundColor:new ao};break;case"RectAreaLight":a={color:new ao,position:new mo,halfWidth:new mo,halfHeight:new mo};break;}e[t.id]=a;return a}}}function vt(){var e={};return{get:function get(t){if(e[t.id]!==void 0){return e[t.id]}var a;switch(t.type){case"DirectionalLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jn};break;case"SpotLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jn};break;case"PointLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jn,shadowCameraNear:1,shadowCameraFar:1e3};break;}e[t.id]=a;return a}}}var md=0;function _t(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function xt(e,t){for(var r=new yt,i=vt(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},o=0;9>o;o++){n.probe.push(new mo)}var s=new mo,l=new Vo,d=new Vo;function a(a,o){for(var s=0,d=0,u=0,p=0;9>p;p++){n.probe[p].set(0,0,0)}var c=0,m=0,f=0,h=0,y=0,v=0,_=0,x=0;a.sort(_t);for(var E=!0!==o?Math.PI:1,S=0,T=a.length;S<T;S++){var l=a[S],M=l.color,A=l.intensity,R=l.distance,w=l.shadow&&l.shadow.map?l.shadow.map.texture:null;if(l.isAmbientLight){s+=M.r*A*E;d+=M.g*A*E;u+=M.b*A*E}else if(l.isLightProbe){for(var U=0;9>U;U++){n.probe[U].addScaledVector(l.sh.coefficients[U],A)}}else if(l.isDirectionalLight){var F=r.get(l);F.color.copy(l.color).multiplyScalar(l.intensity*E);if(l.castShadow){var L=l.shadow,C=i.get(l);C.shadowBias=L.bias;C.shadowNormalBias=L.normalBias;C.shadowRadius=L.radius;C.shadowMapSize=L.mapSize;n.directionalShadow[c]=C;n.directionalShadowMap[c]=w;n.directionalShadowMatrix[c]=l.shadow.matrix;v++}n.directional[c]=F;c++}else if(l.isSpotLight){var B=r.get(l);B.position.setFromMatrixPosition(l.matrixWorld);B.color.copy(M).multiplyScalar(A*E);B.distance=R;B.coneCos=Math.cos(l.angle);B.penumbraCos=Math.cos(l.angle*(1-l.penumbra));B.decay=l.decay;if(l.castShadow){var k=l.shadow,P=i.get(l);P.shadowBias=k.bias;P.shadowNormalBias=k.normalBias;P.shadowRadius=k.radius;P.shadowMapSize=k.mapSize;n.spotShadow[f]=P;n.spotShadowMap[f]=w;n.spotShadowMatrix[f]=l.shadow.matrix;x++}n.spot[f]=B;f++}else if(l.isRectAreaLight){var O=r.get(l);O.color.copy(M).multiplyScalar(A);O.halfWidth.set(.5*l.width,0,0);O.halfHeight.set(0,.5*l.height,0);n.rectArea[h]=O;h++}else if(l.isPointLight){var z=r.get(l);z.color.copy(l.color).multiplyScalar(l.intensity*E);z.distance=l.distance;z.decay=l.decay;if(l.castShadow){var I=l.shadow,D=i.get(l);D.shadowBias=I.bias;D.shadowNormalBias=I.normalBias;D.shadowRadius=I.radius;D.shadowMapSize=I.mapSize;D.shadowCameraNear=I.camera.near;D.shadowCameraFar=I.camera.far;n.pointShadow[m]=D;n.pointShadowMap[m]=w;n.pointShadowMatrix[m]=l.shadow.matrix;_++}n.point[m]=z;m++}else if(l.isHemisphereLight){var H=r.get(l);H.skyColor.copy(l.color).multiplyScalar(A*E);H.groundColor.copy(l.groundColor).multiplyScalar(A*E);n.hemi[y]=H;y++}}if(0<h){if(t.isWebGL2){n.rectAreaLTC1=kl.LTC_FLOAT_1;n.rectAreaLTC2=kl.LTC_FLOAT_2}else{if(!0===e.has("OES_texture_float_linear")){n.rectAreaLTC1=kl.LTC_FLOAT_1;n.rectAreaLTC2=kl.LTC_FLOAT_2}else if(!0===e.has("OES_texture_half_float_linear")){n.rectAreaLTC1=kl.LTC_HALF_1;n.rectAreaLTC2=kl.LTC_HALF_2}else{console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")}}}n.ambient[0]=s;n.ambient[1]=d;n.ambient[2]=u;var N=n.hash;if(N.directionalLength!==c||N.pointLength!==m||N.spotLength!==f||N.rectAreaLength!==h||N.hemiLength!==y||N.numDirectionalShadows!==v||N.numPointShadows!==_||N.numSpotShadows!==x){n.directional.length=c;n.spot.length=f;n.rectArea.length=h;n.point.length=m;n.hemi.length=y;n.directionalShadow.length=v;n.directionalShadowMap.length=v;n.pointShadow.length=_;n.pointShadowMap.length=_;n.spotShadow.length=x;n.spotShadowMap.length=x;n.directionalShadowMatrix.length=v;n.pointShadowMatrix.length=_;n.spotShadowMatrix.length=x;N.directionalLength=c;N.pointLength=m;N.spotLength=f;N.rectAreaLength=h;N.hemiLength=y;N.numDirectionalShadows=v;N.numPointShadows=_;N.numSpotShadows=x;n.version=md++}}return{setup:a,setupView:function(e,t){for(var a=0,r=0,i=0,o=0,u=0,p=t.matrixWorldInverse,c=0,m=e.length,g;c<m;c++){g=e[c];if(g.isDirectionalLight){var f=n.directional[a];f.direction.setFromMatrixPosition(g.matrixWorld);s.setFromMatrixPosition(g.target.matrixWorld);f.direction.sub(s);f.direction.transformDirection(p);a++}else if(g.isSpotLight){var h=n.spot[i];h.position.setFromMatrixPosition(g.matrixWorld);h.position.applyMatrix4(p);h.direction.setFromMatrixPosition(g.matrixWorld);s.setFromMatrixPosition(g.target.matrixWorld);h.direction.sub(s);h.direction.transformDirection(p);i++}else if(g.isRectAreaLight){var y=n.rectArea[o];y.position.setFromMatrixPosition(g.matrixWorld);y.position.applyMatrix4(p);d.identity();l.copy(g.matrixWorld);l.premultiply(p);d.extractRotation(l);y.halfWidth.set(.5*g.width,0,0);y.halfHeight.set(0,.5*g.height,0);y.halfWidth.applyMatrix4(d);y.halfHeight.applyMatrix4(d);o++}else if(g.isPointLight){var v=n.point[r];v.position.setFromMatrixPosition(g.matrixWorld);v.position.applyMatrix4(p);r++}else if(g.isHemisphereLight){var _=n.hemi[u];_.direction.setFromMatrixPosition(g.matrixWorld);_.direction.transformDirection(p);_.direction.normalize();u++}}},state:n}}function bt(e,t){var a=new xt(e,t),r=[],i=[];return{init:function(){r.length=0;i.length=0},state:{lightsArray:r,shadowsArray:i,lights:a},setupLights:function(e){a.setup(r,e)},setupLightsView:function(e){a.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Et(e,t){var r=new WeakMap;function a(a){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,n;if(!1===r.has(a)){n=new bt(e,t);r.set(a,[n])}else{if(i>=r.get(a).length){n=new bt(e,t);r.get(a).push(n)}else{n=r.get(a)[i]}}return n}return{get:a,dispose:function(){r=new WeakMap}}}var gd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="MeshDepthMaterial";r.depthPacking=pn;r.map=null;r.alphaMap=null;r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.wireframe=!1;r.wireframeLinewidth=1;r.fog=!1;r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.depthPacking=e.depthPacking;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;return this}}]);return t}(Rs);gd.prototype.isMeshDepthMaterial=!0;var fd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="MeshDistanceMaterial";r.referencePosition=new mo;r.nearDistance=1;r.farDistance=1e3;r.map=null;r.alphaMap=null;r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.fog=!1;r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.referencePosition.copy(e.referencePosition);this.nearDistance=e.nearDistance;this.farDistance=e.farDistance;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;return this}}]);return t}(Rs);fd.prototype.isMeshDistanceMaterial=!0;function St(e,t,a){var o=new wl,s=new Jn,l=new Jn,d=new so,u=new gd({depthPacking:cn}),p=new fd,c={},m=a.maxTextureSize,g={0:Wa,1:Va,2:ja},f=new hl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Jn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),h=f.clone();h.defines.HORIZONTAL_PASS=1;var y=new Zs;y.setAttribute("position",new ks(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new ml(y,f),_=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=za;this.render=function(t,a,i){if(!1===_.enabled)return;if(!1===_.autoUpdate&&!1===_.needsUpdate)return;if(0===t.length)return;var u=e.getRenderTarget(),p=e.getActiveCubeFace(),c=e.getActiveMipmapLevel(),g=e.state;g.setBlending(Ya);g.buffers.color.setClear(1,1,1,1);g.buffers.depth.setTest(!0);g.setScissorTest(!1);for(var b=0,E=t.length;b<E;b++){var f=t[b],h=f.shadow;if(h===void 0){console.warn("THREE.WebGLShadowMap:",f,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;s.copy(h.mapSize);var S=h.getFrameExtents();s.multiply(S);l.copy(h.mapSize);if(s.x>m||s.y>m){if(s.x>m){l.x=Math.floor(m/S.x);s.x=l.x*S.x;h.mapSize.x=l.x}if(s.y>m){l.y=Math.floor(m/S.y);s.y=l.y*S.y;h.mapSize.y=l.y}}if(null===h.map&&!h.isPointLightShadow&&this.type===Ga){var T={minFilter:Yr,magFilter:Yr,format:ci};h.map=new lo(s.x,s.y,T);h.map.texture.name=f.name+".shadowMap";h.mapPass=new lo(s.x,s.y,T);h.camera.updateProjectionMatrix()}if(null===h.map){h.map=new lo(s.x,s.y,{minFilter:Vr,magFilter:Vr,format:ci});h.map.texture.name=f.name+".shadowMap";h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map);e.clear();for(var y=h.getViewportCount(),v=0,x;v<y;v++){x=h.getViewport(v);d.set(l.x*x.x,l.y*x.y,l.x*x.z,l.y*x.w);g.viewport(d);h.updateMatrices(f,v);o=h.getFrustum();n(a,i,h.camera,f,this.type)}if(!h.isPointLightShadow&&this.type===Ga){r(h,i)}h.needsUpdate=!1}_.needsUpdate=!1;e.setRenderTarget(u,p,c)};function r(a,r){var i=t.update(v);if(f.defines.VSM_SAMPLES!==a.blurSamples){f.defines.VSM_SAMPLES=a.blurSamples;h.defines.VSM_SAMPLES=a.blurSamples;f.needsUpdate=!0;h.needsUpdate=!0}f.uniforms.shadow_pass.value=a.map.texture;f.uniforms.resolution.value=a.mapSize;f.uniforms.radius.value=a.radius;e.setRenderTarget(a.mapPass);e.clear();e.renderBufferDirect(r,null,i,f,v,null);h.uniforms.shadow_pass.value=a.mapPass.texture;h.uniforms.resolution.value=a.mapSize;h.uniforms.radius.value=a.radius;e.setRenderTarget(a.map);e.clear();e.renderBufferDirect(r,null,i,h,v,null)}function i(t,a,r,i,n,o,s){var l=null,d=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(d!==void 0){l=d}else{l=!0===i.isPointLight?p:u}if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&0<r.alphaTest){var m=l.uuid,f=r.uuid,h=c[m];if(h===void 0){h={};c[m]=h}var y=h[f];if(y===void 0){y=l.clone();h[f]=y}l=y}l.visible=r.visible;l.wireframe=r.wireframe;if(s===Ga){l.side=null!==r.shadowSide?r.shadowSide:r.side}else{l.side=null!==r.shadowSide?r.shadowSide:g[r.side]}l.alphaMap=r.alphaMap;l.alphaTest=r.alphaTest;l.clipShadows=r.clipShadows;l.clippingPlanes=r.clippingPlanes;l.clipIntersection=r.clipIntersection;l.displacementMap=r.displacementMap;l.displacementScale=r.displacementScale;l.displacementBias=r.displacementBias;l.wireframeLinewidth=r.wireframeLinewidth;l.linewidth=r.linewidth;if(!0===i.isPointLight&&!0===l.isMeshDistanceMaterial){l.referencePosition.setFromMatrixPosition(i.matrixWorld);l.nearDistance=n;l.farDistance=o}return l}function n(a,r,s,d,u){if(!1===a.visible)return;var p=a.layers.test(r.layers);if(p&&(a.isMesh||a.isLine||a.isPoints)){if((a.castShadow||a.receiveShadow&&u===Ga)&&(!a.frustumCulled||o.intersectsObject(a))){a.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,a.matrixWorld);var c=t.update(a),m=a.material;if(Array.isArray(m)){for(var g=c.groups,f=0,h=g.length;f<h;f++){var y=g[f],v=m[y.materialIndex];if(v&&v.visible){var l=i(a,c,v,d,s.near,s.far,u);e.renderBufferDirect(s,null,c,l,a,y)}}}else if(m.visible){var E=i(a,c,m,d,s.near,s.far,u);e.renderBufferDirect(s,null,c,E,a,null)}}}for(var _=a.children,x=0,b=_.length;x<b;x++){n(_[x],r,s,d,u)}}}function Tt(e,t,a){var _,x,b=a.isWebGL2;var E=new function(){var t=!1,i=new so,n=null,o=new so(0,0,0,0);return{setMask:function setMask(a){if(n!==a&&!t){e.colorMask(a,a,a,a);n=a}},setLocked:function setLocked(e){t=e},setClear:function setClear(t,n,s,l,a){if(!0===a){t*=l;n*=l;s*=l}i.set(t,n,s,l);if(!1===o.equals(i)){e.clearColor(t,n,s,l);o.copy(i)}},reset:function reset(){t=!1;n=null;o.set(-1,0,0,0)}}},S=new function(){var t=!1,a=null,r=null,o=null;return{setTest:function setTest(t){if(t){i(e.DEPTH_TEST)}else{n(e.DEPTH_TEST)}},setMask:function setMask(r){if(a!==r&&!t){e.depthMask(r);a=r}},setFunc:function setFunc(t){if(r!==t){if(t){switch(t){case hr:e.depthFunc(e.NEVER);break;case yr:e.depthFunc(e.ALWAYS);break;case vr:e.depthFunc(e.LESS);break;case _r:e.depthFunc(e.LEQUAL);break;case xr:e.depthFunc(e.EQUAL);break;case br:e.depthFunc(e.GEQUAL);break;case Er:e.depthFunc(e.GREATER);break;case Sr:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL);}}else{e.depthFunc(e.LEQUAL)}r=t}},setLocked:function setLocked(e){t=e},setClear:function setClear(t){if(o!==t){e.clearDepth(t);o=t}},reset:function reset(){t=!1;a=null;r=null;o=null}}},T=new function(){var t=!1,a=null,r=null,o=null,s=null,l=null,d=null,u=null,p=null;return{setTest:function setTest(a){if(!t){if(a){i(e.STENCIL_TEST)}else{n(e.STENCIL_TEST)}}},setMask:function setMask(r){if(a!==r&&!t){e.stencilMask(r);a=r}},setFunc:function setFunc(t,a,i){if(r!==t||o!==a||s!==i){e.stencilFunc(t,a,i);r=t;o=a;s=i}},setOp:function setOp(t,a,r){if(l!==t||d!==a||u!==r){e.stencilOp(t,a,r);l=t;d=a;u=r}},setLocked:function setLocked(e){t=e},setClear:function setClear(t){if(p!==t){e.clearStencil(t);p=t}},reset:function reset(){t=!1;a=null;r=null;o=null;s=null;l=null;d=null;u=null;p=null}}},M={},A={},R=new WeakMap,w=[],L=null,C=!1,k=null,P=null,I=null,D=null,N=null,U=null,F=null,B=!1,O=null,z=null,H=null,G=null,V=null,W=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),j=!1,X=0,q=e.getParameter(e.VERSION);if(-1!==q.indexOf("WebGL")){X=parseFloat(/^WebGL (\d)/.exec(q)[1]);j=1<=X}else if(-1!==q.indexOf("OpenGL ES")){X=parseFloat(/^OpenGL ES (\d)/.exec(q)[1]);j=2<=X}var Y=null,Z={},J=e.getParameter(e.SCISSOR_BOX),K=e.getParameter(e.VIEWPORT),Q=new so().fromArray(J),$=new so().fromArray(K);function r(t,a,r){var i=new Uint8Array(4),n=e.createTexture();e.bindTexture(t,n);e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var o=0;o<r;o++){e.texImage2D(a+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i)}return n}var ee={};ee[e.TEXTURE_2D]=r(e.TEXTURE_2D,e.TEXTURE_2D,1);ee[e.TEXTURE_CUBE_MAP]=r(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6);E.setClear(0,0,0,1);S.setClear(1);T.setClear(0);i(e.DEPTH_TEST);S.setFunc(_r);u(!1);p(Ua);i(e.CULL_FACE);d(Ya);function i(t){if(!0!==M[t]){e.enable(t);M[t]=!0}}function n(t){if(!1!==M[t]){e.disable(t);M[t]=!1}}function o(t,a){if(A[t]!==a){e.bindFramebuffer(t,a);A[t]=a;if(b){if(t===e.DRAW_FRAMEBUFFER){A[e.FRAMEBUFFER]=a}if(t===e.FRAMEBUFFER){A[e.DRAW_FRAMEBUFFER]=a}}return!0}return!1}function s(r,i){var n=w,o=!1;if(r){n=R.get(i);if(n===void 0){n=[];R.set(i,n)}if(r.isWebGLMultipleRenderTargets){var s=r.texture;if(n.length!==s.length||n[0]!==e.COLOR_ATTACHMENT0){for(var l=0,d=s.length;l<d;l++){n[l]=e.COLOR_ATTACHMENT0+l}n.length=s.length;o=!0}}else{if(n[0]!==e.COLOR_ATTACHMENT0){n[0]=e.COLOR_ATTACHMENT0;o=!0}}}else{if(n[0]!==e.BACK){n[0]=e.BACK;o=!0}}if(o){if(a.isWebGL2){e.drawBuffers(n)}else{t.get("WEBGL_draw_buffers").drawBuffersWEBGL(n)}}}function l(t){if(L!==t){e.useProgram(t);L=t;return!0}return!1}var te=(_={},_defineProperty(_,er,e.FUNC_ADD),_defineProperty(_,tr,e.FUNC_SUBTRACT),_defineProperty(_,ar,e.FUNC_REVERSE_SUBTRACT),_);if(b){te[rr]=e.MIN;te[ir]=e.MAX}else{var re=t.get("EXT_blend_minmax");if(null!==re){te[rr]=re.MIN_EXT;te[ir]=re.MAX_EXT}}var ae=(x={},_defineProperty(x,nr,e.ZERO),_defineProperty(x,or,e.ONE),_defineProperty(x,sr,e.SRC_COLOR),_defineProperty(x,dr,e.SRC_ALPHA),_defineProperty(x,fr,e.SRC_ALPHA_SATURATE),_defineProperty(x,mr,e.DST_COLOR),_defineProperty(x,pr,e.DST_ALPHA),_defineProperty(x,lr,e.ONE_MINUS_SRC_COLOR),_defineProperty(x,ur,e.ONE_MINUS_SRC_ALPHA),_defineProperty(x,gr,e.ONE_MINUS_DST_COLOR),_defineProperty(x,cr,e.ONE_MINUS_DST_ALPHA),x);function d(t,a,r,o,s,l,d,u){if(t===Ya){if(!0===C){n(e.BLEND);C=!1}return}if(!1===C){i(e.BLEND);C=!0}if(t!==$a){if(t!==k||u!==B){if(P!==er||N!==er){e.blendEquation(e.FUNC_ADD);P=er;N=er}if(u){switch(t){case Za:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Ja:e.blendFunc(e.ONE,e.ONE);break;case Ka:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case Qa:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break;}}else{switch(t){case Za:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Ja:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case Ka:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case Qa:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break;}}I=null;D=null;U=null;F=null;k=t;B=u}return}s=s||a;l=l||r;d=d||o;if(a!==P||s!==N){e.blendEquationSeparate(te[a],te[s]);P=a;N=s}if(r!==I||o!==D||l!==U||d!==F){e.blendFuncSeparate(ae[r],ae[o],ae[l],ae[d]);I=r;D=o;U=l;F=d}k=t;B=null}function u(t){if(O!==t){if(t){e.frontFace(e.CW)}else{e.frontFace(e.CCW)}O=t}}function p(t){if(t!==Na){i(e.CULL_FACE);if(t!==z){if(t===Ua){e.cullFace(e.BACK)}else if(t===Fa){e.cullFace(e.FRONT)}else{e.cullFace(e.FRONT_AND_BACK)}}}else{n(e.CULL_FACE)}z=t}function c(t){if(t!==H){if(j)e.lineWidth(t);H=t}}function m(t,a,r){if(t){i(e.POLYGON_OFFSET_FILL);if(G!==a||V!==r){e.polygonOffset(a,r);G=a;V=r}}else{n(e.POLYGON_OFFSET_FILL)}}function g(t){if(t===void 0)t=e.TEXTURE0+W-1;if(Y!==t){e.activeTexture(t);Y=t}}function f(t,a){if(null===Y){g()}var r=Z[Y];if(r===void 0){r={type:void 0,texture:void 0};Z[Y]=r}if(r.type!==t||r.texture!==a){e.bindTexture(t,a||ee[t]);r.type=t;r.texture=a}}function h(){var t=Z[Y];if(t!==void 0&&t.type!==void 0){e.bindTexture(t.type,null);t.type=void 0;t.texture=void 0}}function y(t){if(!1===Q.equals(t)){e.scissor(t.x,t.y,t.z,t.w);Q.copy(t)}}function v(t){if(!1===$.equals(t)){e.viewport(t.x,t.y,t.z,t.w);$.copy(t)}}return{buffers:{color:E,depth:S,stencil:T},enable:i,disable:n,bindFramebuffer:o,drawBuffers:s,useProgram:l,setBlending:d,setMaterial:function(t,a){t.side===ja?n(e.CULL_FACE):i(e.CULL_FACE);var r=t.side===Wa;if(a)r=!r;u(r);t.blending===Za&&!1===t.transparent?d(Ya):d(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha);S.setFunc(t.depthFunc);S.setTest(t.depthTest);S.setMask(t.depthWrite);E.setMask(t.colorWrite);var o=t.stencilWrite;T.setTest(o);if(o){T.setMask(t.stencilWriteMask);T.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask);T.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)}m(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits);!0===t.alphaToCoverage?i(e.SAMPLE_ALPHA_TO_COVERAGE):n(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:u,setCullFace:p,setLineWidth:c,setPolygonOffset:m,setScissorTest:function(t){if(t){i(e.SCISSOR_TEST)}else{n(e.SCISSOR_TEST)}},activeTexture:g,bindTexture:f,unbindTexture:h,compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:y,viewport:v,reset:function(){e.disable(e.BLEND);e.disable(e.CULL_FACE);e.disable(e.DEPTH_TEST);e.disable(e.POLYGON_OFFSET_FILL);e.disable(e.SCISSOR_TEST);e.disable(e.STENCIL_TEST);e.disable(e.SAMPLE_ALPHA_TO_COVERAGE);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ONE,e.ZERO);e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO);e.colorMask(!0,!0,!0,!0);e.clearColor(0,0,0,0);e.depthMask(!0);e.depthFunc(e.LESS);e.clearDepth(1);e.stencilMask(4294967295);e.stencilFunc(e.ALWAYS,0,4294967295);e.stencilOp(e.KEEP,e.KEEP,e.KEEP);e.clearStencil(0);e.cullFace(e.BACK);e.frontFace(e.CCW);e.polygonOffset(0,0);e.activeTexture(e.TEXTURE0);e.bindFramebuffer(e.FRAMEBUFFER,null);if(!0===b){e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null);e.bindFramebuffer(e.READ_FRAMEBUFFER,null)}e.useProgram(null);e.lineWidth(1);e.scissor(0,0,e.canvas.width,e.canvas.height);e.viewport(0,0,e.canvas.width,e.canvas.height);M={};Y=null;Z={};A={};R=new WeakMap;w=[];L=null;C=!1;k=null;P=null;I=null;D=null;N=null;U=null;F=null;B=!1;O=null;z=null;H=null;G=null;V=null;Q.set(0,0,e.canvas.width,e.canvas.height);$.set(0,0,e.canvas.width,e.canvas.height);E.reset();S.reset();T.reset()}}}function Mt(e,t,a,r,i,n,o){var O,z,H=i.isWebGL2,G=i.maxTextures,V=i.maxCubemapSize,W=i.maxTextureSize,j=i.maxSamples,X=t.has("WEBGL_multisampled_render_to_texture"),q=X?t.get("WEBGL_multisampled_render_to_texture"):void 0,Y=new WeakMap,Z,J=!1;try{J="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function l(e,t){return J?new OffscreenCanvas(e,t):c("canvas")}function u(e,t,a,r){var i=1;if(e.width>r||e.height>r){i=r/Math.max(e.width,e.height)}if(1>i||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var n=t?d:Math.floor,o=n(i*e.width),s=n(i*e.height);if(Z===void 0)Z=l(o,s);var u=a?l(o,s):Z;u.width=o;u.height=s;var p=u.getContext("2d");p.drawImage(e,0,0,o,s);console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+").");return u}else{if("data"in e){console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+").")}return e}}return e}function p(e){return s(e.width)&&s(e.height)}function m(e){if(H)return!1;return e.wrapS!==Hr||e.wrapT!==Hr||e.minFilter!==Vr&&e.minFilter!==Yr}function g(e,t){return e.generateMipmaps&&t&&e.minFilter!==Vr&&e.minFilter!==Yr}function f(t){e.generateMipmap(t)}function h(a,r,i,n){var o=4<arguments.length&&arguments[4]!==void 0?arguments[4]:!1;if(!1===H)return r;if(null!==a){if(e[a]!==void 0)return e[a];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+a+"'")}var s=r;if(r===e.RED){if(i===e.FLOAT)s=e.R32F;if(i===e.HALF_FLOAT)s=e.R16F;if(i===e.UNSIGNED_BYTE)s=e.R8}if(r===e.RG){if(i===e.FLOAT)s=e.RG32F;if(i===e.HALF_FLOAT)s=e.RG16F;if(i===e.UNSIGNED_BYTE)s=e.RG8}if(r===e.RGBA){if(i===e.FLOAT)s=e.RGBA32F;if(i===e.HALF_FLOAT)s=e.RGBA16F;if(i===e.UNSIGNED_BYTE)s=n===un&&!1===o?e.SRGB8_ALPHA8:e.RGBA8;if(i===e.UNSIGNED_SHORT_4_4_4_4)s=e.RGBA4;if(i===e.UNSIGNED_SHORT_5_5_5_1)s=e.RGB5_A1}if(s===e.R16F||s===e.R32F||s===e.RG16F||s===e.RG32F||s===e.RGBA16F||s===e.RGBA32F){t.get("EXT_color_buffer_float")}return s}function y(e,t,a){if(!0===g(e,a)||e.isFramebufferTexture&&e.minFilter!==Vr&&e.minFilter!==Yr){return Math.log2(Math.max(t.width,t.height))+1}else if(e.mipmaps!==void 0&&0<e.mipmaps.length){return e.mipmaps.length}else if(e.isCompressedTexture&&Array.isArray(e.image)){return t.mipmaps.length}else{return 1}}function v(t){if(t===Vr||t===Wr||t===Xr){return e.NEAREST}return e.LINEAR}function _(e){var t=e.target;t.removeEventListener("dispose",_);b(t);if(t.isVideoTexture){Y.delete(t)}o.memory.textures--}function x(e){var t=e.target;t.removeEventListener("dispose",x);E(t)}function b(t){var a=r.get(t);if(a.__webglInit===void 0)return;e.deleteTexture(a.__webglTexture);r.remove(t)}function E(t){var a=t.texture,i=r.get(t),n=r.get(a);if(!t)return;if(n.__webglTexture!==void 0){e.deleteTexture(n.__webglTexture);o.memory.textures--}if(t.depthTexture){t.depthTexture.dispose()}if(t.isWebGLCubeRenderTarget){for(var s=0;6>s;s++){e.deleteFramebuffer(i.__webglFramebuffer[s]);if(i.__webglDepthbuffer)e.deleteRenderbuffer(i.__webglDepthbuffer[s])}}else{e.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer)e.deleteRenderbuffer(i.__webglDepthbuffer);if(i.__webglMultisampledFramebuffer)e.deleteFramebuffer(i.__webglMultisampledFramebuffer);if(i.__webglColorRenderbuffer)e.deleteRenderbuffer(i.__webglColorRenderbuffer);if(i.__webglDepthRenderbuffer)e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets){for(var l=0,d=a.length,u;l<d;l++){u=r.get(a[l]);if(u.__webglTexture){e.deleteTexture(u.__webglTexture);o.memory.textures--}r.remove(a[l])}}r.remove(a);r.remove(t)}var K=0;function S(){var e=K;if(e>=G){console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+G)}K+=1;return e}function T(t,i){var n=r.get(t);if(t.isVideoTexture)N(t);if(0<t.version&&n.__version!==t.version){var o=t.image;if(o===void 0){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined")}else if(!1===o.complete){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}else{w(n,t,i);return}}a.activeTexture(e.TEXTURE0+i);a.bindTexture(e.TEXTURE_2D,n.__webglTexture)}function M(t,i){var n=r.get(t);if(0<t.version&&n.__version!==t.version){L(n,t,i);return}a.activeTexture(e.TEXTURE0+i);a.bindTexture(e.TEXTURE_CUBE_MAP,n.__webglTexture)}var Q=(O={},_defineProperty(O,zr,e.REPEAT),_defineProperty(O,Hr,e.CLAMP_TO_EDGE),_defineProperty(O,Gr,e.MIRRORED_REPEAT),O),$=(z={},_defineProperty(z,Vr,e.NEAREST),_defineProperty(z,Wr,e.NEAREST_MIPMAP_NEAREST),_defineProperty(z,Xr,e.NEAREST_MIPMAP_LINEAR),_defineProperty(z,Yr,e.LINEAR),_defineProperty(z,Zr,e.LINEAR_MIPMAP_NEAREST),_defineProperty(z,Kr,e.LINEAR_MIPMAP_LINEAR),z);function A(a,n,o){if(o){e.texParameteri(a,e.TEXTURE_WRAP_S,Q[n.wrapS]);e.texParameteri(a,e.TEXTURE_WRAP_T,Q[n.wrapT]);if(a===e.TEXTURE_3D||a===e.TEXTURE_2D_ARRAY){e.texParameteri(a,e.TEXTURE_WRAP_R,Q[n.wrapR])}e.texParameteri(a,e.TEXTURE_MAG_FILTER,$[n.magFilter]);e.texParameteri(a,e.TEXTURE_MIN_FILTER,$[n.minFilter])}else{e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);if(a===e.TEXTURE_3D||a===e.TEXTURE_2D_ARRAY){e.texParameteri(a,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE)}if(n.wrapS!==Hr||n.wrapT!==Hr){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.")}e.texParameteri(a,e.TEXTURE_MAG_FILTER,v(n.magFilter));e.texParameteri(a,e.TEXTURE_MIN_FILTER,v(n.minFilter));if(n.minFilter!==Vr&&n.minFilter!==Yr){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")}}if(!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(n.type===ni&&!1===t.has("OES_texture_float_linear"))return;if(!1===H&&n.type===oi&&!1===t.has("OES_texture_half_float_linear"))return;if(1<n.anisotropy||r.get(n).__currentAnisotropy){e.texParameterf(a,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n.anisotropy,i.getMaxAnisotropy()));r.get(n).__currentAnisotropy=n.anisotropy}}}function R(t,a){if(t.__webglInit===void 0){t.__webglInit=!0;a.addEventListener("dispose",_);t.__webglTexture=e.createTexture();o.memory.textures++}}function w(t,r,i){var o=e.TEXTURE_2D;if(r.isDataTexture2DArray)o=e.TEXTURE_2D_ARRAY;if(r.isDataTexture3D)o=e.TEXTURE_3D;R(t,r);a.activeTexture(e.TEXTURE0+i);a.bindTexture(o,t.__webglTexture);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha);e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);var s=m(r)&&!1===p(r.image),l=u(r.image,s,!1,W);l=U(r,l);var d=p(l)||H,c=n.convert(r.format,r.encoding),v=n.convert(r.type),_=h(r.internalFormat,c,v,r.encoding,r.isVideoTexture);A(o,r,d);var x,b=r.mipmaps,E=H&&!0!==r.isVideoTexture,S=t.__version===void 0,T=y(r,l,d);if(r.isDepthTexture){_=e.DEPTH_COMPONENT;if(H){if(r.type===ni){_=e.DEPTH_COMPONENT32F}else if(r.type===ii){_=e.DEPTH_COMPONENT24}else if(r.type===di){_=e.DEPTH24_STENCIL8}else{_=e.DEPTH_COMPONENT16}}else{if(r.type===ni){console.error("WebGLRenderer: Floating point depth texture requires WebGL2.")}}if(r.format===fi&&_===e.DEPTH_COMPONENT){if(r.type!==ai&&r.type!==ii){console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.");r.type=ai;v=n.convert(r.type)}}if(r.format===hi&&_===e.DEPTH_COMPONENT){_=e.DEPTH_STENCIL;if(r.type!==di){console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.");r.type=di;v=n.convert(r.type)}}if(E&&S){a.texStorage2D(e.TEXTURE_2D,1,_,l.width,l.height)}else{a.texImage2D(e.TEXTURE_2D,0,_,l.width,l.height,0,c,v,null)}}else if(r.isDataTexture){if(0<b.length&&d){if(E&&S){a.texStorage2D(e.TEXTURE_2D,T,_,b[0].width,b[0].height)}for(var M=0,w=b.length;M<w;M++){x=b[M];if(E){a.texSubImage2D(e.TEXTURE_2D,0,0,0,x.width,x.height,c,v,x.data)}else{a.texImage2D(e.TEXTURE_2D,M,_,x.width,x.height,0,c,v,x.data)}}r.generateMipmaps=!1}else{if(E){if(S){a.texStorage2D(e.TEXTURE_2D,T,_,l.width,l.height)}a.texSubImage2D(e.TEXTURE_2D,0,0,0,l.width,l.height,c,v,l.data)}else{a.texImage2D(e.TEXTURE_2D,0,_,l.width,l.height,0,c,v,l.data)}}}else if(r.isCompressedTexture){if(E&&S){a.texStorage2D(e.TEXTURE_2D,T,_,b[0].width,b[0].height)}for(var L=0,C=b.length;L<C;L++){x=b[L];if(r.format!==ci){if(null!==c){if(E){a.compressedTexSubImage2D(e.TEXTURE_2D,L,0,0,x.width,x.height,c,x.data)}else{a.compressedTexImage2D(e.TEXTURE_2D,L,_,x.width,x.height,0,x.data)}}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{if(E){a.texSubImage2D(e.TEXTURE_2D,L,0,0,x.width,x.height,c,v,x.data)}else{a.texImage2D(e.TEXTURE_2D,L,_,x.width,x.height,0,c,v,x.data)}}}}else if(r.isDataTexture2DArray){if(E){if(S){a.texStorage3D(e.TEXTURE_2D_ARRAY,T,_,l.width,l.height,l.depth)}a.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,l.width,l.height,l.depth,c,v,l.data)}else{a.texImage3D(e.TEXTURE_2D_ARRAY,0,_,l.width,l.height,l.depth,0,c,v,l.data)}}else if(r.isDataTexture3D){if(E){if(S){a.texStorage3D(e.TEXTURE_3D,T,_,l.width,l.height,l.depth)}a.texSubImage3D(e.TEXTURE_3D,0,0,0,0,l.width,l.height,l.depth,c,v,l.data)}else{a.texImage3D(e.TEXTURE_3D,0,_,l.width,l.height,l.depth,0,c,v,l.data)}}else if(r.isFramebufferTexture){if(E&&S){a.texStorage2D(e.TEXTURE_2D,T,_,l.width,l.height)}else{a.texImage2D(e.TEXTURE_2D,0,_,l.width,l.height,0,c,v,null)}}else{if(0<b.length&&d){if(E&&S){a.texStorage2D(e.TEXTURE_2D,T,_,b[0].width,b[0].height)}for(var k=0,P=b.length;k<P;k++){x=b[k];if(E){a.texSubImage2D(e.TEXTURE_2D,k,0,0,c,v,x)}else{a.texImage2D(e.TEXTURE_2D,k,_,c,v,x)}}r.generateMipmaps=!1}else{if(E){if(S){a.texStorage2D(e.TEXTURE_2D,T,_,l.width,l.height)}a.texSubImage2D(e.TEXTURE_2D,0,0,0,c,v,l)}else{a.texImage2D(e.TEXTURE_2D,0,_,c,v,l)}}}if(g(r,d)){f(o)}t.__version=r.version;if(r.onUpdate)r.onUpdate(r)}function L(t,r,i){if(6!==r.image.length)return;R(t,r);a.activeTexture(e.TEXTURE0+i);a.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha);e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);for(var o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),s=r.image[0]&&r.image[0].isDataTexture,l=[],d=0;6>d;d++){if(!o&&!s){l[d]=u(r.image[d],!1,!0,V)}else{l[d]=s?r.image[d].image:r.image[d]}l[d]=U(r,l[d])}var c=l[0],m=p(c)||H,v=n.convert(r.format,r.encoding),_=n.convert(r.type),x=h(r.internalFormat,v,_,r.encoding),b=H&&!0!==r.isVideoTexture,E=t.__version===void 0,S=y(r,c,m);A(e.TEXTURE_CUBE_MAP,r,m);var T;if(o){if(b&&E){a.texStorage2D(e.TEXTURE_CUBE_MAP,S,x,c.width,c.height)}for(var L=0;6>L;L++){T=l[L].mipmaps;for(var C=0,k;C<T.length;C++){k=T[C];if(r.format!==ci){if(null!==v){if(b){a.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+L,C,0,0,k.width,k.height,v,k.data)}else{a.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+L,C,x,k.width,k.height,0,k.data)}}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()")}}else{if(b){a.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+L,C,0,0,k.width,k.height,v,_,k.data)}else{a.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+L,C,x,k.width,k.height,0,v,_,k.data)}}}}}else{T=r.mipmaps;if(b&&E){if(0<T.length)S++;a.texStorage2D(e.TEXTURE_CUBE_MAP,S,x,l[0].width,l[0].height)}for(var P=0;6>P;P++){if(s){if(b){a.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,0,0,l[P].width,l[P].height,v,_,l[P].data)}else{a.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,x,l[P].width,l[P].height,0,v,_,l[P].data)}for(var I=0;I<T.length;I++){var M=T[I],w=M.image[P].image;if(b){a.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,I+1,0,0,w.width,w.height,v,_,w.data)}else{a.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,I+1,x,w.width,w.height,0,v,_,w.data)}}}else{if(b){a.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,0,0,v,_,l[P])}else{a.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,x,v,_,l[P])}for(var D=0,N;D<T.length;D++){N=T[D];if(b){a.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,D+1,0,0,v,_,N.image[P])}else{a.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,D+1,x,v,_,N.image[P])}}}}}if(g(r,m)){f(e.TEXTURE_CUBE_MAP)}t.__version=r.version;if(r.onUpdate)r.onUpdate(r)}function C(t,i,o,s,l){var d=n.convert(o.format,o.encoding),u=n.convert(o.type),p=h(o.internalFormat,d,u,o.encoding),c=r.get(i);if(!c.__hasExternalTextures){if(l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY){a.texImage3D(l,0,p,i.width,i.height,i.depth,0,d,u,null)}else{a.texImage2D(l,0,p,i.width,i.height,0,d,u,null)}}a.bindFramebuffer(e.FRAMEBUFFER,t);if(i.useRenderToTexture){q.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,s,l,r.get(o).__webglTexture,0,D(i))}else{e.framebufferTexture2D(e.FRAMEBUFFER,s,l,r.get(o).__webglTexture,0)}a.bindFramebuffer(e.FRAMEBUFFER,null)}function k(t,a,r){e.bindRenderbuffer(e.RENDERBUFFER,t);if(a.depthBuffer&&!a.stencilBuffer){var u=e.DEPTH_COMPONENT16;if(r||a.useRenderToTexture){var p=a.depthTexture;if(p&&p.isDepthTexture){if(p.type===ni){u=e.DEPTH_COMPONENT32F}else if(p.type===ii){u=e.DEPTH_COMPONENT24}}var c=D(a);if(a.useRenderToTexture){q.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,u,a.width,a.height)}else{e.renderbufferStorageMultisample(e.RENDERBUFFER,c,u,a.width,a.height)}}else{e.renderbufferStorage(e.RENDERBUFFER,u,a.width,a.height)}e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(a.depthBuffer&&a.stencilBuffer){var m=D(a);if(r&&a.useRenderbuffer){e.renderbufferStorageMultisample(e.RENDERBUFFER,m,e.DEPTH24_STENCIL8,a.width,a.height)}else if(a.useRenderToTexture){q.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,m,e.DEPTH24_STENCIL8,a.width,a.height)}else{e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,a.width,a.height)}e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{var i=!0===a.isWebGLMultipleRenderTargets?a.texture[0]:a.texture,o=n.convert(i.format,i.encoding),s=n.convert(i.type),l=h(i.internalFormat,o,s,i.encoding),d=D(a);if(r&&a.useRenderbuffer){e.renderbufferStorageMultisample(e.RENDERBUFFER,d,l,a.width,a.height)}else if(a.useRenderToTexture){q.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,l,a.width,a.height)}else{e.renderbufferStorage(e.RENDERBUFFER,l,a.width,a.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function P(t,i){var n=i&&i.isWebGLCubeRenderTarget;if(n)throw new Error("Depth Texture with cube render targets is not supported");a.bindFramebuffer(e.FRAMEBUFFER,t);if(!(i.depthTexture&&i.depthTexture.isDepthTexture)){throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture")}if(!r.get(i.depthTexture).__webglTexture||i.depthTexture.image.width!==i.width||i.depthTexture.image.height!==i.height){i.depthTexture.image.width=i.width;i.depthTexture.image.height=i.height;i.depthTexture.needsUpdate=!0}T(i.depthTexture,0);var o=r.get(i.depthTexture).__webglTexture,s=D(i);if(i.depthTexture.format===fi){if(i.useRenderToTexture){q.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,s)}else{e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0)}}else if(i.depthTexture.format===hi){if(i.useRenderToTexture){q.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,s)}else{e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}else{throw new Error("Unknown depthTexture format")}}function I(t){var i=r.get(t),n=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(n)throw new Error("target.depthTexture not supported in Cube render targets");P(i.__webglFramebuffer,t)}else{if(n){i.__webglDepthbuffer=[];for(var o=0;6>o;o++){a.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[o]);i.__webglDepthbuffer[o]=e.createRenderbuffer();k(i.__webglDepthbuffer[o],t,!1)}}else{a.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer);i.__webglDepthbuffer=e.createRenderbuffer();k(i.__webglDepthbuffer,t,!1)}}a.bindFramebuffer(e.FRAMEBUFFER,null)}function D(e){return H&&(e.useRenderbuffer||e.useRenderToTexture)?Math.min(j,e.samples):0}function N(e){var t=o.render.frame;if(Y.get(e)!==t){Y.set(e,t);e.update()}}function U(e,a){var r=e.encoding,i=e.format,n=e.type;if(!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Gn)return a;if(r!==dn){if(r===un){if(!1===H){if(!0===t.has("EXT_sRGB")&&i===ci){e.format=Gn;e.minFilter=Yr;e.generateMipmaps=!1}else{a=io.sRGBToLinear(a)}}else{if(i!==ci||n!==$r){console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType.")}}}else{console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)}}return a}var ee=!1,te=!1;function F(e,t){if(e&&e.isWebGLRenderTarget){if(!1===ee){console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead.");ee=!0}e=e.texture}T(e,t)}function B(e,t){if(e&&e.isWebGLCubeRenderTarget){if(!1===te){console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead.");te=!0}e=e.texture}M(e,t)}this.allocateTextureUnit=S;this.resetTextureUnits=function(){K=0};this.setTexture2D=T;this.setTexture2DArray=function(t,i){var n=r.get(t);if(0<t.version&&n.__version!==t.version){w(n,t,i);return}a.activeTexture(e.TEXTURE0+i);a.bindTexture(e.TEXTURE_2D_ARRAY,n.__webglTexture)};this.setTexture3D=function(t,i){var n=r.get(t);if(0<t.version&&n.__version!==t.version){w(n,t,i);return}a.activeTexture(e.TEXTURE0+i);a.bindTexture(e.TEXTURE_3D,n.__webglTexture)};this.setTextureCube=M;this.rebindTextures=function(t,a,i){var n=r.get(t);if(a!==void 0){C(n.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D)}if(i!==void 0){I(t)}};this.setupRenderTarget=function(t){var s=t.texture,l=r.get(t),d=r.get(s);t.addEventListener("dispose",x);if(!0!==t.isWebGLMultipleRenderTargets){if(d.__webglTexture===void 0){d.__webglTexture=e.createTexture()}d.__version=s.version;o.memory.textures++}var u=!0===t.isWebGLCubeRenderTarget,c=!0===t.isWebGLMultipleRenderTargets,m=s.isDataTexture3D||s.isDataTexture2DArray,y=p(t)||H;if(u){l.__webglFramebuffer=[];for(var F=0;6>F;F++){l.__webglFramebuffer[F]=e.createFramebuffer()}}else{l.__webglFramebuffer=e.createFramebuffer();if(c){if(i.drawBuffers){for(var v=t.texture,_=0,b=v.length,E;_<b;_++){E=r.get(v[_]);if(E.__webglTexture===void 0){E.__webglTexture=e.createTexture();o.memory.textures++}}}else{console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.")}}else if(t.useRenderbuffer){if(H){l.__webglMultisampledFramebuffer=e.createFramebuffer();l.__webglColorRenderbuffer=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,l.__webglColorRenderbuffer);var S=n.convert(s.format,s.encoding),T=n.convert(s.type),M=h(s.internalFormat,S,T,s.encoding),R=D(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,R,M,t.width,t.height);a.bindFramebuffer(e.FRAMEBUFFER,l.__webglMultisampledFramebuffer);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,l.__webglColorRenderbuffer);e.bindRenderbuffer(e.RENDERBUFFER,null);if(t.depthBuffer){l.__webglDepthRenderbuffer=e.createRenderbuffer();k(l.__webglDepthRenderbuffer,t,!0)}a.bindFramebuffer(e.FRAMEBUFFER,null)}else{console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}}if(u){a.bindTexture(e.TEXTURE_CUBE_MAP,d.__webglTexture);A(e.TEXTURE_CUBE_MAP,s,y);for(var B=0;6>B;B++){C(l.__webglFramebuffer[B],t,s,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+B)}if(g(s,y)){f(e.TEXTURE_CUBE_MAP)}a.unbindTexture()}else if(c){for(var w=t.texture,L=0,P=w.length;L<P;L++){var N=w[L],U=r.get(N);a.bindTexture(e.TEXTURE_2D,U.__webglTexture);A(e.TEXTURE_2D,N,y);C(l.__webglFramebuffer,t,N,e.COLOR_ATTACHMENT0+L,e.TEXTURE_2D);if(g(N,y)){f(e.TEXTURE_2D)}}a.unbindTexture()}else{var O=e.TEXTURE_2D;if(m){if(H){var z=s.isDataTexture3D;O=z?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY}else{console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")}}a.bindTexture(O,d.__webglTexture);A(O,s,y);C(l.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0,O);if(g(s,y)){f(O)}a.unbindTexture()}if(t.depthBuffer){I(t)}};this.updateRenderTargetMipmap=function(t){for(var i=p(t)||H,n=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=0,s=n.length,l;o<s;o++){l=n[o];if(g(l,i)){var d=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,u=r.get(l).__webglTexture;a.bindTexture(d,u);f(d);a.unbindTexture()}}};this.updateMultisampleRenderTarget=function(t){if(t.useRenderbuffer){if(H){var i=t.width,n=t.height,o=e.COLOR_BUFFER_BIT,s=[e.COLOR_ATTACHMENT0],l=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;if(t.depthBuffer){s.push(l)}if(!t.ignoreDepthForMultisampleCopy){if(t.depthBuffer)o|=e.DEPTH_BUFFER_BIT;if(t.stencilBuffer)o|=e.STENCIL_BUFFER_BIT}var d=r.get(t);a.bindFramebuffer(e.READ_FRAMEBUFFER,d.__webglMultisampledFramebuffer);a.bindFramebuffer(e.DRAW_FRAMEBUFFER,d.__webglFramebuffer);if(t.ignoreDepthForMultisampleCopy){e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[l]);e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[l])}e.blitFramebuffer(0,0,i,n,0,0,i,n,o,e.NEAREST);e.invalidateFramebuffer(e.READ_FRAMEBUFFER,s);a.bindFramebuffer(e.READ_FRAMEBUFFER,null);a.bindFramebuffer(e.DRAW_FRAMEBUFFER,d.__webglMultisampledFramebuffer)}else{console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}};this.setupDepthRenderbuffer=I;this.setupFrameBufferTexture=C;this.safeSetTexture2D=F;this.safeSetTextureCube=B}function At(e,t,a){var r=a.isWebGL2;return{convert:function(a){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,n;if(a===$r)return e.UNSIGNED_BYTE;if(a===si)return e.UNSIGNED_SHORT_4_4_4_4;if(a===li)return e.UNSIGNED_SHORT_5_5_5_1;if(a===ei)return e.BYTE;if(a===ti)return e.SHORT;if(a===ai)return e.UNSIGNED_SHORT;if(a===ri)return e.INT;if(a===ii)return e.UNSIGNED_INT;if(a===ni)return e.FLOAT;if(a===oi){if(r)return e.HALF_FLOAT;n=t.get("OES_texture_half_float");if(null!==n){return n.HALF_FLOAT_OES}else{return null}}if(a===ui)return e.ALPHA;if(a===ci)return e.RGBA;if(a===mi)return e.LUMINANCE;if(a===gi)return e.LUMINANCE_ALPHA;if(a===fi)return e.DEPTH_COMPONENT;if(a===hi)return e.DEPTH_STENCIL;if(a===yi)return e.RED;if(a===pi){console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228");return e.RGBA}if(a===Gn){n=t.get("EXT_sRGB");if(null!==n){return n.SRGB_ALPHA_EXT}else{return null}}if(a===vi)return e.RED_INTEGER;if(a===_i)return e.RG;if(a===xi)return e.RG_INTEGER;if(a===bi)return e.RGBA_INTEGER;if(a===Ei||a===Si||a===Ti||a===Mi){if(i===un){n=t.get("WEBGL_compressed_texture_s3tc_srgb");if(null!==n){if(a===Ei)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(a===Si)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(a===Ti)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(a===Mi)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{return null}}else{n=t.get("WEBGL_compressed_texture_s3tc");if(null!==n){if(a===Ei)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===Si)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===Ti)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===Mi)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}else{return null}}}if(a===Ai||a===Ri||a===wi||a===Li){n=t.get("WEBGL_compressed_texture_pvrtc");if(null!==n){if(a===Ai)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===Ri)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===wi)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===Li)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else{return null}}if(a===Ci){n=t.get("WEBGL_compressed_texture_etc1");if(null!==n){return n.COMPRESSED_RGB_ETC1_WEBGL}else{return null}}if(a===ki||a===Pi){n=t.get("WEBGL_compressed_texture_etc");if(null!==n){if(a===ki)return i===un?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(a===Pi)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}else{return null}}if(a===Ii||a===Di||a===Ni||a===Ui||a===Fi||a===Bi||a===Oi||a===zi||a===Hi||a===Gi||a===Vi||a===Wi||a===ji||a===Xi){n=t.get("WEBGL_compressed_texture_astc");if(null!==n){if(a===Ii)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(a===Di)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(a===Ni)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(a===Ui)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(a===Fi)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(a===Bi)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(a===Oi)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(a===zi)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(a===Hi)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(a===Gi)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(a===Vi)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(a===Wi)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(a===ji)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(a===Xi)return i===un?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}else{return null}}if(a===qi){n=t.get("EXT_texture_compression_bptc");if(null!==n){if(a===qi)return i===un?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT}else{return null}}if(a===di){if(r)return e.UNSIGNED_INT_24_8;n=t.get("WEBGL_depth_texture");if(null!==n){return n.UNSIGNED_INT_24_8_WEBGL}else{return null}}}}}var hd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];_classCallCheck(this,t);e=a.call(this);e.cameras=r;return e}return t}(vl);hd.prototype.isArrayCamera=!0;var yd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck(this,t);e=a.call(this);e.type="Group";return e}return t}(gs);yd.prototype.isGroup=!0;var vd={type:"move"},_d=function(){function e(){_classCallCheck(this,e);this._targetRay=null;this._grip=null;this._hand=null}_createClass(e,[{key:"getHandSpace",value:function getHandSpace(){if(null===this._hand){this._hand=new yd;this._hand.matrixAutoUpdate=!1;this._hand.visible=!1;this._hand.joints={};this._hand.inputState={pinching:!1}}return this._hand}},{key:"getTargetRaySpace",value:function getTargetRaySpace(){if(null===this._targetRay){this._targetRay=new yd;this._targetRay.matrixAutoUpdate=!1;this._targetRay.visible=!1;this._targetRay.hasLinearVelocity=!1;this._targetRay.linearVelocity=new mo;this._targetRay.hasAngularVelocity=!1;this._targetRay.angularVelocity=new mo}return this._targetRay}},{key:"getGripSpace",value:function getGripSpace(){if(null===this._grip){this._grip=new yd;this._grip.matrixAutoUpdate=!1;this._grip.visible=!1;this._grip.hasLinearVelocity=!1;this._grip.linearVelocity=new mo;this._grip.hasAngularVelocity=!1;this._grip.angularVelocity=new mo}return this._grip}},{key:"dispatchEvent",value:function dispatchEvent(e){if(null!==this._targetRay){this._targetRay.dispatchEvent(e)}if(null!==this._grip){this._grip.dispatchEvent(e)}if(null!==this._hand){this._hand.dispatchEvent(e)}return this}},{key:"disconnect",value:function disconnect(e){this.dispatchEvent({type:"disconnected",data:e});if(null!==this._targetRay){this._targetRay.visible=!1}if(null!==this._grip){this._grip.visible=!1}if(null!==this._hand){this._hand.visible=!1}return this}},{key:"update",value:function update(e,t,a){var r=null,i=null,n=null,o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(null!==o){r=t.getPose(e.targetRaySpace,a);if(null!==r){o.matrix.fromArray(r.transform.matrix);o.matrix.decompose(o.position,o.rotation,o.scale);if(r.linearVelocity){o.hasLinearVelocity=!0;o.linearVelocity.copy(r.linearVelocity)}else{o.hasLinearVelocity=!1}if(r.angularVelocity){o.hasAngularVelocity=!0;o.angularVelocity.copy(r.angularVelocity)}else{o.hasAngularVelocity=!1}this.dispatchEvent(vd)}}if(l&&e.hand){n=!0;var d=_createForOfIteratorHelper(e.hand.values()),u;try{for(d.s();!(u=d.n()).done;){var p=u.value,c=t.getJointPose(p,a);if(l.joints[p.jointName]===void 0){var v=new yd;v.matrixAutoUpdate=!1;v.visible=!1;l.joints[p.jointName]=v;l.add(v)}var _=l.joints[p.jointName];if(null!==c){_.matrix.fromArray(c.transform.matrix);_.matrix.decompose(_.position,_.rotation,_.scale);_.jointRadius=c.radius}_.visible=null!==c}}catch(e){d.e(e)}finally{d.f()}var m=l.joints["index-finger-tip"],g=l.joints["thumb-tip"],f=m.position.distanceTo(g.position),h=.02,y=.005;if(l.inputState.pinching&&f>h+y){l.inputState.pinching=!1;this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})}else if(!l.inputState.pinching&&f<=h-y){l.inputState.pinching=!0;this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this})}}else{if(null!==s&&e.gripSpace){i=t.getPose(e.gripSpace,a);if(null!==i){s.matrix.fromArray(i.transform.matrix);s.matrix.decompose(s.position,s.rotation,s.scale);if(i.linearVelocity){s.hasLinearVelocity=!0;s.linearVelocity.copy(i.linearVelocity)}else{s.hasLinearVelocity=!1}if(i.angularVelocity){s.hasAngularVelocity=!0;s.angularVelocity.copy(i.angularVelocity)}else{s.hasAngularVelocity=!1}}}}}if(null!==o){o.visible=null!==r}if(null!==s){s.visible=null!==i}if(null!==l){l.visible=null!==n}return this}}]);return e}(),xd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,u,p){var c;_classCallCheck(this,t);p=p!==void 0?p:fi;if(p!==fi&&p!==hi){throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat")}if(i===void 0&&p===fi)i=ai;if(i===void 0&&p===hi)i=di;c=a.call(this,null,n,o,s,l,d,p,i,u);c.image={width:e,height:r};c.magFilter=l!==void 0?l:Vr;c.minFilter=d!==void 0?d:Vr;c.flipY=!1;c.generateMipmaps=!1;return c}return t}(oo);xd.prototype.isDepthTexture=!0;var bd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var p;_classCallCheck(this,t);p=a.call(this);var c=_assertThisInitialized(p),m=null,g=1,f=null,h="local-floor",y=e.extensions.has("WEBGL_multisampled_render_to_texture"),v=null,_=null,x=null,b=null,S=!1,T=null,M=r.getContextAttributes(),A=null,R=null,w=[],L=new Map,C=new vl;C.layers.enable(1);C.viewport=new so;var k=new vl;k.layers.enable(2);k.viewport=new so;var P=[C,k],I=new hd;I.layers.enable(1);I.layers.enable(2);var D=null,N=null;p.cameraAutoUpdate=!0;p.enabled=!1;p.isPresenting=!1;p.getController=function(e){var t=w[e];if(t===void 0){t=new _d;w[e]=t}return t.getTargetRaySpace()};p.getControllerGrip=function(e){var t=w[e];if(t===void 0){t=new _d;w[e]=t}return t.getGripSpace()};p.getHand=function(e){var t=w[e];if(t===void 0){t=new _d;w[e]=t}return t.getHandSpace()};function i(e){var t=L.get(e.inputSource);if(t){t.dispatchEvent({type:e.type,data:e.inputSource})}}function n(){L.forEach(function(e,t){e.disconnect(t)});L.clear();D=null;N=null;e.setRenderTarget(A);b=null;x=null;_=null;m=null;R=null;O.stop();c.isPresenting=!1;c.dispatchEvent({type:"sessionend"})}p.setFramebufferScaleFactor=function(e){g=e;if(!0===c.isPresenting){console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")}};p.setReferenceSpaceType=function(e){h=e;if(!0===c.isPresenting){console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")}};p.getReferenceSpace=function(){return f};p.getBaseLayer=function(){return null!==x?x:b};p.getBinding=function(){return _};p.getFrame=function(){return T};p.getSession=function(){return m};p.setSession=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(a){var s,l,d,u,p;return regeneratorRuntime.wrap(function(t){while(1){switch(t.prev=t.next){case 0:m=a;if(!(null!==m)){t.next=24;break}A=e.getRenderTarget();m.addEventListener("select",i);m.addEventListener("selectstart",i);m.addEventListener("selectend",i);m.addEventListener("squeeze",i);m.addEventListener("squeezestart",i);m.addEventListener("squeezeend",i);m.addEventListener("end",n);m.addEventListener("inputsourceschange",o);if(!(!0!==M.xrCompatible)){t.next=14;break}t.next=14;return r.makeXRCompatible();case 14:if(m.renderState.layers===void 0||!1===e.capabilities.isWebGL2){s={antialias:m.renderState.layers===void 0?M.antialias:!0,alpha:M.alpha,depth:M.depth,stencil:M.stencil,framebufferScaleFactor:g};b=new XRWebGLLayer(m,r,s);m.updateRenderState({baseLayer:b});R=new lo(b.framebufferWidth,b.framebufferHeight,{format:ci,type:$r,encoding:e.outputEncoding})}else{S=M.antialias;l=null;d=null;u=null;if(M.depth){u=M.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;l=M.stencil?hi:fi;d=M.stencil?di:ai}p={colorFormat:e.outputEncoding===un?r.SRGB8_ALPHA8:r.RGBA8,depthFormat:u,scaleFactor:g};_=new XRWebGLBinding(m,r);x=_.createProjectionLayer(p);m.updateRenderState({layers:[x]});if(S){R=new po(x.textureWidth,x.textureHeight,{format:ci,type:$r,depthTexture:new xd(x.textureWidth,x.textureHeight,d,void 0,void 0,void 0,void 0,void 0,void 0,l),stencilBuffer:M.stencil,ignoreDepth:x.ignoreDepthValues,useRenderToTexture:y,encoding:e.outputEncoding})}else{R=new lo(x.textureWidth,x.textureHeight,{format:ci,type:$r,depthTexture:new xd(x.textureWidth,x.textureHeight,d,void 0,void 0,void 0,void 0,void 0,void 0,l),stencilBuffer:M.stencil,ignoreDepth:x.ignoreDepthValues,encoding:e.outputEncoding})}}R.isXRRenderTarget=!0;this.setFoveation(1);t.next=19;return m.requestReferenceSpace(h);case 19:f=t.sent;O.setContext(m);O.start();c.isPresenting=!0;c.dispatchEvent({type:"sessionstart"});case 24:case"end":return t.stop();}}},t,this)}));return function(){return t.apply(this,arguments)}}();function o(e){for(var t=m.inputSources,a=0;a<w.length;a++){L.set(t[a],w[a])}for(var s=0;s<e.removed.length;s++){var r=e.removed[s],i=L.get(r);if(i){i.dispatchEvent({type:"disconnected",data:r});L.delete(r)}}for(var l=0;l<e.added.length;l++){var n=e.added[l],o=L.get(n);if(o){o.dispatchEvent({type:"connected",data:n})}}}var U=new mo,F=new mo;function s(e,t,a){U.setFromMatrixPosition(t.matrixWorld);F.setFromMatrixPosition(a.matrixWorld);var r=U.distanceTo(F),i=t.projectionMatrix.elements,n=a.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],d=(i[9]-1)/i[5],u=(i[8]-1)/i[0],p=(n[8]+1)/n[0],c=r/(-u+p),m=c*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale);e.translateX(m);e.translateZ(c);e.matrixWorld.compose(e.position,e.quaternion,e.scale);e.matrixWorldInverse.copy(e.matrixWorld).invert();var g=o+c,f=s+c;e.projectionMatrix.makePerspective(o*u-m,o*p+(r-m),l*s/f*g,d*s/f*g,g,f)}function d(e,t){if(null===t){e.matrixWorld.copy(e.matrix)}else{e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix)}e.matrixWorldInverse.copy(e.matrixWorld).invert()}p.updateCamera=function(e){if(null===m)return;I.near=k.near=C.near=e.near;I.far=k.far=C.far=e.far;if(D!==I.near||N!==I.far){m.updateRenderState({depthNear:I.near,depthFar:I.far});D=I.near;N=I.far}var t=e.parent,a=I.cameras;d(I,t);for(var o=0;o<a.length;o++){d(a[o],t)}I.matrixWorld.decompose(I.position,I.quaternion,I.scale);e.position.copy(I.position);e.quaternion.copy(I.quaternion);e.scale.copy(I.scale);e.matrix.copy(I.matrix);e.matrixWorld.copy(I.matrixWorld);for(var r=e.children,i=0,n=r.length;i<n;i++){r[i].updateMatrixWorld(!0)}if(2===a.length){s(I,C,k)}else{I.projectionMatrix.copy(C.projectionMatrix)}};p.getCamera=function(){return I};p.getFoveation=function(){if(null!==x){return x.fixedFoveation}if(null!==b){return b.fixedFoveation}};p.setFoveation=function(e){if(null!==x){x.fixedFoveation=e}if(null!==b&&b.fixedFoveation!==void 0){b.fixedFoveation=e}};var B=null;function u(t,a){v=a.getViewerPose(f);T=a;if(null!==v){var d=v.views;if(null!==b){e.setRenderTargetFramebuffer(R,b.framebuffer);e.setRenderTarget(R)}var u=!1;if(d.length!==I.cameras.length){I.cameras.length=0;u=!0}for(var p=0;p<d.length;p++){var r=d[p],i=null;if(null!==b){i=b.getViewport(r)}else{var c=_.getViewSubImage(x,r);i=c.viewport;if(0===p){e.setRenderTargetTextures(R,c.colorTexture,x.ignoreDepthValues?void 0:c.depthStencilTexture);e.setRenderTarget(R)}}var g=P[p];g.matrix.fromArray(r.transform.matrix);g.projectionMatrix.fromArray(r.projectionMatrix);g.viewport.set(i.x,i.y,i.width,i.height);if(0==p){I.matrix.copy(g.matrix)}if(!0===u){I.cameras.push(g)}}}for(var n=m.inputSources,o=0;o<w.length;o++){var s=w[o],l=n[o];s.update(l,a,f)}if(B)B(t,a);T=null}var O=new E;O.setAnimationLoop(u);p.setAnimationLoop=function(e){B=e};p.dispose=function(){};return p}return t}(Vn);function Rt(e){function t(t,a){t.opacity.value=a.opacity;if(a.color){t.diffuse.value.copy(a.color)}if(a.emissive){t.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity)}if(a.map){t.map.value=a.map}if(a.alphaMap){t.alphaMap.value=a.alphaMap}if(a.specularMap){t.specularMap.value=a.specularMap}if(0<a.alphaTest){t.alphaTest.value=a.alphaTest}var r=e.get(a).envMap;if(r){t.envMap.value=r;t.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1;t.reflectivity.value=a.reflectivity;t.ior.value=a.ior;t.refractionRatio.value=a.refractionRatio}if(a.lightMap){t.lightMap.value=a.lightMap;t.lightMapIntensity.value=a.lightMapIntensity}if(a.aoMap){t.aoMap.value=a.aoMap;t.aoMapIntensity.value=a.aoMapIntensity}var i;if(a.map){i=a.map}else if(a.specularMap){i=a.specularMap}else if(a.displacementMap){i=a.displacementMap}else if(a.normalMap){i=a.normalMap}else if(a.bumpMap){i=a.bumpMap}else if(a.roughnessMap){i=a.roughnessMap}else if(a.metalnessMap){i=a.metalnessMap}else if(a.alphaMap){i=a.alphaMap}else if(a.emissiveMap){i=a.emissiveMap}else if(a.clearcoatMap){i=a.clearcoatMap}else if(a.clearcoatNormalMap){i=a.clearcoatNormalMap}else if(a.clearcoatRoughnessMap){i=a.clearcoatRoughnessMap}else if(a.specularIntensityMap){i=a.specularIntensityMap}else if(a.specularColorMap){i=a.specularColorMap}else if(a.transmissionMap){i=a.transmissionMap}else if(a.thicknessMap){i=a.thicknessMap}else if(a.sheenColorMap){i=a.sheenColorMap}else if(a.sheenRoughnessMap){i=a.sheenRoughnessMap}if(i!==void 0){if(i.isWebGLRenderTarget){i=i.texture}if(!0===i.matrixAutoUpdate){i.updateMatrix()}t.uvTransform.value.copy(i.matrix)}var n;if(a.aoMap){n=a.aoMap}else if(a.lightMap){n=a.lightMap}if(n!==void 0){if(n.isWebGLRenderTarget){n=n.texture}if(!0===n.matrixAutoUpdate){n.updateMatrix()}t.uv2Transform.value.copy(n.matrix)}}function a(e,t){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity}function r(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function i(e,t,a,r){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity;e.size.value=t.size*a;e.scale.value=.5*r;if(t.map){e.map.value=t.map}if(t.alphaMap){e.alphaMap.value=t.alphaMap}if(0<t.alphaTest){e.alphaTest.value=t.alphaTest}var i;if(t.map){i=t.map}else if(t.alphaMap){i=t.alphaMap}if(i!==void 0){if(!0===i.matrixAutoUpdate){i.updateMatrix()}e.uvTransform.value.copy(i.matrix)}}function n(e,t){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity;e.rotation.value=t.rotation;if(t.map){e.map.value=t.map}if(t.alphaMap){e.alphaMap.value=t.alphaMap}if(0<t.alphaTest){e.alphaTest.value=t.alphaTest}var a;if(t.map){a=t.map}else if(t.alphaMap){a=t.alphaMap}if(a!==void 0){if(!0===a.matrixAutoUpdate){a.updateMatrix()}e.uvTransform.value.copy(a.matrix)}}function o(e,t){if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}}function s(e,t){e.specular.value.copy(t.specular);e.shininess.value=Math.max(t.shininess,1e-4);if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Wa)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Wa)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function l(e,t){if(t.gradientMap){e.gradientMap.value=t.gradientMap}if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Wa)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Wa)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function d(t,a){t.roughness.value=a.roughness;t.metalness.value=a.metalness;if(a.roughnessMap){t.roughnessMap.value=a.roughnessMap}if(a.metalnessMap){t.metalnessMap.value=a.metalnessMap}if(a.emissiveMap){t.emissiveMap.value=a.emissiveMap}if(a.bumpMap){t.bumpMap.value=a.bumpMap;t.bumpScale.value=a.bumpScale;if(a.side===Wa)t.bumpScale.value*=-1}if(a.normalMap){t.normalMap.value=a.normalMap;t.normalScale.value.copy(a.normalScale);if(a.side===Wa)t.normalScale.value.negate()}if(a.displacementMap){t.displacementMap.value=a.displacementMap;t.displacementScale.value=a.displacementScale;t.displacementBias.value=a.displacementBias}var r=e.get(a).envMap;if(r){t.envMapIntensity.value=a.envMapIntensity}}function u(e,t,a){d(e,t);e.ior.value=t.ior;if(0<t.sheen){e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen);e.sheenRoughness.value=t.sheenRoughness;if(t.sheenColorMap){e.sheenColorMap.value=t.sheenColorMap}if(t.sheenRoughnessMap){e.sheenRoughnessMap.value=t.sheenRoughnessMap}}if(0<t.clearcoat){e.clearcoat.value=t.clearcoat;e.clearcoatRoughness.value=t.clearcoatRoughness;if(t.clearcoatMap){e.clearcoatMap.value=t.clearcoatMap}if(t.clearcoatRoughnessMap){e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap}if(t.clearcoatNormalMap){e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale);e.clearcoatNormalMap.value=t.clearcoatNormalMap;if(t.side===Wa){e.clearcoatNormalScale.value.negate()}}}if(0<t.transmission){e.transmission.value=t.transmission;e.transmissionSamplerMap.value=a.texture;e.transmissionSamplerSize.value.set(a.width,a.height);if(t.transmissionMap){e.transmissionMap.value=t.transmissionMap}e.thickness.value=t.thickness;if(t.thicknessMap){e.thicknessMap.value=t.thicknessMap}e.attenuationDistance.value=t.attenuationDistance;e.attenuationColor.value.copy(t.attenuationColor)}e.specularIntensity.value=t.specularIntensity;e.specularColor.value.copy(t.specularColor);if(t.specularIntensityMap){e.specularIntensityMap.value=t.specularIntensityMap}if(t.specularColorMap){e.specularColorMap.value=t.specularColorMap}}function p(e,t){if(t.matcap){e.matcap.value=t.matcap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Wa)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Wa)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function c(e,t){if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function m(e,t){if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}e.referencePosition.value.copy(t.referencePosition);e.nearDistance.value=t.nearDistance;e.farDistance.value=t.farDistance}function g(e,t){if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===Wa)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===Wa)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color);if(t.isFog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t.isFogExp2){e.fogDensity.value=t.density}},refreshMaterialUniforms:function(e,f,h,y,v){if(f.isMeshBasicMaterial){t(e,f)}else if(f.isMeshLambertMaterial){t(e,f);o(e,f)}else if(f.isMeshToonMaterial){t(e,f);l(e,f)}else if(f.isMeshPhongMaterial){t(e,f);s(e,f)}else if(f.isMeshStandardMaterial){t(e,f);if(f.isMeshPhysicalMaterial){u(e,f,v)}else{d(e,f)}}else if(f.isMeshMatcapMaterial){t(e,f);p(e,f)}else if(f.isMeshDepthMaterial){t(e,f);c(e,f)}else if(f.isMeshDistanceMaterial){t(e,f);m(e,f)}else if(f.isMeshNormalMaterial){t(e,f);g(e,f)}else if(f.isLineBasicMaterial){a(e,f);if(f.isLineDashedMaterial){r(e,f)}}else if(f.isPointsMaterial){i(e,f,h,y)}else if(f.isSpriteMaterial){n(e,f)}else if(f.isShadowMaterial){e.color.value.copy(f.color);e.opacity.value=f.opacity}else if(f.isShaderMaterial){f.uniformsNeedUpdate=!1}}}}function wt(){var e=c("canvas");e.style.display="block";return e}function Lt(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},C=b.canvas!==void 0?b.canvas:wt(),k=b.context!==void 0?b.context:null,P=b.alpha!==void 0?b.alpha:!1,I=b.depth!==void 0?b.depth:!0,D=b.stencil!==void 0?b.stencil:!0,N=b.antialias!==void 0?b.antialias:!1,H=b.premultipliedAlpha!==void 0?b.premultipliedAlpha:!0,G=b.preserveDrawingBuffer!==void 0?b.preserveDrawingBuffer:!1,V=b.powerPreference!==void 0?b.powerPreference:"default",X=b.failIfMajorPerformanceCaveat!==void 0?b.failIfMajorPerformanceCaveat:!1,q=null,Y=null,Z=[],J=[];this.domElement=C;this.debug={checkShaderErrors:!0};this.autoClear=!0;this.autoClearColor=!0;this.autoClearDepth=!0;this.autoClearStencil=!0;this.sortObjects=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.outputEncoding=dn;this.physicallyCorrectLights=!1;this.toneMapping=Rr;this.toneMappingExposure=1;var K=this,Q=!1,$=0,ee=0,te=null,ae=-1,re=null,ie=new so,ne=new so,oe=null,se=C.width,le=C.height,de=1,ue=null,pe=null,ce=new so(0,0,se,le),me=new so(0,0,se,le),ge=!1,fe=new wl,he=!1,ye=!1,ve=null,_e=new Vo,xe=new mo,be={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function e(){return null===te?de:1}var Ee=k;function t(e,t){for(var i=0;i<e.length;i++){var a=e[i],r=C.getContext(a,t);if(null!==r)return r}return null}try{if("setAttribute"in C)C.setAttribute("data-engine","three.js r".concat(Pa));C.addEventListener("webglcontextlost",r,!1);C.addEventListener("webglcontextrestored",i,!1);if(null===Ee){var Je=["webgl2","webgl","experimental-webgl"];if(!0===K.isWebGL1Renderer){Je.shift()}Ee=t(Je,{alpha:!0,depth:I,stencil:D,antialias:N,premultipliedAlpha:H,preserveDrawingBuffer:G,powerPreference:V,failIfMajorPerformanceCaveat:X});if(null===Ee){if(t(Je)){throw new Error("Error creating WebGL context with your selected attributes.")}else{throw new Error("Error creating WebGL context.")}}}if(Ee.getShaderPrecisionFormat===void 0){Ee.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}}catch(e){console.error("THREE.WebGLRenderer: "+e.message);throw e}var Se,Te,Me,Ae,Re,we,Le,Ce,ke,Pe,Ie,De,Ne,Ue,Fe,Be,Oe,ze,Ge,Ve,We,je,Xe;function a(){Se=new F(Ee);Te=new R(Ee,Se,b);Se.init(Te);je=new At(Ee,Se,Te);Me=new Tt(Ee,Se,Te);Ae=new z(Ee);Re=new ct;we=new Mt(Ee,Se,Me,Re,Te,je,Ae);Le=new L(K);Ce=new U(K);ke=new S(Ee,Te);Xe=new M(Ee,Se,ke,Te);Pe=new B(Ee,ke,Ae,Xe);Ie=new j(Ee,Pe,ke,Ae);Ge=new W(Ee,Te,we);Be=new w(Re);De=new pt(K,Le,Ce,Se,Te,Xe,Be);Ne=new Rt(Re);Ue=new ht;Fe=new Et(Se,Te);ze=new T(K,Le,Me,Ie,P,H);Oe=new St(K,Ie,Te);Ve=new A(Ee,Se,Ae,Te);We=new O(Ee,Se,Ae,Te);Ae.programs=De.programs;K.capabilities=Te;K.extensions=Se;K.properties=Re;K.renderLists=Ue;K.shadowMap=Oe;K.state=Me;K.info=Ae}a();var qe=new bd(K,Ee);this.xr=qe;this.getContext=function(){return Ee};this.getContextAttributes=function(){return Ee.getContextAttributes()};this.forceContextLoss=function(){var e=Se.get("WEBGL_lose_context");if(e)e.loseContext()};this.forceContextRestore=function(){var e=Se.get("WEBGL_lose_context");if(e)e.restoreContext()};this.getPixelRatio=function(){return de};this.setPixelRatio=function(e){if(e===void 0)return;de=e;this.setSize(se,le,!1)};this.getSize=function(e){return e.set(se,le)};this.setSize=function(e,t,a){if(qe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}se=e;le=t;C.width=Math.floor(e*de);C.height=Math.floor(t*de);if(!1!==a){C.style.width=e+"px";C.style.height=t+"px"}this.setViewport(0,0,e,t)};this.getDrawingBufferSize=function(e){return e.set(se*de,le*de).floor()};this.setDrawingBufferSize=function(e,t,a){se=e;le=t;de=a;C.width=Math.floor(e*a);C.height=Math.floor(t*a);this.setViewport(0,0,e,t)};this.getCurrentViewport=function(e){return e.copy(ie)};this.getViewport=function(e){return e.copy(ce)};this.setViewport=function(e,t,a,r){if(e.isVector4){ce.set(e.x,e.y,e.z,e.w)}else{ce.set(e,t,a,r)}Me.viewport(ie.copy(ce).multiplyScalar(de).floor())};this.getScissor=function(e){return e.copy(me)};this.setScissor=function(e,t,a,r){if(e.isVector4){me.set(e.x,e.y,e.z,e.w)}else{me.set(e,t,a,r)}Me.scissor(ne.copy(me).multiplyScalar(de).floor())};this.getScissorTest=function(){return ge};this.setScissorTest=function(e){Me.setScissorTest(ge=e)};this.setOpaqueSort=function(e){ue=e};this.setTransparentSort=function(e){pe=e};this.getClearColor=function(e){return e.copy(ze.getClearColor())};this.setClearColor=function(){ze.setClearColor.apply(ze,arguments)};this.getClearAlpha=function(){return ze.getClearAlpha()};this.setClearAlpha=function(){ze.setClearAlpha.apply(ze,arguments)};this.clear=function(e,t,a){var r=0;if(e===void 0||e)r|=Ee.COLOR_BUFFER_BIT;if(t===void 0||t)r|=Ee.DEPTH_BUFFER_BIT;if(a===void 0||a)r|=Ee.STENCIL_BUFFER_BIT;Ee.clear(r)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.dispose=function(){C.removeEventListener("webglcontextlost",r,!1);C.removeEventListener("webglcontextrestored",i,!1);Ue.dispose();Fe.dispose();Re.dispose();Le.dispose();Ce.dispose();Ie.dispose();Xe.dispose();De.dispose();qe.dispose();qe.removeEventListener("sessionstart",d);qe.removeEventListener("sessionend",u);if(ve){ve.dispose();ve=null}Ze.stop()};function r(e){e.preventDefault();console.log("THREE.WebGLRenderer: Context Lost.");Q=!0}function i(){console.log("THREE.WebGLRenderer: Context Restored.");Q=!1;var e=Ae.autoReset,t=Oe.enabled,r=Oe.autoUpdate,i=Oe.needsUpdate,n=Oe.type;a();Ae.autoReset=e;Oe.enabled=t;Oe.autoUpdate=r;Oe.needsUpdate=i;Oe.type=n}function n(e){var t=e.target;t.removeEventListener("dispose",n);o(t)}function o(e){s(e);Re.remove(e)}function s(e){var t=Re.get(e).programs;if(t!==void 0){t.forEach(function(e){De.releaseProgram(e)});if(e.isShaderMaterial){De.releaseShaderCache(e)}}}this.renderBufferDirect=function(t,a,r,i,n,o){if(null===a)a=be;var s=n.isMesh&&0>n.matrixWorld.determinant(),l=v(t,a,r,i,n);Me.setMaterial(i,s);var d=r.index,u=r.attributes.position;if(null===d){if(u===void 0||0===u.count)return}else if(0===d.count){return}var p=1;if(!0===i.wireframe){d=Pe.getWireframeAttribute(r);p=2}Xe.setup(n,i,l,r,d);var c,m=Ve;if(null!==d){c=ke.get(d);m=We;m.setIndex(c)}var g=null!==d?d.count:u.count,f=r.drawRange.start*p,h=r.drawRange.count*p,y=null!==o?o.start*p:0,_=null!==o?o.count*p:1/0,x=Math.max(f,y),b=Math.min(g,f+h,y+_)-1,E=Math.max(0,b-x+1);if(0===E)return;if(n.isMesh){if(!0===i.wireframe){Me.setLineWidth(i.wireframeLinewidth*e());m.setMode(Ee.LINES)}else{m.setMode(Ee.TRIANGLES)}}else if(n.isLine){var S=i.linewidth;if(S===void 0)S=1;Me.setLineWidth(S*e());if(n.isLineSegments){m.setMode(Ee.LINES)}else if(n.isLineLoop){m.setMode(Ee.LINE_LOOP)}else{m.setMode(Ee.LINE_STRIP)}}else if(n.isPoints){m.setMode(Ee.POINTS)}else if(n.isSprite){m.setMode(Ee.TRIANGLES)}if(n.isInstancedMesh){m.renderInstances(x,E,n.count)}else if(r.isInstancedBufferGeometry){var T=Math.min(r.instanceCount,r._maxInstanceCount);m.renderInstances(x,E,T)}else{m.render(x,E)}};this.compile=function(e,t){Y=Fe.get(e);Y.init();J.push(Y);e.traverseVisible(function(e){if(e.isLight&&e.layers.test(t.layers)){Y.pushLight(e);if(e.castShadow){Y.pushShadow(e)}}});Y.setupLights(K.physicallyCorrectLights);e.traverse(function(t){var a=t.material;if(a){if(Array.isArray(a)){for(var r=0,i;r<a.length;r++){i=a[r];h(i,e,t)}}else{h(a,e,t)}}});J.pop();Y=null};var Ye=null;function l(e){if(Ye)Ye(e)}function d(){Ze.stop()}function u(){Ze.start()}var Ze=new E;Ze.setAnimationLoop(l);if("undefined"!=typeof window)Ze.setContext(window);this.setAnimationLoop=function(e){Ye=e;qe.setAnimationLoop(e);null===e?Ze.stop():Ze.start()};qe.addEventListener("sessionstart",d);qe.addEventListener("sessionend",u);this.render=function(e,t){if(t!==void 0&&!0!==t.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===Q)return;if(!0===e.autoUpdate)e.updateMatrixWorld();if(null===t.parent)t.updateMatrixWorld();if(!0===qe.enabled&&!0===qe.isPresenting){if(!0===qe.cameraAutoUpdate)qe.updateCamera(t);t=qe.getCamera()}if(!0===e.isScene)e.onBeforeRender(K,e,t,te);Y=Fe.get(e,J.length);Y.init();J.push(Y);_e.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);fe.setFromProjectionMatrix(_e);ye=this.localClippingEnabled;he=Be.init(this.clippingPlanes,ye,t);q=Ue.get(e,Z.length);q.init();Z.push(q);p(e,t,0,K.sortObjects);q.finish();if(!0===K.sortObjects){q.sort(ue,pe)}if(!0===he)Be.beginShadows();var a=Y.state.shadowsArray;Oe.render(a,e,t);if(!0===he)Be.endShadows();if(!0===this.info.autoReset)this.info.reset();ze.render(q,e);Y.setupLights(K.physicallyCorrectLights);if(t.isArrayCamera){for(var r=t.cameras,i=0,n=r.length,o;i<n;i++){o=r[i];c(q,e,o,o.viewport)}}else{c(q,e,t)}if(null!==te){we.updateMultisampleRenderTarget(te);we.updateRenderTargetMipmap(te)}if(!0===e.isScene)e.onAfterRender(K,e,t);Me.buffers.depth.setTest(!0);Me.buffers.depth.setMask(!0);Me.buffers.color.setMask(!0);Me.setPolygonOffset(!1);Xe.resetDefaultState();ae=-1;re=null;J.pop();if(0<J.length){Y=J[J.length-1]}else{Y=null}Z.pop();if(0<Z.length){q=Z[Z.length-1]}else{q=null}};function p(e,t,a,r){if(!1===e.visible)return;var i=e.layers.test(t.layers);if(i){if(e.isGroup){a=e.renderOrder}else if(e.isLOD){if(!0===e.autoUpdate)e.update(t)}else if(e.isLight){Y.pushLight(e);if(e.castShadow){Y.pushShadow(e)}}else if(e.isSprite){if(!e.frustumCulled||fe.intersectsSprite(e)){if(r){xe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(_e)}var n=Ie.update(e),o=e.material;if(o.visible){q.push(e,n,o,a,xe.z,null)}}}else if(e.isMesh||e.isLine||e.isPoints){if(e.isSkinnedMesh){if(e.skeleton.frame!==Ae.render.frame){e.skeleton.update();e.skeleton.frame=Ae.render.frame}}if(!e.frustumCulled||fe.intersectsObject(e)){if(r){xe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(_e)}var s=Ie.update(e),d=e.material;if(Array.isArray(d)){for(var u=s.groups,c=0,m=u.length;c<m;c++){var l=u[c],g=d[l.materialIndex];if(g&&g.visible){q.push(e,s,g,a,xe.z,l)}}}else if(d.visible){q.push(e,s,d,a,xe.z,null)}}}}for(var f=e.children,h=0,y=f.length;h<y;h++){p(f[h],t,a,r)}}function c(e,t,a,r){var i=e.opaque,n=e.transmissive,o=e.transparent;Y.setupLightsView(a);if(0<n.length)m(i,t,a);if(r)Me.viewport(ie.copy(r));if(0<i.length)g(i,t,a);if(0<n.length)g(n,t,a);if(0<o.length)g(o,t,a)}function m(e,t,a){if(null===ve){var r=!0===N&&!0===Te.isWebGL2,i=r?po:lo;ve=new i(1024,1024,{generateMipmaps:!0,type:null!==je.convert(oi)?oi:$r,minFilter:Kr,magFilter:Vr,wrapS:Hr,wrapT:Hr,useRenderToTexture:Se.has("WEBGL_multisampled_render_to_texture")})}var n=K.getRenderTarget();K.setRenderTarget(ve);K.clear();var o=K.toneMapping;K.toneMapping=Rr;g(e,t,a);K.toneMapping=o;we.updateMultisampleRenderTarget(ve);we.updateRenderTargetMipmap(ve);K.setRenderTarget(n)}function g(e,t,a){for(var r=!0===t.isScene?t.overrideMaterial:null,i=0,n=e.length;i<n;i++){var o=e[i],s=o.object,l=o.geometry,d=null===r?o.material:r,u=o.group;if(s.layers.test(a.layers)){f(s,t,a,l,d,u)}}}function f(e,t,a,r,i,n){e.onBeforeRender(K,t,a,r,i,n);e.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,e.matrixWorld);e.normalMatrix.getNormalMatrix(e.modelViewMatrix);i.onBeforeRender(K,t,a,r,e,n);if(!0===i.transparent&&i.side===ja){i.side=Wa;i.needsUpdate=!0;K.renderBufferDirect(a,t,r,i,e,n);i.side=Va;i.needsUpdate=!0;K.renderBufferDirect(a,t,r,i,e,n);i.side=ja}else{K.renderBufferDirect(a,t,r,i,e,n)}e.onAfterRender(K,t,a,r,i,n)}function h(e,t,a){if(!0!==t.isScene)t=be;var r=Re.get(e),i=Y.state.lights,o=Y.state.shadowsArray,s=i.state.version,l=De.getParameters(e,i.state,o,t,a),d=De.getProgramCacheKey(l),u=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null;r.fog=t.fog;r.envMap=(e.isMeshStandardMaterial?Ce:Le).get(e.envMap||r.environment);if(u===void 0){e.addEventListener("dispose",n);u=new Map;r.programs=u}var p=u.get(d);if(p!==void 0){if(r.currentProgram===p&&r.lightsStateVersion===s){y(e,l);return p}}else{l.uniforms=De.getUniforms(e);e.onBuild(a,l,K);e.onBeforeCompile(l,K);p=De.acquireProgram(l,d);u.set(d,p);r.uniforms=l.uniforms}var c=r.uniforms;if(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping){c.clippingPlanes=Be.uniform}y(e,l);r.needsLights=x(e);r.lightsStateVersion=s;if(r.needsLights){c.ambientLightColor.value=i.state.ambient;c.lightProbe.value=i.state.probe;c.directionalLights.value=i.state.directional;c.directionalLightShadows.value=i.state.directionalShadow;c.spotLights.value=i.state.spot;c.spotLightShadows.value=i.state.spotShadow;c.rectAreaLights.value=i.state.rectArea;c.ltc_1.value=i.state.rectAreaLTC1;c.ltc_2.value=i.state.rectAreaLTC2;c.pointLights.value=i.state.point;c.pointLightShadows.value=i.state.pointShadow;c.hemisphereLights.value=i.state.hemi;c.directionalShadowMap.value=i.state.directionalShadowMap;c.directionalShadowMatrix.value=i.state.directionalShadowMatrix;c.spotShadowMap.value=i.state.spotShadowMap;c.spotShadowMatrix.value=i.state.spotShadowMatrix;c.pointShadowMap.value=i.state.pointShadowMap;c.pointShadowMatrix.value=i.state.pointShadowMatrix}var m=p.getUniforms(),g=He.seqWithValue(m.seq,c);r.currentProgram=p;r.uniformsList=g;return p}function y(e,t){var a=Re.get(e);a.outputEncoding=t.outputEncoding;a.instancing=t.instancing;a.skinning=t.skinning;a.morphTargets=t.morphTargets;a.morphNormals=t.morphNormals;a.morphTargetsCount=t.morphTargetsCount;a.numClippingPlanes=t.numClippingPlanes;a.numIntersection=t.numClipIntersection;a.vertexAlphas=t.vertexAlphas;a.vertexTangents=t.vertexTangents;a.toneMapping=t.toneMapping}function v(e,t,a,r,i){if(!0!==t.isScene)t=be;we.resetTextureUnits();var n=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===te?K.outputEncoding:!0===te.isXRRenderTarget?te.texture.encoding:dn,l=(r.isMeshStandardMaterial?Ce:Le).get(r.envMap||o),d=!0===r.vertexColors&&!!a.attributes.color&&4===a.attributes.color.itemSize,u=!!r.normalMap&&!!a.attributes.tangent,p=!!a.morphAttributes.position,c=!!a.morphAttributes.normal,m=!!a.morphAttributes.position?a.morphAttributes.position.length:0,g=r.toneMapped?K.toneMapping:Rr,f=Re.get(r),y=Y.state.lights;if(!0===he){if(!0===ye||e!==re){var A=e===re&&r.id===ae;Be.setState(r,e,A)}}var v=!1;if(r.version===f.__version){if(f.needsLights&&f.lightsStateVersion!==y.state.version){v=!0}else if(f.outputEncoding!==s){v=!0}else if(i.isInstancedMesh&&!1===f.instancing){v=!0}else if(!i.isInstancedMesh&&!0===f.instancing){v=!0}else if(i.isSkinnedMesh&&!1===f.skinning){v=!0}else if(!i.isSkinnedMesh&&!0===f.skinning){v=!0}else if(f.envMap!==l){v=!0}else if(r.fog&&f.fog!==n){v=!0}else if(f.numClippingPlanes!==void 0&&(f.numClippingPlanes!==Be.numPlanes||f.numIntersection!==Be.numIntersection)){v=!0}else if(f.vertexAlphas!==d){v=!0}else if(f.vertexTangents!==u){v=!0}else if(f.morphTargets!==p){v=!0}else if(f.morphNormals!==c){v=!0}else if(f.toneMapping!==g){v=!0}else if(!0===Te.isWebGL2&&f.morphTargetsCount!==m){v=!0}}else{v=!0;f.__version=r.version}var x=f.currentProgram;if(!0==v){x=h(r,t,i)}var b=!1,E=!1,S=!1,T=x.getUniforms(),M=f.uniforms;if(Me.useProgram(x.program)){b=!0;E=!0;S=!0}if(r.id!==ae){ae=r.id;E=!0}if(b||re!==e){T.setValue(Ee,"projectionMatrix",e.projectionMatrix);if(Te.logarithmicDepthBuffer){T.setValue(Ee,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2))}if(re!==e){re=e;E=!0;S=!0}if(r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var R=T.map.cameraPosition;if(R!==void 0){R.setValue(Ee,xe.setFromMatrixPosition(e.matrixWorld))}}if(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial){T.setValue(Ee,"isOrthographic",!0===e.isOrthographicCamera)}if(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh){T.setValue(Ee,"viewMatrix",e.matrixWorldInverse)}}if(i.isSkinnedMesh){T.setOptional(Ee,i,"bindMatrix");T.setOptional(Ee,i,"bindMatrixInverse");var w=i.skeleton;if(w){if(Te.floatVertexTextures){if(null===w.boneTexture)w.computeBoneTexture();T.setValue(Ee,"boneTexture",w.boneTexture,we);T.setValue(Ee,"boneTextureSize",w.boneTextureSize)}else{T.setOptional(Ee,w,"boneMatrices")}}}if(!!a&&(a.morphAttributes.position!==void 0||a.morphAttributes.normal!==void 0)){Ge.update(i,a,r,x)}if(E||f.receiveShadow!==i.receiveShadow){f.receiveShadow=i.receiveShadow;T.setValue(Ee,"receiveShadow",i.receiveShadow)}if(E){T.setValue(Ee,"toneMappingExposure",K.toneMappingExposure);if(f.needsLights){_(M,S)}if(n&&r.fog){Ne.refreshFogUniforms(M,n)}Ne.refreshMaterialUniforms(M,r,de,le,ve);He.upload(Ee,f.uniformsList,M,we)}if(r.isShaderMaterial&&!0===r.uniformsNeedUpdate){He.upload(Ee,f.uniformsList,M,we);r.uniformsNeedUpdate=!1}if(r.isSpriteMaterial){T.setValue(Ee,"center",i.center)}T.setValue(Ee,"modelViewMatrix",i.modelViewMatrix);T.setValue(Ee,"normalMatrix",i.normalMatrix);T.setValue(Ee,"modelMatrix",i.matrixWorld);return x}function _(e,t){e.ambientLightColor.needsUpdate=t;e.lightProbe.needsUpdate=t;e.directionalLights.needsUpdate=t;e.directionalLightShadows.needsUpdate=t;e.pointLights.needsUpdate=t;e.pointLightShadows.needsUpdate=t;e.spotLights.needsUpdate=t;e.spotLightShadows.needsUpdate=t;e.rectAreaLights.needsUpdate=t;e.hemisphereLights.needsUpdate=t}function x(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}this.getActiveCubeFace=function(){return $};this.getActiveMipmapLevel=function(){return ee};this.getRenderTarget=function(){return te};this.setRenderTargetTextures=function(e,t,a){Re.get(e.texture).__webglTexture=t;Re.get(e.depthTexture).__webglTexture=a;var r=Re.get(e);r.__hasExternalTextures=!0;if(r.__hasExternalTextures){r.__autoAllocateDepthBuffer=a===void 0;if(!r.__autoAllocateDepthBuffer){if(e.useRenderToTexture){console.warn("render-to-texture extension was disabled because an external texture was provided");e.useRenderToTexture=!1;e.useRenderbuffer=!0}}}};this.setRenderTargetFramebuffer=function(e,t){var a=Re.get(e);a.__webglFramebuffer=t;a.__useDefaultFramebuffer=t===void 0};this.setRenderTarget=function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;te=e;$=t;ee=a;var r=!0;if(e){var d=Re.get(e);if(d.__useDefaultFramebuffer!==void 0){Me.bindFramebuffer(Ee.FRAMEBUFFER,null);r=!1}else if(d.__webglFramebuffer===void 0){we.setupRenderTarget(e)}else if(d.__hasExternalTextures){we.rebindTextures(e,Re.get(e.texture).__webglTexture,Re.get(e.depthTexture).__webglTexture)}}var i=null,n=!1,o=!1;if(e){var u=e.texture;if(u.isDataTexture3D||u.isDataTexture2DArray){o=!0}var p=Re.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget){i=p[t];n=!0}else if(e.useRenderbuffer){i=Re.get(e).__webglMultisampledFramebuffer}else{i=p}ie.copy(e.viewport);ne.copy(e.scissor);oe=e.scissorTest}else{ie.copy(ce).multiplyScalar(de).floor();ne.copy(me).multiplyScalar(de).floor();oe=ge}var s=Me.bindFramebuffer(Ee.FRAMEBUFFER,i);if(s&&Te.drawBuffers&&r){Me.drawBuffers(e,i)}Me.viewport(ie);Me.scissor(ne);Me.setScissorTest(oe);if(n){var c=Re.get(e.texture);Ee.framebufferTexture2D(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_CUBE_MAP_POSITIVE_X+t,c.__webglTexture,a)}else if(o){var l=Re.get(e.texture);Ee.framebufferTextureLayer(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,l.__webglTexture,a||0,t||0)}ae=-1};this.readRenderTargetPixels=function(e,t,a,r,i,n,o){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var s=Re.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&o!==void 0){s=s[o]}if(s){Me.bindFramebuffer(Ee.FRAMEBUFFER,s);try{var l=e.texture,d=l.format,u=l.type;if(d!==ci&&je.convert(d)!==Ee.getParameter(Ee.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}var p=u===oi&&(Se.has("EXT_color_buffer_half_float")||Te.isWebGL2&&Se.has("EXT_color_buffer_float"));if(u!==$r&&je.convert(u)!==Ee.getParameter(Ee.IMPLEMENTATION_COLOR_READ_TYPE)&&!(u===ni&&(Te.isWebGL2||Se.has("OES_texture_float")||Se.has("WEBGL_color_buffer_float")))&&!p){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}if(Ee.checkFramebufferStatus(Ee.FRAMEBUFFER)===Ee.FRAMEBUFFER_COMPLETE){if(0<=t&&t<=e.width-r&&0<=a&&a<=e.height-i){Ee.readPixels(t,a,r,i,je.convert(d),je.convert(u),n)}}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}}finally{var c=null!==te?Re.get(te).__webglFramebuffer:null;Me.bindFramebuffer(Ee.FRAMEBUFFER,c)}}};this.copyFramebufferToTexture=function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;if(!0!==t.isFramebufferTexture){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}var r=Math.pow(2,-a),i=Math.floor(t.image.width*r),n=Math.floor(t.image.height*r);we.setTexture2D(t,0);Ee.copyTexSubImage2D(Ee.TEXTURE_2D,a,0,0,e.x,e.y,i,n);Me.unbindTexture()};this.copyTextureToTexture=function(e,t,a){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0,i=t.image.width,n=t.image.height,o=je.convert(a.format),s=je.convert(a.type);we.setTexture2D(a,0);Ee.pixelStorei(Ee.UNPACK_FLIP_Y_WEBGL,a.flipY);Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);Ee.pixelStorei(Ee.UNPACK_ALIGNMENT,a.unpackAlignment);if(t.isDataTexture){Ee.texSubImage2D(Ee.TEXTURE_2D,r,e.x,e.y,i,n,o,s,t.image.data)}else{if(t.isCompressedTexture){Ee.compressedTexSubImage2D(Ee.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data)}else{Ee.texSubImage2D(Ee.TEXTURE_2D,r,e.x,e.y,o,s,t.image)}}if(0===r&&a.generateMipmaps)Ee.generateMipmap(Ee.TEXTURE_2D);Me.unbindTexture()};this.copyTextureToTexture3D=function(e,t,a,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0;if(K.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}var n=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=je.convert(r.format),d=je.convert(r.type),u;if(r.isDataTexture3D){we.setTexture3D(r,0);u=Ee.TEXTURE_3D}else if(r.isDataTexture2DArray){we.setTexture2DArray(r,0);u=Ee.TEXTURE_2D_ARRAY}else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Ee.pixelStorei(Ee.UNPACK_FLIP_Y_WEBGL,r.flipY);Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha);Ee.pixelStorei(Ee.UNPACK_ALIGNMENT,r.unpackAlignment);var p=Ee.getParameter(Ee.UNPACK_ROW_LENGTH),c=Ee.getParameter(Ee.UNPACK_IMAGE_HEIGHT),m=Ee.getParameter(Ee.UNPACK_SKIP_PIXELS),g=Ee.getParameter(Ee.UNPACK_SKIP_ROWS),f=Ee.getParameter(Ee.UNPACK_SKIP_IMAGES),h=a.isCompressedTexture?a.mipmaps[0]:a.image;Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,h.width);Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,h.height);Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,e.min.x);Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,e.min.y);Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,e.min.z);if(a.isDataTexture||a.isDataTexture3D){Ee.texSubImage3D(u,i,t.x,t.y,t.z,n,o,s,l,d,h.data)}else{if(a.isCompressedTexture){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture.");Ee.compressedTexSubImage3D(u,i,t.x,t.y,t.z,n,o,s,l,h.data)}else{Ee.texSubImage3D(u,i,t.x,t.y,t.z,n,o,s,l,d,h)}}Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,p);Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,c);Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,m);Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,g);Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,f);if(0===i&&r.generateMipmaps)Ee.generateMipmap(u);Me.unbindTexture()};this.initTexture=function(e){we.setTexture2D(e,0);Me.unbindTexture()};this.resetState=function(){$=0;ee=0;te=null;Me.reset();Xe.reset()};if("undefined"!=typeof __THREE_DEVTOOLS__){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}Lt.prototype.isWebGLRenderer=!0;var Ed=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck(this,t);return a.apply(this,arguments)}return t}(Lt);Ed.prototype.isWebGL1Renderer=!0;var Sd=function(){function e(t){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:25e-5;_classCallCheck(this,e);this.name="";this.color=new ao(t);this.density=a}_createClass(e,[{key:"clone",value:function clone(){return new e(this.color,this.density)}},{key:"toJSON",value:function toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}]);return e}();Sd.prototype.isFogExp2=!0;var Td=function(){function e(t){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1e3;_classCallCheck(this,e);this.name="";this.color=new ao(t);this.near=a;this.far=r}_createClass(e,[{key:"clone",value:function clone(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]);return e}();Td.prototype.isFog=!0;var Md=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck(this,t);e=a.call(this);e.type="Scene";e.background=null;e.environment=null;e.fog=null;e.overrideMaterial=null;e.autoUpdate=!0;if("undefined"!=typeof __THREE_DEVTOOLS__){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:_assertThisInitialized(e)}))}return e}_createClass(t,[{key:"copy",value:function copy(e,a){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,a);if(null!==e.background)this.background=e.background.clone();if(null!==e.environment)this.environment=e.environment.clone();if(null!==e.fog)this.fog=e.fog.clone();if(null!==e.overrideMaterial)this.overrideMaterial=e.overrideMaterial.clone();this.autoUpdate=e.autoUpdate;this.matrixAutoUpdate=e.matrixAutoUpdate;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);if(null!==this.fog)a.object.fog=this.fog.toJSON();return a}}]);return t}(gs);Md.prototype.isScene=!0;var Ad=function(){function e(a,r){_classCallCheck(this,e);this.array=a;this.stride=r;this.count=a!==void 0?a.length/r:0;this.usage=kn;this.updateRange={offset:0,count:-1};this.version=0;this.uuid=t()}_createClass(e,[{key:"onUploadCallback",value:function onUploadCallback(){}},{key:"setUsage",value:function setUsage(e){this.usage=e;return this}},{key:"copy",value:function copy(e){this.array=new e.array.constructor(e.array);this.count=e.count;this.stride=e.stride;this.usage=e.usage;return this}},{key:"copyAt",value:function copyAt(e,t,a){e*=this.stride;a*=t.stride;for(var r=0,i=this.stride;r<i;r++){this.array[e+r]=t.array[a+r]}return this}},{key:"set",value:function set(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;this.array.set(e,t);return this}},{key:"clone",value:function clone(e){if(e.arrayBuffers===void 0){e.arrayBuffers={}}if(this.array.buffer._uuid===void 0){this.array.buffer._uuid=t()}if(e.arrayBuffers[this.array.buffer._uuid]===void 0){e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer}var a=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(a,this.stride);r.setUsage(this.usage);return r}},{key:"onUpload",value:function onUpload(e){this.onUploadCallback=e;return this}},{key:"toJSON",value:function toJSON(e){if(e.arrayBuffers===void 0){e.arrayBuffers={}}if(this.array.buffer._uuid===void 0){this.array.buffer._uuid=t()}if(e.arrayBuffers[this.array.buffer._uuid]===void 0){e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))}return{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return e}();Ad.prototype.isInterleavedBuffer=!0;var Rd=new mo,wd=function(){function e(t,a,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:!1;_classCallCheck(this,e);this.name="";this.data=t;this.itemSize=a;this.offset=r;this.normalized=!0===i}_createClass(e,[{key:"applyMatrix4",value:function applyMatrix4(e){for(var t=0,a=this.data.count;t<a;t++){Rd.x=this.getX(t);Rd.y=this.getY(t);Rd.z=this.getZ(t);Rd.applyMatrix4(e);this.setXYZ(t,Rd.x,Rd.y,Rd.z)}return this}},{key:"applyNormalMatrix",value:function applyNormalMatrix(e){for(var t=0,a=this.count;t<a;t++){Rd.x=this.getX(t);Rd.y=this.getY(t);Rd.z=this.getZ(t);Rd.applyNormalMatrix(e);this.setXYZ(t,Rd.x,Rd.y,Rd.z)}return this}},{key:"transformDirection",value:function transformDirection(e){for(var t=0,a=this.count;t<a;t++){Rd.x=this.getX(t);Rd.y=this.getY(t);Rd.z=this.getZ(t);Rd.transformDirection(e);this.setXYZ(t,Rd.x,Rd.y,Rd.z)}return this}},{key:"setX",value:function setX(e,t){this.data.array[e*this.data.stride+this.offset]=t;return this}},{key:"setY",value:function setY(e,t){this.data.array[e*this.data.stride+this.offset+1]=t;return this}},{key:"setZ",value:function setZ(e,t){this.data.array[e*this.data.stride+this.offset+2]=t;return this}},{key:"setW",value:function setW(e,t){this.data.array[e*this.data.stride+this.offset+3]=t;return this}},{key:"getX",value:function getX(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function getY(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function getW(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function setXY(e,t,a){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=a;return this}},{key:"setXYZ",value:function setXYZ(e,t,a,r){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=a;this.data.array[e+2]=r;return this}},{key:"setXYZW",value:function setXYZW(e,t,a,r,i){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=a;this.data.array[e+2]=r;this.data.array[e+3]=i;return this}},{key:"clone",value:function clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var a=[],r=0,i;r<this.count;r++){i=r*this.data.stride+this.offset;for(var n=0;n<this.itemSize;n++){a.push(this.data.array[i+n])}}return new ks(new this.array.constructor(a),this.itemSize,this.normalized)}else{if(t.interleavedBuffers===void 0){t.interleavedBuffers={}}if(t.interleavedBuffers[this.data.uuid]===void 0){t.interleavedBuffers[this.data.uuid]=this.data.clone(t)}return new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}}},{key:"toJSON",value:function toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],a=0,r;a<this.count;a++){r=a*this.data.stride+this.offset;for(var i=0;i<this.itemSize;i++){t.push(this.data.array[r+i])}}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else{if(e.interleavedBuffers===void 0){e.interleavedBuffers={}}if(e.interleavedBuffers[this.data.uuid]===void 0){e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)}return{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}},{key:"count",get:function get(){return this.data.count}},{key:"array",get:function get(){return this.data.array}},{key:"needsUpdate",set:function set(e){this.data.needsUpdate=e}}]);return e}();wd.prototype.isInterleavedBufferAttribute=!0;var Ld=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="SpriteMaterial";r.color=new ao(16777215);r.map=null;r.alphaMap=null;r.rotation=0;r.sizeAttenuation=!0;r.transparent=!0;r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.alphaMap=e.alphaMap;this.rotation=e.rotation;this.sizeAttenuation=e.sizeAttenuation;return this}}]);return t}(Rs);Ld.prototype.isSpriteMaterial=!0;var Cd,kd=new mo,Pd=new mo,Id=new mo,Dd=new Jn,Nd=new Jn,Ud=new Vo,Fd=new mo,Bd=new mo,Od=new mo,zd=new Jn,Hd=new Jn,Gd=new Jn,Vd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="Sprite";if(Cd===void 0){Cd=new Zs;var i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Ad(i,5);Cd.setIndex([0,1,2,0,2,3]);Cd.setAttribute("position",new wd(n,3,0,!1));Cd.setAttribute("uv",new wd(n,2,3,!1))}r.geometry=Cd;r.material=e!==void 0?e:new Ld;r.center=new Jn(.5,.5);return r}_createClass(t,[{key:"raycast",value:function raycast(e,t){if(null===e.camera){console.error("THREE.Sprite: \"Raycaster.camera\" needs to be set in order to raycast against sprites.")}Pd.setFromMatrixScale(this.matrixWorld);Ud.copy(e.camera.matrixWorld);this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld);Id.setFromMatrixPosition(this.modelViewMatrix);if(e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation){Pd.multiplyScalar(-Id.z)}var a=this.material.rotation,r,i;if(0!==a){i=Math.cos(a);r=Math.sin(a)}var n=this.center;Ct(Fd.set(-.5,-.5,0),Id,n,Pd,r,i);Ct(Bd.set(.5,-.5,0),Id,n,Pd,r,i);Ct(Od.set(.5,.5,0),Id,n,Pd,r,i);zd.set(0,0);Hd.set(1,0);Gd.set(1,1);var o=e.ray.intersectTriangle(Fd,Bd,Od,!1,kd);if(null===o){Ct(Bd.set(-.5,.5,0),Id,n,Pd,r,i);Hd.set(0,1);o=e.ray.intersectTriangle(Fd,Od,Bd,!1,kd);if(null===o){return}}var s=e.ray.origin.distanceTo(kd);if(s<e.near||s>e.far)return;t.push({distance:s,point:kd.clone(),uv:Ms.getUV(kd,Fd,Bd,Od,zd,Hd,Gd,new Jn),face:null,object:this})}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);if(e.center!==void 0)this.center.copy(e.center);this.material=e.material;return this}}]);return t}(gs);Vd.prototype.isSprite=!0;function Ct(e,t,a,r,i,n){Dd.subVectors(e,a).addScalar(.5).multiply(r);if(i!==void 0){Nd.x=n*Dd.x-i*Dd.y;Nd.y=i*Dd.x+n*Dd.y}else{Nd.copy(Dd)}e.copy(t);e.x+=Nd.x;e.y+=Nd.y;e.applyMatrix4(Ud)}var Wd=new mo,jd=new mo,Xd=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck(this,t);e=a.call(this);e._currentLevel=0;e.type="LOD";Object.defineProperties(_assertThisInitialized(e),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}});e.autoUpdate=!0;return e}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,!1);for(var a=e.levels,r=0,i=a.length,n;r<i;r++){n=a[r];this.addLevel(n.object.clone(),n.distance)}this.autoUpdate=e.autoUpdate;return this}},{key:"addLevel",value:function addLevel(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;t=Math.abs(t);var a=this.levels,r;for(r=0;r<a.length;r++){if(t<a[r].distance){break}}a.splice(r,0,{distance:t,object:e});this.add(e);return this}},{key:"getCurrentLevel",value:function getCurrentLevel(){return this._currentLevel}},{key:"getObjectForDistance",value:function getObjectForDistance(e){var t=this.levels;if(0<t.length){var a,r;for(a=1,r=t.length;a<r;a++){if(e<t[a].distance){break}}return t[a-1].object}return null}},{key:"raycast",value:function raycast(e,t){var a=this.levels;if(0<a.length){Wd.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(Wd);this.getObjectForDistance(r).raycast(e,t)}}},{key:"update",value:function update(e){var t=this.levels;if(1<t.length){Wd.setFromMatrixPosition(e.matrixWorld);jd.setFromMatrixPosition(this.matrixWorld);var a=Wd.distanceTo(jd)/e.zoom;t[0].object.visible=!0;var r,i;for(r=1,i=t.length;r<i;r++){if(a>=t[r].distance){t[r-1].object.visible=!1;t[r].object.visible=!0}else{break}}this._currentLevel=r-1;for(;r<i;r++){t[r].object.visible=!1}}}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);if(!1===this.autoUpdate)a.object.autoUpdate=!1;a.object.levels=[];for(var r=this.levels,i=0,n=r.length,o;i<n;i++){o=r[i];a.object.levels.push({object:o.object.uuid,distance:o.distance})}return a}}]);return t}(gs),qd=new mo,Yd=new so,Zd=new so,Jd=new mo,Kd=new Vo,Qd=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck(this,t);i=a.call(this,e,r);i.type="SkinnedMesh";i.bindMode="attached";i.bindMatrix=new Vo;i.bindMatrixInverse=new Vo;return i}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.bindMode=e.bindMode;this.bindMatrix.copy(e.bindMatrix);this.bindMatrixInverse.copy(e.bindMatrixInverse);this.skeleton=e.skeleton;return this}},{key:"bind",value:function bind(e,t){this.skeleton=e;if(t===void 0){this.updateMatrixWorld(!0);this.skeleton.calculateInverses();t=this.matrixWorld}this.bindMatrix.copy(t);this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function pose(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function normalizeSkinWeights(){for(var e=new so,t=this.geometry.attributes.skinWeight,a=0,r=t.count;a<r;a++){e.x=t.getX(a);e.y=t.getY(a);e.z=t.getZ(a);e.w=t.getW(a);var i=1/e.manhattanLength();if(i!=1/0){e.multiplyScalar(i)}else{e.set(1,0,0,0)}t.setXYZW(a,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e);if("attached"===this.bindMode){this.bindMatrixInverse.copy(this.matrixWorld).invert()}else if("detached"===this.bindMode){this.bindMatrixInverse.copy(this.bindMatrix).invert()}else{console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}}},{key:"boneTransform",value:function boneTransform(e,t){var a=this.skeleton,r=this.geometry;Yd.fromBufferAttribute(r.attributes.skinIndex,e);Zd.fromBufferAttribute(r.attributes.skinWeight,e);qd.copy(t).applyMatrix4(this.bindMatrix);t.set(0,0,0);for(var i=0,n;4>i;i++){n=Zd.getComponent(i);if(0!==n){var o=Yd.getComponent(i);Kd.multiplyMatrices(a.bones[o].matrixWorld,a.boneInverses[o]);t.addScaledVector(Jd.copy(qd).applyMatrix4(Kd),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}]);return t}(ml);Qd.prototype.isSkinnedMesh=!0;var $d=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck(this,t);e=a.call(this);e.type="Bone";return e}return t}(gs);$d.prototype.isBone=!0;var eu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length?arguments[3]:void 0,s=4<arguments.length?arguments[4]:void 0,l=5<arguments.length?arguments[5]:void 0,d=6<arguments.length?arguments[6]:void 0,u=7<arguments.length?arguments[7]:void 0,p=8<arguments.length&&arguments[8]!==void 0?arguments[8]:Vr,c=9<arguments.length&&arguments[9]!==void 0?arguments[9]:Vr,m=10<arguments.length?arguments[10]:void 0,g=11<arguments.length?arguments[11]:void 0;_classCallCheck(this,t);e=a.call(this,null,l,d,u,p,c,o,s,m,g);e.image={data:r,width:i,height:n};e.magFilter=p;e.minFilter=c;e.generateMipmaps=!1;e.flipY=!1;e.unpackAlignment=1;return e}return t}(oo);eu.prototype.isDataTexture=!0;var tu=new Vo,au=new Vo,ru=function(){function e(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];_classCallCheck(this,e);this.uuid=t();this.bones=a.slice(0);this.boneInverses=r;this.boneMatrices=null;this.boneTexture=null;this.boneTextureSize=0;this.frame=-1;this.init()}_createClass(e,[{key:"init",value:function init(){var e=this.bones,t=this.boneInverses;this.boneMatrices=new Float32Array(16*e.length);if(0===t.length){this.calculateInverses()}else{if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones.");this.boneInverses=[];for(var a=0,r=this.bones.length;a<r;a++){this.boneInverses.push(new Vo)}}}}},{key:"calculateInverses",value:function calculateInverses(){this.boneInverses.length=0;for(var e=0,t=this.bones.length,a;e<t;e++){a=new Vo;if(this.bones[e]){a.copy(this.bones[e].matrixWorld).invert()}this.boneInverses.push(a)}}},{key:"pose",value:function pose(){for(var e=0,t=this.bones.length,a;e<t;e++){a=this.bones[e];if(a){a.matrixWorld.copy(this.boneInverses[e]).invert()}}for(var r=0,i=this.bones.length,n;r<i;r++){n=this.bones[r];if(n){if(n.parent&&n.parent.isBone){n.matrix.copy(n.parent.matrixWorld).invert();n.matrix.multiply(n.matrixWorld)}else{n.matrix.copy(n.matrixWorld)}n.matrix.decompose(n.position,n.quaternion,n.scale)}}}},{key:"update",value:function update(){for(var e=this.bones,t=this.boneInverses,a=this.boneMatrices,r=this.boneTexture,i=0,n=e.length,o;i<n;i++){o=e[i]?e[i].matrixWorld:au;tu.multiplyMatrices(o,t[i]);tu.toArray(a,16*i)}if(null!==r){r.needsUpdate=!0}}},{key:"clone",value:function clone(){return new e(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function computeBoneTexture(){var e=Math.sqrt(4*this.bones.length);e=l(e);e=Math.max(e,4);var t=new Float32Array(4*(e*e));t.set(this.boneMatrices);var a=new eu(t,e,e,ci,ni);a.needsUpdate=!0;this.boneMatrices=t;this.boneTexture=a;this.boneTextureSize=e;return this}},{key:"getBoneByName",value:function getBoneByName(e){for(var t=0,a=this.bones.length,r;t<a;t++){r=this.bones[t];if(r.name===e){return r}}}},{key:"dispose",value:function dispose(){if(null!==this.boneTexture){this.boneTexture.dispose();this.boneTexture=null}}},{key:"fromJSON",value:function fromJSON(e,t){this.uuid=e.uuid;for(var i=0,n=e.bones.length;i<n;i++){var a=e.bones[i],r=t[a];if(r===void 0){console.warn("THREE.Skeleton: No bone found with UUID:",a);r=new $d}this.bones.push(r);this.boneInverses.push(new Vo().fromArray(e.boneInverses[i]))}this.init();return this}},{key:"toJSON",value:function toJSON(){for(var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[],uuid:this.uuid},t=this.bones,a=this.boneInverses,r=0,i=t.length,n;r<i;r++){n=t[r];e.bones.push(n.uuid);var o=a[r];e.boneInverses.push(o.toArray())}return e}}]);return e}(),iu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck(this,t);if("number"==typeof i){o=i;i=!1;console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")}n=a.call(this,e,r,i);n.meshPerAttribute=o;return n}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.meshPerAttribute=this.meshPerAttribute;e.isInstancedBufferAttribute=!0;return e}}]);return t}(ks);iu.prototype.isInstancedBufferAttribute=!0;var nu=new Vo,ou=new Vo,su=[],lu=new ml,du=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck(this,t);n=a.call(this,e,r);n.instanceMatrix=new iu(new Float32Array(16*i),16);n.instanceColor=null;n.count=i;n.frustumCulled=!1;return n}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.instanceMatrix.copy(e.instanceMatrix);if(null!==e.instanceColor)this.instanceColor=e.instanceColor.clone();this.count=e.count;return this}},{key:"getColorAt",value:function getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function raycast(e,t){var a=this.matrixWorld,r=this.count;lu.geometry=this.geometry;lu.material=this.material;if(lu.material===void 0)return;for(var i=0;i<r;i++){this.getMatrixAt(i,nu);ou.multiplyMatrices(a,nu);lu.matrixWorld=ou;lu.raycast(e,su);for(var n=0,o=su.length,s;n<o;n++){s=su[n];s.instanceId=i;s.object=this;t.push(s)}su.length=0}}},{key:"setColorAt",value:function setColorAt(e,t){if(null===this.instanceColor){this.instanceColor=new iu(new Float32Array(3*this.instanceMatrix.count),3)}t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function updateMorphTargets(){}},{key:"dispose",value:function dispose(){this.dispatchEvent({type:"dispose"})}}]);return t}(ml);du.prototype.isInstancedMesh=!0;var uu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="LineBasicMaterial";r.color=new ao(16777215);r.linewidth=1;r.linecap="round";r.linejoin="round";r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.linewidth=e.linewidth;this.linecap=e.linecap;this.linejoin=e.linejoin;return this}}]);return t}(Rs);uu.prototype.isLineBasicMaterial=!0;var pu=new mo,cu=new mo,mu=new Vo,gu=new Go,fu=new Do,hu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Zs,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new uu;_classCallCheck(this,t);e=a.call(this);e.type="Line";e.geometry=r;e.material=i;e.updateMorphTargets();return e}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.material=e.material;this.geometry=e.geometry;return this}},{key:"computeLineDistances",value:function computeLineDistances(){var e=this.geometry;if(e.isBufferGeometry){if(null===e.index){for(var t=e.attributes.position,a=[0],r=1,i=t.count;r<i;r++){pu.fromBufferAttribute(t,r-1);cu.fromBufferAttribute(t,r);a[r]=a[r-1];a[r]+=pu.distanceTo(cu)}e.setAttribute("lineDistance",new zs(a,1))}else{console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}}else if(e.isGeometry){console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}return this}},{key:"raycast",value:function raycast(e,t){var r=this.geometry,i=this.matrixWorld,n=e.params.Line.threshold,o=r.drawRange;if(null===r.boundingSphere)r.computeBoundingSphere();fu.copy(r.boundingSphere);fu.applyMatrix4(i);fu.radius+=n;if(!1===e.ray.intersectsSphere(fu))return;mu.copy(i).invert();gu.copy(e.ray).applyMatrix4(mu);var s=n/((this.scale.x+this.scale.y+this.scale.z)/3),l=s*s,d=new mo,u=new mo,p=new mo,c=new mo,m=this.isLineSegments?2:1;if(r.isBufferGeometry){var g=r.index,f=r.attributes,h=f.position;if(null!==g){for(var y=Math.max(0,o.start),v=Math.min(g.count,o.start+o.count),_=y;_<v-1;_+=m){var x=g.getX(_),a=g.getX(_+1);d.fromBufferAttribute(h,x);u.fromBufferAttribute(h,a);var T=gu.distanceSqToSegment(d,u,c,p);if(T>l)continue;c.applyMatrix4(this.matrixWorld);var M=e.ray.origin.distanceTo(c);if(M<e.near||M>e.far)continue;t.push({distance:M,point:p.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{for(var b=Math.max(0,o.start),E=Math.min(h.count,o.start+o.count),S=b;S<E-1;S+=m){d.fromBufferAttribute(h,S);u.fromBufferAttribute(h,S+1);var A=gu.distanceSqToSegment(d,u,c,p);if(A>l)continue;c.applyMatrix4(this.matrixWorld);var R=e.ray.origin.distanceTo(c);if(R<e.near||R>e.far)continue;t.push({distance:R,point:p.clone().applyMatrix4(this.matrixWorld),index:S,face:null,faceIndex:null,object:this})}}}else if(r.isGeometry){console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,a=Object.keys(t);if(0<a.length){var r=t[a[0]];if(r!==void 0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0,n=r.length,o;i<n;i++){o=r[i].name||i+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length){console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}}]);return t}(gs);hu.prototype.isLine=!0;var yu=new mo,vu=new mo,_u=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck(this,t);i=a.call(this,e,r);i.type="LineSegments";return i}_createClass(t,[{key:"computeLineDistances",value:function computeLineDistances(){var e=this.geometry;if(e.isBufferGeometry){if(null===e.index){for(var t=e.attributes.position,a=[],r=0,i=t.count;r<i;r+=2){yu.fromBufferAttribute(t,r);vu.fromBufferAttribute(t,r+1);a[r]=0==r?0:a[r-1];a[r+1]=a[r]+yu.distanceTo(vu)}e.setAttribute("lineDistance",new zs(a,1))}else{console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}}else if(e.isGeometry){console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}return this}}]);return t}(hu);_u.prototype.isLineSegments=!0;var xu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck(this,t);i=a.call(this,e,r);i.type="LineLoop";return i}return t}(hu);xu.prototype.isLineLoop=!0;var bu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="PointsMaterial";r.color=new ao(16777215);r.map=null;r.alphaMap=null;r.size=1;r.sizeAttenuation=!0;r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.alphaMap=e.alphaMap;this.size=e.size;this.sizeAttenuation=e.sizeAttenuation;return this}}]);return t}(Rs);bu.prototype.isPointsMaterial=!0;var Eu=new Vo,Su=new Go,Tu=new Do,Mu=new mo,Au=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Zs,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new bu;_classCallCheck(this,t);e=a.call(this);e.type="Points";e.geometry=r;e.material=i;e.updateMorphTargets();return e}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.material=e.material;this.geometry=e.geometry;return this}},{key:"raycast",value:function raycast(e,t){var r=this.geometry,i=this.matrixWorld,n=e.params.Points.threshold,o=r.drawRange;if(null===r.boundingSphere)r.computeBoundingSphere();Tu.copy(r.boundingSphere);Tu.applyMatrix4(i);Tu.radius+=n;if(!1===e.ray.intersectsSphere(Tu))return;Eu.copy(i).invert();Su.copy(e.ray).applyMatrix4(Eu);var s=n/((this.scale.x+this.scale.y+this.scale.z)/3),l=s*s;if(r.isBufferGeometry){var d=r.index,u=r.attributes,p=u.position;if(null!==d){for(var c=Math.max(0,o.start),m=Math.min(d.count,o.start+o.count),g=c,f;g<m;g++){f=d.getX(g);Mu.fromBufferAttribute(p,f);kt(Mu,f,l,i,e,t,this)}}else{for(var h=Math.max(0,o.start),y=Math.min(p.count,o.start+o.count),v=h;v<y;v++){Mu.fromBufferAttribute(p,v);kt(Mu,v,l,i,e,t,this)}}}else{console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,a=Object.keys(t);if(0<a.length){var r=t[a[0]];if(r!==void 0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0,n=r.length,o;i<n;i++){o=r[i].name||i+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length){console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}}]);return t}(gs);Au.prototype.isPoints=!0;function kt(e,t,a,r,i,n,o){var s=Su.distanceSqToPoint(e);if(s<a){var l=new mo;Su.closestPointToPoint(e,l);l.applyMatrix4(r);var d=i.ray.origin.distanceTo(l);if(d<i.near||d>i.far)return;n.push({distance:d,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}var Ru=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,u){var c;_classCallCheck(this,t);c=a.call(this,e,r,i,n,o,s,l,d,u);c.minFilter=s!==void 0?s:Yr;c.magFilter=o!==void 0?o:Yr;c.generateMipmaps=!1;var m=_assertThisInitialized(c);function p(){m.needsUpdate=!0;e.requestVideoFrameCallback(p)}if("requestVideoFrameCallback"in e){e.requestVideoFrameCallback(p)}return c}_createClass(t,[{key:"clone",value:function clone(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function update(){var e=this.image,t=("requestVideoFrameCallback"in e);if(!1===t&&e.readyState>=e.HAVE_CURRENT_DATA){this.needsUpdate=!0}}}]);return t}(oo);Ru.prototype.isVideoTexture=!0;var wu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck(this,t);n=a.call(this,{width:e,height:r});n.format=i;n.magFilter=Vr;n.minFilter=Vr;n.generateMipmaps=!1;n.needsUpdate=!0;return n}return t}(oo);wu.prototype.isFramebufferTexture=!0;var Lu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,u,p,c,m){var g;_classCallCheck(this,t);g=a.call(this,null,s,l,d,u,p,n,o,c,m);g.image={width:r,height:i};g.mipmaps=e;g.flipY=!1;g.generateMipmaps=!1;return g}return t}(oo);Lu.prototype.isCompressedTexture=!0;var Cu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s,l,d,u){var p;_classCallCheck(this,t);p=a.call(this,e,r,i,n,o,s,l,d,u);p.needsUpdate=!0;return p}return t}(oo);Cu.prototype.isCanvasTexture=!0;var ku=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:8,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:2*Math.PI;_classCallCheck(this,t);e=a.call(this);e.type="CircleGeometry";e.parameters={radius:r,segments:i,thetaStart:n,thetaLength:o};i=Math.max(3,i);var l=[],d=[],u=[],p=[],c=new mo,m=new Jn;d.push(0,0,0);u.push(0,0,1);p.push(.5,.5);for(var g=0,s=3,f;g<=i;g++,s+=3){f=n+g/i*o;"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}".x=r*Math.cos(f);"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}".y=r*Math.sin(f);d.push("void main() {\n\tgl_Position = vec4( position, 1.0 );\n}".x,"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}".y,"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}".z);u.push(0,0,1);m.x=(d[s]/r+1)/2;m.y=(d[s+1]/r+1)/2;p.push(m.x,m.y)}for(var h=1;h<=i;h++){l.push(h,h+1,0)}e.setIndex(l);e.setAttribute("position",new zs(d,3));e.setAttribute("normal",new zs(u,3));e.setAttribute("uv",new zs(p,2));return e}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.segments,e.thetaStart,e.thetaLength)}}]);return t}(Zs),Pu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var i,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:8,p=4<arguments.length&&arguments[4]!==void 0?arguments[4]:1,c=5<arguments.length&&arguments[5]!==void 0?arguments[5]:!1,m=6<arguments.length&&arguments[6]!==void 0?arguments[6]:0,g=7<arguments.length&&arguments[7]!==void 0?arguments[7]:2*Math.PI;_classCallCheck(this,t);i=a.call(this);i.type="CylinderGeometry";i.parameters={radiusTop:n,radiusBottom:o,height:s,radialSegments:l,heightSegments:p,openEnded:c,thetaStart:m,thetaLength:g};var f=_assertThisInitialized(i);l=Math.floor(l);p=Math.floor(p);var h=[],y=[],_=[],b=[],E=0,S=[],T=s/2,M=0;e();if(!1===c){if(0<n)r(!0);if(0<o)r(!1)}i.setIndex(h);i.setAttribute("position",new zs(y,3));i.setAttribute("normal",new zs(_,3));i.setAttribute("uv",new zs(b,2));function e(){for(var e=new mo,t=new mo,r=0,i=0;i<=p;i++){for(var A=[],R=i/p,v=R*(o-n)+n,w=0;w<=l;w++){var L=w/l,u=L*g+m,C=Math.sin(u),k=Math.cos(u);t.x=v*C;t.y=-R*s+T;t.z=v*k;y.push(t.x,t.y,t.z);e.set(C,(o-n)/s,k).normalize();_.push(e.x,e.y,e.z);b.push(L,1-R);A.push(E++)}S.push(A)}for(var d=0;d<l;d++){for(var D=0;D<p;D++){var P=S[D][d],a=S[D+1][d],I=S[D+1][d+1],c=S[D][d+1];h.push(P,a,c);h.push(a,I,c);r+=6}}f.addGroup(M,r,0);M+=r}function r(e){for(var t=E,a=new Jn,r=new mo,i=0,s=!0===e?n:o,d=!0===e?1:-1,p=1;p<=l;p++){y.push(0,T*d,0);_.push(0,d,0);b.push(.5,.5);E++}for(var v=E,S=0;S<=l;S++){var A=S/l,u=A*g+m,R=Math.cos(u),w=Math.sin(u);r.x=s*w;r.y=T*d;r.z=s*R;y.push(r.x,r.y,r.z);_.push(0,d,0);a.x=.5*R+.5;a.y=.5*w*d+.5;b.push(a.x,a.y);E++}for(var C=0;C<l;C++){var L=t+C,c=v+C;if(!0===e){h.push(c,c+1,L)}else{h.push(c+1,c,L)}i+=3}f.addGroup(M,i,!0===e?1:2);M+=i}return i}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]);return t}(Zs),Iu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:8,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:!1,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:0,d=6<arguments.length&&arguments[6]!==void 0?arguments[6]:2*Math.PI;_classCallCheck(this,t);e=a.call(this,0,r,i,n,o,s,l,d);e.type="ConeGeometry";e.parameters={radius:r,height:i,radialSegments:n,heightSegments:o,openEnded:s,thetaStart:l,thetaLength:d};return e}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]);return t}(Pu),Du=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var u,p=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],m=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0;_classCallCheck(this,t);u=a.call(this);u.type="PolyhedronGeometry";u.parameters={vertices:p,indices:m,radius:g,detail:f};var h=[],y=[];(function(t){for(var r=new mo,a=new mo,i=new mo,o=0;o<m.length;o+=3){n(m[o+0],r);n(m[o+1],a);n(m[o+2],i);e(r,a,i,t)}})(f);(function(e){for(var t=new mo,a=0;a<h.length;a+=3){t.x=h[a+0];t.y=h[a+1];t.z=h[a+2];t.normalize().multiplyScalar(e);h[a+0]=t.x;h[a+1]=t.y;h[a+2]=t.z}})(g);(function(){for(var e=new mo,t=0;t<h.length;t+=3){e.x=h[t+0];e.y=h[t+1];e.z=h[t+2];var a=l(e)/2/Math.PI+.5,i=d(e)/Math.PI+.5;y.push(a,1-i)}o();r()})();u.setAttribute("position",new zs(h,3));u.setAttribute("normal",new zs(h.slice(),3));u.setAttribute("uv",new zs(y,2));if(0===f){u.computeVertexNormals()}else{u.normalizeNormals()}function e(e,t,a,r){for(var n=r+1,o=[],s=0;s<=n;s++){o[s]=[];for(var l=e.clone().lerp(a,s/n),d=t.clone().lerp(a,s/n),u=n-s,p=0;p<=u;p++){if(0==p&&s===n){o[s][p]=l}else{o[s][p]=l.clone().lerp(d,p/u)}}}for(var c=0;c<n;c++){for(var m=0,g;m<2*(n-c)-1;m++){g=Math.floor(m/2);if(0==m%2){i(o[c][g+1]);i(o[c+1][g]);i(o[c][g])}else{i(o[c][g+1]);i(o[c+1][g+1]);i(o[c+1][g])}}}}function r(){for(var n=0;n<y.length;n+=6){var e=y[n+0],t=y[n+2],a=y[n+4],r=Math.max(e,t,a),i=Math.min(e,t,a);if(.9<r&&.1>i){if(.2>e)y[n+0]+=1;if(.2>t)y[n+2]+=1;if(.2>a)y[n+4]+=1}}}function i(e){h.push(e.x,e.y,e.z)}function n(e,t){var a=3*e;t.x=p[a+0];t.y=p[a+1];t.z=p[a+2]}function o(){for(var e=new mo,t=new mo,a=new mo,r=new mo,i=new Jn,n=new Jn,o=new Jn,d=0,u=0;d<h.length;d+=9,u+=6){e.set(h[d+0],h[d+1],h[d+2]);t.set(h[d+3],h[d+4],h[d+5]);a.set(h[d+6],h[d+7],h[d+8]);i.set(y[u+0],y[u+1]);n.set(y[u+2],y[u+3]);o.set(y[u+4],y[u+5]);r.copy(e).add(t).add(a).divideScalar(3);var p=l(r);s(i,u+0,e,p);s(n,u+2,t,p);s(o,u+4,a,p)}}function s(e,t,a,r){if(0>r&&1===e.x){y[t]=e.x-1}if(0===a.x&&0===a.z){y[t]=r/2/Math.PI+.5}}function l(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}return u}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.vertices,e.indices,e.radius,e.details)}}]);return t}(Zs),Nu=function(e){_inherits(a,e);var i=_createSuper(a);function a(){var e,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck(this,a);var s=(1+Math.sqrt(5))/2,t=1/s;e=i.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-t,-s,0,-t,s,0,t,-s,0,t,s,-t,-s,0,-t,s,0,t,-s,0,t,s,0,-s,0,-t,s,0,-t,-s,0,t,s,0,t],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],n,o);e.type="DodecahedronGeometry";e.parameters={radius:n,detail:o};return e}_createClass(a,null,[{key:"fromJSON",value:function fromJSON(e){return new a(e.radius,e.detail)}}]);return a}(Du),Uu=new mo,Fu=new mo,Bu=new mo,Ou=new Ms,zu=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck(this,t);e=r.call(this);e.type="EdgesGeometry";e.parameters={geometry:i,thresholdAngle:n};if(null!==i){for(var o=Math.pow(10,4),s=Math.cos(qn*n),l=i.getIndex(),d=i.getAttribute("position"),u=l?l.count:d.count,p=[0,0,0],m=["a","b","c"],g=[,,,],f={},h=[],y=0;y<u;y+=3){if(l){p[0]=l.getX(y);p[1]=l.getX(y+1);p[2]=l.getX(y+2)}else{p[0]=y;p[1]=y+1;p[2]=y+2}var v=Ou.a,a=Ou.b,_=Ou.c;v.fromBufferAttribute(d,p[0]);a.fromBufferAttribute(d,p[1]);_.fromBufferAttribute(d,p[2]);Ou.getNormal(Bu);g[0]="".concat(Math.round(v.x*o),",").concat(Math.round(v.y*o),",").concat(Math.round(v.z*o));g[1]="".concat(Math.round(a.x*o),",").concat(Math.round(a.y*o),",").concat(Math.round(a.z*o));g[2]="".concat(Math.round(_.x*o),",").concat(Math.round(_.y*o),",").concat(Math.round(_.z*o));if(g[0]===g[1]||g[1]===g[2]||g[2]===g[0]){continue}for(var L=0;3>L;L++){var c=(L+1)%3,x=g[L],b=g[c],E=Ou[m[L]],S=Ou[m[c]],T="".concat(x,"_").concat(b),M="".concat(b,"_").concat(x);if(M in f&&f[M]){if(Bu.dot(f[M].normal)<=s){h.push(E.x,E.y,E.z);h.push(S.x,S.y,S.z)}f[M]=null}else if(!(T in f)){f[T]={index0:p[L],index1:p[c],normal:Bu.clone()}}}}for(var C in f){if(f[C]){var A=f[C],R=A.index0,w=A.index1;Uu.fromBufferAttribute(d,R);Fu.fromBufferAttribute(d,w);h.push(Uu.x,Uu.y,Uu.z);h.push(Fu.x,Fu.y,Fu.z)}}e.setAttribute("position",new zs(h,3))}return e}return t}(Zs),Hu=function(){function e(){_classCallCheck(this,e);this.type="Curve";this.arcLengthDivisions=200}_createClass(e,[{key:"getPoint",value:function getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.");return null}},{key:"getPointAt",value:function getPointAt(e,a){var r=this.getUtoTmapping(e);return this.getPoint(r,a)}},{key:"getPoints",value:function getPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:5,t=[],a=0;a<=e;a++){t.push(this.getPoint(a/e))}return t}},{key:"getSpacedPoints",value:function getSpacedPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:5,t=[],a=0;a<=e;a++){t.push(this.getPointAt(a/e))}return t}},{key:"getLength",value:function getLength(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function getLengths(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=!1;var t=[],a,r=this.getPoint(0),i=0;t.push(0);for(var n=1;n<=e;n++){a=this.getPoint(n/e);i+=a.distanceTo(r);t.push(i);r=a}this.cacheArcLengths=t;return t}},{key:"updateArcLengths",value:function updateArcLengths(){this.needsUpdate=!0;this.getLengths()}},{key:"getUtoTmapping",value:function getUtoTmapping(e,a){var r=this.getLengths(),n=0,o=r.length,s;if(a){s=a}else{s=e*r[o-1]}var l=0,d=o-1,u;while(l<=d){n=Math.floor(l+(d-l)/2);u=r[n]-s;if(0>u){l=n+1}else if(0<u){d=n-1}else{d=n;break}}n=d;if(r[n]===s){return n/(o-1)}var p=r[n],c=r[n+1],m=(s-p)/(c-p),g=(n+m)/(o-1);return g}},{key:"getTangent",value:function getTangent(e,t){var a=1e-4,r=e-a,i=e+a;if(0>r)r=0;if(1<i)i=1;var n=this.getPoint(r),o=this.getPoint(i),s=t||(n.isVector2?new Jn:new mo);s.copy(o).sub(n).normalize();return s}},{key:"getTangentAt",value:function getTangentAt(e,a){var r=this.getUtoTmapping(e);return this.getTangent(r,a)}},{key:"computeFrenetFrames",value:function computeFrenetFrames(e,t){for(var r=new mo,i=[],n=[],o=[],s=new mo,l=new Vo,d=0,p;d<=e;d++){p=d/e;i[d]=this.getTangentAt(p,new mo)}n[0]=new mo;o[0]=new mo;var c=Number.MAX_VALUE,m=Math.abs(i[0].x),g=Math.abs(i[0].y),f=Math.abs(i[0].z);if(m<=c){c=m;r.set(1,0,0)}if(g<=c){c=g;r.set(0,1,0)}if(f<=c){r.set(0,0,1)}s.crossVectors(i[0],r).normalize();n[0].crossVectors(i[0],s);o[0].crossVectors(i[0],n[0]);for(var h=1;h<=e;h++){n[h]=n[h-1].clone();o[h]=o[h-1].clone();s.crossVectors(i[h-1],i[h]);if(s.length()>Number.EPSILON){s.normalize();var y=Math.acos(a(i[h-1].dot(i[h]),-1,1));n[h].applyMatrix4(l.makeRotationAxis(s,y))}o[h].crossVectors(i[h],n[h])}if(!0===t){var v=Math.acos(a(n[0].dot(n[e]),-1,1));v/=e;if(0<i[0].dot(s.crossVectors(n[0],n[e]))){v=-v}for(var _=1;_<=e;_++){n[_].applyMatrix4(l.makeRotationAxis(i[_],v*_));o[_].crossVectors(i[_],n[_])}}return{tangents:i,normals:n,binormals:o}}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.arcLengthDivisions=e.arcLengthDivisions;return this}},{key:"toJSON",value:function toJSON(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"},arcLengthDivisions:this.arcLengthDivisions,type:this.type};return e}},{key:"fromJSON",value:function fromJSON(e){this.arcLengthDivisions=e.arcLengthDivisions;return this}}]);return e}(),Gu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:2*Math.PI,d=6<arguments.length&&arguments[6]!==void 0?arguments[6]:!1,u=7<arguments.length&&arguments[7]!==void 0?arguments[7]:0;_classCallCheck(this,t);e=a.call(this);e.type="EllipseCurve";e.aX=r;e.aY=i;e.xRadius=n;e.yRadius=o;e.aStartAngle=s;e.aEndAngle=l;e.aClockwise=d;e.aRotation=u;return e}_createClass(t,[{key:"getPoint",value:function getPoint(e,t){var a=t||new Jn,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,n=Math.abs(i)<Number.EPSILON;while(0>i){i+=r}while(i>r){i-=r}if(i<Number.EPSILON){if(n){i=0}else{i=r}}if(!0===this.aClockwise&&!n){if(i===r){i=-r}else{i=i-r}}var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var d=Math.cos(this.aRotation),u=Math.sin(this.aRotation),p=s-this.aX,c=l-this.aY;s=p*d-c*u+this.aX;l=p*u+c*d+this.aY}return a.set(s,l)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.aX=this.aX;e.aY=this.aY;e.xRadius=this.xRadius;e.yRadius=this.yRadius;e.aStartAngle=this.aStartAngle;e.aEndAngle=this.aEndAngle;e.aClockwise=this.aClockwise;e.aRotation=this.aRotation;return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this}}]);return t}(Hu);Gu.prototype.isEllipseCurve=!0;var Vu=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n,o,s){var l;_classCallCheck(this,t);l=a.call(this,e,r,i,i,n,o,s);l.type="ArcCurve";return l}return t}(Gu);Vu.prototype.isArcCurve=!0;function Pt(){var a=0,r=0,i=0,n=0;function e(e,t,o,s){a=e;r=o;i=-3*e+3*t-2*o-s;n=2*e-2*t+o+s}return{initCatmullRom:function initCatmullRom(t,a,r,i,n){e(a,r,n*(r-t),n*(i-a))},initNonuniformCatmullRom:function initNonuniformCatmullRom(t,a,r,i,n,o,s){var l=(a-t)/n-(r-t)/(n+o)+(r-a)/o,d=(r-a)/o-(i-a)/(o+s)+(i-r)/s;l*=o;d*=o;e(a,r,l,d)},calc:function calc(e){var t=e*e;return a+r*e+i*t+n*(t*e)}}}var Wu=new mo,ju=new Pt,Xu=new Pt,qu=new Pt,Yu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"centripetal",o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:.5;_classCallCheck(this,t);e=a.call(this);e.type="CatmullRomCurve3";e.points=r;e.closed=i;e.curveType=n;e.tension=o;return e}_createClass(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo,a=t,r=this.points,i=r.length,n=(i-(this.closed?0:1))*e,o=Math.floor(n),s=n-o;if(this.closed){o+=0<o?0:(Math.floor(Math.abs(o)/i)+1)*i}else if(0===s&&o===i-1){o=i-2;s=1}var l,d;if(this.closed||0<o){l=r[(o-1)%i]}else{Wu.subVectors(r[0],r[1]).add(r[0]);l=Wu}var u=r[o%i],p=r[(o+1)%i];if(this.closed||o+2<i){d=r[(o+2)%i]}else{Wu.subVectors(r[i-1],r[i-2]).add(r[i-1]);d=Wu}if("centripetal"===this.curveType||"chordal"===this.curveType){var c="chordal"===this.curveType?.5:.25,m=Math.pow(l.distanceToSquared(u),c),g=Math.pow(u.distanceToSquared(p),c),f=Math.pow(p.distanceToSquared(d),c);if(1e-4>g)g=1;if(1e-4>m)m=g;if(1e-4>f)f=g;ju.initNonuniformCatmullRom(l.x,u.x,p.x,d.x,m,g,f);Xu.initNonuniformCatmullRom(l.y,u.y,p.y,d.y,m,g,f);qu.initNonuniformCatmullRom(l.z,u.z,p.z,d.z,m,g,f)}else if("catmullrom"===this.curveType){ju.initCatmullRom(l.x,u.x,p.x,d.x,this.tension);Xu.initCatmullRom(l.y,u.y,p.y,d.y,this.tension);qu.initCatmullRom(l.z,u.z,p.z,d.z,this.tension)}a.set(ju.calc(s),Xu.calc(s),qu.calc(s));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(i.clone())}this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.points=[];for(var a=0,r=this.points.length,i;a<r;a++){i=this.points[a];e.points.push(i.toArray())}e.closed=this.closed;e.curveType=this.curveType;e.tension=this.tension;return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(new mo().fromArray(i))}this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this}}]);return t}(Hu);Yu.prototype.isCatmullRomCurve3=!0;function It(e,t,a,r,i){var n=.5*(r-t),o=.5*(i-a),s=e*e;return(2*a-2*r+n+o)*(e*s)+(-3*a+3*r-2*n-o)*s+n*e+a}function Dt(e,t){var a=1-e;return a*a*t}function Nt(e,t){return 2*(1-e)*e*t}function Ut(e,t){return e*e*t}function Ft(e,t,a,r){return Dt(e,t)+Nt(e,a)+Ut(e,r)}function Bt(e,t){var a=1-e;return a*a*a*t}function Ot(e,t){var a=1-e;return 3*a*a*e*t}function zt(e,t){return 3*(1-e)*e*e*t}function Ht(e,t){return e*e*e*t}function Gt(e,t,a,r,i){return Bt(e,t)+Ot(e,a)+zt(e,r)+Ht(e,i)}var Zu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Jn,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Jn,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new Jn,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:new Jn;_classCallCheck(this,t);e=a.call(this);e.type="CubicBezierCurve";e.v0=r;e.v1=i;e.v2=n;e.v3=o;return e}_createClass(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Jn,a=t,r=this.v0,i=this.v1,n=this.v2,o=this.v3;a.set(Gt(e,r.x,i.x,n.x,o.x),Gt(e,r.y,i.y,n.y,o.y));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();e.v3=this.v3.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);this.v3.fromArray(e.v3);return this}}]);return t}(Hu);Zu.prototype.isCubicBezierCurve=!0;var Ju=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new mo,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new mo,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:new mo;_classCallCheck(this,t);e=a.call(this);e.type="CubicBezierCurve3";e.v0=r;e.v1=i;e.v2=n;e.v3=o;return e}_createClass(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo,a=t,r=this.v0,i=this.v1,n=this.v2,o=this.v3;a.set(Gt(e,r.x,i.x,n.x,o.x),Gt(e,r.y,i.y,n.y,o.y),Gt(e,r.z,i.z,n.z,o.z));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();e.v3=this.v3.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);this.v3.fromArray(e.v3);return this}}]);return t}(Hu);Ju.prototype.isCubicBezierCurve3=!0;var Ku=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Jn,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Jn;_classCallCheck(this,t);e=a.call(this);e.type="LineCurve";e.v1=r;e.v2=i;return e}_createClass(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Jn,a=t;if(1===e){a.copy(this.v2)}else{a.copy(this.v2).sub(this.v1);a.multiplyScalar(e).add(this.v1)}return a}},{key:"getPointAt",value:function getPointAt(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function getTangent(e,t){var a=t||new Jn;a.copy(this.v2).sub(this.v1).normalize();return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(Hu);Ku.prototype.isLineCurve=!0;var Qu=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new mo,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo;_classCallCheck(this,t);e=a.call(this);e.type="LineCurve3";e.isLineCurve3=!0;e.v1=r;e.v2=i;return e}_createClass(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo,a=t;if(1===e){a.copy(this.v2)}else{a.copy(this.v2).sub(this.v1);a.multiplyScalar(e).add(this.v1)}return a}},{key:"getPointAt",value:function getPointAt(e,t){return this.getPoint(e,t)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(Hu),$u=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Jn,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Jn,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new Jn;_classCallCheck(this,t);e=a.call(this);e.type="QuadraticBezierCurve";e.v0=r;e.v1=i;e.v2=n;return e}_createClass(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Jn,a=t,r=this.v0,i=this.v1,n=this.v2;a.set(Ft(e,r.x,i.x,n.x),Ft(e,r.y,i.y,n.y));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(Hu);$u.prototype.isQuadraticBezierCurve=!0;var ep=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new mo,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:new mo;_classCallCheck(this,t);e=a.call(this);e.type="QuadraticBezierCurve3";e.v0=r;e.v1=i;e.v2=n;return e}_createClass(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo,a=t,r=this.v0,i=this.v1,n=this.v2;a.set(Ft(e,r.x,i.x,n.x),Ft(e,r.y,i.y,n.y),Ft(e,r.z,i.z,n.z));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this}}]);return t}(Hu);ep.prototype.isQuadraticBezierCurve3=!0;var tp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];_classCallCheck(this,t);e=a.call(this);e.type="SplineCurve";e.points=r;return e}_createClass(t,[{key:"getPoint",value:function getPoint(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Jn,a=t,r=this.points,i=(r.length-1)*e,n=Math.floor(i),o=i-n,s=r[0===n?n:n-1],l=r[n],d=r[n>r.length-2?r.length-1:n+1],u=r[n>r.length-3?r.length-1:n+2];a.set(It(o,s.x,l.x,d.x,u.x),It(o,s.y,l.y,d.y,u.y));return a}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(i.clone())}return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.points=[];for(var a=0,r=this.points.length,i;a<r;a++){i=this.points[a];e.points.push(i.toArray())}return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.points=[];for(var a=0,r=e.points.length,i;a<r;a++){i=e.points[a];this.points.push(new Jn().fromArray(i))}return this}}]);return t}(Hu);tp.prototype.isSplineCurve=!0;var ap=Object.freeze({__proto__:null,ArcCurve:Vu,CatmullRomCurve3:Yu,CubicBezierCurve:Zu,CubicBezierCurve3:Ju,EllipseCurve:Gu,LineCurve:Ku,LineCurve3:Qu,QuadraticBezierCurve:$u,QuadraticBezierCurve3:ep,SplineCurve:tp}),rp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck(this,t);e=a.call(this);e.type="CurvePath";e.curves=[];e.autoClose=!1;return e}_createClass(t,[{key:"add",value:function add(e){this.curves.push(e)}},{key:"closePath",value:function closePath(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new Ku(t,e))}}},{key:"getPoint",value:function getPoint(e,t){var a=e*this.getLength(),r=this.getCurveLengths(),n=0;while(n<r.length){if(r[n]>=a){var o=r[n]-a,s=this.curves[n],l=s.getLength(),d=0===l?0:1-o/l;return s.getPointAt(d,t)}n++}return null}},{key:"getLength",value:function getLength(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function updateArcLengths(){this.needsUpdate=!0;this.cacheLengths=null;this.getCurveLengths()}},{key:"getCurveLengths",value:function getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length){return this.cacheLengths}for(var e=[],t=0,a=0,r=this.curves.length;a<r;a++){t+=this.curves[a].getLength();e.push(t)}this.cacheLengths=e;return e}},{key:"getSpacedPoints",value:function getSpacedPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:40,t=[],a=0;a<=e;a++){t.push(this.getPoint(a/e))}if(this.autoClose){t.push(t[0])}return t}},{key:"getPoints",value:function getPoints(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:12,t=[],a,r=0,i=this.curves;r<i.length;r++){for(var n=i[r],o=n&&n.isEllipseCurve?2*e:n&&(n.isLineCurve||n.isLineCurve3)?1:n&&n.isSplineCurve?e*n.points.length:e,s=n.getPoints(o),l=0,d;l<s.length;l++){d=s[l];if(a&&a.equals(d))continue;t.push(d);a=d}}if(this.autoClose&&1<t.length&&!t[t.length-1].equals(t[0])){t.push(t[0])}return t}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.curves=[];for(var a=0,r=e.curves.length,i;a<r;a++){i=e.curves[a];this.curves.push(i.clone())}this.autoClose=e.autoClose;return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose;e.curves=[];for(var a=0,r=this.curves.length,i;a<r;a++){i=this.curves[a];e.curves.push(i.toJSON())}return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.autoClose=e.autoClose;this.curves=[];for(var a=0,r=e.curves.length,i;a<r;a++){i=e.curves[a];this.curves.push(new ap[i.type]().fromJSON(i))}return this}}]);return t}(Hu),ip=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="Path";r.currentPoint=new Jn;if(e){r.setFromPoints(e)}return r}_createClass(t,[{key:"setFromPoints",value:function setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(var t=1,a=e.length;t<a;t++){this.lineTo(e[t].x,e[t].y)}return this}},{key:"moveTo",value:function moveTo(e,t){this.currentPoint.set(e,t);return this}},{key:"lineTo",value:function lineTo(e,t){var a=new Ku(this.currentPoint.clone(),new Jn(e,t));this.curves.push(a);this.currentPoint.set(e,t);return this}},{key:"quadraticCurveTo",value:function quadraticCurveTo(e,t,a,r){var i=new $u(this.currentPoint.clone(),new Jn(e,t),new Jn(a,r));this.curves.push(i);this.currentPoint.set(a,r);return this}},{key:"bezierCurveTo",value:function bezierCurveTo(e,t,a,r,i,n){var o=new Zu(this.currentPoint.clone(),new Jn(e,t),new Jn(a,r),new Jn(i,n));this.curves.push(o);this.currentPoint.set(i,n);return this}},{key:"splineThru",value:function splineThru(e){var t=[this.currentPoint.clone()].concat(e),a=new tp(t);this.curves.push(a);this.currentPoint.copy(e[e.length-1]);return this}},{key:"arc",value:function arc(e,t,a,r,i,n){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,a,r,i,n);return this}},{key:"absarc",value:function absarc(e,t,a,r,i,n){this.absellipse(e,t,a,a,r,i,n);return this}},{key:"ellipse",value:function ellipse(e,t,a,r,i,n,o,s){var l=this.currentPoint.x,d=this.currentPoint.y;this.absellipse(e+l,t+d,a,r,i,n,o,s);return this}},{key:"absellipse",value:function absellipse(e,t,a,r,i,n,o,s){var l=new Gu(e,t,a,r,i,n,o,s);if(0<this.curves.length){var u=l.getPoint(0);if(!u.equals(this.currentPoint)){this.lineTo(u.x,u.y)}}this.curves.push(l);var d=l.getPoint(1);this.currentPoint.copy(d);return this}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.currentPoint.copy(e.currentPoint);return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.currentPoint=this.currentPoint.toArray();return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(t.prototype),"fromJSON",this).call(this,e);this.currentPoint.fromArray(e.currentPoint);return this}}]);return t}(rp),np=function(e){_inherits(a,e);var r=_createSuper(a);function a(e){var i;_classCallCheck(this,a);i=r.call(this,e);i.uuid=t();i.type="Shape";i.holes=[];return i}_createClass(a,[{key:"getPointsHoles",value:function getPointsHoles(e){for(var t=[],a=0,r=this.holes.length;a<r;a++){t[a]=this.holes[a].getPoints(e)}return t}},{key:"extractPoints",value:function extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(a.prototype),"copy",this).call(this,e);this.holes=[];for(var t=0,r=e.holes.length,i;t<r;t++){i=e.holes[t];this.holes.push(i.clone())}return this}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(a.prototype),"toJSON",this).call(this);e.uuid=this.uuid;e.holes=[];for(var t=0,r=this.holes.length,i;t<r;t++){i=this.holes[t];e.holes.push(i.toJSON())}return e}},{key:"fromJSON",value:function fromJSON(e){_get(_getPrototypeOf(a.prototype),"fromJSON",this).call(this,e);this.uuid=e.uuid;this.holes=[];for(var t=0,r=e.holes.length,i;t<r;t++){i=e.holes[t];this.holes.push(new ip().fromJSON(i))}return this}}]);return a}(ip),op={triangulate:function triangulate(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:2,r=t&&t.length,i=r?t[0]*a:e.length,n=Vt(e,0,i,a,!0),o=[];if(!n||n.next===n.prev)return o;var s,l,d,u,p,c,m;if(r)n=Jt(e,t,n,a);if(e.length>80*a){s=d=e[0];l=u=e[1];for(var g=a;g<i;g+=a){p=e[g];c=e[g+1];if(p<s)s=p;if(c<l)l=c;if(p>d)d=p;if(c>u)u=c}m=Math.max(d-s,u-l);m=0!==m?1/m:0}jt(n,o,a,s,l,m);return o}};function Vt(e,t,a,r,n){var o,s;if(n===0<_a(e,t,a,r)){for(o=t;o<a;o+=r){s=ha(o,e[o],e[o+1],s)}}else{for(o=a-r;o>=t;o-=r){s=ha(o,e[o],e[o+1],s)}}if(s&&la(s,s.next)){ya(s);s=s.next}return s}function Wt(e,t){if(!e)return e;if(!t)t=e;var a=e,r;do{r=!1;if(!a.steiner&&(la(a,a.next)||0===sa(a.prev,a,a.next))){ya(a);a=t=a.prev;if(a===a.next)break;r=!0}else{a=a.next}}while(r||a!==t);return t}function jt(e,t,a,r,i,n,o){if(!e)return;if(!o&&n)ta(e,r,i,n);var s=e,l,d;while(e.prev!==e.next){l=e.prev;d=e.next;if(n?qt(e,r,i,n):Xt(e)){t.push(l.i/a);t.push(e.i/a);t.push(d.i/a);ya(e);e=d.next;s=d.next;continue}e=d;if(e===s){if(!o){jt(Wt(e),t,a,r,i,n,1)}else if(1===o){e=Yt(Wt(e),t,a);jt(e,t,a,r,i,n,2)}else if(2===o){Zt(e,t,a,r,i,n)}break}}}function Xt(e){var t=e.prev,a=e,r=e.next;if(0<=sa(t,a,r))return!1;var i=e.next.next;while(i!==e.prev){if(na(t.x,t.y,a.x,a.y,r.x,r.y,i.x,i.y)&&0<=sa(i.prev,i,i.next))return!1;i=i.next}return!0}function qt(e,t,r,i){var o=e.prev,a=e,s=e.next;if(0<=sa(o,a,s))return!1;var l=o.x<a.x?o.x<s.x?o.x:s.x:a.x<s.x?a.x:s.x,d=o.y<a.y?o.y<s.y?o.y:s.y:a.y<s.y?a.y:s.y,u=o.x>a.x?o.x>s.x?o.x:s.x:a.x>s.x?a.x:s.x,c=o.y>a.y?o.y>s.y?o.y:s.y:a.y>s.y?a.y:s.y,m=ra(l,d,t,r,i),g=ra(u,c,t,r,i),f=e.prevZ,h=e.nextZ;while(f&&f.z>=m&&h&&h.z<=g){if(f!==e.prev&&f!==e.next&&na(o.x,o.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=sa(f.prev,f,f.next))return!1;f=f.prevZ;if(h!==e.prev&&h!==e.next&&na(o.x,o.y,a.x,a.y,s.x,s.y,h.x,h.y)&&0<=sa(h.prev,h,h.next))return!1;h=h.nextZ}while(f&&f.z>=m){if(f!==e.prev&&f!==e.next&&na(o.x,o.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=sa(f.prev,f,f.next))return!1;f=f.prevZ}while(h&&h.z<=g){if(h!==e.prev&&h!==e.next&&na(o.x,o.y,a.x,a.y,s.x,s.y,h.x,h.y)&&0<=sa(h.prev,h,h.next))return!1;h=h.nextZ}return!0}function Yt(e,t,r){var i=e;do{var n=i.prev,a=i.next.next;if(!la(n,a)&&da(n,i,i.next,a)&&ma(n,a)&&ma(a,n)){t.push(n.i/r);t.push(i.i/r);t.push(a.i/r);ya(i);ya(i.next);i=e=a}i=i.next}while(i!==e);return Wt(i)}function Zt(e,t,r,i,n,o){var s=e;do{var l=s.next.next;while(l!==s.prev){if(s.i!==l.i&&oa(s,l)){var d=fa(s,l);s=Wt(s,s.next);d=Wt(d,d.next);jt(s,t,r,i,n,o);jt(d,t,r,i,n,o);return}l=l.next}s=s.next}while(s!==e)}function Jt(e,t,a,r){var n=[],o,s,l,d,u;for(o=0,s=t.length;o<s;o++){l=t[o]*r;d=o<s-1?t[o+1]*r:e.length;u=Vt(e,l,d,r,!1);if(u===u.next)u.steiner=!0;n.push(ia(u))}n.sort(Kt);for(o=0;o<n.length;o++){Qt(n[o],a);a=Wt(a,a.next)}return a}function Kt(e,t){return e.x-t.x}function Qt(e,t){t=$t(e,t);if(t){var a=fa(t,e);Wt(t,t.next);Wt(a,a.next)}}function $t(e,t){var a=t,r=e.x,i=e.y,n=-Infinity,o;do{if(i<=a.y&&i>=a.next.y&&a.next.y!==a.y){var g=a.x+(i-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(g<=r&&g>n){n=g;if(g===r){if(i===a.y)return a;if(i===a.next.y)return a.next}o=a.x<a.next.x?a:a.next}}a=a.next}while(a!==t);if(!o)return null;if(r===n)return o;var s=o,l=o.x,d=o.y,u=1/0,c;a=o;do{if(r>=a.x&&a.x>=l&&r!==a.x&&na(i<d?r:n,i,l,d,i<d?n:r,i,a.x,a.y)){c=Math.abs(i-a.y)/(r-a.x);if(ma(a,e)&&(c<u||c===u&&(a.x>o.x||a.x===o.x&&ea(o,a)))){o=a;u=c}}a=a.next}while(a!==s);return o}function ea(e,t){return 0>sa(e.prev,e,t.prev)&&0>sa(t.next,e,e.next)}function ta(e,t,a,r){var i=e;do{if(null===i.z)i.z=ra(i.x,i.y,t,a,r);i.prevZ=i.prev;i.nextZ=i.next;i=i.next}while(i!==e);i.prevZ.nextZ=null;i.prevZ=null;aa(i)}function aa(t){var a,r,n,o,s,l,d,u,c=1;do{r=t;t=null;s=null;l=0;while(r){l++;n=r;d=0;for(a=0;a<c;a++){d++;n=n.nextZ;if(!n)break}u=c;while(0<d||0<u&&n){if(0!==d&&(0===u||!n||r.z<=n.z)){o=r;r=r.nextZ;d--}else{o=n;n=n.nextZ;u--}if(s)s.nextZ=o;else t=o;o.prevZ=s;s=o}r=n}s.nextZ=null;c*=2}while(1<l);return t}function ra(e,t,a,r,i){e=32767*(e-a)*i;t=32767*(t-r)*i;e=16711935&(e|e<<8);e=252645135&(e|e<<4);e=858993459&(e|e<<2);e=1431655765&(e|e<<1);t=16711935&(t|t<<8);t=252645135&(t|t<<4);t=858993459&(t|t<<2);t=1431655765&(t|t<<1);return e|t<<1}function ia(e){var t=e,a=e;do{if(t.x<a.x||t.x===a.x&&t.y<a.y)a=t;t=t.next}while(t!==e);return a}function na(e,t,a,r,i,n,o,s){return 0<=(i-o)*(t-s)-(e-o)*(n-s)&&0<=(e-o)*(r-s)-(a-o)*(t-s)&&0<=(a-o)*(n-s)-(i-o)*(r-s)}function oa(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!ca(e,t)&&(ma(e,t)&&ma(t,e)&&ga(e,t)&&(sa(e.prev,e,t.prev)||sa(e,t.prev,t))||la(e,t)&&0<sa(e.prev,e,e.next)&&0<sa(t.prev,t,t.next))}function sa(e,t,a){return(t.y-e.y)*(a.x-t.x)-(t.x-e.x)*(a.y-t.y)}function la(e,t){return e.x===t.x&&e.y===t.y}function da(e,t,a,r){var i=pa(sa(e,t,a)),n=pa(sa(e,t,r)),o=pa(sa(a,r,e)),s=pa(sa(a,r,t));if(i!==n&&o!==s)return!0;if(0===i&&ua(e,a,t))return!0;if(0===n&&ua(e,r,t))return!0;if(0===o&&ua(a,e,r))return!0;if(0===s&&ua(a,t,r))return!0;return!1}function ua(e,t,a){return t.x<=Math.max(e.x,a.x)&&t.x>=Math.min(e.x,a.x)&&t.y<=Math.max(e.y,a.y)&&t.y>=Math.min(e.y,a.y)}function pa(e){return 0<e?1:0>e?-1:0}function ca(e,t){var a=e;do{if(a.i!==e.i&&a.next.i!==e.i&&a.i!==t.i&&a.next.i!==t.i&&da(a,a.next,e,t))return!0;a=a.next}while(a!==e);return!1}function ma(e,t){return 0>sa(e.prev,e,e.next)?0<=sa(e,t,e.next)&&0<=sa(e,e.prev,t):0>sa(e,t,e.prev)||0>sa(e,e.next,t)}function ga(e,t){var a=e,r=!1,i=(e.x+t.x)/2,n=(e.y+t.y)/2;do{if(a.y>n!=a.next.y>n&&a.next.y!==a.y&&i<(a.next.x-a.x)*(n-a.y)/(a.next.y-a.y)+a.x)r=!r;a=a.next}while(a!==e);return r}function fa(e,t){var a=new va(e.i,e.x,e.y),r=new va(t.i,t.x,t.y),i=e.next,n=t.prev;e.next=t;t.prev=e;a.next=i;i.prev=a;r.next=a;a.prev=r;n.next=r;r.prev=n;return r}function ha(e,t,a,r){var i=new va(e,t,a);if(!r){i.prev=i;i.next=i}else{i.next=r.next;i.prev=r;r.next.prev=i;r.next=i}return i}function ya(e){e.next.prev=e.prev;e.prev.next=e.next;if(e.prevZ)e.prevZ.nextZ=e.nextZ;if(e.nextZ)e.nextZ.prevZ=e.prevZ}function va(e,t,a){this.i=e;this.x=t;this.y=a;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=!1}function _a(e,t,a,r){for(var i=0,n=t,o=a-r;n<a;n+=r){i+=(e[o]-e[n])*(e[n+1]+e[o+1]);o=n}return i}var sp=function(){function e(){_classCallCheck(this,e)}_createClass(e,null,[{key:"area",value:function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++){r+=e[i].x*e[n].y-e[n].x*e[i].y}return .5*r}},{key:"isClockWise",value:function isClockWise(t){return 0>e.area(t)}},{key:"triangulateShape",value:function triangulateShape(e,t){var a=[],r=[],i=[];xa(e);ba(a,e);var n=e.length;t.forEach(xa);for(var l=0;l<t.length;l++){r.push(n);n+=t[l].length;ba(a,t[l])}for(var o=op.triangulate(a,r),s=0;s<o.length;s+=3){i.push(o.slice(s,s+3))}return i}}]);return e}();function xa(e){var t=e.length;if(2<t&&e[t-1].equals(e[0])){e.pop()}}function ba(e,t){for(var a=0;a<t.length;a++){e.push(t[a].x);e.push(t[a].y)}}var lp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var r,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new np([new Jn(.5,.5),new Jn(-.5,.5),new Jn(-.5,-.5),new Jn(.5,-.5)]),n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};_classCallCheck(this,t);r=a.call(this);r.type="ExtrudeGeometry";r.parameters={shapes:i,options:n};i=Array.isArray(i)?i:[i];for(var o=_assertThisInitialized(r),s=[],d=[],u=0,p=i.length,l;u<p;u++){l=i[u];e(l)}r.setAttribute("position",new zs(s,3));r.setAttribute("uv",new zs(d,2));r.computeVertexNormals();function e(e){var v=[],_=n.curveSegments!==void 0?n.curveSegments:12,x=n.steps!==void 0?n.steps:1,E=n.depth!==void 0?n.depth:1,S=n.bevelEnabled!==void 0?n.bevelEnabled:!0,T=n.bevelThickness!==void 0?n.bevelThickness:.2,M=n.bevelSize!==void 0?n.bevelSize:T-.1,A=n.bevelOffset!==void 0?n.bevelOffset:0,R=n.bevelSegments!==void 0?n.bevelSegments:3,w=n.extrudePath,L=n.UVGenerator!==void 0?n.UVGenerator:dp;if(n.amount!==void 0){console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth.");E=n.amount}var C,P=!1,I,D,N,U;if(w){C=w.getSpacedPoints(x);P=!0;S=!1;I=w.computeFrenetFrames(x,!1);D=new mo;N=new mo;U=new mo}if(!S){R=0;T=0;M=0;A=0}var F=e.extractPoints(_),B=F.shape,O=F.holes,H=!sp.isClockWise(B);if(H){B=B.reverse();for(var ve=0,h=O.length,_e;ve<h;ve++){_e=O[ve];if(sp.isClockWise(_e)){O[ve]=_e.reverse()}}}for(var G=sp.triangulateShape(B,O),V=B,W=0,c=O.length,y;W<c;W++){y=O[W];B=B.concat(y)}function a(e,t,a){if(!t)console.error("THREE.ExtrudeGeometry: vec does not exist");return t.clone().multiplyScalar(a).add(e)}var X=B.length,q=G.length;function r(e,t,a){var r,i,n,o=e.x-t.x,s=e.y-t.y,l=a.x-e.x,d=a.y-e.y,u=o*o+s*s;if(Math.abs(o*d-s*l)>Number.EPSILON){var p=Math.sqrt(u),c=Math.sqrt(l*l+d*d),m=t.x-s/p,g=t.y+o/p,f=a.x-d/c,h=a.y+l/c,y=((f-m)*d-(h-g)*l)/(o*d-s*l);r=m+o*y-e.x;i=g+s*y-e.y;var v=r*r+i*i;if(2>=v){return new Jn(r,i)}else{n=Math.sqrt(v/2)}}else{var _=!1;if(o>Number.EPSILON){if(l>Number.EPSILON){_=!0}}else{if(o<-Number.EPSILON){if(l<-Number.EPSILON){_=!0}}else{if(Math.sign(s)===Math.sign(d)){_=!0}}}if(_){r=-s;i=o;n=Math.sqrt(u)}else{r=o;i=s;n=Math.sqrt(u/2)}}return new Jn(r/n,i/n)}for(var Y=[],Z=0,J=V.length,K=J-1,Q=Z+1;Z<J;Z++,K++,Q++){if(K===J)K=0;if(Q===J)Q=0;Y[Z]=r(V[Z],V[K],V[Q])}for(var $=[],ee,te=Y.concat(),ae=0,re=O.length,ie;ae<re;ae++){ie=O[ae];ee=[];for(var xe=0,be=ie.length,Ee=be-1,Se=xe+1;xe<be;xe++,Ee++,Se++){if(Ee===be)Ee=0;if(Se===be)Se=0;ee[xe]=r(ie[xe],ie[Ee],ie[Se])}$.push(ee);te=te.concat(ee)}for(var Te=0;Te<R;Te++){for(var ne=Te/R,t=T*Math.cos(ne*Math.PI/2),z=M*Math.sin(ne*Math.PI/2)+A,oe=0,se=V.length,le;oe<se;oe++){le=a(V[oe],Y[oe],z);u(le.x,le.y,-t)}for(var b=0,Me=O.length,Ae;b<Me;b++){Ae=O[b];ee=$[b];for(var Re=0,we=Ae.length,Le;Re<we;Re++){Le=a(Ae[Re],ee[Re],z);u(Le.x,Le.y,-t)}}}for(var de=M+A,ue=0,pe;ue<X;ue++){pe=S?a(B[ue],te[ue],de):B[ue];if(!P){u(pe.x,pe.y,0)}else{N.copy(I.normals[0]).multiplyScalar(pe.x);D.copy(I.binormals[0]).multiplyScalar(pe.y);U.copy(C[0]).add(N).add(D);u(U.x,U.y,U.z)}}for(var Ce=1;Ce<=x;Ce++){for(var ke=0,Pe;ke<X;ke++){Pe=S?a(B[ke],te[ke],de):B[ke];if(!P){u(Pe.x,Pe.y,E/x*Ce)}else{N.copy(I.normals[Ce]).multiplyScalar(Pe.x);D.copy(I.binormals[Ce]).multiplyScalar(Pe.y);U.copy(C[Ce]).add(N).add(D);u(U.x,U.y,U.z)}}}for(var Ie=R-1;0<=Ie;Ie--){for(var ce=Ie/R,me=T*Math.cos(ce*Math.PI/2),ge=M*Math.sin(ce*Math.PI/2)+A,fe=0,he=V.length,ye;fe<he;fe++){ye=a(V[fe],Y[fe],ge);u(ye.x,ye.y,E+me)}for(var De=0,Ne=O.length,Ue;De<Ne;De++){Ue=O[De];ee=$[De];for(var Fe=0,Be=Ue.length,Oe;Fe<Be;Fe++){Oe=a(Ue[Fe],ee[Fe],ge);if(!P){u(Oe.x,Oe.y,E+me)}else{u(Oe.x,Oe.y+C[x-1].y,C[x-1].x+me)}}}}i();(function(){var e=s.length/3,t=0;l(V,t);t+=V.length;for(var a=0,r=O.length,i;a<r;a++){i=O[a];l(i,t);t+=i.length}o.addGroup(e,s.length/3-e,1)})();function i(){var e=s.length/3;if(S){for(var t=0,a=X*t,r=0,i;r<q;r++){i=G[r];p(i[2]+a,i[1]+a,i[0]+a)}t=x+2*R;a=X*t;for(var n=0,l;n<q;n++){l=G[n];p(l[0]+a,l[1]+a,l[2]+a)}}else{for(var d=0,u;d<q;d++){u=G[d];p(u[2],u[1],u[0])}for(var c=0,m;c<q;c++){m=G[c];p(m[0]+X*x,m[1]+X*x,m[2]+X*x)}}o.addGroup(e,s.length/3-e,0)}function l(e,t){var a=e.length;while(0<=--a){var r=a,n=a-1;if(0>n)n=e.length-1;for(var u=0,p=x+2*R;u<p;u++){var o=X*u,s=X*(u+1),l=t+n+o,d=t+n+s;m(t+r+o,l,d,t+r+s)}}}function u(e,t,a){v.push(e);v.push(t);v.push(a)}function p(e,t,a){g(e);g(t);g(a);var r=s.length/3,i=L.generateTopUV(o,s,r-3,r-2,r-1);f(i[0]);f(i[1]);f(i[2])}function m(e,t,a,r){g(e);g(t);g(r);g(t);g(a);g(r);var i=s.length/3,n=L.generateSideWallUV(o,s,i-6,i-3,i-2,i-1);f(n[0]);f(n[1]);f(n[3]);f(n[1]);f(n[2]);f(n[3])}function g(e){s.push(v[3*e+0]);s.push(v[3*e+1]);s.push(v[3*e+2])}function f(e){d.push(e.x);d.push(e.y)}}return r}_createClass(t,[{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this),a=this.parameters.shapes,r=this.parameters.options;return Ea(a,r,e)}}],[{key:"fromJSON",value:function fromJSON(e,a){for(var r=[],i=0,n=e.shapes.length,o;i<n;i++){o=a[e.shapes[i]];r.push(o)}var s=e.options.extrudePath;if(s!==void 0){e.options.extrudePath=new ap[s.type]().fromJSON(s)}return new t(r,e.options)}}]);return t}(Zs),dp={generateTopUV:function generateTopUV(e,t,a,r,i){var n=t[3*a],o=t[3*a+1],s=t[3*r],l=t[3*r+1],d=t[3*i],u=t[3*i+1];return[new Jn(n,o),new Jn(s,l),new Jn(d,u)]},generateSideWallUV:function generateSideWallUV(e,t,a,r,i,n){var o=t[3*a],s=t[3*a+1],l=t[3*a+2],d=t[3*r],u=t[3*r+1],p=t[3*r+2],c=t[3*i],m=t[3*i+1],g=t[3*i+2],f=t[3*n],h=t[3*n+1],y=t[3*n+2];if(Math.abs(s-u)<Math.abs(o-d)){return[new Jn(o,1-l),new Jn(d,1-p),new Jn(c,1-g),new Jn(f,1-y)]}else{return[new Jn(s,1-l),new Jn(u,1-p),new Jn(m,1-g),new Jn(h,1-y)]}}};function Ea(e,t,a){a.shapes=[];if(Array.isArray(e)){for(var r=0,i=e.length,n;r<i;r++){n=e[r];a.shapes.push(n.uuid)}}else{a.shapes.push(e.uuid)}if(t.extrudePath!==void 0)a.options.extrudePath=t.extrudePath.toJSON();return a}var up=function(e){_inherits(a,e);var r=_createSuper(a);function a(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck(this,a);var o=(1+Math.sqrt(5))/2;e=r.call(this,[-1,o,0,1,o,0,-1,-o,0,1,-o,0,0,-1,o,0,1,o,0,-1,-o,0,1,-o,o,0,-1,o,0,1,-o,0,-1,-o,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],i,n);e.type="IcosahedronGeometry";e.parameters={radius:i,detail:n};return e}_createClass(a,null,[{key:"fromJSON",value:function fromJSON(e){return new a(e.radius,e.detail)}}]);return a}(Du),pp=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[new Jn(0,.5),new Jn(.5,0),new Jn(0,-.5)],n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:12,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:2*Math.PI;_classCallCheck(this,t);e=r.call(this);e.type="LatheGeometry";e.parameters={points:i,segments:n,phiStart:o,phiLength:s};n=Math.floor(n);s=a(s,0,2*Math.PI);for(var l=[],u=[],p=[],m=[],g=[],f=1/n,h=new mo,v=new Jn,_=new mo,E=new mo,S=new mo,T=0,M=0,A=0;A<=i.length-1;A++){switch(A){case 0:T=i[A+1].x-i[A].x;M=i[A+1].y-i[A].y;_.x=1*M;_.y=-T;_.z=0*M;S.copy(_);_.normalize();m.push(_.x,_.y,_.z);break;case i.length-1:m.push(S.x,S.y,S.z);break;default:T=i[A+1].x-i[A].x;M=i[A+1].y-i[A].y;_.x=1*M;_.y=-T;_.z=0*M;E.copy(_);_.x+=S.x;_.y+=S.y;_.z+=S.z;_.normalize();m.push(_.x,_.y,_.z);S.copy(E);}}for(var d=0;d<=n;d++){for(var R=o+d*f*s,w=Math.sin(R),L=Math.cos(R),C=0;C<=i.length-1;C++){h.x=i[C].x*w;h.y=i[C].y;h.z=i[C].x*L;u.push(h.x,h.y,h.z);v.x=d/n;v.y=C/(i.length-1);p.push(v.x,v.y);var k=m[3*C+0]*w,x=m[3*C+1],y=m[3*C+0]*L;g.push(k,x,y)}}for(var D=0;D<n;D++){for(var N=0;N<i.length-1;N++){var P=N+D*i.length,I=P+i.length,b=P+i.length+1,c=P+1;l.push(P,I,c);l.push(b,c,I)}}e.setIndex(l);e.setAttribute("position",new zs(u,3));e.setAttribute("uv",new zs(p,2));e.setAttribute("normal",new zs(g,3));return e}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.points,e.segments,e.phiStart,e.phiLength)}}]);return t}(Zs),cp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck(this,t);e=a.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],r,i);e.type="OctahedronGeometry";e.parameters={radius:r,detail:i};return e}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.detail)}}]);return t}(Du),mp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:.5,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:8,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:2*Math.PI;_classCallCheck(this,t);e=a.call(this);e.type="RingGeometry";e.parameters={innerRadius:r,outerRadius:i,thetaSegments:n,phiSegments:o,thetaStart:s,thetaLength:l};n=Math.max(3,n);o=Math.max(1,o);for(var u=[],p=[],m=[],g=[],f=r,h=(i-r)/o,y=new mo,v=new Jn,_=0;_<=o;_++){for(var d=0,S;d<=n;d++){S=s+d/n*l;y.x=f*Math.cos(S);y.y=f*Math.sin(S);p.push(y.x,y.y,y.z);m.push(0,0,1);v.x=(y.x/i+1)/2;v.y=(y.y/i+1)/2;g.push(v.x,v.y)}f+=h}for(var T=0,M;T<o;T++){M=T*(n+1);for(var A=0;A<n;A++){var x=A+M,E=x+n+1,b=x+n+2,c=x+1;u.push(x,E,c);u.push(E,b,c)}}e.setIndex(u);e.setAttribute("position",new zs(p,3));e.setAttribute("normal",new zs(m,3));e.setAttribute("uv",new zs(g,2));return e}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}]);return t}(Zs),gp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var r,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new np([new Jn(0,.5),new Jn(-.5,-.5),new Jn(.5,-.5)]),n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:12;_classCallCheck(this,t);r=a.call(this);r.type="ShapeGeometry";r.parameters={shapes:i,curveSegments:n};var o=[],s=[],l=[],d=[],u=0,p=0;if(!1===Array.isArray(i)){e(i)}else{for(var c=0;c<i.length;c++){e(i[c]);r.addGroup(u,p,c);u+=p;p=0}}r.setIndex(o);r.setAttribute("position",new zs(s,3));r.setAttribute("normal",new zs(l,3));r.setAttribute("uv",new zs(d,2));function e(e){var t=s.length/3,r=e.extractPoints(n),i=r.shape,u=r.holes;if(!1===sp.isClockWise(i)){i=i.reverse()}for(var c=0,x=u.length,l;c<x;c++){l=u[c];if(!0===sp.isClockWise(l)){u[c]=l.reverse()}}for(var m=sp.triangulateShape(i,u),g=0,f=u.length,h;g<f;g++){h=u[g];i=i.concat(h)}for(var b=0,E=i.length,S;b<E;b++){S=i[b];s.push(S.x,S.y,0);l.push(0,0,1);d.push(S.x,S.y)}for(var T=0,M=m.length;T<M;T++){var y=m[T],v=y[0]+t,a=y[1]+t,_=y[2]+t;o.push(v,a,_);p+=3}}return r}_createClass(t,[{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this),a=this.parameters.shapes;return Sa(a,e)}}],[{key:"fromJSON",value:function fromJSON(e,a){for(var r=[],i=0,n=e.shapes.length,o;i<n;i++){o=a[e.shapes[i]];r.push(o)}return new t(r,e.curveSegments)}}]);return t}(Zs);function Sa(e,t){t.shapes=[];if(Array.isArray(e)){for(var a=0,r=e.length,i;a<r;a++){i=e[a];t.shapes.push(i.uuid)}}else{t.shapes.push(e.uuid)}return t}var fp=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:32,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:16,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:2*Math.PI,p=5<arguments.length&&arguments[5]!==void 0?arguments[5]:0,m=6<arguments.length&&arguments[6]!==void 0?arguments[6]:Math.PI;_classCallCheck(this,t);e=r.call(this);e.type="SphereGeometry";e.parameters={radius:i,widthSegments:n,heightSegments:o,phiStart:s,phiLength:l,thetaStart:p,thetaLength:m};n=Math.max(3,Math.floor(n));o=Math.max(2,Math.floor(o));for(var g=Math.min(p+m,Math.PI),f=0,h=[],y=new mo,_=new mo,x=[],E=[],S=[],T=[],M=0;M<=o;M++){var A=[],R=M/o,v=0;if(0==M&&0==p){v=.5/n}else if(M==o&&g==Math.PI){v=-.5/n}for(var d=0,L;d<=n;d++){L=d/n;y.x=-i*Math.cos(s+L*l)*Math.sin(p+R*m);y.y=i*Math.cos(p+R*m);y.z=i*Math.sin(s+L*l)*Math.sin(p+R*m);E.push(y.x,y.y,y.z);_.copy(y).normalize();S.push(_.x,_.y,_.z);T.push(L+v,1-R);A.push(f++)}h.push(A)}for(var u=0;u<o;u++){for(var C=0;C<n;C++){var w=h[u][C+1],a=h[u][C],b=h[u+1][C],c=h[u+1][C+1];if(0!==u||0<p)x.push(w,a,c);if(u!==o-1||g<Math.PI)x.push(a,b,c)}}e.setIndex(x);e.setAttribute("position",new zs(E,3));e.setAttribute("normal",new zs(S,3));e.setAttribute("uv",new zs(T,2));return e}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]);return t}(Zs),hp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck(this,t);e=a.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],r,i);e.type="TetrahedronGeometry";e.parameters={radius:r,detail:i};return e}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.detail)}}]);return t}(Du),yp=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:.4,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:8,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:6,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:2*Math.PI;_classCallCheck(this,t);e=r.call(this);e.type="TorusGeometry";e.parameters={radius:i,tube:n,radialSegments:o,tubularSegments:s,arc:l};o=Math.floor(o);s=Math.floor(s);for(var p=[],m=[],g=[],f=[],h=new mo,y=new mo,_=new mo,x=0;x<=o;x++){for(var d=0;d<=s;d++){var E=d/s*l,u=2*(x/o*Math.PI);y.x=(i+n*Math.cos(u))*Math.cos(E);y.y=(i+n*Math.cos(u))*Math.sin(E);y.z=n*Math.sin(u);m.push(y.x,y.y,y.z);h.x=i*Math.cos(E);h.y=i*Math.sin(E);_.subVectors(y,h).normalize();g.push(_.x,_.y,_.z);f.push(d/s);f.push(x/o)}}for(var S=1;S<=o;S++){for(var T=1;T<=s;T++){var v=(s+1)*S+T-1,a=(s+1)*(S-1)+T-1,b=(s+1)*(S-1)+T,c=(s+1)*S+T;p.push(v,a,c);p.push(a,b,c)}}e.setIndex(p);e.setAttribute("position",new zs(m,3));e.setAttribute("normal",new zs(g,3));e.setAttribute("uv",new zs(f,2));return e}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}]);return t}(Zs),vp=function(e){_inherits(t,e);var r=_createSuper(t);function t(){var i,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:.4,s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:64,l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:8,m=4<arguments.length&&arguments[4]!==void 0?arguments[4]:2,p=5<arguments.length&&arguments[5]!==void 0?arguments[5]:3;_classCallCheck(this,t);i=r.call(this);i.type="TorusKnotGeometry";i.parameters={radius:n,tube:o,tubularSegments:s,radialSegments:l,p:m,q:p};s=Math.floor(s);l=Math.floor(l);for(var g=[],f=[],h=[],y=[],_=new mo,x=new mo,E=new mo,S=new mo,M=new mo,A=new mo,T=new mo,R=0,w;R<=s;++R){w=2*(R/s*m*Math.PI);e(w,m,p,n,E);e(w+.01,m,p,n,S);A.subVectors(S,E);T.addVectors(S,E);M.crossVectors(A,T);T.crossVectors(M,A);M.normalize();T.normalize();for(var d=0;d<=l;++d){var L=2*(d/l*Math.PI),v=-o*Math.cos(L),C=o*Math.sin(L);_.x=E.x+(v*T.x+C*M.x);_.y=E.y+(v*T.y+C*M.y);_.z=E.z+(v*T.z+C*M.z);f.push(_.x,_.y,_.z);x.subVectors(_,E).normalize();h.push(x.x,x.y,x.z);y.push(R/s);y.push(d/l)}}for(var P=1;P<=s;P++){for(var I=1;I<=l;I++){var k=(l+1)*(P-1)+(I-1),a=(l+1)*P+(I-1),b=(l+1)*P+I,c=(l+1)*(P-1)+I;g.push(k,a,c);g.push(a,b,c)}}i.setIndex(g);i.setAttribute("position",new zs(f,3));i.setAttribute("normal",new zs(h,3));i.setAttribute("uv",new zs(y,2));function e(e,t,a,r,i){var n=Math.cos(e),o=Math.sin(e),s=a/t*e,l=Math.cos(s);i.x=.5*(r*(2+l))*n;i.y=.5*(r*(2+l)*o);i.z=.5*(r*Math.sin(s))}return i}_createClass(t,null,[{key:"fromJSON",value:function fromJSON(e){return new t(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}]);return t}(Zs),_p=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var n,o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new ep(new mo(-1,-1,0),new mo(-1,1,0),new mo(1,1,0)),s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:64,l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:8,p=4<arguments.length&&arguments[4]!==void 0?arguments[4]:!1;_classCallCheck(this,t);n=a.call(this);n.type="TubeGeometry";n.parameters={path:o,tubularSegments:s,radius:l,radialSegments:u,closed:p};var c=o.computeFrenetFrames(s,p);n.tangents=c.tangents;n.normals=c.normals;n.binormals=c.binormals;var m=new mo,g=new mo,f=new Jn,d=new mo,h=[],y=[],v=[],_=[];(function(){for(var t=0;t<s;t++){e(t)}e(!1===p?s:0);i();r()})();n.setIndex(_);n.setAttribute("position",new zs(h,3));n.setAttribute("normal",new zs(y,3));n.setAttribute("uv",new zs(v,2));function e(e){d=o.getPointAt(e/s,d);for(var t=c.normals[e],a=c.binormals[e],r=0;r<=u;r++){var i=2*(r/u*Math.PI),n=Math.sin(i),p=-Math.cos(i);g.x=p*t.x+n*a.x;g.y=p*t.y+n*a.y;g.z=p*t.z+n*a.z;g.normalize();y.push(g.x,g.y,g.z);m.x=d.x+l*g.x;m.y=d.y+l*g.y;m.z=d.z+l*g.z;h.push(m.x,m.y,m.z)}}function r(){for(var i=1;i<=s;i++){for(var n=1;n<=u;n++){var e=(u+1)*(i-1)+(n-1),t=(u+1)*i+(n-1),a=(u+1)*i+n,r=(u+1)*(i-1)+n;_.push(e,t,r);_.push(t,a,r)}}}function i(){for(var e=0;e<=s;e++){for(var t=0;t<=u;t++){f.x=e/s;f.y=t/u;v.push(f.x,f.y)}}}return n}_createClass(t,[{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this);e.path=this.parameters.path.toJSON();return e}}],[{key:"fromJSON",value:function fromJSON(e){return new t(new ap[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}]);return t}(Zs),xp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;_classCallCheck(this,t);e=a.call(this);e.type="WireframeGeometry";e.parameters={geometry:r};if(null!==r){var i=[],n=new Set,s=new mo,l=new mo;if(null!==r.index){var d=r.attributes.position,u=r.index,p=r.groups;if(0===p.length){p=[{start:0,count:u.count,materialIndex:0}]}for(var S=0,o=p.length;S<o;++S){for(var c=p[S],m=c.start,g=c.count,f=m;f<m+g;f+=3){for(var T=0;3>T;T++){var h=u.getX(f+T),y=u.getX(f+(T+1)%3);s.fromBufferAttribute(d,h);l.fromBufferAttribute(d,y);if(!0===Ta(s,l,n)){i.push(s.x,s.y,s.z);i.push(l.x,l.y,l.z)}}}}}else{for(var v=r.attributes.position,_=0,x=v.count/3;_<x;_++){for(var M=0;3>M;M++){var b=3*_+M,E=3*_+(M+1)%3;s.fromBufferAttribute(v,b);l.fromBufferAttribute(v,E);if(!0===Ta(s,l,n)){i.push(s.x,s.y,s.z);i.push(l.x,l.y,l.z)}}}}e.setAttribute("position",new zs(i,3))}return e}return t}(Zs);function Ta(e,t,a){var r="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),i="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);if(!0===a.has(r)||!0===a.has(i)){return!1}else{a.add(r,i);return!0}}var bp=Object.freeze({__proto__:null,BoxGeometry:gl,BoxBufferGeometry:gl,CircleGeometry:ku,CircleBufferGeometry:ku,ConeGeometry:Iu,ConeBufferGeometry:Iu,CylinderGeometry:Pu,CylinderBufferGeometry:Pu,DodecahedronGeometry:Nu,DodecahedronBufferGeometry:Nu,EdgesGeometry:zu,ExtrudeGeometry:lp,ExtrudeBufferGeometry:lp,IcosahedronGeometry:up,IcosahedronBufferGeometry:up,LatheGeometry:pp,LatheBufferGeometry:pp,OctahedronGeometry:cp,OctahedronBufferGeometry:cp,PlaneGeometry:Ll,PlaneBufferGeometry:Ll,PolyhedronGeometry:Du,PolyhedronBufferGeometry:Du,RingGeometry:mp,RingBufferGeometry:mp,ShapeGeometry:gp,ShapeBufferGeometry:gp,SphereGeometry:fp,SphereBufferGeometry:fp,TetrahedronGeometry:hp,TetrahedronBufferGeometry:hp,TorusGeometry:yp,TorusBufferGeometry:yp,TorusKnotGeometry:vp,TorusKnotBufferGeometry:vp,TubeGeometry:_p,TubeBufferGeometry:_p,WireframeGeometry:xp}),Ep=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="ShadowMaterial";r.color=new ao(0);r.transparent=!0;r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);return this}}]);return t}(Rs);Ep.prototype.isShadowMaterial=!0;var Sp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.defines={STANDARD:""};r.type="MeshStandardMaterial";r.color=new ao(16777215);r.roughness=1;r.metalness=0;r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new ao(0);r.emissiveIntensity=1;r.emissiveMap=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=mn;r.normalScale=new Jn(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.roughnessMap=null;r.metalnessMap=null;r.alphaMap=null;r.envMap=null;r.envMapIntensity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.flatShading=!1;r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.defines={STANDARD:""};this.color.copy(e.color);this.roughness=e.roughness;this.metalness=e.metalness;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.roughnessMap=e.roughnessMap;this.metalnessMap=e.metalnessMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.envMapIntensity=e.envMapIntensity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.flatShading=e.flatShading;return this}}]);return t}(Rs);Sp.prototype.isMeshStandardMaterial=!0;var Tp=function(e){_inherits(t,e);var r=_createSuper(t);function t(e){var i;_classCallCheck(this,t);i=r.call(this);i.defines={STANDARD:"",PHYSICAL:""};i.type="MeshPhysicalMaterial";i.clearcoatMap=null;i.clearcoatRoughness=0;i.clearcoatRoughnessMap=null;i.clearcoatNormalScale=new Jn(1,1);i.clearcoatNormalMap=null;i.ior=1.5;Object.defineProperty(_assertThisInitialized(i),"reflectivity",{get:function get(){return a(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function set(e){this.ior=(1+.4*e)/(1-.4*e)}});i.sheenColor=new ao(0);i.sheenColorMap=null;i.sheenRoughness=1;i.sheenRoughnessMap=null;i.transmissionMap=null;i.thickness=0;i.thicknessMap=null;i.attenuationDistance=0;i.attenuationColor=new ao(1,1,1);i.specularIntensity=1;i.specularIntensityMap=null;i.specularColor=new ao(1,1,1);i.specularColorMap=null;i._sheen=0;i._clearcoat=0;i._transmission=0;i.setValues(e);return i}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.defines={STANDARD:"",PHYSICAL:""};this.clearcoat=e.clearcoat;this.clearcoatMap=e.clearcoatMap;this.clearcoatRoughness=e.clearcoatRoughness;this.clearcoatRoughnessMap=e.clearcoatRoughnessMap;this.clearcoatNormalMap=e.clearcoatNormalMap;this.clearcoatNormalScale.copy(e.clearcoatNormalScale);this.ior=e.ior;this.sheen=e.sheen;this.sheenColor.copy(e.sheenColor);this.sheenColorMap=e.sheenColorMap;this.sheenRoughness=e.sheenRoughness;this.sheenRoughnessMap=e.sheenRoughnessMap;this.transmission=e.transmission;this.transmissionMap=e.transmissionMap;this.thickness=e.thickness;this.thicknessMap=e.thicknessMap;this.attenuationDistance=e.attenuationDistance;this.attenuationColor.copy(e.attenuationColor);this.specularIntensity=e.specularIntensity;this.specularIntensityMap=e.specularIntensityMap;this.specularColor.copy(e.specularColor);this.specularColorMap=e.specularColorMap;return this}},{key:"sheen",get:function get(){return this._sheen},set:function set(e){if(0<this._sheen!=0<e){this.version++}this._sheen=e}},{key:"clearcoat",get:function get(){return this._clearcoat},set:function set(e){if(0<this._clearcoat!=0<e){this.version++}this._clearcoat=e}},{key:"transmission",get:function get(){return this._transmission},set:function set(e){if(0<this._transmission!=0<e){this.version++}this._transmission=e}}]);return t}(Sp);Tp.prototype.isMeshPhysicalMaterial=!0;var Mp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="MeshPhongMaterial";r.color=new ao(16777215);r.specular=new ao(1118481);r.shininess=30;r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new ao(0);r.emissiveIntensity=1;r.emissiveMap=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=mn;r.normalScale=new Jn(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.specularMap=null;r.alphaMap=null;r.envMap=null;r.combine=Tr;r.reflectivity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.flatShading=!1;r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.specular.copy(e.specular);this.shininess=e.shininess;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.flatShading=e.flatShading;return this}}]);return t}(Rs);Mp.prototype.isMeshPhongMaterial=!0;var Ap=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.defines={TOON:""};r.type="MeshToonMaterial";r.color=new ao(16777215);r.map=null;r.gradientMap=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new ao(0);r.emissiveIntensity=1;r.emissiveMap=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=mn;r.normalScale=new Jn(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.alphaMap=null;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.gradientMap=e.gradientMap;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.alphaMap=e.alphaMap;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;return this}}]);return t}(Rs);Ap.prototype.isMeshToonMaterial=!0;var Rp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="MeshNormalMaterial";r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=mn;r.normalScale=new Jn(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.wireframe=!1;r.wireframeLinewidth=1;r.fog=!1;r.flatShading=!1;r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.flatShading=e.flatShading;return this}}]);return t}(Rs);Rp.prototype.isMeshNormalMaterial=!0;var wp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="MeshLambertMaterial";r.color=new ao(16777215);r.map=null;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=null;r.aoMapIntensity=1;r.emissive=new ao(0);r.emissiveIntensity=1;r.emissiveMap=null;r.specularMap=null;r.alphaMap=null;r.envMap=null;r.combine=Tr;r.reflectivity=1;r.refractionRatio=.98;r.wireframe=!1;r.wireframeLinewidth=1;r.wireframeLinecap="round";r.wireframeLinejoin="round";r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;return this}}]);return t}(Rs);wp.prototype.isMeshLambertMaterial=!0;var Lp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.defines={MATCAP:""};r.type="MeshMatcapMaterial";r.color=new ao(16777215);r.matcap=null;r.map=null;r.bumpMap=null;r.bumpScale=1;r.normalMap=null;r.normalMapType=mn;r.normalScale=new Jn(1,1);r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.alphaMap=null;r.flatShading=!1;r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.defines={MATCAP:""};this.color.copy(e.color);this.matcap=e.matcap;this.map=e.map;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.alphaMap=e.alphaMap;this.flatShading=e.flatShading;return this}}]);return t}(Rs);Lp.prototype.isMeshMatcapMaterial=!0;var Cp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="LineDashedMaterial";r.scale=1;r.dashSize=3;r.gapSize=1;r.setValues(e);return r}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.scale=e.scale;this.dashSize=e.dashSize;this.gapSize=e.gapSize;return this}}]);return t}(uu);Cp.prototype.isLineDashedMaterial=!0;var kp=Object.freeze({__proto__:null,ShadowMaterial:Ep,SpriteMaterial:Ld,RawShaderMaterial:Dl,ShaderMaterial:hl,PointsMaterial:bu,MeshPhysicalMaterial:Tp,MeshStandardMaterial:Sp,MeshPhongMaterial:Mp,MeshToonMaterial:Ap,MeshNormalMaterial:Rp,MeshLambertMaterial:wp,MeshDepthMaterial:gd,MeshDistanceMaterial:fd,MeshBasicMaterial:ws,MeshMatcapMaterial:Lp,LineDashedMaterial:Cp,LineBasicMaterial:uu,Material:Rs}),Pp={arraySlice:function arraySlice(e,t,a){if(Pp.isTypedArray(e)){return new e.constructor(e.subarray(t,a!==void 0?a:e.length))}return e.slice(t,a)},convertArray:function convertArray(e,t,a){if(!e||!a&&e.constructor===t)return e;if("number"==typeof t.BYTES_PER_ELEMENT){return new t(e)}return Array.prototype.slice.call(e)},isTypedArray:function isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function getKeyframeOrder(e){function t(t,a){return e[t]-e[a]}for(var a=e.length,r=Array(a),i=0;i!==a;++i){r[i]=i}r.sort(t);return r},sortedArray:function sortedArray(e,t,a){for(var r=e.length,i=new e.constructor(r),n=0,o=0,s;o!==r;++n){s=a[n]*t;for(var l=0;l!==t;++l){i[o++]=e[s+l]}}return i},flattenJSON:function flattenJSON(e,t,a,r){var n=1,o=e[0];while(o!==void 0&&o[r]===void 0){o=e[n++]}if(o===void 0)return;var s=o[r];if(s===void 0)return;if(Array.isArray(s)){do{s=o[r];if(s!==void 0){t.push(o.time);a.push.apply(a,s)}o=e[n++]}while(o!==void 0)}else if(s.toArray!==void 0){do{s=o[r];if(s!==void 0){t.push(o.time);s.toArray(a,a.length)}o=e[n++]}while(o!==void 0)}else{do{s=o[r];if(s!==void 0){t.push(o.time);a.push(s)}o=e[n++]}while(o!==void 0)}},subclip:function subclip(e,t,a,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:30,n=e.clone();n.name=t;for(var o=[],s=0;s<n.tracks.length;++s){for(var l=n.tracks[s],d=l.getValueSize(),u=[],p=[],c=0,m;c<l.times.length;++c){m=l.times[c]*i;if(m<a||m>=r)continue;u.push(l.times[c]);for(var h=0;h<d;++h){p.push(l.values[c*d+h])}}if(0===u.length)continue;l.times=Pp.convertArray(u,l.times.constructor);l.values=Pp.convertArray(p,l.values.constructor);o.push(l)}n.tracks=o;for(var g=1/0,f=0;f<n.tracks.length;++f){if(g>n.tracks[f].times[0]){g=n.tracks[f].times[0]}}for(var y=0;y<n.tracks.length;++y){n.tracks[y].shift(-1*g)}n.resetDuration();return n},makeClipAdditive:function makeClipAdditive(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:e,r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:30;if(0>=r)r=30;for(var i=a.tracks.length,n=t/r,o=function(t){var r=a.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)return"continue";var o=e.tracks.find(function(e){return e.name===r.name&&e.ValueTypeName===i});if(o===void 0)return"continue";var s=0,l=r.getValueSize();if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline){s=l/3}var d=0,u=o.getValueSize();if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline){d=u/3}var p=r.times.length-1,c=void 0;if(n<=r.times[0]){var m=s,g=l-s;c=Pp.arraySlice(r.values,m,g)}else if(n>=r.times[p]){var f=p*l+s,h=f+l-s;c=Pp.arraySlice(r.values,f,h)}else{var y=r.createInterpolant(),v=s,_=l-s;y.evaluate(n);c=Pp.arraySlice(y.resultBuffer,v,_)}if("quaternion"===i){var M=new co().fromArray(c).normalize().conjugate();M.toArray(c)}for(var x=o.times.length,b=0,E;b<x;++b){E=b*u+d;if("quaternion"===i){co.multiplyQuaternionsFlat(o.values,E,c,0,o.values,E)}else{for(var S=u-2*d,T=0;T<S;++T){o.values[E+T]-=c[T]}}}},s=0,l;s<i;++s){l=o(s);if("continue"===l)continue}e.blendMode=nn;return e}},Ip=function(){function e(t,a,r,i){_classCallCheck(this,e);this.parameterPositions=t;this._cachedIndex=0;this.resultBuffer=i!==void 0?i:new a.constructor(r);this.sampleValues=a;this.valueSize=r;this.settings=null;this.DefaultSettings_={}}_createClass(e,[{key:"evaluate",value:function evaluate(e){var t=this.parameterPositions,a=this._cachedIndex,r=t[a],i=t[a-1];validate_interval:{seek:{var n;linear_scan:{forward_scan:if(!(e<r)){for(var o=a+2;;){if(r===void 0){if(e<i)break forward_scan;a=t.length;this._cachedIndex=a;return this.afterEnd_(a-1,e,i)}if(a===o)break;i=r;r=t[++a];if(e<r){break seek}}n=t.length;break linear_scan}if(!(e>=i)){var s=t[1];if(e<s){a=2;i=s}for(var l=a-2;;){if(i===void 0){this._cachedIndex=0;return this.beforeStart_(0,e,r)}if(a===l)break;r=i;i=t[--a-1];if(e>=i){break seek}}n=a;a=0;break linear_scan}break validate_interval}while(a<n){var d=a+n>>>1;if(e<t[d]){n=d}else{a=d+1}}r=t[a];i=t[a-1];if(i===void 0){this._cachedIndex=0;return this.beforeStart_(0,e,r)}if(r===void 0){a=t.length;this._cachedIndex=a;return this.afterEnd_(a-1,i,e)}}this._cachedIndex=a;this.intervalChanged_(a,i,r)}return this.interpolate_(a,i,e,r)}},{key:"getSettings_",value:function getSettings_(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function copySampleValue_(e){for(var t=this.resultBuffer,a=this.sampleValues,r=this.valueSize,i=0;i!==r;++i){t[i]=a[e*r+i]}return t}},{key:"interpolate_",value:function interpolate_(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function intervalChanged_(){}}]);return e}();Ip.prototype.beforeStart_=Ip.prototype.copySampleValue_;Ip.prototype.afterEnd_=Ip.prototype.copySampleValue_;var Dp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){var o;_classCallCheck(this,t);o=a.call(this,e,r,i,n);o._weightPrev=-0;o._offsetPrev=-0;o._weightNext=-0;o._offsetNext=-0;o.DefaultSettings_={endingStart:en,endingEnd:en};return o}_createClass(t,[{key:"intervalChanged_",value:function intervalChanged_(e,t,a){var r=this.parameterPositions,i=e-2,n=e+1,o=r[i],s=r[n];if(o===void 0){switch(this.getSettings_().endingStart){case tn:i=e;o=2*t-a;break;case an:i=r.length-2;o=t+r[i]-r[i+1];break;default:i=e;o=a;}}if(s===void 0){switch(this.getSettings_().endingEnd){case tn:n=e;s=2*a-t;break;case an:n=1;s=a+r[1]-r[0];break;default:n=e-1;s=t;}}var l=.5*(a-t),d=this.valueSize;this._weightPrev=l/(t-o);this._weightNext=l/(s-a);this._offsetPrev=i*d;this._offsetNext=n*d}},{key:"interpolate_",value:function interpolate_(e,a,r,t){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,s=e*o,l=this._offsetPrev,d=this._offsetNext,u=this._weightPrev,c=this._weightNext,m=(r-a)/(t-a),p=m*m,g=p*m,f=0;f!==o;++f){i[f]=(-u*g+2*u*p-u*m)*n[l+f]+((1+u)*g+(-1.5-2*u)*p+(-.5+u)*m+1)*n[s-o+f]+((-1-c)*g+(1.5+c)*p+.5*m)*n[s+f]+(c*g-c*p)*n[d+f]}return i}}]);return t}(Ip),Np=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){_classCallCheck(this,t);return a.call(this,e,r,i,n)}_createClass(t,[{key:"interpolate_",value:function interpolate_(e,a,r,t){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,s=e*o,l=(r-a)/(t-a),d=0;d!==o;++d){i[d]=n[s-o+d]*(1-l)+n[s+d]*l}return i}}]);return t}(Ip),Up=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){_classCallCheck(this,t);return a.call(this,e,r,i,n)}_createClass(t,[{key:"interpolate_",value:function interpolate_(e){return this.copySampleValue_(e-1)}}]);return t}(Ip),Fp=function(){function e(t,a,r,i){_classCallCheck(this,e);if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(a===void 0||0===a.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t;this.times=Pp.convertArray(a,this.TimeBufferType);this.values=Pp.convertArray(r,this.ValueBufferType);this.setInterpolation(i||this.DefaultInterpolation)}_createClass(e,[{key:"InterpolantFactoryMethodDiscrete",value:function InterpolantFactoryMethodDiscrete(e){return new Up(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function InterpolantFactoryMethodLinear(e){return new Np(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function InterpolantFactoryMethodSmooth(e){return new Dp(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function setInterpolation(e){var t;switch(e){case Ki:t=this.InterpolantFactoryMethodDiscrete;break;case Qi:t=this.InterpolantFactoryMethodLinear;break;case $i:t=this.InterpolantFactoryMethodSmooth;break;}if(t===void 0){var a="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e!==this.DefaultInterpolation){this.setInterpolation(this.DefaultInterpolation)}else{throw new Error(a)}}console.warn("THREE.KeyframeTrack:",a);return this}this.createInterpolant=t;return this}},{key:"getInterpolation",value:function getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ki;case this.InterpolantFactoryMethodLinear:return Qi;case this.InterpolantFactoryMethodSmooth:return $i;}}},{key:"getValueSize",value:function getValueSize(){return this.values.length/this.times.length}},{key:"shift",value:function shift(e){if(0!==e){for(var t=this.times,a=0,r=t.length;a!==r;++a){t[a]+=e}}return this}},{key:"scale",value:function scale(e){if(1!==e){for(var t=this.times,a=0,r=t.length;a!==r;++a){t[a]*=e}}return this}},{key:"trim",value:function trim(e,t){var a=this.times,r=a.length,i=0,n=r-1;while(i!==r&&a[i]<e){++i}while(-1!==n&&a[n]>t){--n}++n;if(0!==i||n!==r){if(i>=n){n=Math.max(n,1);i=n-1}var o=this.getValueSize();this.times=Pp.arraySlice(a,i,n);this.values=Pp.arraySlice(this.values,i*o,n*o)}return this}},{key:"validate",value:function validate(){var e=!0,t=this.getValueSize();if(0!=t-Math.floor(t)){console.error("THREE.KeyframeTrack: Invalid value size in track.",this);e=!1}var a=this.times,r=this.values,i=a.length;if(0===i){console.error("THREE.KeyframeTrack: Track is empty.",this);e=!1}for(var o=null,s=0,l;s!==i;s++){l=a[s];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,l);e=!1;break}if(null!==o&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,l,o);e=!1;break}o=l}if(r!==void 0){if(Pp.isTypedArray(r)){for(var d=0,u=r.length,n;d!==u;++d){n=r[d];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,d,n);e=!1;break}}}}return e}},{key:"optimize",value:function optimize(){for(var e=Pp.arraySlice(this.times),t=Pp.arraySlice(this.values),a=this.getValueSize(),r=this.getInterpolation()===$i,i=e.length-1,n=1,o=1;o<i;++o){var s=!1,l=e[o],d=e[o+1];if(l!==d&&(1!==o||l!==e[0])){if(!r){for(var u=o*a,p=0,c;p!==a;++p){c=t[u+p];if(c!==t[u-a+p]||c!==t[u+a+p]){s=!0;break}}}else{s=!0}}if(s){if(o!==n){e[n]=e[o];for(var m=o*a,g=n*a,f=0;f!==a;++f){t[g+f]=t[m+f]}}++n}}if(0<i){e[n]=e[i];for(var h=n*a,y=0;y!==a;++y){t[h+y]=t[i*a+y]}++n}if(n!==e.length){this.times=Pp.arraySlice(e,0,n);this.values=Pp.arraySlice(t,0,n*a)}else{this.times=e;this.values=t}return this}},{key:"clone",value:function clone(){var e=Pp.arraySlice(this.times,0),t=Pp.arraySlice(this.values,0),a=this.constructor,r=new a(this.name,e,t);r.createInterpolant=this.createInterpolant;return r}}],[{key:"toJSON",value:function toJSON(e){var t=e.constructor,a;if(t.toJSON!==this.toJSON){a=t.toJSON(e)}else{a={name:e.name,times:Pp.convertArray(e.times,Array),values:Pp.convertArray(e.values,Array)};var r=e.getInterpolation();if(r!==e.DefaultInterpolation){a.interpolation=r}}a.type=e.ValueTypeName;return a}}]);return e}();Fp.prototype.TimeBufferType=Float32Array;Fp.prototype.ValueBufferType=Float32Array;Fp.prototype.DefaultInterpolation=Qi;var Bp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck(this,t);return a.apply(this,arguments)}return t}(Fp);Bp.prototype.ValueTypeName="bool";Bp.prototype.ValueBufferType=Array;Bp.prototype.DefaultInterpolation=Ki;Bp.prototype.InterpolantFactoryMethodLinear=void 0;Bp.prototype.InterpolantFactoryMethodSmooth=void 0;var Op=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck(this,t);return a.apply(this,arguments)}return t}(Fp);Op.prototype.ValueTypeName="color";var zp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck(this,t);return a.apply(this,arguments)}return t}(Fp);zp.prototype.ValueTypeName="number";var Hp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i,n){_classCallCheck(this,t);return a.call(this,e,r,i,n)}_createClass(t,[{key:"interpolate_",value:function interpolate_(e,a,r,t){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,s=e*o,l=s+o;s!==l;s+=4){co.slerpFlat(i,0,n,s-o,n,s,(r-a)/(t-a))}return i}}]);return t}(Ip),Gp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck(this,t);return a.apply(this,arguments)}_createClass(t,[{key:"InterpolantFactoryMethodLinear",value:function InterpolantFactoryMethodLinear(e){return new Hp(this.times,this.values,this.getValueSize(),e)}}]);return t}(Fp);Gp.prototype.ValueTypeName="quaternion";Gp.prototype.DefaultInterpolation=Qi;Gp.prototype.InterpolantFactoryMethodSmooth=void 0;var Vp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck(this,t);return a.apply(this,arguments)}return t}(Fp);Vp.prototype.ValueTypeName="string";Vp.prototype.ValueBufferType=Array;Vp.prototype.DefaultInterpolation=Ki;Vp.prototype.InterpolantFactoryMethodLinear=void 0;Vp.prototype.InterpolantFactoryMethodSmooth=void 0;var Wp=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck(this,t);return a.apply(this,arguments)}return t}(Fp);Wp.prototype.ValueTypeName="vector";var jp=function(){function e(a){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:-1,i=2<arguments.length?arguments[2]:void 0,n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:rn;_classCallCheck(this,e);this.name=a;this.tracks=i;this.duration=r;this.blendMode=n;this.uuid=t();if(0>this.duration){this.resetDuration()}}_createClass(e,[{key:"resetDuration",value:function resetDuration(){for(var e=this.tracks,t=0,a=0,r=e.length,i;a!==r;++a){i=this.tracks[a];t=Math.max(t,i.times[i.times.length-1])}this.duration=t;return this}},{key:"trim",value:function trim(){for(var e=0;e<this.tracks.length;e++){this.tracks[e].trim(0,this.duration)}return this}},{key:"validate",value:function validate(){for(var e=!0,t=0;t<this.tracks.length;t++){e=e&&this.tracks[t].validate()}return e}},{key:"optimize",value:function optimize(){for(var e=0;e<this.tracks.length;e++){this.tracks[e].optimize()}return this}},{key:"clone",value:function clone(){for(var e=[],t=0;t<this.tracks.length;t++){e.push(this.tracks[t].clone())}return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function toJSON(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function parse(e){for(var t=[],a=e.tracks,r=1/(e.fps||1),i=0,o=a.length;i!==o;++i){t.push(Aa(a[i]).scale(r))}var n=new this(e.name,e.duration,t,e.blendMode);n.uuid=e.uuid;return n}},{key:"toJSON",value:function toJSON(e){for(var t=[],a=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},i=0,o=a.length;i!==o;++i){t.push(Fp.toJSON(a[i]))}return r}},{key:"CreateFromMorphTargetSequence",value:function CreateFromMorphTargetSequence(e,t,a,r){for(var i=t.length,n=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i);l.push(0,1,0);var d=Pp.getKeyframeOrder(s);s=Pp.sortedArray(s,1,d);l=Pp.sortedArray(l,1,d);if(!r&&0===s[0]){s.push(i);l.push(l[0])}n.push(new zp(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/a))}return new this(e,-1,n)}},{key:"findByName",value:function findByName(e,t){var a=e;if(!Array.isArray(e)){var r=e;a=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<a.length;i++){if(a[i].name===t){return a[i]}}return null}},{key:"CreateClipsFromMorphTargetSequences",value:function CreateClipsFromMorphTargetSequences(e,t,a){for(var r={},i=0,n=e.length;i<n;i++){var o=e[i],s=o.name.match(/^([\w-]*?)([\d]+)$/);if(s&&1<s.length){var l=s[1],d=r[l];if(!d){r[l]=d=[]}d.push(o)}}var u=[];for(var p in r){u.push(this.CreateFromMorphTargetSequence(p,r[p],t,a))}return u}},{key:"parseAnimation",value:function parseAnimation(e,t){if(!e){console.error("THREE.AnimationClip: No animation in JSONLoader data.");return null}for(var a=function(e,t,a,r,i){if(0!==a.length){var n=[],o=[];Pp.flattenJSON(a,n,o,r);if(0!==n.length){i.push(new e(t,n,o))}}},r=[],i=e.name||"default",n=e.fps||30,o=e.blendMode,s=e.length||-1,l=e.hierarchy||[],d=0,u;d<l.length;d++){u=l[d].keys;if(!u||0===u.length)continue;if(u[0].morphTargets){var p={},c=void 0;for(c=0;c<u.length;c++){if(u[c].morphTargets){for(var x=0;x<u[c].morphTargets.length;x++){p[u[c].morphTargets[x]]=-1}}}for(var m in p){for(var g=[],f=[],y=0,v;y!==u[c].morphTargets.length;++y){v=u[c];g.push(v.time);f.push(v.morphTarget===m?1:0)}r.push(new zp(".morphTargetInfluence["+m+"]",g,f))}s=p.length*(n||1)}else{var b=".bones["+t[d].name+"]";a(Wp,b+".position",u,"pos",r);a(Gp,b+".quaternion",u,"rot",r);a(Wp,b+".scale",u,"scl",r)}}if(0===r.length){return null}var _=new this(i,s,r,o);return _}}]);return e}();function Ma(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return zp;case"vector":case"vector2":case"vector3":case"vector4":return Wp;case"color":return Op;case"quaternion":return Gp;case"bool":case"boolean":return Bp;case"string":return Vp;}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function Aa(e){if(e.type===void 0){throw new Error("THREE.KeyframeTrack: track type undefined, can not parse")}var t=Ma(e.type);if(e.times===void 0){var a=[],r=[];Pp.flattenJSON(e.keys,a,r,"value");e.times=a;e.values=r}if(t.parse!==void 0){return t.parse(e)}else{return new t(e.name,e.times,e.values,e.interpolation)}}var Xp={enabled:!1,files:{},add:function add(e,t){if(!1===this.enabled)return;this.files[e]=t},get:function get(e){if(!1===this.enabled)return;return this.files[e]},remove:function remove(e){delete this.files[e]},clear:function clear(){this.files={}}},qp=function e(t,a,r){_classCallCheck(this,e);var i=this,n=!1,o=0,s=0,l=void 0,d=[];this.onStart=void 0;this.onLoad=t;this.onProgress=a;this.onError=r;this.itemStart=function(e){s++;if(!1===n){if(i.onStart!==void 0){i.onStart(e,o,s)}}n=!0};this.itemEnd=function(e){o++;if(i.onProgress!==void 0){i.onProgress(e,o,s)}if(o===s){n=!1;if(i.onLoad!==void 0){i.onLoad()}}};this.itemError=function(e){if(i.onError!==void 0){i.onError(e)}};this.resolveURL=function(e){if(l){return l(e)}return e};this.setURLModifier=function(e){l=e;return this};this.addHandler=function(e,t){d.push(e,t);return this};this.removeHandler=function(e){var t=d.indexOf(e);if(-1!==t){d.splice(t,2)}return this};this.getHandler=function(e){for(var r=0,i=d.length;r<i;r+=2){var t=d[r],a=d[r+1];if(t.global)t.lastIndex=0;if(t.test(e)){return a}}return null}},Yp=new qp,Zp=function(){function e(t){_classCallCheck(this,e);this.manager=t!==void 0?t:Yp;this.crossOrigin="anonymous";this.withCredentials=!1;this.path="";this.resourcePath="";this.requestHeader={}}_createClass(e,[{key:"load",value:function load(){}},{key:"loadAsync",value:function loadAsync(e,t){var a=this;return new Promise(function(r,i){a.load(e,r,t,i)})}},{key:"parse",value:function parse(){}},{key:"setCrossOrigin",value:function setCrossOrigin(e){this.crossOrigin=e;return this}},{key:"setWithCredentials",value:function setWithCredentials(e){this.withCredentials=e;return this}},{key:"setPath",value:function setPath(e){this.path=e;return this}},{key:"setResourcePath",value:function setResourcePath(e){this.resourcePath=e;return this}},{key:"setRequestHeader",value:function setRequestHeader(e){this.requestHeader=e;return this}}]);return e}(),Jp={},Kp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck(this,t);return a.call(this,e)}_createClass(t,[{key:"load",value:function load(e,t,a,r){var i=this;if(e===void 0)e="";if(this.path!==void 0)e=this.path+e;e=this.manager.resolveURL(e);var n=Xp.get(e);if(n!==void 0){this.manager.itemStart(e);setTimeout(function(){if(t)t(n);i.manager.itemEnd(e)},0);return n}if(Jp[e]!==void 0){Jp[e].push({onLoad:t,onProgress:a,onError:r});return}Jp[e]=[];Jp[e].push({onLoad:t,onProgress:a,onError:r});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,l=this.responseType;fetch(o).then(function(t){if(200===t.status||0===t.status){if(0===t.status){console.warn("THREE.FileLoader: HTTP Status 0 received.")}if("undefined"==typeof ReadableStream||t.body.getReader===void 0){return t}var a=Jp[e],r=t.body.getReader(),i=t.headers.get("Content-Length"),n=i?parseInt(i):0,o=0,s=new ReadableStream({start:function start(e){t();function t(){r.read().then(function(r){var i=r.done,s=r.value;if(i){e.close()}else{o+=s.byteLength;for(var l=new ProgressEvent("progress",{lengthComputable:0!==n,loaded:o,total:n}),d=0,u=a.length,p;d<u;d++){p=a[d];if(p.onProgress)p.onProgress(l)}e.enqueue(s);t()}})}}});return new Response(s)}else{throw Error("fetch for \"".concat(t.url,"\" responded with ").concat(t.status,": ").concat(t.statusText))}}).then(function(e){switch(l){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(function(e){var t=new DOMParser;return t.parseFromString(e,s)});case"json":return e.json();default:if(s===void 0){return e.text()}else{var t=/charset="?([^;"\s]*)"?/i.exec(s),a=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(a);return e.arrayBuffer().then(function(e){return r.decode(e)})}}}).then(function(t){Xp.add(e,t);var a=Jp[e];delete Jp[e];for(var r=0,i=a.length,n;r<i;r++){n=a[r];if(n.onLoad)n.onLoad(t)}}).catch(function(t){var a=Jp[e];if(a===void 0){i.manager.itemError(e);throw t}delete Jp[e];for(var r=0,n=a.length,o;r<n;r++){o=a[r];if(o.onError)o.onError(t)}i.manager.itemError(e)}).finally(function(){i.manager.itemEnd(e)});this.manager.itemStart(e)}},{key:"setResponseType",value:function setResponseType(e){this.responseType=e;return this}},{key:"setMimeType",value:function setMimeType(e){this.mimeType=e;return this}}]);return t}(Zp),Qp=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck(this,t);return a.call(this,e)}_createClass(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new Kp(this.manager);o.setPath(this.path);o.setRequestHeader(this.requestHeader);o.setWithCredentials(this.withCredentials);o.load(t,function(e){try{a(n.parse(JSON.parse(e)))}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}},{key:"parse",value:function parse(e){for(var t=[],a=0,r;a<e.length;a++){r=jp.parse(e[a]);t.push(r)}return t}}]);return t}(Zp),$p=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck(this,t);return a.call(this,e)}_createClass(t,[{key:"load",value:function load(e,t,a,r){var n=this,o=[],s=new Lu,l=new Kp(this.manager);l.setPath(this.path);l.setResponseType("arraybuffer");l.setRequestHeader(this.requestHeader);l.setWithCredentials(n.withCredentials);var d=0;function i(u){l.load(e[u],function(e){var a=n.parse(e,!0);o[u]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};d+=1;if(6==d){if(1===a.mipmapCount)s.minFilter=Yr;s.image=o;s.format=a.format;s.needsUpdate=!0;if(t)t(s)}},a,r)}if(Array.isArray(e)){for(var u=0,p=e.length;u<p;++u){i(u)}}else{l.load(e,function(e){var a=n.parse(e,!0);if(a.isCubemap){for(var r=a.mipmaps.length/a.mipmapCount,i=0;i<r;i++){o[i]={mipmaps:[]};for(var l=0;l<a.mipmapCount;l++){o[i].mipmaps.push(a.mipmaps[i*a.mipmapCount+l]);o[i].format=a.format;o[i].width=a.width;o[i].height=a.height}}s.image=o}else{s.image.width=a.width;s.image.height=a.height;s.mipmaps=a.mipmaps}if(1===a.mipmapCount){s.minFilter=Yr}s.format=a.format;s.needsUpdate=!0;if(t)t(s)},a,r)}return s}}]);return t}(Zp),ec=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck(this,t);return a.call(this,e)}_createClass(t,[{key:"load",value:function load(e,t,a,r){if(this.path!==void 0)e=this.path+e;e=this.manager.resolveURL(e);var s=this,l=Xp.get(e);if(l!==void 0){s.manager.itemStart(e);setTimeout(function(){if(t)t(l);s.manager.itemEnd(e)},0);return l}var d=c("img");function i(){o();Xp.add(e,this);if(t)t(this);s.manager.itemEnd(e)}function n(t){o();if(r)r(t);s.manager.itemError(e);s.manager.itemEnd(e)}function o(){d.removeEventListener("load",i,!1);d.removeEventListener("error",n,!1)}d.addEventListener("load",i,!1);d.addEventListener("error",n,!1);if("data:"!==e.substr(0,5)){if(this.crossOrigin!==void 0)d.crossOrigin=this.crossOrigin}s.manager.itemStart(e);d.src=e;return d}}]);return t}(Zp),tc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck(this,t);return a.call(this,e)}_createClass(t,[{key:"load",value:function load(e,t,a,r){var n=new xl,o=new ec(this.manager);o.setCrossOrigin(this.crossOrigin);o.setPath(this.path);var s=0;function i(a){o.load(e[a],function(e){n.images[a]=e;s++;if(6==s){n.needsUpdate=!0;if(t)t(n)}},void 0,r)}for(var l=0;l<e.length;++l){i(l)}return n}}]);return t}(Zp),ac=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck(this,t);return a.call(this,e)}_createClass(t,[{key:"load",value:function load(e,t,a,r){var i=this,n=new eu,o=new Kp(this.manager);o.setResponseType("arraybuffer");o.setRequestHeader(this.requestHeader);o.setPath(this.path);o.setWithCredentials(i.withCredentials);o.load(e,function(e){var a=i.parse(e);if(!a)return;if(a.image!==void 0){n.image=a.image}else if(a.data!==void 0){n.image.width=a.width;n.image.height=a.height;n.image.data=a.data}n.wrapS=a.wrapS!==void 0?a.wrapS:Hr;n.wrapT=a.wrapT!==void 0?a.wrapT:Hr;n.magFilter=a.magFilter!==void 0?a.magFilter:Yr;n.minFilter=a.minFilter!==void 0?a.minFilter:Yr;n.anisotropy=a.anisotropy!==void 0?a.anisotropy:1;if(a.encoding!==void 0){n.encoding=a.encoding}if(a.flipY!==void 0){n.flipY=a.flipY}if(a.format!==void 0){n.format=a.format}if(a.type!==void 0){n.type=a.type}if(a.mipmaps!==void 0){n.mipmaps=a.mipmaps;n.minFilter=Kr}if(1===a.mipmapCount){n.minFilter=Yr}if(a.generateMipmaps!==void 0){n.generateMipmaps=a.generateMipmaps}n.needsUpdate=!0;if(t)t(n,a)},a,r);return n}}]);return t}(Zp),rc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck(this,t);return a.call(this,e)}_createClass(t,[{key:"load",value:function load(e,t,a,r){var i=new oo,n=new ec(this.manager);n.setCrossOrigin(this.crossOrigin);n.setPath(this.path);n.load(e,function(e){i.image=e;i.needsUpdate=!0;if(t!==void 0){t(i)}},a,r);return i}}]);return t}(Zp),ic=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck(this,t);r=a.call(this);r.type="Light";r.color=new ao(e);r.intensity=i;return r}_createClass(t,[{key:"dispose",value:function dispose(){}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.color.copy(e.color);this.intensity=e.intensity;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.color=this.color.getHex();a.object.intensity=this.intensity;if(this.groundColor!==void 0)a.object.groundColor=this.groundColor.getHex();if(this.distance!==void 0)a.object.distance=this.distance;if(this.angle!==void 0)a.object.angle=this.angle;if(this.decay!==void 0)a.object.decay=this.decay;if(this.penumbra!==void 0)a.object.penumbra=this.penumbra;if(this.shadow!==void 0)a.object.shadow=this.shadow.toJSON();return a}}]);return t}(gs);ic.prototype.isLight=!0;var nc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck(this,t);n=a.call(this,e,i);n.type="HemisphereLight";n.position.copy(gs.DefaultUp);n.updateMatrix();n.groundColor=new ao(r);return n}_createClass(t,[{key:"copy",value:function copy(e){ic.prototype.copy.call(this,e);this.groundColor.copy(e.groundColor);return this}}]);return t}(ic);nc.prototype.isHemisphereLight=!0;var oc=new Vo,sc=new mo,lc=new mo,dc=function(){function e(t){_classCallCheck(this,e);this.camera=t;this.bias=0;this.normalBias=0;this.radius=1;this.blurSamples=8;this.mapSize=new Jn(512,512);this.map=null;this.mapPass=null;this.matrix=new Vo;this.autoUpdate=!0;this.needsUpdate=!1;this._frustum=new wl;this._frameExtents=new Jn(1,1);this._viewportCount=1;this._viewports=[new so(0,0,1,1)]}_createClass(e,[{key:"getViewportCount",value:function getViewportCount(){return this._viewportCount}},{key:"getFrustum",value:function getFrustum(){return this._frustum}},{key:"updateMatrices",value:function updateMatrices(e){var t=this.camera,a=this.matrix;sc.setFromMatrixPosition(e.matrixWorld);t.position.copy(sc);lc.setFromMatrixPosition(e.target.matrixWorld);t.lookAt(lc);t.updateMatrixWorld();oc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);this._frustum.setFromProjectionMatrix(oc);a.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);a.multiply(t.projectionMatrix);a.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function getViewport(e){return this._viewports[e]}},{key:"getFrameExtents",value:function getFrameExtents(){return this._frameExtents}},{key:"dispose",value:function dispose(){if(this.map){this.map.dispose()}if(this.mapPass){this.mapPass.dispose()}}},{key:"copy",value:function copy(e){this.camera=e.camera.clone();this.bias=e.bias;this.radius=e.radius;this.mapSize.copy(e.mapSize);return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"toJSON",value:function toJSON(){var e={};if(0!==this.bias)e.bias=this.bias;if(0!==this.normalBias)e.normalBias=this.normalBias;if(1!==this.radius)e.radius=this.radius;if(512!==this.mapSize.x||512!==this.mapSize.y)e.mapSize=this.mapSize.toArray();e.camera=this.camera.toJSON(!1).object;delete e.camera.matrix;return e}}]);return e}(),uc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck(this,t);e=a.call(this,new vl(50,1,.5,500));e.focus=1;return e}_createClass(t,[{key:"updateMatrices",value:function updateMatrices(e){var a=this.camera,r=2*Yn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=e.distance||a.far;if(90!==a.fov||1!==a.aspect||n!==a.far){a.fov=90;a.aspect=1;a.far=n;a.updateProjectionMatrix()}_get(_getPrototypeOf(t.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.focus=e.focus;return this}}]);return t}(dc);uc.prototype.isSpotLightShadow=!0;var pc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:Math.PI/3,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:1;_classCallCheck(this,t);i=a.call(this,e,r);i.type="SpotLight";i.position.copy(gs.DefaultUp);i.updateMatrix();i.target=new gs;i.distance=n;i.angle=o;i.penumbra=s;i.decay=l;i.shadow=new uc;return i}_createClass(t,[{key:"dispose",value:function dispose(){this.shadow.dispose()}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.distance=e.distance;this.angle=e.angle;this.penumbra=e.penumbra;this.decay=e.decay;this.target=e.target.clone();this.shadow=e.shadow.clone();return this}},{key:"power",get:function get(){return this.intensity*Math.PI},set:function set(e){this.intensity=e/Math.PI}}]);return t}(ic);pc.prototype.isSpotLight=!0;var cc=new Vo,mc=new mo,gc=new mo,fc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck(this,t);e=a.call(this,new vl(90,1,.5,500));e._frameExtents=new Jn(4,2);e._viewportCount=6;e._viewports=[new so(2,1,1,1),new so(0,1,1,1),new so(3,1,1,1),new so(1,1,1,1),new so(3,0,1,1),new so(1,0,1,1)];e._cubeDirections=[new mo(1,0,0),new mo(-1,0,0),new mo(0,0,1),new mo(0,0,-1),new mo(0,1,0),new mo(0,-1,0)];e._cubeUps=[new mo(0,1,0),new mo(0,1,0),new mo(0,1,0),new mo(0,1,0),new mo(0,0,1),new mo(0,0,-1)];return e}_createClass(t,[{key:"updateMatrices",value:function updateMatrices(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.camera,r=this.matrix,i=e.distance||a.far;if(i!==a.far){a.far=i;a.updateProjectionMatrix()}mc.setFromMatrixPosition(e.matrixWorld);a.position.copy(mc);gc.copy(a.position);gc.add(this._cubeDirections[t]);a.up.copy(this._cubeUps[t]);a.lookAt(gc);a.updateMatrixWorld();r.makeTranslation(-mc.x,-mc.y,-mc.z);cc.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);this._frustum.setFromProjectionMatrix(cc)}}]);return t}(dc);fc.prototype.isPointLightShadow=!0;var hc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;_classCallCheck(this,t);i=a.call(this,e,r);i.type="PointLight";i.distance=n;i.decay=o;i.shadow=new fc;return i}_createClass(t,[{key:"dispose",value:function dispose(){this.shadow.dispose()}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.distance=e.distance;this.decay=e.decay;this.shadow=e.shadow.clone();return this}},{key:"power",get:function get(){return 4*this.intensity*Math.PI},set:function set(e){this.intensity=e/(4*Math.PI)}}]);return t}(ic);hc.prototype.isPointLight=!0;var yc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){_classCallCheck(this,t);return a.call(this,new Il(-5,5,5,-5,.5,500))}return t}(dc);yc.prototype.isDirectionalLightShadow=!0;var vc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck(this,t);i=a.call(this,e,r);i.type="DirectionalLight";i.position.copy(gs.DefaultUp);i.updateMatrix();i.target=new gs;i.shadow=new yc;return i}_createClass(t,[{key:"dispose",value:function dispose(){this.shadow.dispose()}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.target=e.target.clone();this.shadow=e.shadow.clone();return this}}]);return t}(ic);vc.prototype.isDirectionalLight=!0;var _c=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck(this,t);i=a.call(this,e,r);i.type="AmbientLight";return i}return t}(ic);_c.prototype.isAmbientLight=!0;var xc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:10,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:10;_classCallCheck(this,t);i=a.call(this,e,r);i.type="RectAreaLight";i.width=n;i.height=o;return i}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.width=e.width;this.height=e.height;return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.width=this.width;a.object.height=this.height;return a}},{key:"power",get:function get(){return this.intensity*this.width*this.height*Math.PI},set:function set(e){this.intensity=e/(this.width*this.height*Math.PI)}}]);return t}(ic);xc.prototype.isRectAreaLight=!0;var bc=function(){function e(){_classCallCheck(this,e);this.coefficients=[];for(var t=0;9>t;t++){this.coefficients.push(new mo)}}_createClass(e,[{key:"set",value:function set(e){for(var t=0;9>t;t++){this.coefficients[t].copy(e[t])}return this}},{key:"zero",value:function zero(){for(var e=0;9>e;e++){this.coefficients[e].set(0,0,0)}return this}},{key:"getAt",value:function getAt(e,t){var a=e.x,r=e.y,i=e.z,n=this.coefficients;t.copy(n[0]).multiplyScalar(.282095);t.addScaledVector(n[1],.488603*r);t.addScaledVector(n[2],.488603*i);t.addScaledVector(n[3],.488603*a);t.addScaledVector(n[4],1.092548*(a*r));t.addScaledVector(n[5],1.092548*(r*i));t.addScaledVector(n[6],.315392*(3*i*i-1));t.addScaledVector(n[7],1.092548*(a*i));t.addScaledVector(n[8],.546274*(a*a-r*r));return t}},{key:"getIrradianceAt",value:function getIrradianceAt(e,t){var a=e.x,r=e.y,i=e.z,n=this.coefficients;t.copy(n[0]).multiplyScalar(.886227);t.addScaledVector(n[1],.511664*2*r);t.addScaledVector(n[2],.511664*2*i);t.addScaledVector(n[3],.511664*2*a);t.addScaledVector(n[4],.429043*2*a*r);t.addScaledVector(n[5],.429043*2*r*i);t.addScaledVector(n[6],.743125*i*i-.247708);t.addScaledVector(n[7],.429043*2*a*i);t.addScaledVector(n[8],.429043*(a*a-r*r));return t}},{key:"add",value:function add(e){for(var t=0;9>t;t++){this.coefficients[t].add(e.coefficients[t])}return this}},{key:"addScaledSH",value:function addScaledSH(e,t){for(var a=0;9>a;a++){this.coefficients[a].addScaledVector(e.coefficients[a],t)}return this}},{key:"scale",value:function scale(e){for(var t=0;9>t;t++){this.coefficients[t].multiplyScalar(e)}return this}},{key:"lerp",value:function(e,t){for(var a=0;9>a;a++){this.coefficients[a].lerp(e.coefficients[a],t)}return this}},{key:"equals",value:function(e){for(var t=0;9>t;t++){if(!this.coefficients[t].equals(e.coefficients[t])){return!1}}return!0}},{key:"copy",value:function copy(e){return this.set(e.coefficients)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"fromArray",value:function fromArray(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.coefficients,r=0;9>r;r++){a[r].fromArray(e,t+3*r)}return this}},{key:"toArray",value:function toArray(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=this.coefficients,r=0;9>r;r++){a[r].toArray(e,t+3*r)}return e}}],[{key:"getBasisAt",value:function getBasisAt(e,t){var a=e.x,r=e.y,i=e.z;t[0]=.282095;t[1]=.488603*r;t[2]=.488603*i;t[3]=.488603*a;t[4]=1.092548*a*r;t[5]=1.092548*r*i;t[6]=.315392*(3*i*i-1);t[7]=1.092548*a*i;t[8]=.546274*(a*a-r*r)}}]);return e}();bc.prototype.isSphericalHarmonics3=!0;var Ec=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new bc,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck(this,t);e=a.call(this,void 0,i);e.sh=r;return e}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.sh.copy(e.sh);return this}},{key:"fromJSON",value:function fromJSON(e){this.intensity=e.intensity;this.sh.fromArray(e.sh);return this}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.object.sh=this.sh.toArray();return a}}]);return t}(ic);Ec.prototype.isLightProbe=!0;var Sc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this,e);r.textures={};return r}_createClass(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new Kp(n.manager);o.setPath(n.path);o.setRequestHeader(n.requestHeader);o.setWithCredentials(n.withCredentials);o.load(t,function(e){try{a(n.parse(JSON.parse(e)))}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}},{key:"parse",value:function parse(e){var a=this.textures;function t(e){if(a[e]===void 0){console.warn("THREE.MaterialLoader: Undefined texture",e)}return a[e]}var r=new kp[e.type];if(e.uuid!==void 0)r.uuid=e.uuid;if(e.name!==void 0)r.name=e.name;if(e.color!==void 0&&r.color!==void 0)r.color.setHex(e.color);if(e.roughness!==void 0)r.roughness=e.roughness;if(e.metalness!==void 0)r.metalness=e.metalness;if(e.sheen!==void 0)r.sheen=e.sheen;if(e.sheenColor!==void 0)r.sheenColor=new ao().setHex(e.sheenColor);if(e.sheenRoughness!==void 0)r.sheenRoughness=e.sheenRoughness;if(e.emissive!==void 0&&r.emissive!==void 0)r.emissive.setHex(e.emissive);if(e.specular!==void 0&&r.specular!==void 0)r.specular.setHex(e.specular);if(e.specularIntensity!==void 0)r.specularIntensity=e.specularIntensity;if(e.specularColor!==void 0&&r.specularColor!==void 0)r.specularColor.setHex(e.specularColor);if(e.shininess!==void 0)r.shininess=e.shininess;if(e.clearcoat!==void 0)r.clearcoat=e.clearcoat;if(e.clearcoatRoughness!==void 0)r.clearcoatRoughness=e.clearcoatRoughness;if(e.transmission!==void 0)r.transmission=e.transmission;if(e.thickness!==void 0)r.thickness=e.thickness;if(e.attenuationDistance!==void 0)r.attenuationDistance=e.attenuationDistance;if(e.attenuationColor!==void 0&&r.attenuationColor!==void 0)r.attenuationColor.setHex(e.attenuationColor);if(e.fog!==void 0)r.fog=e.fog;if(e.flatShading!==void 0)r.flatShading=e.flatShading;if(e.blending!==void 0)r.blending=e.blending;if(e.combine!==void 0)r.combine=e.combine;if(e.side!==void 0)r.side=e.side;if(e.shadowSide!==void 0)r.shadowSide=e.shadowSide;if(e.opacity!==void 0)r.opacity=e.opacity;if(e.transparent!==void 0)r.transparent=e.transparent;if(e.alphaTest!==void 0)r.alphaTest=e.alphaTest;if(e.depthTest!==void 0)r.depthTest=e.depthTest;if(e.depthWrite!==void 0)r.depthWrite=e.depthWrite;if(e.colorWrite!==void 0)r.colorWrite=e.colorWrite;if(e.stencilWrite!==void 0)r.stencilWrite=e.stencilWrite;if(e.stencilWriteMask!==void 0)r.stencilWriteMask=e.stencilWriteMask;if(e.stencilFunc!==void 0)r.stencilFunc=e.stencilFunc;if(e.stencilRef!==void 0)r.stencilRef=e.stencilRef;if(e.stencilFuncMask!==void 0)r.stencilFuncMask=e.stencilFuncMask;if(e.stencilFail!==void 0)r.stencilFail=e.stencilFail;if(e.stencilZFail!==void 0)r.stencilZFail=e.stencilZFail;if(e.stencilZPass!==void 0)r.stencilZPass=e.stencilZPass;if(e.wireframe!==void 0)r.wireframe=e.wireframe;if(e.wireframeLinewidth!==void 0)r.wireframeLinewidth=e.wireframeLinewidth;if(e.wireframeLinecap!==void 0)r.wireframeLinecap=e.wireframeLinecap;if(e.wireframeLinejoin!==void 0)r.wireframeLinejoin=e.wireframeLinejoin;if(e.rotation!==void 0)r.rotation=e.rotation;if(1!==e.linewidth)r.linewidth=e.linewidth;if(e.dashSize!==void 0)r.dashSize=e.dashSize;if(e.gapSize!==void 0)r.gapSize=e.gapSize;if(e.scale!==void 0)r.scale=e.scale;if(e.polygonOffset!==void 0)r.polygonOffset=e.polygonOffset;if(e.polygonOffsetFactor!==void 0)r.polygonOffsetFactor=e.polygonOffsetFactor;if(e.polygonOffsetUnits!==void 0)r.polygonOffsetUnits=e.polygonOffsetUnits;if(e.dithering!==void 0)r.dithering=e.dithering;if(e.alphaToCoverage!==void 0)r.alphaToCoverage=e.alphaToCoverage;if(e.premultipliedAlpha!==void 0)r.premultipliedAlpha=e.premultipliedAlpha;if(e.visible!==void 0)r.visible=e.visible;if(e.toneMapped!==void 0)r.toneMapped=e.toneMapped;if(e.userData!==void 0)r.userData=e.userData;if(e.vertexColors!==void 0){if("number"==typeof e.vertexColors){r.vertexColors=0<e.vertexColors?!0:!1}else{r.vertexColors=e.vertexColors}}if(e.uniforms!==void 0){for(var i in e.uniforms){var n=e.uniforms[i];r.uniforms[i]={};switch(n.type){case"t":r.uniforms[i].value=t(n.value);break;case"c":r.uniforms[i].value=new ao().setHex(n.value);break;case"v2":r.uniforms[i].value=new Jn().fromArray(n.value);break;case"v3":r.uniforms[i].value=new mo().fromArray(n.value);break;case"v4":r.uniforms[i].value=new so().fromArray(n.value);break;case"m3":r.uniforms[i].value=new Kn().fromArray(n.value);break;case"m4":r.uniforms[i].value=new Vo().fromArray(n.value);break;default:r.uniforms[i].value=n.value;}}}if(e.defines!==void 0)r.defines=e.defines;if(e.vertexShader!==void 0)r.vertexShader=e.vertexShader;if(e.fragmentShader!==void 0)r.fragmentShader=e.fragmentShader;if(e.extensions!==void 0){for(var o in e.extensions){r.extensions[o]=e.extensions[o]}}if(e.shading!==void 0)r.flatShading=1===e.shading;if(e.size!==void 0)r.size=e.size;if(e.sizeAttenuation!==void 0)r.sizeAttenuation=e.sizeAttenuation;if(e.map!==void 0)r.map=t(e.map);if(e.matcap!==void 0)r.matcap=t(e.matcap);if(e.alphaMap!==void 0)r.alphaMap=t(e.alphaMap);if(e.bumpMap!==void 0)r.bumpMap=t(e.bumpMap);if(e.bumpScale!==void 0)r.bumpScale=e.bumpScale;if(e.normalMap!==void 0)r.normalMap=t(e.normalMap);if(e.normalMapType!==void 0)r.normalMapType=e.normalMapType;if(e.normalScale!==void 0){var s=e.normalScale;if(!1===Array.isArray(s)){s=[s,s]}r.normalScale=new Jn().fromArray(s)}if(e.displacementMap!==void 0)r.displacementMap=t(e.displacementMap);if(e.displacementScale!==void 0)r.displacementScale=e.displacementScale;if(e.displacementBias!==void 0)r.displacementBias=e.displacementBias;if(e.roughnessMap!==void 0)r.roughnessMap=t(e.roughnessMap);if(e.metalnessMap!==void 0)r.metalnessMap=t(e.metalnessMap);if(e.emissiveMap!==void 0)r.emissiveMap=t(e.emissiveMap);if(e.emissiveIntensity!==void 0)r.emissiveIntensity=e.emissiveIntensity;if(e.specularMap!==void 0)r.specularMap=t(e.specularMap);if(e.specularIntensityMap!==void 0)r.specularIntensityMap=t(e.specularIntensityMap);if(e.specularColorMap!==void 0)r.specularColorMap=t(e.specularColorMap);if(e.envMap!==void 0)r.envMap=t(e.envMap);if(e.envMapIntensity!==void 0)r.envMapIntensity=e.envMapIntensity;if(e.reflectivity!==void 0)r.reflectivity=e.reflectivity;if(e.refractionRatio!==void 0)r.refractionRatio=e.refractionRatio;if(e.lightMap!==void 0)r.lightMap=t(e.lightMap);if(e.lightMapIntensity!==void 0)r.lightMapIntensity=e.lightMapIntensity;if(e.aoMap!==void 0)r.aoMap=t(e.aoMap);if(e.aoMapIntensity!==void 0)r.aoMapIntensity=e.aoMapIntensity;if(e.gradientMap!==void 0)r.gradientMap=t(e.gradientMap);if(e.clearcoatMap!==void 0)r.clearcoatMap=t(e.clearcoatMap);if(e.clearcoatRoughnessMap!==void 0)r.clearcoatRoughnessMap=t(e.clearcoatRoughnessMap);if(e.clearcoatNormalMap!==void 0)r.clearcoatNormalMap=t(e.clearcoatNormalMap);if(e.clearcoatNormalScale!==void 0)r.clearcoatNormalScale=new Jn().fromArray(e.clearcoatNormalScale);if(e.transmissionMap!==void 0)r.transmissionMap=t(e.transmissionMap);if(e.thicknessMap!==void 0)r.thicknessMap=t(e.thicknessMap);if(e.sheenColorMap!==void 0)r.sheenColorMap=t(e.sheenColorMap);if(e.sheenRoughnessMap!==void 0)r.sheenRoughnessMap=t(e.sheenRoughnessMap);return r}},{key:"setTextures",value:function setTextures(e){this.textures=e;return this}}]);return t}(Zp),Tc=function(){function e(){_classCallCheck(this,e)}_createClass(e,null,[{key:"decodeText",value:function decodeText(e){if("undefined"!=typeof TextDecoder){return new TextDecoder().decode(e)}for(var t="",a=0,r=e.length;a<r;a++){t+=String.fromCharCode(e[a])}try{return decodeURIComponent(escape(t))}catch(a){return t}}},{key:"extractUrlBase",value:function extractUrlBase(e){var t=e.lastIndexOf("/");if(-1===t)return"./";return e.substr(0,t+1)}},{key:"resolveURL",value:function resolveURL(e,t){if("string"!=typeof e||""===e)return"";if(/^https?:\/\//i.test(t)&&/^\//.test(e)){t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")}if(/^(https?:)?\/\//i.test(e))return e;if(/^data:.*,.*$/i.test(e))return e;if(/^blob:.*$/i.test(e))return e;return t+e}}]);return e}(),Mc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck(this,t);e=a.call(this);e.type="InstancedBufferGeometry";e.instanceCount=1/0;return e}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.instanceCount=e.instanceCount;return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"toJSON",value:function toJSON(){var e=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,this);e.instanceCount=this.instanceCount;e.isInstancedBufferGeometry=!0;return e}}]);return t}(Zs);Mc.prototype.isInstancedBufferGeometry=!0;var Ac=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck(this,t);return a.call(this,e)}_createClass(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new Kp(n.manager);o.setPath(n.path);o.setRequestHeader(n.requestHeader);o.setWithCredentials(n.withCredentials);o.load(t,function(e){try{a(n.parse(JSON.parse(e)))}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}},{key:"parse",value:function parse(e){var r={},i={};function t(e,t){if(r[t]!==void 0)return r[t];var i=e.interleavedBuffers,n=i[t],o=a(e,n.buffer),s=p(n.type,o),l=new Ad(s,n.stride);l.uuid=n.uuid;r[t]=l;return l}function a(e,t){if(i[t]!==void 0)return i[t];var a=e.arrayBuffers,r=a[t],n=new Uint32Array(r).buffer;i[t]=n;return n}var o=e.isInstancedBufferGeometry?new Mc:new Zs,s=e.data.index;if(s!==void 0){var T=p(s.type,s.array);o.setIndex(new ks(T,1))}var l=e.data.attributes;for(var M in l){var d=l[M],u=void 0;if(d.isInterleavedBufferAttribute){var A=t(e.data,d.data);u=new wd(A,d.itemSize,d.offset,d.normalized)}else{var c=p(d.type,d.array),m=d.isInstancedBufferAttribute?iu:ks;u=new m(c,d.itemSize,d.normalized)}if(d.name!==void 0)u.name=d.name;if(d.usage!==void 0)u.setUsage(d.usage);if(d.updateRange!==void 0){u.updateRange.offset=d.updateRange.offset;u.updateRange.count=d.updateRange.count}o.setAttribute(M,u)}var g=e.data.morphAttributes;if(g){for(var R in g){for(var f=g[R],h=[],y=0,v=f.length;y<v;y++){var _=f[y],x=void 0;if(_.isInterleavedBufferAttribute){var w=t(e.data,_.data);x=new wd(w,_.itemSize,_.offset,_.normalized)}else{var L=p(_.type,_.array);x=new ks(L,_.itemSize,_.normalized)}if(_.name!==void 0)x.name=_.name;h.push(x)}o.morphAttributes[R]=h}}var b=e.data.morphTargetsRelative;if(b){o.morphTargetsRelative=!0}var E=e.data.groups||e.data.drawcalls||e.data.offsets;if(E!==void 0){for(var C=0,k=E.length,n;C!==k;++C){n=E[C];o.addGroup(n.start,n.count,n.materialIndex)}}var S=e.data.boundingSphere;if(S!==void 0){var P=new mo;if(S.center!==void 0){P.fromArray(S.center)}o.boundingSphere=new Do(P,S.radius)}if(e.name)o.name=e.name;if(e.userData)o.userData=e.userData;return o}}]);return t}(Zp),Rc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck(this,t);return a.call(this,e)}_createClass(t,[{key:"load",value:function load(e,t,a,r){var i=this,n=""===this.path?Tc.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;var o=new Kp(this.manager);o.setPath(this.path);o.setRequestHeader(this.requestHeader);o.setWithCredentials(this.withCredentials);o.load(e,function(a){var n=null;try{n=JSON.parse(a)}catch(t){if(r!==void 0)r(t);console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message);return}var o=n.metadata;if(o===void 0||o.type===void 0||"geometry"===o.type.toLowerCase()){console.error("THREE.ObjectLoader: Can't load "+e);return}i.parse(n,t)},a,r)}},{key:"loadAsync",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,a){var r,i,n,o,s,l;return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:r=this;i=""===this.path?Tc.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;n=new Kp(this.manager);n.setPath(this.path);n.setRequestHeader(this.requestHeader);n.setWithCredentials(this.withCredentials);e.next=9;return n.loadAsync(t,a);case 9:o=e.sent;s=JSON.parse(o);l=s.metadata;if(!(l===void 0||l.type===void 0||"geometry"===l.type.toLowerCase())){e.next=14;break}throw new Error("THREE.ObjectLoader: Can't load "+t);case 14:e.next=16;return r.parseAsync(s);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop();}}},e,this)}));return function loadAsync(){return e.apply(this,arguments)}}()},{key:"parse",value:function parse(e,t){var a=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),n=this.parseImages(e.images,function(){if(t!==void 0)t(l)}),o=this.parseTextures(e.textures,n),s=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,i,s,o,a),d=this.parseSkeletons(e.skeletons,l);this.bindSkeletons(l,d);if(t!==void 0){var u=!1;for(var p in n){if(n[p]instanceof HTMLImageElement){u=!0;break}}if(!1==u)t(l)}return l}},{key:"parseAsync",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var a,r,i,n,o,s,l,d;return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:a=this.parseAnimations(t.animations);r=this.parseShapes(t.shapes);i=this.parseGeometries(t.geometries,r);e.next=5;return this.parseImagesAsync(t.images);case 5:n=e.sent;o=this.parseTextures(t.textures,n);s=this.parseMaterials(t.materials,o);l=this.parseObject(t.object,i,s,o,a);d=this.parseSkeletons(t.skeletons,l);this.bindSkeletons(l,d);return e.abrupt("return",l);case 12:case"end":return e.stop();}}},e,this)}));return function parseAsync(){return e.apply(this,arguments)}}()},{key:"parseShapes",value:function parseShapes(e){var t={};if(e!==void 0){for(var a=0,r=e.length,i;a<r;a++){i=new np().fromJSON(e[a]);t[i.uuid]=i}}return t}},{key:"parseSkeletons",value:function parseSkeletons(e,t){var a={},r={};t.traverse(function(e){if(e.isBone)r[e.uuid]=e});if(e!==void 0){for(var i=0,n=e.length,o;i<n;i++){o=new ru().fromJSON(e[i],r);a[o.uuid]=o}}return a}},{key:"parseGeometries",value:function parseGeometries(e,t){var a={};if(e!==void 0){for(var r=new Ac,i=0,n=e.length;i<n;i++){var o=void 0,s=e[i];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(s);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:if(s.type in bp){o=bp[s.type].fromJSON(s,t)}else{console.warn("THREE.ObjectLoader: Unsupported geometry type \"".concat(s.type,"\""))}}o.uuid=s.uuid;if(s.name!==void 0)o.name=s.name;if(!0===o.isBufferGeometry&&s.userData!==void 0)o.userData=s.userData;a[s.uuid]=o}}return a}},{key:"parseMaterials",value:function parseMaterials(e,t){var a={},r={};if(e!==void 0){var s=new Sc;s.setTextures(t);for(var d=0,u=e.length,l;d<u;d++){l=e[d];if("MultiMaterial"===l.type){for(var i=[],n=0,o;n<l.materials.length;n++){o=l.materials[n];if(a[o.uuid]===void 0){a[o.uuid]=s.parse(o)}i.push(a[o.uuid])}r[l.uuid]=i}else{if(a[l.uuid]===void 0){a[l.uuid]=s.parse(l)}r[l.uuid]=a[l.uuid]}}}return r}},{key:"parseAnimations",value:function parseAnimations(e){var t={};if(e!==void 0){for(var i=0;i<e.length;i++){var a=e[i],r=jp.parse(a);t[r.uuid]=r}}return t}},{key:"parseImages",value:function parseImages(e,t){var i=this,n={},o;function a(e){i.manager.itemStart(e);return o.load(e,function(){i.manager.itemEnd(e)},void 0,function(){i.manager.itemError(e);i.manager.itemEnd(e)})}function r(e){if("string"==typeof e){var t=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t;return a(r)}else{if(e.data){return{data:p(e.type,e.data),width:e.width,height:e.height}}else{return null}}}if(e!==void 0&&0<e.length){var c=new qp(t);o=new ec(c);o.setCrossOrigin(this.crossOrigin);for(var m=0,g=e.length;m<g;m++){var s=e[m],l=s.url;if(Array.isArray(l)){n[s.uuid]=[];for(var f=0,h=l.length;f<h;f++){var d=l[f],u=r(d);if(null!==u){if(u instanceof HTMLImageElement){n[s.uuid].push(u)}else{n[s.uuid].push(new eu(u.data,u.width,u.height))}}}}else{var y=r(s.url);if(null!==y){n[s.uuid]=y}}}}return n}},{key:"parseImagesAsync",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var a,r,i,n,o,s,l,d,u,c,m,g,f,h;return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:o=function(){o=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:if(!("string"==typeof t)){e.next=8;break}r=t;n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:a.resourcePath+r;e.next=5;return i.loadAsync(n);case 5:return e.abrupt("return",e.sent);case 8:if(!t.data){e.next=12;break}return e.abrupt("return",{data:p(t.type,t.data),width:t.width,height:t.height});case 12:return e.abrupt("return",null);case 13:case"end":return e.stop();}}},e)}));return o.apply(this,arguments)};n=function(){return o.apply(this,arguments)};a=this;r={};if(!(t!==void 0&&0<t.length)){e.next=32;break}i=new ec(this.manager);i.setCrossOrigin(this.crossOrigin);s=0,l=t.length;case 8:if(!(s<l)){e.next=32;break}d=t[s];u=d.url;if(!Array.isArray(u)){e.next=25;break}r[d.uuid]=[];c=0,m=u.length;case 14:if(!(c<m)){e.next=23;break}g=u[c];e.next=18;return n(g);case 18:f=e.sent;if(null!==f){if(f instanceof HTMLImageElement){r[d.uuid].push(f)}else{r[d.uuid].push(new eu(f.data,f.width,f.height))}}case 20:c++;e.next=14;break;case 23:e.next=29;break;case 25:e.next=27;return n(d.url);case 27:h=e.sent;if(null!==h){r[d.uuid]=h}case 29:s++;e.next=8;break;case 32:return e.abrupt("return",r);case 33:case"end":return e.stop();}}},e,this)}));return function parseImagesAsync(){return e.apply(this,arguments)}}()},{key:"parseTextures",value:function parseTextures(e,t){function a(e,t){if("number"==typeof e)return e;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e);return t[e]}var r={};if(e!==void 0){for(var o=0,s=e.length,l;o<s;o++){l=e[o];if(l.image===void 0){console.warn("THREE.ObjectLoader: No \"image\" specified for",l.uuid)}if(t[l.image]===void 0){console.warn("THREE.ObjectLoader: Undefined image",l.image)}var i=void 0,n=t[l.image];if(Array.isArray(n)){i=new xl(n);if(6===n.length)i.needsUpdate=!0}else{if(n&&n.data){i=new eu(n.data,n.width,n.height)}else{i=new oo(n)}if(n)i.needsUpdate=!0}i.uuid=l.uuid;if(l.name!==void 0)i.name=l.name;if(l.mapping!==void 0)i.mapping=a(l.mapping,wc);if(l.offset!==void 0)i.offset.fromArray(l.offset);if(l.repeat!==void 0)i.repeat.fromArray(l.repeat);if(l.center!==void 0)i.center.fromArray(l.center);if(l.rotation!==void 0)i.rotation=l.rotation;if(l.wrap!==void 0){i.wrapS=a(l.wrap[0],Lc);i.wrapT=a(l.wrap[1],Lc)}if(l.format!==void 0)i.format=l.format;if(l.type!==void 0)i.type=l.type;if(l.encoding!==void 0)i.encoding=l.encoding;if(l.minFilter!==void 0)i.minFilter=a(l.minFilter,Cc);if(l.magFilter!==void 0)i.magFilter=a(l.magFilter,Cc);if(l.anisotropy!==void 0)i.anisotropy=l.anisotropy;if(l.flipY!==void 0)i.flipY=l.flipY;if(l.premultiplyAlpha!==void 0)i.premultiplyAlpha=l.premultiplyAlpha;if(l.unpackAlignment!==void 0)i.unpackAlignment=l.unpackAlignment;if(l.userData!==void 0)i.userData=l.userData;r[l.uuid]=i}}return r}},{key:"parseObject",value:function parseObject(e,t,a,r,i){var d;function n(e){if(t[e]===void 0){console.warn("THREE.ObjectLoader: Undefined geometry",e)}return t[e]}function o(e){if(e===void 0)return;if(Array.isArray(e)){for(var t=[],r=0,i=e.length,n;r<i;r++){n=e[r];if(a[n]===void 0){console.warn("THREE.ObjectLoader: Undefined material",n)}t.push(a[n])}return t}if(a[e]===void 0){console.warn("THREE.ObjectLoader: Undefined material",e)}return a[e]}function s(e){if(r[e]===void 0){console.warn("THREE.ObjectLoader: Undefined texture",e)}return r[e]}var u,p;switch(e.type){case"Scene":d=new Md;if(e.background!==void 0){if(Number.isInteger(e.background)){d.background=new ao(e.background)}else{d.background=s(e.background)}}if(e.environment!==void 0){d.environment=s(e.environment)}if(e.fog!==void 0){if("Fog"===e.fog.type){d.fog=new Td(e.fog.color,e.fog.near,e.fog.far)}else if("FogExp2"===e.fog.type){d.fog=new Sd(e.fog.color,e.fog.density)}}break;case"PerspectiveCamera":d=new vl(e.fov,e.aspect,e.near,e.far);if(e.focus!==void 0)d.focus=e.focus;if(e.zoom!==void 0)d.zoom=e.zoom;if(e.filmGauge!==void 0)d.filmGauge=e.filmGauge;if(e.filmOffset!==void 0)d.filmOffset=e.filmOffset;if(e.view!==void 0)d.view=Object.assign({},e.view);break;case"OrthographicCamera":d=new Il(e.left,e.right,e.top,e.bottom,e.near,e.far);if(e.zoom!==void 0)d.zoom=e.zoom;if(e.view!==void 0)d.view=Object.assign({},e.view);break;case"AmbientLight":d=new _c(e.color,e.intensity);break;case"DirectionalLight":d=new vc(e.color,e.intensity);break;case"PointLight":d=new hc(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":d=new xc(e.color,e.intensity,e.width,e.height);break;case"SpotLight":d=new pc(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":d=new nc(e.color,e.groundColor,e.intensity);break;case"LightProbe":d=new Ec().fromJSON(e);break;case"SkinnedMesh":u=n(e.geometry);p=o(e.material);d=new Qd(u,p);if(e.bindMode!==void 0)d.bindMode=e.bindMode;if(e.bindMatrix!==void 0)d.bindMatrix.fromArray(e.bindMatrix);if(e.skeleton!==void 0)d.skeleton=e.skeleton;break;case"Mesh":u=n(e.geometry);p=o(e.material);d=new ml(u,p);break;case"InstancedMesh":u=n(e.geometry);p=o(e.material);var c=e.count,m=e.instanceMatrix,g=e.instanceColor;d=new du(u,p,c);d.instanceMatrix=new iu(new Float32Array(m.array),16);if(g!==void 0)d.instanceColor=new iu(new Float32Array(g.array),g.itemSize);break;case"LOD":d=new Xd;break;case"Line":d=new hu(n(e.geometry),o(e.material));break;case"LineLoop":d=new xu(n(e.geometry),o(e.material));break;case"LineSegments":d=new _u(n(e.geometry),o(e.material));break;case"PointCloud":case"Points":d=new Au(n(e.geometry),o(e.material));break;case"Sprite":d=new Vd(o(e.material));break;case"Group":d=new yd;break;case"Bone":d=new $d;break;default:d=new gs;}d.uuid=e.uuid;if(e.name!==void 0)d.name=e.name;if(e.matrix!==void 0){d.matrix.fromArray(e.matrix);if(e.matrixAutoUpdate!==void 0)d.matrixAutoUpdate=e.matrixAutoUpdate;if(d.matrixAutoUpdate)d.matrix.decompose(d.position,d.quaternion,d.scale)}else{if(e.position!==void 0)d.position.fromArray(e.position);if(e.rotation!==void 0)d.rotation.fromArray(e.rotation);if(e.quaternion!==void 0)d.quaternion.fromArray(e.quaternion);if(e.scale!==void 0)d.scale.fromArray(e.scale)}if(e.castShadow!==void 0)d.castShadow=e.castShadow;if(e.receiveShadow!==void 0)d.receiveShadow=e.receiveShadow;if(e.shadow){if(e.shadow.bias!==void 0)d.shadow.bias=e.shadow.bias;if(e.shadow.normalBias!==void 0)d.shadow.normalBias=e.shadow.normalBias;if(e.shadow.radius!==void 0)d.shadow.radius=e.shadow.radius;if(e.shadow.mapSize!==void 0)d.shadow.mapSize.fromArray(e.shadow.mapSize);if(e.shadow.camera!==void 0)d.shadow.camera=this.parseObject(e.shadow.camera)}if(e.visible!==void 0)d.visible=e.visible;if(e.frustumCulled!==void 0)d.frustumCulled=e.frustumCulled;if(e.renderOrder!==void 0)d.renderOrder=e.renderOrder;if(e.userData!==void 0)d.userData=e.userData;if(e.layers!==void 0)d.layers.mask=e.layers;if(e.children!==void 0){for(var f=e.children,h=0;h<f.length;h++){d.add(this.parseObject(f[h],t,a,r,i))}}if(e.animations!==void 0){for(var y=e.animations,v=0,_;v<y.length;v++){_=y[v];d.animations.push(i[_])}}if("LOD"===e.type){if(e.autoUpdate!==void 0)d.autoUpdate=e.autoUpdate;for(var x=e.levels,b=0;b<x.length;b++){var E=x[b],S=d.getObjectByProperty("uuid",E.object);if(S!==void 0){d.addLevel(S,E.distance)}}}return d}},{key:"bindSkeletons",value:function bindSkeletons(e,t){if(0===Object.keys(t).length)return;e.traverse(function(e){if(!0===e.isSkinnedMesh&&e.skeleton!==void 0){var a=t[e.skeleton];if(a===void 0){console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton)}else{e.bind(a,e.bindMatrix)}}})}},{key:"setTexturePath",value:function setTexturePath(e){console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath().");return this.setResourcePath(e)}}]);return t}(Zp),wc={UVMapping:Ir,CubeReflectionMapping:Dr,CubeRefractionMapping:Nr,EquirectangularReflectionMapping:Ur,EquirectangularRefractionMapping:Fr,CubeUVReflectionMapping:Br,CubeUVRefractionMapping:Or},Lc={RepeatWrapping:zr,ClampToEdgeWrapping:Hr,MirroredRepeatWrapping:Gr},Cc={NearestFilter:Vr,NearestMipmapNearestFilter:Wr,NearestMipmapLinearFilter:Xr,LinearFilter:Yr,LinearMipmapNearestFilter:Zr,LinearMipmapLinearFilter:Kr},kc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this,e);if("undefined"==typeof createImageBitmap){console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.")}if("undefined"==typeof fetch){console.warn("THREE.ImageBitmapLoader: fetch() not supported.")}r.options={premultiplyAlpha:"none"};return r}_createClass(t,[{key:"setOptions",value:function setOptions(e){this.options=e;return this}},{key:"load",value:function load(t,a,r,i){if(t===void 0)t="";if(this.path!==void 0)t=this.path+t;t=this.manager.resolveURL(t);var n=this,o=Xp.get(t);if(o!==void 0){n.manager.itemStart(t);setTimeout(function(){if(a)a(o);n.manager.itemEnd(t)},0);return o}var s={credentials:"anonymous"===this.crossOrigin?"same-origin":"include",headers:this.requestHeader};fetch(t,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(e){Xp.add(t,e);if(a)a(e);n.manager.itemEnd(t)}).catch(function(a){if(i)i(a);n.manager.itemError(t);n.manager.itemEnd(t)});n.manager.itemStart(t)}}]);return t}(Zp);kc.prototype.isImageBitmapLoader=!0;var Pc,Ic={getContext:function getContext(){if(Pc===void 0){Pc=new(window.AudioContext||window.webkitAudioContext)}return Pc},setContext:function setContext(e){Pc=e}},Dc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){_classCallCheck(this,t);return a.call(this,e)}_createClass(t,[{key:"load",value:function load(t,a,r,i){var n=this,o=new Kp(this.manager);o.setResponseType("arraybuffer");o.setPath(this.path);o.setRequestHeader(this.requestHeader);o.setWithCredentials(this.withCredentials);o.load(t,function(e){try{var r=e.slice(0),o=Ic.getContext();o.decodeAudioData(r,function(e){a(e)})}catch(a){if(i){i(a)}else{console.error(a)}n.manager.itemError(t)}},r,i)}}]);return t}(Zp),Nc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;_classCallCheck(this,t);i=a.call(this,void 0,n);var o=new ao().set(e),s=new ao().set(r),l=new mo(o.r,o.g,o.b),d=new mo(s.r,s.g,s.b),u=Math.sqrt(Math.PI),p=u*Math.sqrt(.75);i.sh.coefficients[0].copy(l).add(d).multiplyScalar(u);i.sh.coefficients[1].copy(l).sub(d).multiplyScalar(p);return i}return t}(Ec);Nc.prototype.isHemisphereLightProbe=!0;var Uc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;_classCallCheck(this,t);r=a.call(this,void 0,i);var n=new ao().set(e);r.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI));return r}return t}(Ec);Uc.prototype.isAmbientLightProbe=!0;var Fc=new Vo,Bc=new Vo,Oc=new Vo,zc=function(){function e(){_classCallCheck(this,e);this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new vl;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new vl;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1;this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}_createClass(e,[{key:"update",value:function update(e){var t=this._cache,a=t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep;if(a){t.focus=e.focus;t.fov=e.fov;t.aspect=e.aspect*this.aspect;t.near=e.near;t.far=e.far;t.zoom=e.zoom;t.eyeSep=this.eyeSep;Oc.copy(e.projectionMatrix);var r=t.eyeSep/2,i=r*t.near/t.focus,n=t.near*Math.tan(.5*(qn*t.fov))/t.zoom,o,s;Bc.elements[12]=-r;Fc.elements[12]=r;o=-n*t.aspect+i;s=n*t.aspect+i;Oc.elements[0]=2*t.near/(s-o);Oc.elements[8]=(s+o)/(s-o);this.cameraL.projectionMatrix.copy(Oc);o=-n*t.aspect-i;s=n*t.aspect-i;Oc.elements[0]=2*t.near/(s-o);Oc.elements[8]=(s+o)/(s-o);this.cameraR.projectionMatrix.copy(Oc)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Bc);this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Fc)}}]);return e}(),Hc=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0;_classCallCheck(this,e);this.autoStart=t;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=!1}_createClass(e,[{key:"start",value:function start(){this.startTime=Ra();this.oldTime=this.startTime;this.elapsedTime=0;this.running=!0}},{key:"stop",value:function stop(){this.getElapsedTime();this.running=!1;this.autoStart=!1}},{key:"getElapsedTime",value:function getElapsedTime(){this.getDelta();return this.elapsedTime}},{key:"getDelta",value:function getDelta(){var e=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var t=Ra();e=(t-this.oldTime)/1e3;this.oldTime=t;this.elapsedTime+=e}return e}}]);return e}();function Ra(){return("undefined"==typeof performance?Date:performance).now()}var Gc=new mo,Vc=new co,Wc=new mo,jc=new mo,Xc=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e;_classCallCheck(this,t);e=a.call(this);e.type="AudioListener";e.context=Ic.getContext();e.gain=e.context.createGain();e.gain.connect(e.context.destination);e.filter=null;e.timeDelta=0;e._clock=new Hc;return e}_createClass(t,[{key:"getInput",value:function getInput(){return this.gain}},{key:"removeFilter",value:function removeFilter(){if(null!==this.filter){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination);this.gain.connect(this.context.destination);this.filter=null}return this}},{key:"getFilter",value:function getFilter(){return this.filter}},{key:"setFilter",value:function setFilter(e){if(null!==this.filter){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination)}else{this.gain.disconnect(this.context.destination)}this.filter=e;this.gain.connect(this.filter);this.filter.connect(this.context.destination);return this}},{key:"getMasterVolume",value:function getMasterVolume(){return this.gain.gain.value}},{key:"setMasterVolume",value:function setMasterVolume(e){this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01);return this}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e);var a=this.context.listener,r=this.up;this.timeDelta=this._clock.getDelta();this.matrixWorld.decompose(Gc,Vc,Wc);jc.set(0,0,-1).applyQuaternion(Vc);if(a.positionX){var i=this.context.currentTime+this.timeDelta;a.positionX.linearRampToValueAtTime(Gc.x,i);a.positionY.linearRampToValueAtTime(Gc.y,i);a.positionZ.linearRampToValueAtTime(Gc.z,i);a.forwardX.linearRampToValueAtTime(jc.x,i);a.forwardY.linearRampToValueAtTime(jc.y,i);a.forwardZ.linearRampToValueAtTime(jc.z,i);a.upX.linearRampToValueAtTime(r.x,i);a.upY.linearRampToValueAtTime(r.y,i);a.upZ.linearRampToValueAtTime(r.z,i)}else{a.setPosition(Gc.x,Gc.y,Gc.z);a.setOrientation(jc.x,jc.y,jc.z,r.x,r.y,r.z)}}}]);return t}(gs),qc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r.type="Audio";r.listener=e;r.context=e.context;r.gain=r.context.createGain();r.gain.connect(e.getInput());r.autoplay=!1;r.buffer=null;r.detune=0;r.loop=!1;r.loopStart=0;r.loopEnd=0;r.offset=0;r.duration=void 0;r.playbackRate=1;r.isPlaying=!1;r.hasPlaybackControl=!0;r.source=null;r.sourceType="empty";r._startedAt=0;r._progress=0;r._connected=!1;r.filters=[];return r}_createClass(t,[{key:"getOutput",value:function getOutput(){return this.gain}},{key:"setNodeSource",value:function setNodeSource(e){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=e;this.connect();return this}},{key:"setMediaElementSource",value:function setMediaElementSource(e){this.hasPlaybackControl=!1;this.sourceType="mediaNode";this.source=this.context.createMediaElementSource(e);this.connect();return this}},{key:"setMediaStreamSource",value:function setMediaStreamSource(e){this.hasPlaybackControl=!1;this.sourceType="mediaStreamNode";this.source=this.context.createMediaStreamSource(e);this.connect();return this}},{key:"setBuffer",value:function setBuffer(e){this.buffer=e;this.sourceType="buffer";if(this.autoplay)this.play();return this}},{key:"play",value:function play(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;if(!0===this.isPlaying){console.warn("THREE.Audio: Audio is already playing.");return}if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();t.buffer=this.buffer;t.loop=this.loop;t.loopStart=this.loopStart;t.loopEnd=this.loopEnd;t.onended=this.onEnded.bind(this);t.start(this._startedAt,this._progress+this.offset,this.duration);this.isPlaying=!0;this.source=t;this.setDetune(this.detune);this.setPlaybackRate(this.playbackRate);return this.connect()}},{key:"pause",value:function pause(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}if(!0===this.isPlaying){this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate;if(!0===this.loop){this._progress=this._progress%(this.duration||this.buffer.duration)}this.source.stop();this.source.onended=null;this.isPlaying=!1}return this}},{key:"stop",value:function stop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._progress=0;this.source.stop();this.source.onended=null;this.isPlaying=!1;return this}},{key:"connect",value:function connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++){this.filters[e-1].connect(this.filters[e])}this.filters[this.filters.length-1].connect(this.getOutput())}else{this.source.connect(this.getOutput())}this._connected=!0;return this}},{key:"disconnect",value:function disconnect(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++){this.filters[e-1].disconnect(this.filters[e])}this.filters[this.filters.length-1].disconnect(this.getOutput())}else{this.source.disconnect(this.getOutput())}this._connected=!1;return this}},{key:"getFilters",value:function getFilters(){return this.filters}},{key:"setFilters",value:function setFilters(e){if(!e)e=[];if(!0===this._connected){this.disconnect();this.filters=e.slice();this.connect()}else{this.filters=e.slice()}return this}},{key:"setDetune",value:function setDetune(e){this.detune=e;if(this.source.detune===void 0)return;if(!0===this.isPlaying){this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01)}return this}},{key:"getDetune",value:function getDetune(){return this.detune}},{key:"getFilter",value:function getFilter(){return this.getFilters()[0]}},{key:"setFilter",value:function setFilter(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function setPlaybackRate(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this.playbackRate=e;if(!0===this.isPlaying){this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01)}return this}},{key:"getPlaybackRate",value:function getPlaybackRate(){return this.playbackRate}},{key:"onEnded",value:function onEnded(){this.isPlaying=!1}},{key:"getLoop",value:function getLoop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return!1}return this.loop}},{key:"setLoop",value:function setLoop(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this.loop=e;if(!0===this.isPlaying){this.source.loop=this.loop}return this}},{key:"setLoopStart",value:function setLoopStart(e){this.loopStart=e;return this}},{key:"setLoopEnd",value:function setLoopEnd(e){this.loopEnd=e;return this}},{key:"getVolume",value:function getVolume(){return this.gain.gain.value}},{key:"setVolume",value:function setVolume(e){this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01);return this}}]);return t}(gs),Yc=new mo,Zc=new co,Jc=new mo,Kc=new mo,Qc=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this,e);r.panner=r.context.createPanner();r.panner.panningModel="HRTF";r.panner.connect(r.gain);return r}_createClass(t,[{key:"getOutput",value:function getOutput(){return this.panner}},{key:"getRefDistance",value:function getRefDistance(){return this.panner.refDistance}},{key:"setRefDistance",value:function setRefDistance(e){this.panner.refDistance=e;return this}},{key:"getRolloffFactor",value:function getRolloffFactor(){return this.panner.rolloffFactor}},{key:"setRolloffFactor",value:function setRolloffFactor(e){this.panner.rolloffFactor=e;return this}},{key:"getDistanceModel",value:function getDistanceModel(){return this.panner.distanceModel}},{key:"setDistanceModel",value:function setDistanceModel(e){this.panner.distanceModel=e;return this}},{key:"getMaxDistance",value:function getMaxDistance(){return this.panner.maxDistance}},{key:"setMaxDistance",value:function setMaxDistance(e){this.panner.maxDistance=e;return this}},{key:"setDirectionalCone",value:function setDirectionalCone(e,t,a){this.panner.coneInnerAngle=e;this.panner.coneOuterAngle=t;this.panner.coneOuterGain=a;return this}},{key:"updateMatrixWorld",value:function updateMatrixWorld(e){_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e);if(!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Yc,Zc,Jc);Kc.set(0,0,1).applyQuaternion(Zc);var a=this.panner;if(a.positionX){var r=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(Yc.x,r);a.positionY.linearRampToValueAtTime(Yc.y,r);a.positionZ.linearRampToValueAtTime(Yc.z,r);a.orientationX.linearRampToValueAtTime(Kc.x,r);a.orientationY.linearRampToValueAtTime(Kc.y,r);a.orientationZ.linearRampToValueAtTime(Kc.z,r)}else{a.setPosition(Yc.x,Yc.y,Yc.z);a.setOrientation(Kc.x,Kc.y,Kc.z)}}}]);return t}(qc),$c=function(){function e(t){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2048;_classCallCheck(this,e);this.analyser=t.context.createAnalyser();this.analyser.fftSize=a;this.data=new Uint8Array(this.analyser.frequencyBinCount);t.getOutput().connect(this.analyser)}_createClass(e,[{key:"getFrequencyData",value:function getFrequencyData(){this.analyser.getByteFrequencyData(this.data);return this.data}},{key:"getAverageFrequency",value:function getAverageFrequency(){for(var e=0,t=this.getFrequencyData(),a=0;a<t.length;a++){e+=t[a]}return e/t.length}}]);return e}(),em=function(){function e(t,a,r){_classCallCheck(this,e);this.binding=t;this.valueSize=r;var i,n,o;switch(a){case"quaternion":i=this._slerp;n=this._slerpAdditive;o=this._setAdditiveIdentityQuaternion;this.buffer=new Float64Array(6*r);this._workIndex=5;break;case"string":case"bool":i=this._select;n=this._select;o=this._setAdditiveIdentityOther;this.buffer=Array(5*r);break;default:i=this._lerp;n=this._lerpAdditive;o=this._setAdditiveIdentityNumeric;this.buffer=new Float64Array(5*r);}this._mixBufferRegion=i;this._mixBufferRegionAdditive=n;this._setIdentity=o;this._origIndex=3;this._addIndex=4;this.cumulativeWeight=0;this.cumulativeWeightAdditive=0;this.useCount=0;this.referenceCount=0}_createClass(e,[{key:"accumulate",value:function accumulate(e,t){var a=this.buffer,r=this.valueSize,i=e*r+r,n=this.cumulativeWeight;if(0===n){for(var o=0;o!==r;++o){a[i+o]=a[o]}n=t}else{n+=t;var s=t/n;this._mixBufferRegion(a,i,0,s,r)}this.cumulativeWeight=n}},{key:"accumulateAdditive",value:function accumulateAdditive(e){var t=this.buffer,a=this.valueSize,r=a*this._addIndex;if(0===this.cumulativeWeightAdditive){this._setIdentity()}this._mixBufferRegionAdditive(t,r,0,e,a);this.cumulativeWeightAdditive+=e}},{key:"apply",value:function apply(e){var t=this.valueSize,a=this.buffer,r=e*t+t,i=this.cumulativeWeight,n=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0;this.cumulativeWeightAdditive=0;if(1>i){var s=t*this._origIndex;this._mixBufferRegion(a,r,s,1-i,t)}if(0<n){this._mixBufferRegionAdditive(a,r,this._addIndex*t,1,t)}for(var l=t;l!==t+t;++l){if(a[l]!==a[l+t]){o.setValue(a,r);break}}}},{key:"saveOriginalState",value:function saveOriginalState(){var e=this.binding,t=this.buffer,a=this.valueSize,r=a*this._origIndex;e.getValue(t,r);for(var i=a;i!==r;++i){t[i]=t[r+i%a]}this._setIdentity();this.cumulativeWeight=0;this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function restoreOriginalState(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function _setAdditiveIdentityNumeric(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,a=e;a<t;a++){this.buffer[a]=0}}},{key:"_setAdditiveIdentityQuaternion",value:function _setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric();this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function _setAdditiveIdentityOther(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,a=0;a<this.valueSize;a++){this.buffer[t+a]=this.buffer[e+a]}}},{key:"_select",value:function _select(e,a,r,i,t){if(.5<=i){for(var n=0;n!==t;++n){e[a+n]=e[r+n]}}}},{key:"_slerp",value:function _slerp(e,a,r,i){co.slerpFlat(e,a,e,a,e,r,i)}},{key:"_slerpAdditive",value:function _slerpAdditive(e,a,r,i,t){var n=this._workIndex*t;co.multiplyQuaternionsFlat(e,n,e,a,e,r);co.slerpFlat(e,a,e,a,e,n,i)}},{key:"_lerp",value:function _lerp(e,a,r,i,t){for(var n=0,o;n!==t;++n){o=a+n;e[o]=e[o]*(1-i)+e[r+n]*i}}},{key:"_lerpAdditive",value:function _lerpAdditive(e,a,r,i,t){for(var n=0,o;n!==t;++n){o=a+n;e[o]=e[o]+e[r+n]*i}}}]);return e}(),tm="\\[\\]\\.:\\/",am=new RegExp("["+tm+"]","g"),rm="[^"+tm+"]",im="[^"+tm.replace("\\.","")+"]",nm=/((?:WC+[\/:])*)/.source.replace("WC",rm),om=/(WCOD+)?/.source.replace("WCOD",im),sm=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",rm),lm=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",rm),dm=new RegExp("^"+nm+om+sm+lm+"$"),um=["material","materials","bones"],pm=function(){function e(t,a,r){_classCallCheck(this,e);var i=r||cm.parseTrackName(a);this._targetGroup=t;this._bindings=t.subscribe_(a,i)}_createClass(e,[{key:"getValue",value:function getValue(e,t){this.bind();var a=this._targetGroup.nCachedObjects_,r=this._bindings[a];if(r!==void 0)r.getValue(e,t)}},{key:"setValue",value:function setValue(e,t){for(var a=this._bindings,r=this._targetGroup.nCachedObjects_,i=a.length;r!==i;++r){a[r].setValue(e,t)}}},{key:"bind",value:function bind(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,a=e.length;t!==a;++t){e[t].bind()}}},{key:"unbind",value:function unbind(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,a=e.length;t!==a;++t){e[t].unbind()}}}]);return e}(),cm=function(){function e(t,a,r){_classCallCheck(this,e);this.path=a;this.parsedPath=r||e.parseTrackName(a);this.node=e.findNode(t,this.parsedPath.nodeName)||t;this.rootNode=t;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}_createClass(e,[{key:"_getValue_unavailable",value:function _getValue_unavailable(){}},{key:"_setValue_unavailable",value:function _setValue_unavailable(){}},{key:"_getValue_direct",value:function _getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function _getValue_array(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){e[t++]=a[r]}}},{key:"_getValue_arrayElement",value:function _getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function _getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function _setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function _setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t];this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function _setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function _setValue_array(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){a[r]=e[t++]}}},{key:"_setValue_array_setNeedsUpdate",value:function _setValue_array_setNeedsUpdate(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){a[r]=e[t++]}this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function _setValue_array_setMatrixWorldNeedsUpdate(e,t){for(var a=this.resolvedProperty,r=0,i=a.length;r!==i;++r){a[r]=e[t++]}this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function _setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function _setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t];this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function _setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function _setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function _setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t);this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function _setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t);this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function _getValue_unbound(e,t){this.bind();this.getValue(e,t)}},{key:"_setValue_unbound",value:function _setValue_unbound(e,t){this.bind();this.setValue(e,t)}},{key:"bind",value:function bind(){var t=this.node,a=this.parsedPath,r=a.objectName,i=a.propertyName,n=a.propertyIndex;if(!t){t=e.findNode(this.rootNode,a.nodeName)||this.rootNode;this.node=t}this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){var d=a.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(var u=0;u<t.length;u++){if(t[u].name===d){d=u;break}}break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r];}if(d!==void 0){if(t[d]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[d]}}var o=t[i];if(o===void 0){var p=a.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+p+"."+i+" but it wasn't found.",t);return}var s=this.Versioning.None;this.targetObject=t;if(t.needsUpdate!==void 0){s=this.Versioning.NeedsUpdate}else if(t.matrixWorldNeedsUpdate!==void 0){s=this.Versioning.MatrixWorldNeedsUpdate}var l=this.BindingType.Direct;if(n!==void 0){if("morphTargetInfluences"===i){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}if(t.morphTargetDictionary[n]!==void 0){n=t.morphTargetDictionary[n]}}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement;this.resolvedProperty=o;this.propertyIndex=n}else if(o.fromArray!==void 0&&o.toArray!==void 0){l=this.BindingType.HasFromToArray;this.resolvedProperty=o}else if(Array.isArray(o)){l=this.BindingType.EntireArray;this.resolvedProperty=o}else{this.propertyName=i}this.getValue=this.GetterByBindingType[l];this.setValue=this.SetterByBindingTypeAndVersioning[l][s]}},{key:"unbind",value:function unbind(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}}],[{key:"create",value:function create(t,a,r){if(!(t&&t.isAnimationObjectGroup)){return new e(t,a,r)}else{return new e.Composite(t,a,r)}}},{key:"sanitizeNodeName",value:function sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(am,"")}},{key:"parseTrackName",value:function parseTrackName(e){var t=dm.exec(e);if(!t){throw new Error("PropertyBinding: Cannot parse trackName: "+e)}var a={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=a.nodeName&&a.nodeName.lastIndexOf(".");if(r!==void 0&&-1!==r){var i=a.nodeName.substring(r+1);if(-1!==um.indexOf(i)){a.nodeName=a.nodeName.substring(0,r);a.objectName=i}}if(null===a.propertyName||0===a.propertyName.length){throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e)}return a}},{key:"findNode",value:function findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid){return e}if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(i!==void 0){return i}}if(e.children){var a=function(e){for(var r=0,i;r<e.length;r++){i=e[r];if(i.name===t||i.uuid===t){return i}var n=a(i.children);if(n)return n}return null},r=a(e.children);if(r){return r}}return null}}]);return e}();cm.Composite=pm;cm.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};cm.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};cm.prototype.GetterByBindingType=[cm.prototype._getValue_direct,cm.prototype._getValue_array,cm.prototype._getValue_arrayElement,cm.prototype._getValue_toArray];cm.prototype.SetterByBindingTypeAndVersioning=[[cm.prototype._setValue_direct,cm.prototype._setValue_direct_setNeedsUpdate,cm.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[cm.prototype._setValue_array,cm.prototype._setValue_array_setNeedsUpdate,cm.prototype._setValue_array_setMatrixWorldNeedsUpdate],[cm.prototype._setValue_arrayElement,cm.prototype._setValue_arrayElement_setNeedsUpdate,cm.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[cm.prototype._setValue_fromArray,cm.prototype._setValue_fromArray_setNeedsUpdate,cm.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var mm=function(){function e(){_classCallCheck(this,e);this.uuid=t();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var a={};this._indicesByUUID=a;for(var i=0,o=arguments.length;i!==o;++i){a[arguments[i].uuid]=i}this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}_createClass(e,[{key:"add",value:function add(){for(var e=this._objects,t=this._indicesByUUID,a=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length,s=void 0,l=e.length,d=this.nCachedObjects_,u=0,p=arguments.length;u!==p;++u){var n=arguments[u],c=n.uuid,m=t[c];if(m===void 0){m=l++;t[c]=m;e.push(n);for(var y=0;y!==o;++y){i[y].push(new cm(n,a[y],r[y]))}}else if(m<d){s=e[m];var v=--d,_=e[v];t[_.uuid]=m;e[m]=_;t[c]=v;e[v]=n;for(var x=0;x!==o;++x){var g=i[x],f=g[v],h=g[m];g[m]=f;if(h===void 0){h=new cm(n,a[x],r[x])}g[v]=h}}else if(e[m]!==s){console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}}this.nCachedObjects_=d}},{key:"remove",value:function remove(){for(var e=this._objects,t=this._indicesByUUID,a=this._bindings,r=a.length,i=this.nCachedObjects_,o=0,s=arguments.length;o!==s;++o){var n=arguments[o],l=n.uuid,d=t[l];if(d!==void 0&&d>=i){var u=i++,p=e[u];t[p.uuid]=d;e[d]=p;t[l]=u;e[u]=n;for(var c=0;c!==r;++c){var m=a[c],g=m[u],f=m[d];m[d]=g;m[u]=f}}}this.nCachedObjects_=i}},{key:"uncache",value:function uncache(){for(var e=this._objects,t=this._indicesByUUID,a=this._bindings,r=a.length,i=this.nCachedObjects_,o=e.length,s=0,l=arguments.length;s!==l;++s){var n=arguments[s],d=n.uuid,u=t[d];if(u!==void 0){delete t[d];if(u<i){var p=--i,c=e[p],m=--o,g=e[m];t[c.uuid]=u;e[u]=c;t[g.uuid]=p;e[p]=g;e.pop();for(var f=0;f!==r;++f){var h=a[f],y=h[p],v=h[m];h[u]=y;h[p]=v;h.pop()}}else{var _=--o,x=e[_];if(0<_){t[x.uuid]=u}e[u]=x;e.pop();for(var b=0,E;b!==r;++b){E=a[b];E[u]=E[_];E.pop()}}}}this.nCachedObjects_=i}},{key:"subscribe_",value:function subscribe_(e,t){var a=this._bindingsIndicesByPath,r=a[e],i=this._bindings;if(r!==void 0)return i[r];var o=this._paths,s=this._parsedPaths,l=this._objects,d=l.length,u=this.nCachedObjects_,p=Array(d);r=i.length;a[e]=r;o.push(e);s.push(t);i.push(p);for(var c=u,m=l.length,n;c!==m;++c){n=l[c];p[c]=new cm(n,e,t)}return p}},{key:"unsubscribe_",value:function unsubscribe_(e){var t=this._bindingsIndicesByPath,a=t[e];if(a!==void 0){var r=this._paths,i=this._parsedPaths,n=this._bindings,o=n.length-1,s=n[o],l=e[o];t[l]=a;n[a]=s;n.pop();i[a]=i[o];i.pop();r[a]=r[o];r.pop()}}}]);return e}();mm.prototype.isAnimationObjectGroup=!0;var gm=function(){function e(t,a){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:a.blendMode;_classCallCheck(this,e);this._mixer=t;this._clip=a;this._localRoot=r;this.blendMode=i;for(var n=a.tracks,o=n.length,s=Array(o),l={endingStart:en,endingEnd:en},d=0,u;d!==o;++d){u=n[d].createInterpolant(null);s[d]=u;u.settings=l}this._interpolantSettings=l;this._interpolants=s;this._propertyBindings=Array(o);this._cacheIndex=null;this._byClipCacheIndex=null;this._timeScaleInterpolant=null;this._weightInterpolant=null;this.loop=Zi;this._loopCount=-1;this._startTime=null;this.time=0;this.timeScale=1;this._effectiveTimeScale=1;this.weight=1;this._effectiveWeight=1;this.repetitions=1/0;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtStart=!0;this.zeroSlopeAtEnd=!0}_createClass(e,[{key:"play",value:function play(){this._mixer._activateAction(this);return this}},{key:"stop",value:function stop(){this._mixer._deactivateAction(this);return this.reset()}},{key:"reset",value:function reset(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()}},{key:"isRunning",value:function isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function isScheduled(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function startAt(e){this._startTime=e;return this}},{key:"setLoop",value:function setLoop(e,t){this.loop=e;this.repetitions=t;return this}},{key:"setEffectiveWeight",value:function setEffectiveWeight(e){this.weight=e;this._effectiveWeight=this.enabled?e:0;return this.stopFading()}},{key:"getEffectiveWeight",value:function getEffectiveWeight(){return this._effectiveWeight}},{key:"fadeIn",value:function fadeIn(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function fadeOut(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function crossFadeFrom(e,t,a){e.fadeOut(t);this.fadeIn(t);if(a){var r=this._clip.duration,i=e._clip.duration;e.warp(1,i/r,t);this.warp(r/i,1,t)}return this}},{key:"crossFadeTo",value:function crossFadeTo(e,t,a){return e.crossFadeFrom(this,t,a)}},{key:"stopFading",value:function stopFading(){var e=this._weightInterpolant;if(null!==e){this._weightInterpolant=null;this._mixer._takeBackControlInterpolant(e)}return this}},{key:"setEffectiveTimeScale",value:function setEffectiveTimeScale(e){this.timeScale=e;this._effectiveTimeScale=this.paused?0:e;return this.stopWarping()}},{key:"getEffectiveTimeScale",value:function getEffectiveTimeScale(){return this._effectiveTimeScale}},{key:"setDuration",value:function setDuration(e){this.timeScale=this._clip.duration/e;return this.stopWarping()}},{key:"syncWith",value:function syncWith(e){this.time=e.time;this.timeScale=e.timeScale;return this.stopWarping()}},{key:"halt",value:function halt(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function warp(e,t,a){var r=this._mixer,i=r.time,n=this.timeScale,o=this._timeScaleInterpolant;if(null===o){o=r._lendControlInterpolant();this._timeScaleInterpolant=o}var s=o.parameterPositions,l=o.sampleValues;s[0]=i;s[1]=i+a;l[0]=e/n;l[1]=t/n;return this}},{key:"stopWarping",value:function stopWarping(){var e=this._timeScaleInterpolant;if(null!==e){this._timeScaleInterpolant=null;this._mixer._takeBackControlInterpolant(e)}return this}},{key:"getMixer",value:function getMixer(){return this._mixer}},{key:"getClip",value:function getClip(){return this._clip}},{key:"getRoot",value:function getRoot(){return this._localRoot||this._mixer._root}},{key:"_update",value:function _update(e,t,a,r){if(!this.enabled){this._updateWeight(e);return}var i=this._startTime;if(null!==i){var d=(e-i)*a;if(0>d||0===a){return}this._startTime=null;t=a*d}t*=this._updateTimeScale(e);var n=this._updateTime(t),o=this._updateWeight(e);if(0<o){var s=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case nn:for(var u=0,p=s.length;u!==p;++u){s[u].evaluate(n);l[u].accumulateAdditive(o)}break;case rn:default:for(var c=0,m=s.length;c!==m;++c){s[c].evaluate(n);l[c].accumulate(r,o)}}}}},{key:"_updateWeight",value:function _updateWeight(e){var t=0;if(this.enabled){t=this.weight;var a=this._weightInterpolant;if(null!==a){var r=a.evaluate(e)[0];t*=r;if(e>a.parameterPositions[1]){this.stopFading();if(0===r){this.enabled=!1}}}}this._effectiveWeight=t;return t}},{key:"_updateTimeScale",value:function _updateTimeScale(e){var t=0;if(!this.paused){t=this.timeScale;var a=this._timeScaleInterpolant;if(null!==a){var r=a.evaluate(e)[0];t*=r;if(e>a.parameterPositions[1]){this.stopWarping();if(0===t){this.paused=!0}else{this.timeScale=t}}}}this._effectiveTimeScale=t;return t}},{key:"_updateTime",value:function _updateTime(e){var t=this._clip.duration,a=this.loop,r=this.time+e,i=this._loopCount,n=a===Ji;if(0===e){if(-1===i)return r;return n&&1==(1&i)?t-r:r}if(a===Yi){if(-1===i){this._loopCount=0;this._setEndings(!0,!0,!1)}handle_stop:{if(r>=t){r=t}else if(0>r){r=0}else{this.time=r;break handle_stop}if(this.clampWhenFinished)this.paused=!0;else this.enabled=!1;this.time=r;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>e?-1:1})}}else{if(-1===i){if(0<=e){i=0;this._setEndings(!0,0===this.repetitions,n)}else{this._setEndings(0===this.repetitions,!0,n)}}if(r>=t||0>r){var o=Math.floor(r/t);r-=t*o;i+=Math.abs(o);var s=this.repetitions-i;if(0>=s){if(this.clampWhenFinished)this.paused=!0;else this.enabled=!1;r=0<e?t:0;this.time=r;this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})}else{if(1===s){var l=0>e;this._setEndings(l,!l,n)}else{this._setEndings(!1,!1,n)}this._loopCount=i;this.time=r;this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else{this.time=r}if(n&&1==(1&i)){return t-r}}return r}},{key:"_setEndings",value:function _setEndings(e,t,a){var r=this._interpolantSettings;if(a){r.endingStart=tn;r.endingEnd=tn}else{if(e){r.endingStart=this.zeroSlopeAtStart?tn:en}else{r.endingStart=an}if(t){r.endingEnd=this.zeroSlopeAtEnd?tn:en}else{r.endingEnd=an}}}},{key:"_scheduleFading",value:function _scheduleFading(e,t,a){var r=this._mixer,i=r.time,n=this._weightInterpolant;if(null===n){n=r._lendControlInterpolant();this._weightInterpolant=n}var o=n.parameterPositions,s=n.sampleValues;o[0]=i;s[0]=t;o[1]=i+e;s[1]=a;return this}}]);return e}(),fm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);r=a.call(this);r._root=e;r._initMemoryManager();r._accuIndex=0;r.time=0;r.timeScale=1;return r}_createClass(t,[{key:"_bindAction",value:function _bindAction(e,t){var a=e._localRoot||this._root,r=e._clip.tracks,i=r.length,n=e._propertyBindings,o=e._interpolants,s=a.uuid,l=this._bindingsByRootAndName,d=l[s];if(d===void 0){d={};l[s]=d}for(var m=0;m!==i;++m){var u=r[m],p=u.name,c=d[p];if(c!==void 0){++c.referenceCount;n[m]=c}else{c=n[m];if(c!==void 0){if(null===c._cacheIndex){++c.referenceCount;this._addInactiveBinding(c,s,p)}continue}var g=t&&t._propertyBindings[m].binding.parsedPath;c=new em(cm.create(a,p,g),u.ValueTypeName,u.getValueSize());++c.referenceCount;this._addInactiveBinding(c,s,p);n[m]=c}o[m].resultBuffer=c.buffer}}},{key:"_activateAction",value:function _activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var n=(e._localRoot||this._root).uuid,o=e._clip.uuid,s=this._actionsByClip[o];this._bindAction(e,s&&s.knownActions[0]);this._addInactiveAction(e,o,n)}for(var t=e._propertyBindings,a=0,r=t.length,i;a!==r;++a){i=t[a];if(0==i.useCount++){this._lendBinding(i);i.saveOriginalState()}}this._lendAction(e)}}},{key:"_deactivateAction",value:function _deactivateAction(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,a=0,r=t.length,i;a!==r;++a){i=t[a];if(0==--i.useCount){i.restoreOriginalState();this._takeBackBinding(i)}}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function _initMemoryManager(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function _isActiveAction(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function _addInactiveAction(e,t,a){var r=this._actions,i=this._actionsByClip,n=i[t];if(n===void 0){n={knownActions:[e],actionByRoot:{}};e._byClipCacheIndex=0;i[t]=n}else{var o=n.knownActions;e._byClipCacheIndex=o.length;o.push(e)}e._cacheIndex=r.length;r.push(e);n.actionByRoot[a]=e}},{key:"_removeInactiveAction",value:function _removeInactiveAction(e){var t=this._actions,a=t[t.length-1],r=e._cacheIndex;a._cacheIndex=r;t[r]=a;t.pop();e._cacheIndex=null;var i=e._clip.uuid,n=this._actionsByClip,o=n[i],s=o.knownActions,l=s[s.length-1],d=e._byClipCacheIndex;l._byClipCacheIndex=d;s[d]=l;s.pop();e._byClipCacheIndex=null;var u=o.actionByRoot,p=(e._localRoot||this._root).uuid;delete u[p];if(0===s.length){delete n[i]}this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function _removeInactiveBindingsForAction(e){for(var t=e._propertyBindings,a=0,r=t.length,i;a!==r;++a){i=t[a];if(0==--i.referenceCount){this._removeInactiveBinding(i)}}}},{key:"_lendAction",value:function _lendAction(e){var t=this._actions,a=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_takeBackAction",value:function _takeBackAction(e){var t=this._actions,a=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_addInactiveBinding",value:function _addInactiveBinding(e,t,a){var r=this._bindingsByRootAndName,i=this._bindings,n=r[t];if(n===void 0){n={};r[t]=n}n[a]=e;e._cacheIndex=i.length;i.push(e)}},{key:"_removeInactiveBinding",value:function _removeInactiveBinding(e){var t=this._bindings,a=e.binding,r=a.rootNode.uuid,i=a.path,n=this._bindingsByRootAndName,o=n[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l;t[l]=s;t.pop();delete o[i];if(0===Object.keys(o).length){delete n[r]}}},{key:"_lendBinding",value:function _lendBinding(e){var t=this._bindings,a=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_takeBackBinding",value:function _takeBackBinding(e){var t=this._bindings,a=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r;t[r]=e;i._cacheIndex=a;t[a]=i}},{key:"_lendControlInterpolant",value:function _lendControlInterpolant(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,a=e[t];if(a===void 0){a=new Np(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer);a.__cacheIndex=t;e[t]=a}return a}},{key:"_takeBackControlInterpolant",value:function _takeBackControlInterpolant(e){var t=this._controlInterpolants,a=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r;t[r]=e;i.__cacheIndex=a;t[a]=i}},{key:"clipAction",value:function clipAction(e,t,a){var r=t||this._root,i=r.uuid,n="string"==typeof e?jp.findByName(r,e):e,o=null!==n?n.uuid:e,s=this._actionsByClip[o],l=null;if(a===void 0){if(null!==n){a=n.blendMode}else{a=rn}}if(s!==void 0){var u=s.actionByRoot[i];if(u!==void 0&&u.blendMode===a){return u}l=s.knownActions[0];if(null===n)n=l._clip}if(null===n)return null;var d=new gm(this,n,t,a);this._bindAction(d,l);this._addInactiveAction(d,o,i);return d}},{key:"existingAction",value:function existingAction(e,t){var a=t||this._root,r=a.uuid,i="string"==typeof e?jp.findByName(a,e):e,n=i?i.uuid:e,o=this._actionsByClip[n];if(o!==void 0){return o.actionByRoot[r]||null}return null}},{key:"stopAllAction",value:function stopAllAction(){for(var e=this._actions,t=this._nActiveActions,a=t-1;0<=a;--a){e[a].stop()}return this}},{key:"update",value:function update(e){e*=this.timeScale;for(var t=this._actions,a=this._nActiveActions,r=this.time+=e,i=Math.sign(e),n=this._accuIndex^=1,o=0,s;o!==a;++o){s=t[o];s._update(r,e,i,n)}for(var l=this._bindings,d=this._nActiveBindings,u=0;u!==d;++u){l[u].apply(n)}return this}},{key:"setTime",value:function setTime(e){this.time=0;for(var t=0;t<this._actions.length;t++){this._actions[t].time=0}return this.update(e)}},{key:"getRoot",value:function getRoot(){return this._root}},{key:"uncacheClip",value:function uncacheClip(e){var t=this._actions,a=e.uuid,r=this._actionsByClip,i=r[a];if(i!==void 0){for(var o=i.knownActions,s=0,l=o.length,n;s!==l;++s){n=o[s];this._deactivateAction(n);var d=n._cacheIndex,u=t[t.length-1];n._cacheIndex=null;n._byClipCacheIndex=null;u._cacheIndex=d;t[d]=u;t.pop();this._removeInactiveBindingsForAction(n)}delete r[a]}}},{key:"uncacheRoot",value:function uncacheRoot(e){var t=e.uuid,a=this._actionsByClip;for(var n in a){var o=a[n].actionByRoot,s=o[t];if(s!==void 0){this._deactivateAction(s);this._removeInactiveAction(s)}}var r=this._bindingsByRootAndName,i=r[t];if(i!==void 0){for(var l in i){var d=i[l];d.restoreOriginalState();this._removeInactiveBinding(d)}}}},{key:"uncacheAction",value:function uncacheAction(e,t){var a=this.existingAction(e,t);if(null!==a){this._deactivateAction(a);this._removeInactiveAction(a)}}}]);return t}(Vn);fm.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var hm=function(){function e(t){_classCallCheck(this,e);if("string"==typeof t){console.warn("THREE.Uniform: Type parameter is no longer needed.");t=arguments[1]}this.value=t}_createClass(e,[{key:"clone",value:function clone(){return new e(this.value.clone===void 0?this.value:this.value.clone())}}]);return e}(),ym=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;_classCallCheck(this,t);i=a.call(this,e,r);i.meshPerAttribute=n;return i}_createClass(t,[{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this}},{key:"clone",value:function clone(e){var a=_get(_getPrototypeOf(t.prototype),"clone",this).call(this,e);a.meshPerAttribute=this.meshPerAttribute;return a}},{key:"toJSON",value:function toJSON(e){var a=_get(_getPrototypeOf(t.prototype),"toJSON",this).call(this,e);a.isInstancedInterleavedBuffer=!0;a.meshPerAttribute=this.meshPerAttribute;return a}}]);return t}(Ad);ym.prototype.isInstancedInterleavedBuffer=!0;var vm=function(){function e(t,a,r,i,n){_classCallCheck(this,e);this.buffer=t;this.type=a;this.itemSize=r;this.elementSize=i;this.count=n;this.version=0}_createClass(e,[{key:"setBuffer",value:function setBuffer(e){this.buffer=e;return this}},{key:"setType",value:function setType(e,t){this.type=e;this.elementSize=t;return this}},{key:"setItemSize",value:function setItemSize(e){this.itemSize=e;return this}},{key:"setCount",value:function setCount(e){this.count=e;return this}},{key:"needsUpdate",set:function set(e){if(!0===e)this.version++}}]);return e}();vm.prototype.isGLBufferAttribute=!0;var _m=function(){function e(t,a){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1/0;_classCallCheck(this,e);this.ray=new Go(t,a);this.near=r;this.far=i;this.camera=null;this.layers=new es;this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}_createClass(e,[{key:"set",value:function set(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function setFromCamera(e,t){if(t&&t.isPerspectiveCamera){this.ray.origin.setFromMatrixPosition(t.matrixWorld);this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize();this.camera=t}else if(t&&t.isOrthographicCamera){this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t);this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld);this.camera=t}else{console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}}},{key:"intersectObject",value:function intersectObject(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:[];La(e,this,a,t);a.sort(wa);return a}},{key:"intersectObjects",value:function intersectObjects(e){for(var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:[],r=0,i=e.length;r<i;r++){La(e[r],this,a,t)}a.sort(wa);return a}}]);return e}();function wa(e,t){return e.distance-t.distance}function La(e,t,a,r){if(e.layers.test(t.layers)){e.raycast(t,a)}if(!0===r){for(var i=e.children,n=0,o=i.length;n<o;n++){La(i[n],t,a,!0)}}}var xm=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;_classCallCheck(this,e);this.radius=t;this.phi=a;this.theta=r;return this}_createClass(e,[{key:"set",value:function set(e,t,a){this.radius=e;this.phi=t;this.theta=a;return this}},{key:"copy",value:function copy(e){this.radius=e.radius;this.phi=e.phi;this.theta=e.theta;return this}},{key:"makeSafe",value:function makeSafe(){var e=1e-6;this.phi=Math.max(e,Math.min(Math.PI-e,this.phi));return this}},{key:"setFromVector3",value:function setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function setFromCartesianCoords(e,t,r){this.radius=Math.sqrt(e*e+t*t+r*r);if(0===this.radius){this.theta=0;this.phi=0}else{this.theta=Math.atan2(e,r);this.phi=Math.acos(a(t/this.radius,-1,1))}return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),bm=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;_classCallCheck(this,e);this.radius=t;this.theta=a;this.y=r;return this}_createClass(e,[{key:"set",value:function set(e,t,a){this.radius=e;this.theta=t;this.y=a;return this}},{key:"copy",value:function copy(e){this.radius=e.radius;this.theta=e.theta;this.y=e.y;return this}},{key:"setFromVector3",value:function setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function setFromCartesianCoords(e,t,a){this.radius=Math.sqrt(e*e+a*a);this.theta=Math.atan2(e,a);this.y=t;return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),Em=new Jn,Sm=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new Jn(+Infinity,+Infinity),a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new Jn(-Infinity,-Infinity);_classCallCheck(this,e);this.min=t;this.max=a}_createClass(e,[{key:"set",value:function set(e,t){this.min.copy(e);this.max.copy(t);return this}},{key:"setFromPoints",value:function setFromPoints(e){this.makeEmpty();for(var t=0,a=e.length;t<a;t++){this.expandByPoint(e[t])}return this}},{key:"setFromCenterAndSize",value:function setFromCenterAndSize(e,t){var a=Em.copy(t).multiplyScalar(.5);this.min.copy(e).sub(a);this.max.copy(e).add(a);return this}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}},{key:"copy",value:function copy(e){this.min.copy(e.min);this.max.copy(e.max);return this}},{key:"makeEmpty",value:function makeEmpty(){this.min.x=this.min.y=+Infinity;this.max.x=this.max.y=-Infinity;return this}},{key:"isEmpty",value:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function expandByPoint(e){this.min.min(e);this.max.max(e);return this}},{key:"expandByVector",value:function expandByVector(e){this.min.sub(e);this.max.add(e);return this}},{key:"expandByScalar",value:function expandByScalar(e){this.min.addScalar(-e);this.max.addScalar(e);return this}},{key:"containsPoint",value:function containsPoint(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0}},{key:"containsBox",value:function containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function intersectsBox(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0}},{key:"clampPoint",value:function clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function distanceToPoint(e){var t=Em.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"intersect",value:function intersect(e){this.min.max(e.min);this.max.min(e.max);return this}},{key:"union",value:function union(e){this.min.min(e.min);this.max.max(e.max);return this}},{key:"translate",value:function translate(e){this.min.add(e);this.max.add(e);return this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]);return e}();Sm.prototype.isBox2=!0;var Tm=new mo,Mm=new mo,Am=function(){function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new mo,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo;_classCallCheck(this,e);this.start=t;this.end=a}_createClass(e,[{key:"set",value:function set(e,t){this.start.copy(e);this.end.copy(t);return this}},{key:"copy",value:function copy(e){this.start.copy(e.start);this.end.copy(e.end);return this}},{key:"getCenter",value:function getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function delta(e){return e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function distanceSq(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function distance(){return this.start.distanceTo(this.end)}},{key:"at",value:function at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function closestPointToPointParameter(e,r){Tm.subVectors(e,this.start);Mm.subVectors(this.end,this.start);var i=Mm.dot(Mm),n=Mm.dot(Tm),o=n/i;if(r){o=a(o,0,1)}return o}},{key:"closestPointToPoint",value:function closestPointToPoint(e,a,r){var i=this.closestPointToPointParameter(e,a);return this.delta(r).multiplyScalar(i).add(this.start)}},{key:"applyMatrix4",value:function applyMatrix4(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function clone(){return new this.constructor().copy(this)}}]);return e}(),Rm=new mo,wm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r){var i;_classCallCheck(this,t);i=a.call(this);i.light=e;i.light.updateMatrixWorld();i.matrix=e.matrixWorld;i.matrixAutoUpdate=!1;i.color=r;for(var n=new Zs,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],s=0,d=1,u=32;s<u;s++,d++){var l=2*(s/u*Math.PI),p=2*(d/u*Math.PI);o.push(Math.cos(l),Math.sin(l),1,Math.cos(p),Math.sin(p),1)}n.setAttribute("position",new zs(o,3));var c=new uu({fog:!1,toneMapped:!1});i.cone=new _u(n,c);i.add(i.cone);i.update();return i}_createClass(t,[{key:"dispose",value:function dispose(){this.cone.geometry.dispose();this.cone.material.dispose()}},{key:"update",value:function update(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e);Rm.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(Rm);if(this.color!==void 0){this.cone.material.color.set(this.color)}else{this.cone.material.color.copy(this.light.color)}}}]);return t}(gs),Lm=new mo,Cm=new Vo,km=new Vo,Pm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r;_classCallCheck(this,t);for(var i=Ca(e),n=new Zs,o=[],s=[],l=new ao(0,0,1),d=new ao(0,1,0),u=0,p;u<i.length;u++){p=i[u];if(p.parent&&p.parent.isBone){o.push(0,0,0);o.push(0,0,0);s.push(l.r,l.g,l.b);s.push(d.r,d.g,d.b)}}n.setAttribute("position",new zs(o,3));n.setAttribute("color",new zs(s,3));var c=new uu({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});r=a.call(this,n,c);r.type="SkeletonHelper";r.isSkeletonHelper=!0;r.root=e;r.bones=i;r.matrix=e.matrixWorld;r.matrixAutoUpdate=!1;return r}_createClass(t,[{key:"updateMatrixWorld",value:function updateMatrixWorld(e){var a=this.bones,r=this.geometry,i=r.getAttribute("position");km.copy(this.root.matrixWorld).invert();for(var n=0,o=0,s;n<a.length;n++){s=a[n];if(s.parent&&s.parent.isBone){Cm.multiplyMatrices(km,s.matrixWorld);Lm.setFromMatrixPosition(Cm);i.setXYZ(o,Lm.x,Lm.y,Lm.z);Cm.multiplyMatrices(km,s.parent.matrixWorld);Lm.setFromMatrixPosition(Cm);i.setXYZ(o+1,Lm.x,Lm.y,Lm.z);o+=2}}r.getAttribute("position").needsUpdate=!0;_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e)}}]);return t}(_u);function Ca(e){var t=[];if(e&&e.isBone){t.push(e)}for(var a=0;a<e.children.length;a++){t.push.apply(t,Ca(e.children[a]))}return t}var Im=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck(this,t);var o=new fp(r,4,2),s=new ws({wireframe:!0,fog:!1,toneMapped:!1});n=a.call(this,o,s);n.light=e;n.light.updateMatrixWorld();n.color=i;n.type="PointLightHelper";n.matrix=n.light.matrixWorld;n.matrixAutoUpdate=!1;n.update();return n}_createClass(t,[{key:"dispose",value:function dispose(){this.geometry.dispose();this.material.dispose()}},{key:"update",value:function update(){if(this.color!==void 0){this.material.color.set(this.color)}else{this.material.color.copy(this.light.color)}}}]);return t}(ml),Dm=new mo,Nm=new ao,Um=new ao,Fm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck(this,t);n=a.call(this);n.light=e;n.light.updateMatrixWorld();n.matrix=e.matrixWorld;n.matrixAutoUpdate=!1;n.color=i;var o=new cp(r);o.rotateY(.5*Math.PI);n.material=new ws({wireframe:!0,fog:!1,toneMapped:!1});if(n.color===void 0)n.material.vertexColors=!0;var s=o.getAttribute("position"),l=new Float32Array(3*s.count);o.setAttribute("color",new ks(l,3));n.add(new ml(o,n.material));n.update();return n}_createClass(t,[{key:"dispose",value:function dispose(){this.children[0].geometry.dispose();this.children[0].material.dispose()}},{key:"update",value:function update(){var e=this.children[0];if(this.color!==void 0){this.material.color.set(this.color)}else{var t=e.geometry.getAttribute("color");Nm.copy(this.light.color);Um.copy(this.light.groundColor);for(var a=0,r=t.count,i;a<r;a++){i=a<r/2?Nm:Um;t.setXYZ(a,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(Dm.setFromMatrixPosition(this.light.matrixWorld).negate())}}]);return t}(gs),Bm=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:10,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:10,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:4473924,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:8947848;_classCallCheck(this,t);n=new ao(n);o=new ao(o);for(var s=r/2,l=[],d=[],u=0,p=0,c=-s;u<=i;u++,c+=r/i){l.push(-s,0,c,s,0,c);l.push(c,0,-s,c,0,s);var f=u===i/2?n:o;f.toArray(d,p);p+=3;f.toArray(d,p);p+=3;f.toArray(d,p);p+=3;f.toArray(d,p);p+=3}var m=new Zs;m.setAttribute("position",new zs(l,3));m.setAttribute("color",new zs(d,3));var g=new uu({vertexColors:!0,toneMapped:!1});e=a.call(this,m,g);e.type="GridHelper";return e}return t}(_u),Om=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:10,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:16,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:8,s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:64,l=4<arguments.length&&arguments[4]!==void 0?arguments[4]:4473924,d=5<arguments.length&&arguments[5]!==void 0?arguments[5]:8947848;_classCallCheck(this,t);l=new ao(l);d=new ao(d);for(var u=[],p=[],c=0;c<=n;c++){var m=c/n*(2*Math.PI),g=Math.sin(m)*i,f=Math.cos(m)*i;u.push(0,0,0);u.push(g,0,f);var S=1&c?l:d;p.push(S.r,S.g,S.b);p.push(S.r,S.g,S.b)}for(var T=0;T<=o;T++){for(var h=1&T?l:d,y=i-i/o*T,r=0;r<s;r++){var v=r/s*(2*Math.PI),_=Math.sin(v)*y,x=Math.cos(v)*y;u.push(_,0,x);p.push(h.r,h.g,h.b);v=(r+1)/s*(2*Math.PI);_=Math.sin(v)*y;x=Math.cos(v)*y;u.push(_,0,x);p.push(h.r,h.g,h.b)}}var b=new Zs;b.setAttribute("position",new zs(u,3));b.setAttribute("color",new zs(p,3));var E=new uu({vertexColors:!0,toneMapped:!1});e=a.call(this,b,E);e.type="PolarGridHelper";return e}return t}(_u),zm=new mo,Hm=new mo,Gm=new mo,Vm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e,r,i){var n;_classCallCheck(this,t);n=a.call(this);n.light=e;n.light.updateMatrixWorld();n.matrix=e.matrixWorld;n.matrixAutoUpdate=!1;n.color=i;if(r===void 0)r=1;var o=new Zs;o.setAttribute("position",new zs([-r,r,0,r,r,0,r,-r,0,-r,-r,0,-r,r,0],3));var s=new uu({fog:!1,toneMapped:!1});n.lightPlane=new hu(o,s);n.add(n.lightPlane);o=new Zs;o.setAttribute("position",new zs([0,0,0,0,0,1],3));n.targetLine=new hu(o,s);n.add(n.targetLine);n.update();return n}_createClass(t,[{key:"dispose",value:function dispose(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()}},{key:"update",value:function update(){zm.setFromMatrixPosition(this.light.matrixWorld);Hm.setFromMatrixPosition(this.light.target.matrixWorld);Gm.subVectors(Hm,zm);this.lightPlane.lookAt(Hm);if(this.color!==void 0){this.lightPlane.material.color.set(this.color);this.targetLine.material.color.set(this.color)}else{this.lightPlane.material.color.copy(this.light.color);this.targetLine.material.color.copy(this.light.color)}this.targetLine.lookAt(Hm);this.targetLine.scale.z=Gm.length()}}]);return t}(gs),Wm=new mo,jm=new yl,Xm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var n;_classCallCheck(this,t);var o=new Zs,s=new uu({color:16777215,vertexColors:!0,toneMapped:!1}),l=[],d=[],u={},p=new ao(16755200),c=new ao(16711680),m=new ao(43775),g=new ao(16777215),f=new ao(3355443);r("n1","n2",p);r("n2","n4",p);r("n4","n3",p);r("n3","n1",p);r("f1","f2",p);r("f2","f4",p);r("f4","f3",p);r("f3","f1",p);r("n1","f1",p);r("n2","f2",p);r("n3","f3",p);r("n4","f4",p);r("p","n1",c);r("p","n2",c);r("p","n3",c);r("p","n4",c);r("u1","u2",m);r("u2","u3",m);r("u3","u1",m);r("c","t",g);r("p","c",f);r("cn1","cn2",f);r("cn3","cn4",f);r("cf1","cf2",f);r("cf3","cf4",f);function r(e,t,a){i(e,a);i(t,a)}function i(e,t){l.push(0,0,0);d.push(t.r,t.g,t.b);if(u[e]===void 0){u[e]=[]}u[e].push(l.length/3-1)}o.setAttribute("position",new zs(l,3));o.setAttribute("color",new zs(d,3));n=a.call(this,o,s);n.type="CameraHelper";n.camera=e;if(n.camera.updateProjectionMatrix)n.camera.updateProjectionMatrix();n.matrix=e.matrixWorld;n.matrixAutoUpdate=!1;n.pointMap=u;n.update();return n}_createClass(t,[{key:"update",value:function update(){var e=this.geometry,t=this.pointMap,a=1,r=1;jm.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);ka("c",t,e,jm,0,0,-1);ka("t",t,e,jm,0,0,1);ka("n1",t,e,jm,-a,-r,-1);ka("n2",t,e,jm,a,-r,-1);ka("n3",t,e,jm,-a,r,-1);ka("n4",t,e,jm,a,r,-1);ka("f1",t,e,jm,-a,-r,1);ka("f2",t,e,jm,a,-r,1);ka("f3",t,e,jm,-a,r,1);ka("f4",t,e,jm,a,r,1);ka("u1",t,e,jm,.7*a,1.1*r,-1);ka("u2",t,e,jm,.7*-a,1.1*r,-1);ka("u3",t,e,jm,0,2*r,-1);ka("cf1",t,e,jm,-a,0,1);ka("cf2",t,e,jm,a,0,1);ka("cf3",t,e,jm,0,-r,1);ka("cf4",t,e,jm,0,r,1);ka("cn1",t,e,jm,-a,0,-1);ka("cn2",t,e,jm,a,0,-1);ka("cn3",t,e,jm,0,-r,-1);ka("cn4",t,e,jm,0,r,-1);e.getAttribute("position").needsUpdate=!0}},{key:"dispose",value:function dispose(){this.geometry.dispose();this.material.dispose()}}]);return t}(_u);function ka(e,t,a,r,i,n,o){Wm.set(i,n,o).unproject(r);var s=t[e];if(s!==void 0){for(var d=a.getAttribute("position"),u=0,p=s.length;u<p;u++){d.setXYZ(s[u],Wm.x,Wm.y,Wm.z)}}}var qm=new ho,Ym=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:16776960;_classCallCheck(this,t);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),s=new Zs;s.setIndex(new ks(n,1));s.setAttribute("position",new ks(o,3));r=a.call(this,s,new uu({color:i,toneMapped:!1}));r.object=e;r.type="BoxHelper";r.matrixAutoUpdate=!1;r.update();return r}_createClass(t,[{key:"update",value:function update(e){if(e!==void 0){console.warn("THREE.BoxHelper: .update() has no longer arguments.")}if(this.object!==void 0){qm.setFromObject(this.object)}if(qm.isEmpty())return;var t=qm.min,a=qm.max,r=this.geometry.attributes.position,i=r.array;i[0]=a.x;i[1]=a.y;i[2]=a.z;i[3]=t.x;i[4]=a.y;i[5]=a.z;i[6]=t.x;i[7]=t.y;i[8]=a.z;i[9]=a.x;i[10]=t.y;i[11]=a.z;i[12]=a.x;i[13]=a.y;i[14]=t.z;i[15]=t.x;i[16]=a.y;i[17]=t.z;i[18]=t.x;i[19]=t.y;i[20]=t.z;i[21]=a.x;i[22]=t.y;i[23]=t.z;r.needsUpdate=!0;this.geometry.computeBoundingSphere()}},{key:"setFromObject",value:function setFromObject(e){this.object=e;this.update();return this}},{key:"copy",value:function copy(e){_u.prototype.copy.call(this,e);this.object=e.object;return this}}]);return t}(_u),Zm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:16776960;_classCallCheck(this,t);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Zs;o.setIndex(new ks(n,1));o.setAttribute("position",new zs([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3));r=a.call(this,o,new uu({color:i,toneMapped:!1}));r.box=e;r.type="Box3Helper";r.geometry.computeBoundingSphere();return r}_createClass(t,[{key:"updateMatrixWorld",value:function updateMatrixWorld(e){var a=this.box;if(a.isEmpty())return;a.getCenter(this.position);a.getSize(this.scale);this.scale.multiplyScalar(.5);_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e)}}]);return t}(_u),Jm=function(e){_inherits(t,e);var a=_createSuper(t);function t(e){var r,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:16776960;_classCallCheck(this,t);var o=n,s=new Zs;s.setAttribute("position",new zs([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3));s.computeBoundingSphere();r=a.call(this,s,new uu({color:o,toneMapped:!1}));r.type="PlaneHelper";r.plane=e;r.size=i;var l=new Zs;l.setAttribute("position",new zs([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3));l.computeBoundingSphere();r.add(new ml(l,new ws({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})));return r}_createClass(t,[{key:"updateMatrixWorld",value:function updateMatrixWorld(e){var a=-this.plane.constant;if(1e-8>Math.abs(a))a=1e-8;this.scale.set(.5*this.size,.5*this.size,a);this.children[0].material.side=0>a?Wa:Va;this.lookAt(this.plane.normal);_get(_getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e)}}]);return t}(hu),Km=new mo,Qm,$m,eg=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:new mo(0,0,1),i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new mo(0,0,0),n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:16776960,s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:.2*n,l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:.2*s;_classCallCheck(this,t);e=a.call(this);e.type="ArrowHelper";if(Qm===void 0){Qm=new Zs;Qm.setAttribute("position",new zs([0,0,0,0,1,0],3));$m=new Pu(0,.5,1,5,1);$m.translate(0,-.5,0)}e.position.copy(i);e.line=new hu(Qm,new uu({color:o,toneMapped:!1}));e.line.matrixAutoUpdate=!1;e.add(e.line);e.cone=new ml($m,new ws({color:o,toneMapped:!1}));e.cone.matrixAutoUpdate=!1;e.add(e.cone);e.setDirection(r);e.setLength(n,s,l);return e}_createClass(t,[{key:"setDirection",value:function setDirection(e){if(.99999<e.y){this.quaternion.set(0,0,0,1)}else if(-.99999>e.y){this.quaternion.set(1,0,0,0)}else{Km.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Km,t)}}},{key:"setLength",value:function setLength(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:.2*e,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1);this.line.updateMatrix();this.cone.scale.set(a,t,a);this.cone.position.y=e;this.cone.updateMatrix()}},{key:"setColor",value:function setColor(e){this.line.material.color.set(e);this.cone.material.color.set(e)}},{key:"copy",value:function copy(e){_get(_getPrototypeOf(t.prototype),"copy",this).call(this,e,!1);this.line.copy(e.line);this.cone.copy(e.cone);return this}}]);return t}(gs),tg=function(e){_inherits(t,e);var a=_createSuper(t);function t(){var e,r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;_classCallCheck(this,t);var i=new Zs;i.setAttribute("position",new zs([0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],3));i.setAttribute("color",new zs([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new uu({vertexColors:!0,toneMapped:!1});e=a.call(this,i,n);e.type="AxesHelper";return e}_createClass(t,[{key:"setColors",value:function setColors(e,t,a){var r=new ao,i=this.geometry.attributes.color.array;r.set(e);r.toArray(i,0);r.toArray(i,3);r.set(t);r.toArray(i,6);r.toArray(i,9);r.set(a);r.toArray(i,12);r.toArray(i,15);this.geometry.attributes.color.needsUpdate=!0;return this}},{key:"dispose",value:function dispose(){this.geometry.dispose();this.material.dispose()}}]);return t}(_u),ag=function(){function e(){_classCallCheck(this,e);this.type="ShapePath";this.color=new ao;this.subPaths=[];this.currentPath=null}_createClass(e,[{key:"moveTo",value:function moveTo(e,t){this.currentPath=new ip;this.subPaths.push(this.currentPath);this.currentPath.moveTo(e,t);return this}},{key:"lineTo",value:function lineTo(e,t){this.currentPath.lineTo(e,t);return this}},{key:"quadraticCurveTo",value:function quadraticCurveTo(e,t,a,r){this.currentPath.quadraticCurveTo(e,t,a,r);return this}},{key:"bezierCurveTo",value:function bezierCurveTo(e,t,a,r,i,n){this.currentPath.bezierCurveTo(e,t,a,r,i,n);return this}},{key:"splineThru",value:function splineThru(e){this.currentPath.splineThru(e);return this}},{key:"toShapes",value:function toShapes(e,t){function a(e){for(var t=[],a=0,r=e.length;a<r;a++){var i=e[a],n=new np;n.curves=i.curves;t.push(n)}return t}function r(e,t){for(var a=t.length,r=!1,i=a-1,n=0;n<a;i=n++){var o=t[i],s=t[n],l=s.x-o.x,d=s.y-o.y;if(Math.abs(d)>Number.EPSILON){if(0>d){o=t[n];l=-l;s=t[i];d=-d}if(e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var u=d*(e.x-o.x)-l*(e.y-o.y);if(0==u)return!0;if(0>u)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return r}var i=sp.isClockWise,n=this.subPaths;if(0===n.length)return[];if(!0===t)return a(n);var o,s,d,u=[];if(1===n.length){s=n[0];d=new np;d.curves=s.curves;u.push(d);return u}var p=!i(n[0].getPoints());p=e?!p:p;var c=[],m=[],g=[],f=0,h;m[f]=void 0;g[f]=[];for(var R=0,w=n.length;R<w;R++){s=n[R];h=s.getPoints();o=i(h);o=e?!o:o;if(o){if(!p&&m[f])f++;m[f]={s:new np,p:h};m[f].s.curves=s.curves;if(p)f++;g[f]=[]}else{g[f].push({h:s,p:h[0]})}}if(!m[0])return a(n);if(1<m.length){for(var y=!1,v=[],_=0,x=m.length;_<x;_++){c[_]=[]}for(var l=0,L=m.length,C;l<L;l++){C=g[l];for(var k=0;k<C.length;k++){for(var b=C[k],E=!0,S=0;S<m.length;S++){if(r(b.p,m[S].p)){if(l!==S)v.push({froms:l,tos:S,hole:k});if(E){E=!1;c[S].push(b)}else{y=!0}}}if(E){c[l].push(b)}}}if(0<v.length){if(!y)g=c}}for(var T,M=0,A=m.length;M<A;M++){d=m[M].s;u.push(d);T=g[M];for(var P=0,I=T.length;P<I;P++){d.holes.push(T[P].h)}}return u}}]);return e}(),rg=new Float32Array(1),ig=new Int32Array(rg.buffer),ng=function(){function e(){_classCallCheck(this,e)}_createClass(e,null,[{key:"toHalfFloat",value:function toHalfFloat(t){if(65504<t){console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504.");t=65504}rg[0]=t;var a=ig[0],r=32768&a>>16,i=2047&a>>12,n=255&a>>23;if(103>n)return r;if(142<n){r|=31744;r|=(255==n?0:1)&&8388607&a;return r}if(113>n){i|=2048;r|=(i>>114-n)+(1&i>>113-n);return r}r|=n-112<<10|i>>1;r+=1&i;return r}}]);return e}();Hu.create=function(e,t){console.log("THREE.Curve.create() has been deprecated");e.prototype=Object.create(Hu.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};ip.prototype.fromPoints=function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");return this.setFromPoints(e)};Bm.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Pm.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Zp.prototype.extractUrlBase=function(e){console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.");return Tc.extractUrlBase(e)};Zp.Handlers={add:function add(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function get(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Sm.prototype.center=function(e){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(e)};Sm.prototype.empty=function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()};Sm.prototype.isIntersectionBox=function(e){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)};Sm.prototype.size=function(e){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(e)};ho.prototype.center=function(e){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(e)};ho.prototype.empty=function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()};ho.prototype.isIntersectionBox=function(e){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)};ho.prototype.isIntersectionSphere=function(e){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(e)};ho.prototype.size=function(e){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(e)};Do.prototype.empty=function(){console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty().");return this.isEmpty()};wl.prototype.setFromMatrix=function(e){console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix().");return this.setFromProjectionMatrix(e)};Am.prototype.center=function(e){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(e)};Kn.prototype.flattenToArrayOffset=function(e,t){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(e,t)};Kn.prototype.multiplyVector3=function(e){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)};Kn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Kn.prototype.applyToBufferAttribute=function(e){console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)};Kn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Kn.prototype.getInverse=function(e){console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.");return this.copy(e).invert()};Vo.prototype.extractPosition=function(e){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)};Vo.prototype.flattenToArrayOffset=function(e,t){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(e,t)};Vo.prototype.getPosition=function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return new mo().setFromMatrixColumn(this,3)};Vo.prototype.setRotationFromQuaternion=function(e){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)};Vo.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Vo.prototype.multiplyVector3=function(e){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};Vo.prototype.multiplyVector4=function(e){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};Vo.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Vo.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)};Vo.prototype.crossVector=function(e){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};Vo.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Vo.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Vo.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Vo.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Vo.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Vo.prototype.applyToBufferAttribute=function(e){console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)};Vo.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Vo.prototype.makeFrustum=function(e,t,a,r,i,n){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(e,t,r,a,i,n)};Vo.prototype.getInverse=function(e){console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.");return this.copy(e).invert()};Ml.prototype.isIntersectionLine=function(e){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(e)};co.prototype.multiplyVector3=function(e){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)};co.prototype.inverse=function(){console.warn("THREE.Quaternion: .inverse() has been renamed to invert().");return this.invert()};Go.prototype.isIntersectionBox=function(e){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)};Go.prototype.isIntersectionPlane=function(e){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(e)};Go.prototype.isIntersectionSphere=function(e){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(e)};Ms.prototype.area=function(){console.warn("THREE.Triangle: .area() has been renamed to .getArea().");return this.getArea()};Ms.prototype.barycoordFromPoint=function(e,t){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return this.getBarycoord(e,t)};Ms.prototype.midpoint=function(e){console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint().");return this.getMidpoint(e)};Ms.prototypenormal=function(e){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return this.getNormal(e)};Ms.prototype.plane=function(e){console.warn("THREE.Triangle: .plane() has been renamed to .getPlane().");return this.getPlane(e)};Ms.barycoordFromPoint=function(e,t,a,r,i){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return Ms.getBarycoord(e,t,a,r,i)};Ms.normal=function(e,t,a,r){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return Ms.getNormal(e,t,a,r)};np.prototype.extractAllPoints=function(e){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");return this.extractPoints(e)};np.prototype.extrude=function(e){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new lp(this,e)};np.prototype.makeGeometry=function(e){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new gp(this,e)};Jn.prototype.fromAttribute=function(e,t,a){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,a)};Jn.prototype.distanceToManhattan=function(e){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(e)};Jn.prototype.lengthManhattan=function(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()};mo.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};mo.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};mo.prototype.getPositionFromMatrix=function(e){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)};mo.prototype.getScaleFromMatrix=function(e){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)};mo.prototype.getColumnFromMatrix=function(e,t){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(t,e)};mo.prototype.applyProjection=function(e){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(e)};mo.prototype.fromAttribute=function(e,t,a){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,a)};mo.prototype.distanceToManhattan=function(e){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(e)};mo.prototype.lengthManhattan=function(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()};so.prototype.fromAttribute=function(e,t,a){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,a)};so.prototype.lengthManhattan=function(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()};gs.prototype.getChildByName=function(e){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e)};gs.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};gs.prototype.translate=function(e,t){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)};gs.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};gs.prototype.applyMatrix=function(e){console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(e)};Object.defineProperties(gs.prototype,{eulerOrder:{get:function get(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function set(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=e}},useQuaternion:{get:function get(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function set(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});ml.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(ml.prototype,{drawMode:{get:function get(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode.");return on},set:function set(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Qd.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};vl.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");if(t!==void 0)this.filmGauge=t;this.setFocalLength(e)};Object.defineProperties(ic.prototype,{onlyShadow:{set:function set(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function set(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=e}},shadowCameraLeft:{set:function set(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=e}},shadowCameraRight:{set:function set(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=e}},shadowCameraTop:{set:function set(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=e}},shadowCameraBottom:{set:function set(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=e}},shadowCameraNear:{set:function set(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=e}},shadowCameraFar:{set:function set(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=e}},shadowCameraVisible:{set:function set(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function set(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=e}},shadowDarkness:{set:function set(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function set(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=e}},shadowMapHeight:{set:function set(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=e}}});Object.defineProperties(ks.prototype,{length:{get:function get(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}},dynamic:{get:function get(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");return this.usage===Pn},set:function set(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");this.setUsage(Pn)}}});ks.prototype.setDynamic=function(e){console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(!0===e?Pn:kn);return this};ks.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},ks.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Zs.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(e)};Zs.prototype.addAttribute=function(e,t){console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute().");if(!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");return this.setAttribute(e,new ks(arguments[1],arguments[2]))}if("index"===e){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.");this.setIndex(t);return this}return this.setAttribute(e,t)};Zs.prototype.addDrawCall=function(e,t,a){if(a!==void 0){console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.")}console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(e,t)};Zs.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()};Zs.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};Zs.prototype.removeAttribute=function(e){console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute().");return this.deleteAttribute(e)};Zs.prototype.applyMatrix=function(e){console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(e)};Object.defineProperties(Zs.prototype,{drawcalls:{get:function get(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function get(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Ad.prototype.setDynamic=function(e){console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(!0===e?Pn:kn);return this};Ad.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};lp.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};lp.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};lp.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Md.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};hm.prototype.onUpdate=function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this};Object.defineProperties(Rs.prototype,{wrapAround:{get:function get(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function set(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function get(){console.warn("THREE.Material: .overdraw has been removed.")},set:function set(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function get(){console.warn("THREE.Material: .wrapRGB has been removed.");return new ao}},shading:{get:function get(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function set(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=e===Xa}},stencilMask:{get:function get(){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");return this.stencilFuncMask},set:function set(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");this.stencilFuncMask=e}},vertexTangents:{get:function get(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function set(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(hl.prototype,{derivatives:{get:function get(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function set(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=e}}});Lt.prototype.clearTarget=function(e,t,a,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead.");this.setRenderTarget(e);this.clear(t,a,r)};Lt.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop().");this.setAnimationLoop(e)};Lt.prototype.getCurrentRenderTarget=function(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");return this.getRenderTarget()};Lt.prototype.getMaxAnisotropy=function(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()};Lt.prototype.getPrecision=function(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision};Lt.prototype.resetGLState=function(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");return this.state.reset()};Lt.prototype.supportsFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")};Lt.prototype.supportsHalfFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")};Lt.prototype.supportsStandardDerivatives=function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")};Lt.prototype.supportsCompressedTextureS3TC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")};Lt.prototype.supportsCompressedTexturePVRTC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")};Lt.prototype.supportsBlendMinMax=function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")};Lt.prototype.supportsVertexTextures=function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures};Lt.prototype.supportsInstancedArrays=function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")};Lt.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(e)};Lt.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Lt.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Lt.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Lt.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Lt.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Lt.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Lt.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Lt.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Lt.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Lt.prototype.getActiveMipMapLevel=function(){console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel().");return this.getActiveMipmapLevel()};Object.defineProperties(Lt.prototype,{shadowMapEnabled:{get:function get(){return this.shadowMap.enabled},set:function set(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=e}},shadowMapType:{get:function get(){return this.shadowMap.type},set:function set(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=e}},shadowMapCullFace:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function get(){console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead.");return this.getContext()}},vr:{get:function get(){console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr");return this.xr}},gammaInput:{get:function get(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.");return!1},set:function set(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function get(){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");return!1},set:function set(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");this.outputEncoding=!0===e?un:dn}},toneMappingWhitePoint:{get:function get(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.");return 1},set:function set(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function get(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.");return 2},set:function set(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});Object.defineProperties(St.prototype,{cullFace:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(lo.prototype,{wrapS:{get:function get(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function set(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=e}},wrapT:{get:function get(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function set(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=e}},magFilter:{get:function get(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function set(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=e}},minFilter:{get:function get(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function set(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=e}},anisotropy:{get:function get(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function set(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=e}},offset:{get:function get(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function set(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=e}},repeat:{get:function get(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function set(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=e}},format:{get:function get(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function set(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=e}},type:{get:function get(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function set(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=e}},generateMipmaps:{get:function get(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function set(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=e}}});qc.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,a=new Dc;a.load(e,function(e){t.setBuffer(e)});return this};$c.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};_l.prototype.updateCubeMap=function(e,t){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(e,t)};_l.prototype.clear=function(e,t,a,r){console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear().");return this.renderTarget.clear(e,t,a,r)};io.crossOrigin=void 0;io.loadTexture=function(e,t,a,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new rc;i.setCrossOrigin(this.crossOrigin);var n=i.load(e,a,void 0,r);if(t)n.mapping=t;return n};io.loadTextureCube=function(e,t,a,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new tc;i.setCrossOrigin(this.crossOrigin);var n=i.load(e,a,void 0,r);if(t)n.mapping=t;return n};io.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};io.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};if("undefined"!=typeof __THREE_DEVTOOLS__){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Pa}}))}if("undefined"!=typeof window){if(window.__THREE__){console.warn("WARNING: Multiple instances of Three.js being imported.")}else{window.__THREE__=Pa}}e.ACESFilmicToneMapping=kr;e.AddEquation=er;e.AddOperation=Ar;e.AdditiveAnimationBlendMode=nn;e.AdditiveBlending=Ja;e.AlphaFormat=ui;e.AlwaysDepth=yr;e.AlwaysStencilFunc=Cn;e.AmbientLight=_c;e.AmbientLightProbe=Uc;e.AnimationClip=jp;e.AnimationLoader=Qp;e.AnimationMixer=fm;e.AnimationObjectGroup=mm;e.AnimationUtils=Pp;e.ArcCurve=Vu;e.ArrayCamera=hd;e.ArrowHelper=eg;e.Audio=qc;e.AudioAnalyser=$c;e.AudioContext=Ic;e.AudioListener=Xc;e.AudioLoader=Dc;e.AxesHelper=tg;e.AxisHelper=function(e){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper.");return new tg(e)};e.BackSide=Wa;e.BasicDepthPacking=pn;e.BasicShadowMap=Oa;e.BinaryTextureLoader=function(e){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new ac(e)};e.Bone=$d;e.BooleanKeyframeTrack=Bp;e.BoundingBoxHelper=function(e,t){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new Ym(e,t)};e.Box2=Sm;e.Box3=ho;e.Box3Helper=Zm;e.BoxBufferGeometry=gl;e.BoxGeometry=gl;e.BoxHelper=Ym;e.BufferAttribute=ks;e.BufferGeometry=Zs;e.BufferGeometryLoader=Ac;e.ByteType=ei;e.Cache=Xp;e.Camera=yl;e.CameraHelper=Xm;e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")};e.CanvasTexture=Cu;e.CatmullRomCurve3=Yu;e.CineonToneMapping=Cr;e.CircleBufferGeometry=ku;e.CircleGeometry=ku;e.ClampToEdgeWrapping=Hr;e.Clock=Hc;e.Color=ao;e.ColorKeyframeTrack=Op;e.CompressedTexture=Lu;e.CompressedTextureLoader=$p;e.ConeBufferGeometry=Iu;e.ConeGeometry=Iu;e.CubeCamera=_l;e.CubeReflectionMapping=Dr;e.CubeRefractionMapping=Nr;e.CubeTexture=xl;e.CubeTextureLoader=tc;e.CubeUVReflectionMapping=Br;e.CubeUVRefractionMapping=Or;e.CubicBezierCurve=Zu;e.CubicBezierCurve3=Ju;e.CubicInterpolant=Dp;e.CullFaceBack=Ua;e.CullFaceFront=Fa;e.CullFaceFrontBack=Ba;e.CullFaceNone=Na;e.Curve=Hu;e.CurvePath=rp;e.CustomBlending=$a;e.CustomToneMapping=Pr;e.CylinderBufferGeometry=Pu;e.CylinderGeometry=Pu;e.Cylindrical=bm;e.DataTexture=eu;e.DataTexture2DArray=Kl;e.DataTexture3D=Ql;e.DataTextureLoader=ac;e.DataUtils=ng;e.DecrementStencilOp=_n;e.DecrementWrapStencilOp=bn;e.DefaultLoadingManager=Yp;e.DepthFormat=fi;e.DepthStencilFormat=hi;e.DepthTexture=xd;e.DirectionalLight=vc;e.DirectionalLightHelper=Vm;e.DiscreteInterpolant=Up;e.DodecahedronBufferGeometry=Nu;e.DodecahedronGeometry=Nu;e.DoubleSide=ja;e.DstAlphaFactor=pr;e.DstColorFactor=mr;e.DynamicBufferAttribute=function(e,t){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead.");return new ks(e,t).setUsage(Pn)};e.DynamicCopyUsage=Bn;e.DynamicDrawUsage=Pn;e.DynamicReadUsage=Nn;e.EdgesGeometry=zu;e.EdgesHelper=function(e,t){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new _u(new zu(e.geometry),new uu({color:t!==void 0?t:16777215}))};e.EllipseCurve=Gu;e.EqualDepth=xr;e.EqualStencilFunc=Mn;e.EquirectangularReflectionMapping=Ur;e.EquirectangularRefractionMapping=Fr;e.Euler=$o;e.EventDispatcher=Vn;e.ExtrudeBufferGeometry=lp;e.ExtrudeGeometry=lp;e.FaceColors=1;e.FileLoader=Kp;e.FlatShading=Xa;e.Float16BufferAttribute=Os;e.Float32Attribute=function(e,t){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new zs(e,t)};e.Float32BufferAttribute=zs;e.Float64Attribute=function(e,t){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new Hs(e,t)};e.Float64BufferAttribute=Hs;e.FloatType=ni;e.Fog=Td;e.FogExp2=Sd;e.Font=function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")};e.FontLoader=function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")};e.FramebufferTexture=wu;e.FrontSide=Va;e.Frustum=wl;e.GLBufferAttribute=vm;e.GLSL1=zn;e.GLSL3=Hn;e.GreaterDepth=Er;e.GreaterEqualDepth=br;e.GreaterEqualStencilFunc=Ln;e.GreaterStencilFunc=Rn;e.GridHelper=Bm;e.Group=yd;e.HalfFloatType=oi;e.HemisphereLight=nc;e.HemisphereLightHelper=Fm;e.HemisphereLightProbe=Nc;e.IcosahedronBufferGeometry=up;e.IcosahedronGeometry=up;e.ImageBitmapLoader=kc;e.ImageLoader=ec;e.ImageUtils=io;e.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")};e.IncrementStencilOp=vn;e.IncrementWrapStencilOp=xn;e.InstancedBufferAttribute=iu;e.InstancedBufferGeometry=Mc;e.InstancedInterleavedBuffer=ym;e.InstancedMesh=du;e.Int16Attribute=function(e,t){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new Ns(e,t)};e.Int16BufferAttribute=Ns;e.Int32Attribute=function(e,t){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new Fs(e,t)};e.Int32BufferAttribute=Fs;e.Int8Attribute=function(e,t){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new Ps(e,t)};e.Int8BufferAttribute=Ps;e.IntType=ri;e.InterleavedBuffer=Ad;e.InterleavedBufferAttribute=wd;e.Interpolant=Ip;e.InterpolateDiscrete=Ki;e.InterpolateLinear=Qi;e.InterpolateSmooth=$i;e.InvertStencilOp=En;e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")};e.KeepStencilOp=hn;e.KeyframeTrack=Fp;e.LOD=Xd;e.LatheBufferGeometry=pp;e.LatheGeometry=pp;e.Layers=es;e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")};e.LessDepth=vr;e.LessEqualDepth=_r;e.LessEqualStencilFunc=An;e.LessStencilFunc=Tn;e.Light=ic;e.LightProbe=Ec;e.Line=hu;e.Line3=Am;e.LineBasicMaterial=uu;e.LineCurve=Ku;e.LineCurve3=Qu;e.LineDashedMaterial=Cp;e.LineLoop=xu;e.LinePieces=1;e.LineSegments=_u;e.LineStrip=0;e.LinearEncoding=dn;e.LinearFilter=Yr;e.LinearInterpolant=Np;e.LinearMipMapLinearFilter=Qr;e.LinearMipMapNearestFilter=Jr;e.LinearMipmapLinearFilter=Kr;e.LinearMipmapNearestFilter=Zr;e.LinearToneMapping=wr;e.Loader=Zp;e.LoaderUtils=Tc;e.LoadingManager=qp;e.LoopOnce=Yi;e.LoopPingPong=Ji;e.LoopRepeat=Zi;e.LuminanceAlphaFormat=gi;e.LuminanceFormat=mi;e.MOUSE=Ia;e.Material=Rs;e.MaterialLoader=Sc;e.Math=Zn;e.MathUtils=Zn;e.Matrix3=Kn;e.Matrix4=Vo;e.MaxEquation=ir;e.Mesh=ml;e.MeshBasicMaterial=ws;e.MeshDepthMaterial=gd;e.MeshDistanceMaterial=fd;e.MeshFaceMaterial=function(e){console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead.");return e};e.MeshLambertMaterial=wp;e.MeshMatcapMaterial=Lp;e.MeshNormalMaterial=Rp;e.MeshPhongMaterial=Mp;e.MeshPhysicalMaterial=Tp;e.MeshStandardMaterial=Sp;e.MeshToonMaterial=Ap;e.MinEquation=rr;e.MirroredRepeatWrapping=Gr;e.MixOperation=Mr;e.MultiMaterial=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];console.warn("THREE.MultiMaterial has been removed. Use an Array instead.");e.isMultiMaterial=!0;e.materials=e;e.clone=function(){return e.slice()};return e};e.MultiplyBlending=Qa;e.MultiplyOperation=Tr;e.NearestFilter=Vr;e.NearestMipMapLinearFilter=qr;e.NearestMipMapNearestFilter=jr;e.NearestMipmapLinearFilter=Xr;e.NearestMipmapNearestFilter=Wr;e.NeverDepth=hr;e.NeverStencilFunc=Sn;e.NoBlending=Ya;e.NoColors=0;e.NoToneMapping=Rr;e.NormalAnimationBlendMode=rn;e.NormalBlending=Za;e.NotEqualDepth=Sr;e.NotEqualStencilFunc=wn;e.NumberKeyframeTrack=zp;e.Object3D=gs;e.ObjectLoader=Rc;e.ObjectSpaceNormalMap=gn;e.OctahedronBufferGeometry=cp;e.OctahedronGeometry=cp;e.OneFactor=or;e.OneMinusDstAlphaFactor=cr;e.OneMinusDstColorFactor=gr;e.OneMinusSrcAlphaFactor=ur;e.OneMinusSrcColorFactor=lr;e.OrthographicCamera=Il;e.PCFShadowMap=za;e.PCFSoftShadowMap=Ha;e.PMREMGenerator=Jl;e.ParametricGeometry=function(){console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js");return new Zs};e.Particle=function(e){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new Vd(e)};e.ParticleBasicMaterial=function(e){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new bu(e)};e.ParticleSystem=function(e,t){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Au(e,t)};e.ParticleSystemMaterial=function(e){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new bu(e)};e.Path=ip;e.PerspectiveCamera=vl;e.Plane=Ml;e.PlaneBufferGeometry=Ll;e.PlaneGeometry=Ll;e.PlaneHelper=Jm;e.PointCloud=function(e,t){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Au(e,t)};e.PointCloudMaterial=function(e){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new bu(e)};e.PointLight=hc;e.PointLightHelper=Im;e.Points=Au;e.PointsMaterial=bu;e.PolarGridHelper=Om;e.PolyhedronBufferGeometry=Du;e.PolyhedronGeometry=Du;e.PositionalAudio=Qc;e.PropertyBinding=cm;e.PropertyMixer=em;e.QuadraticBezierCurve=$u;e.QuadraticBezierCurve3=ep;e.Quaternion=co;e.QuaternionKeyframeTrack=Gp;e.QuaternionLinearInterpolant=Hp;e.REVISION=Pa;e.RGBADepthPacking=cn;e.RGBAFormat=ci;e.RGBAIntegerFormat=bi;e.RGBA_ASTC_10x10_Format=Wi;e.RGBA_ASTC_10x5_Format=Hi;e.RGBA_ASTC_10x6_Format=Gi;e.RGBA_ASTC_10x8_Format=Vi;e.RGBA_ASTC_12x10_Format=ji;e.RGBA_ASTC_12x12_Format=Xi;e.RGBA_ASTC_4x4_Format=Ii;e.RGBA_ASTC_5x4_Format=Di;e.RGBA_ASTC_5x5_Format=Ni;e.RGBA_ASTC_6x5_Format=Ui;e.RGBA_ASTC_6x6_Format=Fi;e.RGBA_ASTC_8x5_Format=Bi;e.RGBA_ASTC_8x6_Format=Oi;e.RGBA_ASTC_8x8_Format=zi;e.RGBA_BPTC_Format=qi;e.RGBA_ETC2_EAC_Format=Pi;e.RGBA_PVRTC_2BPPV1_Format=Li;e.RGBA_PVRTC_4BPPV1_Format=wi;e.RGBA_S3TC_DXT1_Format=Si;e.RGBA_S3TC_DXT3_Format=Ti;e.RGBA_S3TC_DXT5_Format=Mi;e.RGBFormat=pi;e.RGB_ETC1_Format=Ci;e.RGB_ETC2_Format=ki;e.RGB_PVRTC_2BPPV1_Format=Ri;e.RGB_PVRTC_4BPPV1_Format=Ai;e.RGB_S3TC_DXT1_Format=Ei;e.RGFormat=_i;e.RGIntegerFormat=xi;e.RawShaderMaterial=Dl;e.Ray=Go;e.Raycaster=_m;e.RectAreaLight=xc;e.RedFormat=yi;e.RedIntegerFormat=vi;e.ReinhardToneMapping=Lr;e.RepeatWrapping=zr;e.ReplaceStencilOp=yn;e.ReverseSubtractEquation=ar;e.RingBufferGeometry=mp;e.RingGeometry=mp;e.Scene=Md;e.SceneUtils={createMultiMaterialObject:function createMultiMaterialObject(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function detach(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function attach(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};e.ShaderChunk=Cl;e.ShaderLib=Pl;e.ShaderMaterial=hl;e.ShadowMaterial=Ep;e.Shape=np;e.ShapeBufferGeometry=gp;e.ShapeGeometry=gp;e.ShapePath=ag;e.ShapeUtils=sp;e.ShortType=ti;e.Skeleton=ru;e.SkeletonHelper=Pm;e.SkinnedMesh=Qd;e.SmoothShading=qa;e.Sphere=Do;e.SphereBufferGeometry=fp;e.SphereGeometry=fp;e.Spherical=xm;e.SphericalHarmonics3=bc;e.SplineCurve=tp;e.SpotLight=pc;e.SpotLightHelper=wm;e.Sprite=Vd;e.SpriteMaterial=Ld;e.SrcAlphaFactor=dr;e.SrcAlphaSaturateFactor=fr;e.SrcColorFactor=sr;e.StaticCopyUsage=Fn;e.StaticDrawUsage=kn;e.StaticReadUsage=Dn;e.StereoCamera=zc;e.StreamCopyUsage=On;e.StreamDrawUsage=In;e.StreamReadUsage=Un;e.StringKeyframeTrack=Vp;e.SubtractEquation=tr;e.SubtractiveBlending=Ka;e.TOUCH=Da;e.TangentSpaceNormalMap=mn;e.TetrahedronBufferGeometry=hp;e.TetrahedronGeometry=hp;e.TextGeometry=function(){console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js");return new Zs};e.Texture=oo;e.TextureLoader=rc;e.TorusBufferGeometry=yp;e.TorusGeometry=yp;e.TorusKnotBufferGeometry=vp;e.TorusKnotGeometry=vp;e.Triangle=Ms;e.TriangleFanDrawMode=ln;e.TriangleStripDrawMode=sn;e.TrianglesDrawMode=on;e.TubeBufferGeometry=_p;e.TubeGeometry=_p;e.UVMapping=Ir;e.Uint16Attribute=function(e,t){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new Us(e,t)};e.Uint16BufferAttribute=Us;e.Uint32Attribute=function(e,t){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new Bs(e,t)};e.Uint32BufferAttribute=Bs;e.Uint8Attribute=function(e,t){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new Is(e,t)};e.Uint8BufferAttribute=Is;e.Uint8ClampedAttribute=function(e,t){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new Ds(e,t)};e.Uint8ClampedBufferAttribute=Ds;e.Uniform=hm;e.UniformsLib=kl;e.UniformsUtils=fl;e.UnsignedByteType=$r;e.UnsignedInt248Type=di;e.UnsignedIntType=ii;e.UnsignedShort4444Type=si;e.UnsignedShort5551Type=li;e.UnsignedShortType=ai;e.VSMShadowMap=Ga;e.Vector2=Jn;e.Vector3=mo;e.Vector4=so;e.VectorKeyframeTrack=Wp;e.Vertex=function(e,t,a){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new mo(e,t,a)};e.VertexColors=2;e.VideoTexture=Ru;e.WebGL1Renderer=Ed;e.WebGLCubeRenderTarget=bl;e.WebGLMultipleRenderTargets=uo;e.WebGLMultisampleRenderTarget=po;e.WebGLRenderTarget=lo;e.WebGLRenderTargetCube=function(e,t,a){console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options ).");return new bl(e,a)};e.WebGLRenderer=Lt;e.WebGLUtils=At;e.WireframeGeometry=xp;e.WireframeHelper=function(e,t){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new _u(new xp(e.geometry),new uu({color:t!==void 0?t:16777215}))};e.WrapAroundEnding=an;e.XHRLoader=function(e){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new Kp(e)};e.ZeroCurvatureEnding=en;e.ZeroFactor=nr;e.ZeroSlopeEnding=tn;e.ZeroStencilOp=fn;e._SRGBAFormat=Gn;e.sRGBEncoding=un;Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=three.min.js.map
