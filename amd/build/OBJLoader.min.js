define ("mod_wavefront/OBJLoader",["exports","mod_wavefront/three"],function(a,b){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.OBJLoader=void 0;function c(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){c=function(a){return typeof a}}else{c=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return c(a)}function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function e(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function f(a,b,c){if(b)e(a.prototype,b);if(c)e(a,c);return a}function g(a,b){if("function"!=typeof b&&null!==b){throw new TypeError("Super expression must either be null or a function")}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}});if(b)h(a,b)}function h(a,b){h=Object.setPrototypeOf||function(a,b){a.__proto__=b;return a};return h(a,b)}function i(a){return function(){var b=m(a),c;if(l()){var d=m(this).constructor;c=Reflect.construct(b,arguments,d)}else{c=b.apply(this,arguments)}return j(this,c)}}function j(a,b){if(b&&("object"===c(b)||"function"==typeof b)){return b}return k(a)}function k(a){if(void 0===a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return a}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return!0}catch(a){return!1}}function m(a){m=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)};return m(a)}var o=new b.Vector3,p=new b.Vector3,q=new b.Vector3,r=new b.Vector3,s=new b.Vector3;function n(){var a={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function startObject(a,b){if(this.object&&!1===this.object.fromDeclaration){this.object.name=a;this.object.fromDeclaration=!1!==b;return}var c=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize){this.object._finalize(!0)}this.object={name:a||"",fromDeclaration:!1!==b,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function startMaterial(a,b){var c=this._finalize(!1);if(c&&(c.inherited||0>=c.groupCount)){this.materials.splice(c.index,1)}var d={index:this.materials.length,name:a||"",mtllib:Array.isArray(b)&&0<b.length?b[b.length-1]:"",smooth:c!==void 0?c.smooth:this.smooth,groupStart:c!==void 0?c.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function clone(a){var b={index:"number"==typeof a?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};b.clone=this.clone.bind(b);return b}};this.materials.push(d);return d},currentMaterial:function currentMaterial(){if(0<this.materials.length){return this.materials[this.materials.length-1]}},_finalize:function _finalize(a){var b=this.currentMaterial();if(b&&-1===b.groupEnd){b.groupEnd=this.geometry.vertices.length/3;b.groupCount=b.groupEnd-b.groupStart;b.inherited=!1}if(a&&1<this.materials.length){for(var c=this.materials.length-1;0<=c;c--){if(0>=this.materials[c].groupCount){this.materials.splice(c,1)}}}if(a&&0===this.materials.length){this.materials.push({name:"",smooth:this.smooth})}return b}};if(c&&c.name&&"function"==typeof c.clone){var d=c.clone(0);d.inherited=!0;this.object.materials.push(d)}this.objects.push(this.object)},finalize:function finalize(){if(this.object&&"function"==typeof this.object._finalize){this.object._finalize(!0)}},parseVertexIndex:function parseVertexIndex(a,b){var c=parseInt(a,10);return 3*(0<=c?c-1:c+b/3)},parseNormalIndex:function parseNormalIndex(a,b){var c=parseInt(a,10);return 3*(0<=c?c-1:c+b/3)},parseUVIndex:function parseUVIndex(a,b){var c=parseInt(a,10);return 2*(0<=c?c-1:c+b/2)},addVertex:function addVertex(d,a,b){var c=this.vertices,e=this.object.geometry.vertices;e.push(c[d+0],c[d+1],c[d+2]);e.push(c[a+0],c[a+1],c[a+2]);e.push(c[b+0],c[b+1],c[b+2])},addVertexPoint:function addVertexPoint(b){var a=this.vertices,c=this.object.geometry.vertices;c.push(a[b+0],a[b+1],a[b+2])},addVertexLine:function addVertexLine(b){var a=this.vertices,c=this.object.geometry.vertices;c.push(a[b+0],a[b+1],a[b+2])},addNormal:function addNormal(d,a,b){var c=this.normals,e=this.object.geometry.normals;e.push(c[d+0],c[d+1],c[d+2]);e.push(c[a+0],c[a+1],c[a+2]);e.push(c[b+0],c[b+1],c[b+2])},addFaceNormal:function addFaceNormal(d,a,b){var c=this.vertices,e=this.object.geometry.normals;o.fromArray(c,d);p.fromArray(c,a);q.fromArray(c,b);s.subVectors(q,p);r.subVectors(o,p);s.cross(r);s.normalize();e.push(s.x,s.y,s.z);e.push(s.x,s.y,s.z);e.push(s.x,s.y,s.z)},addColor:function addColor(d,a,b){var c=this.colors,e=this.object.geometry.colors;if(c[d]!==void 0)e.push(c[d+0],c[d+1],c[d+2]);if(c[a]!==void 0)e.push(c[a+0],c[a+1],c[a+2]);if(c[b]!==void 0)e.push(c[b+0],c[b+1],c[b+2])},addUV:function addUV(d,a,b){var c=this.uvs,e=this.object.geometry.uvs;e.push(c[d+0],c[d+1]);e.push(c[a+0],c[a+1]);e.push(c[b+0],c[b+1])},addDefaultUV:function addDefaultUV(){var a=this.object.geometry.uvs;a.push(0,0);a.push(0,0);a.push(0,0)},addUVLine:function addUVLine(b){var a=this.uvs,c=this.object.geometry.uvs;c.push(a[b+0],a[b+1])},addFace:function addFace(d,a,b,c,e,f,g,h,i){var j=this.vertices.length,k=this.parseVertexIndex(d,j),l=this.parseVertexIndex(a,j),m=this.parseVertexIndex(b,j);this.addVertex(k,l,m);this.addColor(k,l,m);if(g!==void 0&&""!==g){var n=this.normals.length;k=this.parseNormalIndex(g,n);l=this.parseNormalIndex(h,n);m=this.parseNormalIndex(i,n);this.addNormal(k,l,m)}else{this.addFaceNormal(k,l,m)}if(c!==void 0&&""!==c){var o=this.uvs.length;k=this.parseUVIndex(c,o);l=this.parseUVIndex(e,o);m=this.parseUVIndex(f,o);this.addUV(k,l,m);this.object.geometry.hasUVIndices=!0}else{this.addDefaultUV()}},addPointGeometry:function addPointGeometry(a){this.object.geometry.type="Points";for(var b=this.vertices.length,c=0,d=a.length,e;c<d;c++){e=this.parseVertexIndex(a[c],b);this.addVertexPoint(e);this.addColor(e)}},addLineGeometry:function addLineGeometry(a,b){this.object.geometry.type="Line";for(var c=this.vertices.length,d=this.uvs.length,e=0,f=a.length;e<f;e++){this.addVertexLine(this.parseVertexIndex(a[e],c))}for(var g=0,h=b.length;g<h;g++){this.addUVLine(this.parseUVIndex(b[g],d))}}};a.startObject("",!1);return a}var t=function(a){g(c,a);var e=i(c);function c(a){var b;d(this,c);b=e.call(this,a);b.materials=null;return b}f(c,[{key:"load",value:function load(a,c,d,f){var g=this,h=new b.FileLoader(this.manager);h.setPath(this.path);h.setRequestHeader(this.requestHeader);h.setWithCredentials(this.withCredentials);h.load(a,function(b){try{c(g.parse(b))}catch(b){if(f){f(b)}else{console.error(b)}g.manager.itemError(a)}},d,f)}},{key:"setMaterials",value:function setMaterials(a){this.materials=a;return this}},{key:"parse",value:function parse(a){var c=new n;if(-1!==a.indexOf("\r\n")){a=a.replace(/\r\n/g,"\n")}if(-1!==a.indexOf("\\\n")){a=a.replace(/\\\n/g,"")}for(var d=a.split("\n"),e="",f="",g=0,h=[],k="function"==typeof"".trimLeft,m=0,o=d.length;m<o;m++){e=d[m];e=k?e.trimLeft():e.trim();g=e.length;if(0===g)continue;f=e.charAt(0);if("#"===f)continue;if("v"===f){var U=e.split(/\s+/);switch(U[0]){case"v":c.vertices.push(parseFloat(U[1]),parseFloat(U[2]),parseFloat(U[3]));if(7<=U.length){c.colors.push(parseFloat(U[4]),parseFloat(U[5]),parseFloat(U[6]))}else{c.colors.push(void 0,void 0,void 0)}break;case"vn":c.normals.push(parseFloat(U[1]),parseFloat(U[2]),parseFloat(U[3]));break;case"vt":c.uvs.push(parseFloat(U[1]),parseFloat(U[2]));break;}}else if("f"===f){for(var l=e.substr(1).trim(),p=l.split(/\s+/),q=[],r=0,s=p.length,t;r<s;r++){t=p[r];if(0<t.length){var V=t.split("/");q.push(V)}}for(var u=q[0],v=1,w=q.length-1;v<w;v++){var x=q[v],y=q[v+1];c.addFace(u[0],x[0],y[0],u[1],x[1],y[1],u[2],x[2],y[2])}}else if("l"===f){var z=e.substring(1).trim().split(" "),A=[],B=[];if(-1===e.indexOf("/")){A=z}else{for(var W=0,X=z.length,Y;W<X;W++){Y=z[W].split("/");if(""!==Y[0])A.push(Y[0]);if(""!==Y[1])B.push(Y[1])}}c.addLineGeometry(A,B)}else if("p"===f){var C=e.substr(1).trim(),D=C.split(" ");c.addPointGeometry(D)}else if(null!==(h=/^[og]\s*(.+)?/.exec(e))){var Z=(" "+h[0].substr(1).trim()).substr(1);c.startObject(Z)}else if(/^usemtl /.test(e)){c.object.startMaterial(e.substring(7).trim(),c.materialLibraries)}else if(/^mtllib /.test(e)){c.materialLibraries.push(e.substring(7).trim())}else if(/^usemap /.test(e)){console.warn("THREE.OBJLoader: Rendering identifier \"usemap\" not supported. Textures must be defined in MTL files.")}else if("s"===f){h=e.split(" ");if(1<h.length){var $=h[1].trim().toLowerCase();c.object.smooth="0"!==$&&"off"!==$}else{c.object.smooth=!0}var _=c.object.currentMaterial();if(_)_.smooth=c.object.smooth}else{if("\0"===e)continue;console.warn("THREE.OBJLoader: Unexpected line: \""+e+"\"")}}c.finalize();var E=new b.Group;E.materialLibraries=[].concat(c.materialLibraries);var F=!(1===c.objects.length&&0===c.objects[0].geometry.vertices.length);if(!0==F){for(var aa=0,ba=c.objects.length;aa<ba;aa++){var G=c.objects[aa],H=G.geometry,I=G.materials,J="Line"===H.type,K="Points"===H.type,L=!1;if(0===H.vertices.length)continue;var ca=new b.BufferGeometry;ca.setAttribute("position",new b.Float32BufferAttribute(H.vertices,3));if(0<H.normals.length){ca.setAttribute("normal",new b.Float32BufferAttribute(H.normals,3))}if(0<H.colors.length){L=!0;ca.setAttribute("color",new b.Float32BufferAttribute(H.colors,3))}if(!0===H.hasUVIndices){ca.setAttribute("uv",new b.Float32BufferAttribute(H.uvs,2))}for(var M=[],N=0,O=I.length;N<O;N++){var P=I[N],Q=P.name+"_"+P.smooth+"_"+L,R=c.materials[Q];if(null!==this.materials){R=this.materials.create(P.name);if(J&&R&&!(R instanceof b.LineBasicMaterial)){var da=new b.LineBasicMaterial;b.Material.prototype.copy.call(da,R);da.color.copy(R.color);R=da}else if(K&&R&&!(R instanceof b.PointsMaterial)){var ea=new b.PointsMaterial({size:10,sizeAttenuation:!1});b.Material.prototype.copy.call(ea,R);ea.color.copy(R.color);ea.map=R.map;R=ea}}if(R===void 0){if(J){R=new b.LineBasicMaterial}else if(K){R=new b.PointsMaterial({size:1,sizeAttenuation:!1})}else{R=new b.MeshPhongMaterial}R.name=P.name;R.flatShading=P.smooth?!1:!0;R.vertexColors=L;c.materials[Q]=R}M.push(R)}var fa=void 0;if(1<M.length){for(var ga=0,ha=I.length,ia;ga<ha;ga++){ia=I[ga];ca.addGroup(ia.groupStart,ia.groupCount,ga)}if(J){fa=new b.LineSegments(ca,M)}else if(K){fa=new b.Points(ca,M)}else{fa=new b.Mesh(ca,M)}}else{if(J){fa=new b.LineSegments(ca,M[0])}else if(K){fa=new b.Points(ca,M[0])}else{fa=new b.Mesh(ca,M[0])}}fa.name=G.name;E.add(fa)}}else{if(0<c.vertices.length){var S=new b.PointsMaterial({size:1,sizeAttenuation:!1}),T=new b.BufferGeometry;T.setAttribute("position",new b.Float32BufferAttribute(c.vertices,3));if(0<c.colors.length&&c.colors[0]!==void 0){T.setAttribute("color",new b.Float32BufferAttribute(c.colors,3));S.vertexColors=!0}var ja=new b.Points(T,S);E.add(ja)}}return E}}]);return c}(b.Loader);a.OBJLoader=t});
//# sourceMappingURL=OBJLoader.min.js.map
